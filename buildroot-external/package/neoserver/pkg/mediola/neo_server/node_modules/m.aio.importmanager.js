var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var h=b.length,d=0;d<h;d++){var e=b[d];if(a.call(c,e,d,b))return{i:d,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,a,c,h){if(a){c=$jscomp.global;b=b.split(".");for(h=0;h<b.length-1;h++){var d=b[h];d in c||(c[d]={});c=c[d]}b=b[b.length-1];h=c[b];a=a(h);a!=h&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var m=m||{};m.aio=m.aio||{};m.aio.importmanager=m.aio.importmanager||{};
m.aio.importmanager.Manager=function(){var b=function(){};b.prototype.importSteckerPRO=function(a,c,h,d){var e=function(a,c){var d={rooms:[],devices:[],gateways:[]};try{var f,e,h=$($.parseXML(c)),g=h.find("gateway");if(g&&0<g.length)for(f=0;f<g.length;f++){var b=g[f];if(b){var n=$(b).find("transmitter");if(n&&0<n.length&&n[0]){var k=$(n[0]),l=k.attr("ip"),y=k.attr("mode");l&&y&&(y=parseInt(y),d.gateways.push({index:d.gateways.length+1,name:("hc"==a?"HC":a)+" Gateway",info:{sys:"hcgw",ip:l,port:49880,
vendor:a,mode:1==y?1:0}}))}}}0==d.gateways.length&&d.gateways.push({index:d.gateways.length+1,name:("hc"==a?"HC":a)+" Gateway",info:{sys:"hcgw",ip:"0.0.0.0",port:49880,vendor:a,mode:1}});var z=h.find("location");if(z&&0<z.length)for(f=0;f<z.length;f++){var E=z[f];if(E){var w=$(E);if(e=w.attr("id")){var A={index:d.rooms.length+1,name:e};d.rooms.push(A);var x=w.find("device");if(x&&0<x.length)for(a=0;a<x.length;a++){var F=x[a];if(F){var B=$(F);e=B.attr("id");var C=B.attr("type"),D=B.attr("address"),
q=B.attr("data");if(e&&C&&D&&q){switch(C){case "BS":var t="brennenstuhl";var p="RC 3600";"heater"==q&&(p="FHT 433");break;case "ELRO":t="brennenstuhl";p="RCS 1000N";break;case "DY":t="rohrmotor24";p="RMF Motor";break;case "DY2":t="rohrmotor24";p="RMF-RS1 (AP/UP)";break;case "IT":t="intertechno",9<=D.length?(p="IT-1500 ","shutter"==q?p="ITL-1000":"dimmer"==q&&(p="ITLR-300")):(p="CMR-300","shutter"==q&&(p="CMR-500"))}d.devices.push({index:d.devices.length+1,name:e,room:A.index,info:{sys:"hcgw",gateway:1,
data:q,type:"IT"==C&&9<=D.length?"IT2":C,manufacture:t,model:p,address:D}})}}}}}}}catch(H){console.error(H)}return d},b=function(a,c){var d={groups:[]};try{var e,f=$($.parseXML(a)).find("location");if(f&&0<f.length)for(e=0;e<f.length;e++){var h=f[e];if(h){var g=$(h),b=g.attr("id"),n;if(n=b)a:{for(a=0;a<c.length;a++)if(c[a]===b){n=!0;break a}n=!1}if(n){var k={classid:"group",index:d.groups.length+1,name:b,macros:[]};d.groups.push(k);var l=g.find("macro");if(l&&0<l.length)for(a=0;a<l.length;a++){var y=
l[a];if(y){var z=$(y),E=z.attr("id");if(E){var w={classid:"macro",index:k.macros.length+1,name:E,commands:[]};k.macros.push(w);var A=z.find("command");if(A&&0<A.length)for(var x=0;x<A.length;x++){var F=A[x];if(F){var B=$(F),C=B.attr("action"),D=B.attr("sleep");if(C){var q=C.split(".");if(3==q.length){var t={classid:"command",index:w.commands.length+1,action:{type:"command",device:{name:q[1],room:q[0]},value:q[2]}};w.commands.push(t)}}else D&&(t={classid:"sleep",index:w.commands.length+1,time:parseInt(D)},
w.commands.push(t))}}}}}}}}}catch(p){console.error(p)}return d},k=require("m.aio.configmanager.js"),n=k.LicenseManager;k.trace("/config/tenants/"+a,function(f,g){if(f)d&&d(f);else if(g&&g.license){if(n.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"brennenstuhl"},g.license))f="brennenstuhl";else if(n.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"intertechno"},g.license))f="intertechno";else if(n.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"hc"},g.license))f="hc";else{d&&
d(Error("license do not have hcgw module"));return}f=e(f,c);var k=[];f&&f.rooms&&f.rooms.forEach(function(a){a&&a.name&&k.push(a.name)});var l=b(h,k);g=require("m.aio.devicemanager.js");var v=require("m.aio.macromanager.js");if(g=g.getIntHandler(a)){var r=v._getHandler(a);r?(g.data=f,g._save(function(a){a?d&&d(a):(r.macros=v.Macros.parse(l),r._saveMacros(function(a){d&&d(a)}))})):d&&d(Error("no such tenant for macros"))}else d&&d(Error("no such tenant"))}else d&&d("invalid tenant")})};b.prototype.getConfigList_IQP=
function(a,c,h,d){a+="/iqconfig/getconfigs";var e=require("url").parse(a);a=e.protocol;"http:"==a&&(a="http");"https:"==a&&(a="https");a||(a="https");var b=e.port;b||(b=443);c={host:e.hostname,port:b,path:e.path+"?app=iqontrolpro",auth:c+":"+h};c=require(a).request(c,function(a){a.setEncoding("utf8");var c="";a.on("data",function(a){c+=a});a.on("end",function(){if(200!=a.statusCode)d&&(d(Error("http reponse code:"+a.statusCode)),d=null);else try{var e=[];c&&(e=JSON.parse(c));d&&(d(null,e),d=null)}catch(g){d&&
(d(Error("invalid json reponse")),d=null)}})});c.on("timeout",function(){d&&(d(Error("http timeout")),d=null)});c.on("error",function(a){d&&(d(a),d=null)});c.end()};b.prototype.downloadConfig_IQP=function(a,c,h,d,e){a+="/iqconfig/getdevices";var b=require("url").parse(a);a=b.protocol;"http:"==a&&(a="http");"https:"==a&&(a="https");a||(a="https");var k=b.port;k||(k=443);c={host:b.hostname,port:k,path:b.path+"?app=iqontrolpro&name="+encodeURIComponent(d),auth:c+":"+h};c=require(a).request(c,function(a){a.setEncoding("utf8");
var c="";a.on("data",function(a){c+=a});a.on("end",function(){200!=a.statusCode?e&&(e(Error("http reponse code:"+a.statusCode)),e=null):e&&(e(null,c),e=null)})});c.on("timeout",function(){e&&(e(Error("http timeout")),e=null)});c.on("error",function(a){e&&(e(a),e=null)});c.end()};b.prototype.decryptConfig_IQP=function(a,c,b){a=require("x.crypt.js").AES.decodeString(a,c);if(0<a.length&&"string"==typeof a){c=null;try{c=JSON.parse(a),b&&b(null,c)}catch(d){b&&b(Error("invalid config json"))}}else b&&b(Error("decryption failed"))};
b.prototype.importConfig_IQP=function(a,c,b,d,e){require("m.aio.configmanager.js").trace("/config/tenants/"+a,function(h,k){if(h)e&&e(h);else if(k&&k.license){var n=require("m.aio.devicemanager.js");if(h=n.getIntHandler(a)){var f=-1,g=[];if(c.rooms)for(var l=0;l<c.rooms.length;l++){var u=c.rooms[l];if(u)if("_cameras_288c9304ed854ca5f41185e88b240621"==u.name){f=u.index;break}else g.push(u.index)}if(-1==f){for(f=1;-1!=g.indexOf(f);)f++;c.rooms.push({name:"_cameras_288c9304ed854ca5f41185e88b240621",
index:f})}if(c.devices)for(g=0;g<c.devices.length;g++)if(l=c.devices[g])l.info&&"cloudservice"==l.info.sys&&"ivideon"==l.info.module&&"camera"==l.info.type?l.room=f:l.info&&"cam"==l.info.sys&&(l.room=f);if(c.gateways)for(f=0;f<c.gateways.length;f++)if(g=c.gateways[f])g.info&&"cloudservice"==g.info.sys&&(g.info.ip||(g.info.ip="cloud.mediola.com"),g.info.port||(g.info.port=443),g.info.username||g.info.password||(g.info.username=b,g.info.password=d)),g.info&&"aio"==g.info.sys&&"gtw"==g.info.common_type&&
(c.gateways.splice(f,1),f--);h.data=c;h._save(function(a){a?e&&e(a):n.reloadTenant(k,function(a){e&&e(a)})})}else e&&e(Error("no such tenant"))}else e&&e("invalid tenant")})};b.prototype.downloadMacros_IQP=function(a,c,b,d,e){a+="/iqconfig/getmacros";var h=require("url").parse(a);a=h.protocol;"http:"==a&&(a="http");"https:"==a&&(a="https");a||(a="https");var k=h.port;k||(k=443);c={host:h.hostname,port:k,path:h.path+"?app=iqontrolpro&name="+encodeURIComponent(d),auth:c+":"+b};c=require(a).request(c,
function(a){a.setEncoding("utf8");var c="";a.on("data",function(a){c+=a});a.on("end",function(){200!=a.statusCode?e&&(e(Error("http reponse code:"+a.statusCode)),e=null):e&&(e(null,c),e=null)})});c.on("timeout",function(){e&&(e(Error("http timeout")),e=null)});c.on("error",function(a){e&&(e(a),e=null)});c.end()};b.prototype.decryptMacros_IQP=function(a,c,b){a=require("x.crypt.js").AES.decodeString(a,c);if(0<a.length&&"string"==typeof a){c=null;try{c=JSON.parse(a),b&&b(null,c)}catch(d){b&&b(Error("invalid macros json"))}}else b&&
b(Error("decryption failed"))};b.prototype.importMacros_IQP=function(a,c,b){require("m.aio.configmanager.js").trace("/config/tenants/"+a,function(d,e){if(d)b&&b(d);else if(e&&e.license){d=require("m.aio.macromanager.js");var h=d._getHandler(a);if(h){var k=require("m.aio.devicemanager.js").getIntHandler(a);if(k){if(c&&c.groups)for(var n=0;n<c.groups.length;n++){var f=c.groups[n];if(f&&f.macros)for(var g=0;g<f.macros.length;g++){var G=f.macros[g];if(G&&G.commands)for(var u=0;u<G.commands.length;u++){var v=
G.commands[u];if(v&&v.action&&v.action.device){var r=v.action.device.room;r&&!isNaN(parseInt(r))&&(r=k.findRoomWithIndex(parseInt(r)))&&r.name&&(v.action.device.room=r.name)}}}}h.macros=d.Macros.parse(c);h._saveMacros(function(a){a?b&&b(a):require("m.aio.devicemanager.js").reloadTenant(e,function(a){b&&b(a)})})}else b&&b(Error("no device manager"))}else b&&b(Error("no such tenant"))}else b&&b("invalid tenant")})};return b}();m.aio.importmanager.Handler=m.aio.importmanager.Manager;
"undefined"!=typeof module&&null!=module&&(module.exports=new m.aio.importmanager.Handler);
