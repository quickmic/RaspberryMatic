var x=x||{};x.hub=x.hub||{};x.hub.logman=x.hub.logman||{};
x.hub.logman.Handler=function(){Handler=function(){};Handler.prototype.init=function(a,c){var b=global.LOG_LEVEL;if(localStorage){var d=localStorage.getItem("x.hub.Server.logLevel");"undefined"!=typeof d&&null!=d&&(b=d)}this._setupLogger(a,b);"fatal"==b?this._clearLogFiles(c):c&&c()};Handler.prototype.setLoggger=function(a,c,b){require("x.logger.js").setLevel(c,a);!a&&localStorage&&localStorage.setItem("x.hub.Server.logLevel",c);a||"fatal"!=c?b&&b():this._clearLogFiles(b)};Handler.prototype._setupLogger=
function(a,c){var b=require("fs-extra"),d=require("path");require("x.logger.js").setFile(a.getLogFile());require("x.logger.js").setLogFolder(a.getUserLogPath());require("x.logger.js")._fileMaxSize=2048;require("x.logger.js").setLevel(c);require("x.logger.js").setTagFile("CloudRemoteAccess","cloud_access.log");require("x.logger.js").setTagFile("x.hub.v5.CloudConnectWS","v5p_cloud_access.log");require("x.logger.js").setLogToConsole(!1,"x.hub.v5.CloudConnectWS");b.ensureFileSync(d.resolve(a.getUserLogPath(),
"v5p_taskmanager.log"));require("x.logger.js").setTagFile("x.hub.taskman","v5p_taskmanager.log");require("x.logger.js").setLogToConsole(!1,"x.hub.taskman");b.ensureFileSync(d.resolve(a.getUserLogPath(),"v5p_homematic.log"));require("x.logger.js").setTagFile("x.hub.m.hm","v5p_homematic.log");require("x.logger.js").setTagFile("xnm.aio.hm","v5p_homematic.log");require("x.logger.js").setLogToConsole(!1,"x.hub.m.hm");require("x.logger.js").setLogToConsole(!1,"xnm.aio.hm");global.LOAD_MODULES&&-1!=global.LOAD_MODULES.indexOf("enocean")&&
(b.ensureFileSync(d.resolve(a.getUserLogPath(),"v5p_enocean.log")),require("x.logger.js").setTagFile("x.hub.m.enocean","v5p_enocean.log"),require("x.logger.js").setLogToConsole(!1,"x.hub.m.enocean"));global.LOAD_MODULES&&-1!=global.LOAD_MODULES.indexOf("zigbee")&&(b.ensureFileSync(d.resolve(a.getUserLogPath(),"v5p_zigbee.log")),require("x.logger.js").setTagFile("x.hub.m.zigbee","v5p_zigbee.log"),require("x.logger.js").setLogToConsole(!1,"x.hub.m.zigbee"));global.LOAD_MODULES&&-1!=global.LOAD_MODULES.indexOf("zway")&&
(b.ensureFileSync(d.resolve(a.getUserLogPath(),"v5p_zwave.log")),require("x.logger.js").setTagFile("x.hub.m.zway","v5p_zwave.log"),require("x.logger.js").setLogToConsole(!1,"x.hub.m.zway"));global.LOAD_MODULES&&-1!=global.LOAD_MODULES.indexOf("knx")&&(b.ensureFileSync(d.resolve(a.getUserLogPath(),"v5p_knx.log")),require("x.logger.js").setTagFile("x.hub.m.knx","v5p_knx.log"),require("x.logger.js").setTagFile("xnm.aio.knx","v5p_knx.log"),require("x.logger.js").setLogToConsole(!1,"x.hub.m.knx"),require("x.logger.js").setLogToConsole(!1,
"xnm.aio.knx"));b.ensureFileSync(d.resolve(a.getUserLogPath(),"v5p_aiogateway.log"));require("x.logger.js").setTagFile("x.hub.m.gateway","v5p_aiogateway.log");require("x.logger.js").setTagFile("xnm.aio.gateway","v5p_aiogateway.log");require("x.logger.js").setLogToConsole(!1,"x.hub.m.gateway");require("x.logger.js").setLogToConsole(!1,"xnm.aio.gateway");b.ensureFileSync(d.resolve(a.getUserLogPath(),"v5p_rf_st.log"));require("x.logger.js").setTagFile("x.hub.v5.USBSerial","v5p_rf_st.log");require("x.logger.js").setLogToConsole(!1,
"x.hub.v5.USBSerial")};Handler.prototype._clearLogFiles=function(a){var c=this;this._clearMainLogFile(function(){c._clearTagFiles(function(){c._clearConsoleDumpFile(function(){a&&a()})})})};Handler.prototype._clearConsoleDumpFile=function(a){if("EA"!=global.HARDWARE_VERSION)a&&a();else{var c=require("x.hub.fileman.js").fileManager,b=require("path");this._clearLogFile(b.resolve(c.getUserLogPath(),"v5plus_daemon"),a)}};Handler.prototype._clearMainLogFile=function(a){var c=require("x.hub.fileman.js").fileManager,
b=require("path"),d=require("x.logger.js").getFile();d?this._clearLogFile(b.resolve(c.getUserLogPath(),d),a):a&&a()};Handler.prototype._clearTagFiles=function(a){var c=require("x.hub.fileman.js").fileManager,b=require("x.logger.js").getTagFiles(),d=require("path"),e=[],g;for(g in b)b[g]&&e.push(b[g]);if(0==e.length)a&&a();else{var f=0,k=this,h=function(){f++;f<e.length?k._clearLogFile(d.resolve(c.getUserLogPath(),e[f]),h):a&&a()};this._clearLogFile(d.resolve(c.getUserLogPath(),e[f]),h)}};Handler.prototype._clearLogFile=
function(a,c){if(a){var b=require("fs-extra");b.ensureFile(a,function(d){d?c&&c(d):b.writeFile(a,"",function(a){c&&c(a)})})}else c&&c()};return Handler}();module.exports=new x.hub.logman.Handler;
