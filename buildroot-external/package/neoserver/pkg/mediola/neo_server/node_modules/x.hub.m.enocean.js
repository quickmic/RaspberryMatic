var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,e,a){g!=Array.prototype&&g!=Object.prototype&&(g[e]=a.value)};$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var g=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+g++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var g=$jscomp.global.Symbol.iterator;g||(g=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[g]&&$jscomp.defineProperty(Array.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(g){var e=0;return $jscomp.iteratorPrototype(function(){return e<g.length?{done:!1,value:g[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(g){$jscomp.initSymbolIterator();g={next:g};g[$jscomp.global.Symbol.iterator]=function(){return this};return g};$jscomp.iteratorFromArray=function(g,e){$jscomp.initSymbolIterator();g instanceof String&&(g+="");var a=0,f={next:function(){if(a<g.length){var c=a++;return{value:e(c,g[c]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill=function(g,e,a,f){if(e){a=$jscomp.global;g=g.split(".");for(f=0;f<g.length-1;f++){var c=g[f];c in a||(a[c]={});a=a[c]}g=g[g.length-1];f=a[g];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),crypto=require("crypto"),fs_extra=require("fs-extra"),fileman=require("x.hub.fileman.js"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.enocean=x.hub.m.enocean||{};x.hub.m.enocean.SENDER_ID=null;x.hub.m.enocean.MANUFACTURE_ID=2047;
x.hub.m.enocean._CRC8Table=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,
149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];
x.hub.m.enocean.CRC8=function(g){for(var e=0,a=0;a<g.length;a++)e=x.hub.m.enocean._CRC8Table[e^g[a]];return e};
x.hub.m.enocean.Serial=function(){var g=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Serial");this._port=e;this._serialPort=null};g.prototype.getPort=function(){return this._port};g.prototype.setListener=function(e){this._listener=e};g.prototype.open=function(e){if(this._serialPort)this._logger.log("warn","port:"+this._port+" already opened"),e&&e();else{var a=e;try{this._logger.log("trace","try to listen to port:"+this._port);var f=require("serialport");if(f){var c=
new f.SerialPort(this._port,{baudrate:57600}),k=this;c.on("open",function(){k._logger.log("trace","port:"+k._port+" opened");k._serialPort=c;c.flush();a&&a();a=null});c.on("error",function(c){k._logger.log("warn","enocean error:"+c.message);k._serialPort=null;if(a)a&&a(c),a=null;else if(k._listener&&k._listener.onSerialError)k._listener.onSerialError(c)});c.on("data",function(a){k._logger.log("trace","receive data "+a.toString("hex"));if(k._listener&&k._listener.onSerialData)k._listener.onSerialData(a)})}else this._logger.log("warn",
"no seiralport module"),e&&e(Error("no seiralport modul"))}catch(h){this._logger.log("warn","init enocean via "+this._port+" error:"+h.message),a&&a(h),a=null}}};g.prototype.close=function(){this._listener=null;try{this._serialPort&&this._serialPort.close()}catch(e){this._logger.log("warn","close enocean via "+this._port+" error:"+e.message)}this._serialPort=null};g.prototype.sendPacket=function(e,a){this._serialPort?this._serialPort.write(e,a):a&&a(Error("port not opened"))};return g}();
x.hub.m.enocean.ReComm=function(){var g=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ReComm");this._esp3=e};g.prototype.sendRawSysEx=function(e,a,f,c){var k=this;e=new x.hub.m.enocean.ESP3.Telegram.ADT(197,e,a,f);this._esp3.sendTelegram(e,!0,function(a,f){setTimeout(function(){a?(k._logger.log("warn","ReComm command failed with err:"+a.message),c&&c(a)):f&&0!=f.retCode?(k._logger.log("warn","ReComm command failed with retCode:"+f.retCode),a=Error("ReComm command failed:"+
f.retCode),a.code=f.retCode,c&&c(a,f)):c&&c(null,f)},50)})};return g}();
x.hub.m.enocean.SecurityHandler=function(){var g=new Buffer("3410de8f1aba3eff9f5a117172eacabd","hex"),e=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SecurityHandler");this._secInfo={};this._unsync={}};e.prototype.SECURITY_FILE="enocean_sec.json";e.prototype.init=function(a){this._logger.log("trace","init");var f=this;this._loadSec(function(c,e){c&&f._logger.log("warn","init error:"+c.message);e&&(f._secInfo=e);a&&a()})};e.prototype.getUnsyncDevice=function(){return this._unsync};
e.prototype.isSecureDevice=function(a){return this._secInfo[a]};e.prototype.secureTeachIn=function(a,f,c){this._logger.log("trace","secure teach-in:"+a);a&&(f.key&&delete f.key,this._secInfo[a]=f);this._saveSec(this._secInfo,c)};e.prototype.resolve=function(a){if(!a)return null;switch(a.rorg){case 53:return this._resolveSecureTeachIn(a);case 49:return this._resolveSecureMessage(a);default:return null}};e.prototype._resolveSecureTeachIn=function(a){var f={};a=a.userData;var c=a.readUInt8(0);f.teachInInfo=
{};f.teachInInfo.idx=c>>6&3;f.teachInInfo.cnt=c>>4&3;f.teachInInfo.psk=c>>3&1;f.teachInInfo.type=c>>2&1;f.teachInInfo.info=c&3;0==f.teachInInfo.idx?(c=a.readUInt8(1),f.slf={},f.slf.rlc_algo=c>>6&3,f.slf.rlc_tx=c>>5&1,f.slf.mac_alro=c>>3&3,f.slf.data_enc=c&7,c=0,1==f.slf.rlc_algo?c=2:2==f.slf.rlc_algo&&(c=3),c&&(f.rlc=a.slice(2,2+c)),f.key=a.slice(2+c),f.completeKey=null):f.key=a.slice(1);return f};e.prototype._resolveSecureMessage=function(a){var f=a.senderID,c=this._secInfo[f];if(!c||!c.completeKey)return null;
var e=0,h=0;1==c.slf.mac_alro?e=3:2==c.slf.mac_alro&&(e=4);1==c.slf.rlc_tx&&(1==c.slf.rlc_algo?h=2:2==c.slf.rlc_algo&&(h=3));var l=a.userData.length-e-h,r=a.userData.slice(0,l),m=null;h&&a.userData.slice(l,l+h);e&&(m=a.userData.slice(l+h));e=c.rlc;h=!0;m&&(m=this.checkCmac(a.rorg,r,e,c.completeKey,m),m.rlc&&e.toString("hex")!=m.rlc.toString("hex")&&(e=m.rlc,c.rlc=m.rlc),m&&m.ok?(this._logger.log("trace","receive from "+f+" with cmac rlc:"+e.toString("hex")),delete this._unsync[f]):(h=!1,this._logger.log("warn",
"receive from "+f+" with cmac out of snyc, last rlc:"+e.toString("hex")),this._unsync[f]=e.toString("hex")));f=null;h&&3==c.slf.data_enc&&(r=this.decryptVAES(e,g,c.completeKey,r),f=a.convertToPacket(r).toRadioTelegram());c.rlc=this._incRLC(e);this._logger.log("trace","senderID next rlc:"+c.rlc.toString("hex"));this._saveSec(this._secInfo);return f};e.prototype.decryptVAES=function(a,f,c,e){for(var k=e.length,l=Math.ceil(k/16),g=[],m=null,v=0;v<l;v++){var y=16*v,C=y+16;C>k&&(C=k);y=e.slice(y,C);m=
this._doVAESblock(a,f,c,m,y);g.push(m.data);m=m.enc}return Buffer.concat(g)};e.prototype._doVAESblock=function(a,f,c,e,h){a=this._xor(a,f);e&&(a=this._xor(a,e));c=this._doAES128(c,null,a);e=this._xor(c,h);e=e.slice(0,h.length);return{data:e,enc:c}};e.prototype.checkCmac=function(a,f,c,e,h){if(c){for(var k=this._bufToInt(c),g=0;128>g;g++){if(0!=g){k+=1;var m=65535;3==c.length&&(m=16777215);k>m&&(k=0)}m=this._intToBuf(k,c.length);m=this.calcCmac(a,f,m,e,h.length);if(m.toString("hex")==h.toString("hex"))return{ok:!0,
rlc:this._intToBuf(k,c.length)}}return{ok:!1,rlc:this._intToBuf(k,c.length)}}m=this.calcCmac(a,f,null,e,h.length);return m.toString("hex")==h.toString("hex")?{ok:!0}:{ok:!1}};e.prototype.calcCmac=function(a,f,c,e,h){var k=this._getCmacSubkey(e),g=new Buffer(1);g.writeUInt8(a);g=Buffer.concat([g,f]);c&&(g=Buffer.concat([g,c]));a=g.length;f=Math.ceil(a/16);c=null;for(var m=0;m<f;m++){var v=16*m;var y=v+16;y>a&&(y=a);v=g.slice(v,y);c=v=this._doCmacBlock(e,k.k1,k.k2,v,c)}return v.slice(0,h)};e.prototype._doCmacBlock=
function(a,f,c,e,h){for(var k=new Buffer(16),g=0;16>g;g++)g<e.length?k.writeUInt8(e.readUInt8(g),g):g==e.length?k.writeUInt8(128,g):k.writeUInt8(0,g);h&&(k=this._xor(k,h));k=16>e.length?this._xor(k,c):this._xor(k,f);return this._doAES128(a,null,k)};e.prototype._getCmacSubkey=function(a){var f=new Buffer("00000000000000000000000000000000","hex");var c=new Buffer("00000000000000000000000000000087","hex");f=this._doAES128(a,null,f);a=new Buffer(f.toString("hex"),"hex");this._bufShiftLeft(a,1);f.readUInt8(0)&
128&&(a=this._xor(a,c));f=new Buffer(a.toString("hex"),"hex");this._bufShiftLeft(f,1);a.readUInt8(0)&128&&(f=this._xor(f,c));return{k1:a,k2:f}};e.prototype._doAES128=function(a,f,c){f||(f=new Buffer("00000000000000000000000000000000","hex"));a=crypto.createCipheriv("aes128",a,f);a.setAutoPadding(!1);c=a.update(c);a=a.final();return Buffer.concat([c,a])};e.prototype._xor=function(a,f){for(var c=Math.max(a.length,f.length),e=new Buffer(c),h=0;h<c;h++){var g=0,r=0;h<a.length&&(g=a.readUInt8(h));h<f.length&&
(r=f.readUInt8(h));e.writeUInt8(g^r,h)}return e};e.prototype._bufShiftLeft=function(a,f){if(f!==(f|0))throw Error("shiftBits must be a 32 bit int");var c=2*((f>>4)+(0!==(f&15)));f=8*c-f;for(var e=0,h=0;h-c<a.length;h+=2)if(e<<=16,h<a.length-1?e|=a.readUInt16BE(h):h<a.length&&(e|=a[h]<<8),0<=h-c)if(h-c<a.length-1)a.writeUInt16BE(e>>>f&65535,h-c);else{if(h-c!==a.length-1)throw Error();a[h-c]=e>>>f+8}else-1===h-c&&(a[0]=e>>>f)};e.prototype._bufToInt=function(a){for(var f=0,c=0;c<a.length;c++){var e=
a.readUInt8(c);f=(f<<8*c)+e}return f};e.prototype._intToBuf=function(a,f){for(a=a.toString(16);a.length<2*f;)a="0"+a;return new Buffer(a,"hex")};e.prototype._incRLC=function(a){var f=this._bufToInt(a);f+=1;var c=65535;3==a.length&&(c=16777215);f>c&&(f=0);return this._intToBuf(f,a.length)};e.prototype._getFile=function(){var a=require("x.hub.fileman.js").fileManager,f=require("path");require("fs");a=a.getUserRootDataPath();return f.resolve(a,this.SECURITY_FILE)};e.prototype._loadSec=function(a){var f=
this._getFile();fs_extra.ensureFile(f,function(c){c?a&&a(c):fs_extra.readFile(f,"utf8",function(c,f){if(c)a&&a(c);else{try{var e=JSON.parse(f);for(var k in e)if(e.hasOwnProperty(k)){var h=e[k];h.rlc&&(h.rlc=new Buffer(h.rlc,"hex"));h.completeKey&&(h.completeKey=new Buffer(h.completeKey,"hex"))}}catch(v){}a&&a(null,e)}})})};e.prototype._saveSec=function(a,f){var c=this._getFile(),e={},h;for(h in a)e[h]={},e[h].teachInInfo=a[h].teachInInfo,e[h].slf=a[h].slf,e[h].rlc=a[h].rlc.toString("hex"),e[h].completeKey=
a[h].completeKey.toString("hex");fs_extra.writeFile(c,JSON.stringify(e,null,2),function(a){f&&f(a)})};return e}();
x.hub.m.enocean.LearnHandler=function(){var g=function(){var a=function(a){this._handler=a};a.prototype.onTelegram=function(a){var c=this;switch(a.rorg){case 176:if(this._isProfileMatch(a.getManufacturerId(),a.getProductId())){var f={address:a.senderID,data:this._getLearnProfile(),vendor:this._getLearnVendor(),senderID:x.hub.m.enocean.SENDER_ID,gpInfo:a.toJSON()};if(0==a.purpose)this._handler._controller._deviceHandler.onLearnDevice(null,f,function(f,e){f?c._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,
a.senderID,function(){c._handler._learnFinish(f,-1,e)}):c._sendTeachInResponse(1,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){c._handler._learnFinish(f,0,e)})});else if(1==a.purpose)this._handler._controller._deviceHandler.deleteDevice(f,function(f,e){f?c._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){c._handler._learnFinish(f,-1,e)}):c._sendTeachInResponse(2,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){c._handler._learnFinish(f,1,e)})});else if(2==a.purpose)this._handler._controller._deviceHandler.onLearnAddDeleteDevice(f,
function(f,e,k){f?c._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){c._handler._learnFinish(f,e,k)}):c._sendTeachInResponse(0==e?1:2,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){c._handler._learnFinish(f,e,k)})})}}};a.prototype._sendTeachInResponse=function(a,c,e,h,g){e||(e=x.hub.m.enocean.SENDER_ID);a=new x.hub.m.enocean.ESP3.Telegram.GP_TR(2047,a,c,e,0);a.setDstId(h);this._handler._controller._esp3.sendTelegram(a,!0,function(a){g&&g(a)})};a.prototype._isProfileMatch=
function(a,c){var f=this._handler._learnProfile;if(!f||"gp"==f)return!0;var e=x.hub.m.enocean.profiles[f];if(!e)return!1;e=new e;return e._data!=f?!1:e.isGPMatch?e.isGPMatch(a,c):!0};a.prototype._getLearnProfile=function(){return this._handler._learnProfile?this._handler._learnProfile:"gp"};a.prototype._getLearnVendor=function(){return this._handler._learnVendor};return a}(),e=function(a){this._controller=a;this._learning=!1;this._saParams=this._learnVendor=this._learnSenderID=this._learnAddress=
this._learnProfile=this._learnCallback=null;this._secTeachInFrames={};this._teaching=!1;this._teachingTO=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;var f=this;this._teachinTelegramCB={_onEOTelegram:function(a){f.onTeachInResponseTelegram(a)}};this._gpLearn=new g(this)};e.prototype.learn=function(a,f,c,e,h,g,r){if(this._learning)g&&g(Error("learning process running"));else if(this._teaching)g&&g(Error("teach-in process running"));else{if(!h||0>=
h)h=3E4;this._learning=!0;this._learnCallback=g;this._learnProfile=a?a.toLowerCase():null;this._learnAddress=f?f.toLowerCase():null;this._learnVendor=e?e:"general";this._learnSenderID=c?c.toLowerCase():null;this._secTeachInFrames={};this._saParams=null;!a||"bb-aa-cc"!=a.toLowerCase()&&"d2-06-10"!=a.toLowerCase()||(this._saParams={extended:1},r&&"undefined"!=typeof r.saLearnMode&&null!=r.saLearnMode&&(a=parseInt(r.saLearnMode),isNaN(a)&&(a=1),0>a&&(a=1),2<a&&(a=1),this._saParams.extended=a));var k=
this;this._controller._esp3.startLearn(this,h,this._saParams,function(a){if(a){var c=k._learnCallback;k._learning=!1;k._learnProfile=null;k._learnCallback=null;k._secTeachInFrames={};c&&c(a)}})}};e.prototype.onLearnTimeout=function(){this._learnFinish(Error("learn timeout"))};e.prototype.onTelegram=function(a){if(a){if(this._learnProfile){var f=x.hub.m.enocean.profiles[this._learnProfile];if(f&&(f=new f,f.handleLearnTelegram)){f.handleLearnTelegram(this,a);return}}switch(a.rorg){case 212:0==a.cmd&&
this._learnUTE(a);break;case 213:0==a.getLearnBit()&&this._learn1BS(a);break;case 165:0==a.getLearnBit()&&this._learn4BS(a);break;case 176:case 177:this._gpLearn.onTelegram(a);break;case 246:this._learnRPS(a);break;case 53:var c=this._controller._secHandler.resolve(a);a=a.senderID;f=this._secTeachInFrames[a];c&&(c.teachInInfo&&0==c.teachInInfo.idx?(f||(this._secTeachInFrames[a]=[],f=this._secTeachInFrames[a]),f.push(c)):c.teachInInfo&&0!=c.teachInInfo.idx&&f&&f.push(c));if(f&&f[0]&&(c=f[0])&&c.teachInInfo){var e=
c.teachInInfo.cnt;if(e&&f.length==e){if(1<e){e=[];for(var h=0;h<f.length;h++)e.push(f[h].key);c.completeKey=Buffer.concat(e)}else c.completeKey=c.key;this._controller._secHandler.secureTeachIn(a,c)}}}}};e.prototype.onEvent=function(a){if(a&&a instanceof x.hub.m.enocean.ESP3.Event.SA_CONFIRM_LEARN){var f=a.getEEP();if(!this._learnProfile||this._isLearningProfileEquals(f)){var c=this._learnProfile?this._learnProfile:f,e=this,h=x.hub.m.enocean.profiles[c];if(!h){var g=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,
17);this._controller._esp3.sendResponse(g,function(a){e._learnFinish(Error("eep not supported"))})}h=new h;var r=a.getPMCandidateId();r||(r=h.UNIQUE_GATEWAY_SENDERID?this._controller._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID);f={address:a.getSAClientId(),data:c,vendor:this._learnVendor,senderID:r,hopCount:a.getHopCount(),saLearnMode:this._saParams?this._saParams.extended:null,originalEEP:f};this._controller._deviceHandler.onLearnAddDeleteDevice(f,function(c,f,k){if(c)g=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,
19),e._controller._esp3.sendResponse(g,function(a){e._learnFinish(a)});else{c=0;1==f&&(c=32);var h=a.getHopCount();g=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(128*(h+1),c);e._controller._esp3.sendResponse(g,function(a){e._learnFinish(a,f,k)})}})}}};e.prototype.onTeachInResponseTelegram=function(a){if(a&&this._teaching){var f=this;if(this._teachProfile){var c=x.hub.m.enocean.profiles[this._teachProfile];if(c&&(c=new c,c.handleTeachinTelegram)){c.handleTeachinTelegram(this,a);return}}switch(a.rorg){case 165:if(0==
a.getLearnBit()){c=a.getFunc();var e=a.getType();this._toProfileStr(165,c,e);if(1==a.getLearnResult())this._controller._deviceHandler.onLearnDevice({address:this._teachID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},{address:a.senderID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},function(a,c){f._teachFinish(a,c)});else 0==a.getLearnResult()&&(a=this._controller._deviceHandler.getDevice(this._teachID),f._teachFinish(null,a,1))}}}};
e.prototype._learnRPS=function(a){var f=this._getRealProfile(this._learnProfile),c=this;f&&"f6"!=f.substr(0,2)||((f=this._learnProfile)||(f="f6-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:f,vendor:this._learnVendor},function(a,f){c._learnFinish(a,0,f)}))};e.prototype._learn1BS=function(a){var f=this,c=this._getRealProfile(this._learnProfile);
c&&"d5"!=c.substr(0,2)||((c=this._learnProfile)||(c="d5-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:c,vendor:this._learnVendor},function(a,c){f._learnFinish(a,0,c)}))};e.prototype._learn4BS=function(a){if(0==a.getLearnType())this._learn4BSV1(a);else{var f=a.getFunc(),c=a.getType();f=this._toProfileStr(165,f,c);(f=x.hub.m.enocean.profiles[f])&&
(3==(new f).TEACH_IN_VARIATION?this._learn4BSV3(a):this._learn4BSV2(a))}};e.prototype._learn4BSV1=function(a){var f=this._getRealProfile(this._learnProfile);if(f){if("a5"!=f.substr(0,2))return;f=x.hub.m.enocean.profiles[this._learnProfile];if(!f||1!=(new f).TEACH_IN_VARIATION)return}var c=this;(f=this._learnProfile)||(f="a5-??-??");this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,
senderID:this._learnSenderID,data:f,vendor:this._learnVendor},function(a,f){c._learnFinish(a,0,f)})};e.prototype._learn4BSV2=function(a){var f=a.getFunc(),c=a.getType();f=this._toProfileStr(165,f,c);if(!this._learnProfile||this._isLearningProfileEquals(f))if(f=this._learnProfile?this._learnProfile:f,c=x.hub.m.enocean.profiles[f])if(3==(new c).TEACH_IN_VARIATION)this._learn4BSV3(a);else{var e=this;this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,
data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:f,vendor:this._learnVendor},function(a,c){e._learnFinish(a,0,c)})}};e.prototype._learn4BSV3=function(a){var f=a.getFunc(),c=a.getType();f=this._toProfileStr(165,f,c);if(!this._learnProfile||this._isLearningProfileEquals(f)){f=this._learnProfile?this._learnProfile:f;c=x.hub.m.enocean.profiles[f];var e=this;if(c){c=new c;var h=e._learnSenderID;!h&&c.UNIQUE_GATEWAY_SENDERID&&(h=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId());
this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:h,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:h,data:f,vendor:this._learnVendor},function(c,f){c?e._send4BSResponse(null,1,0,a,function(){e._learnFinish(c,0,f)}):e._send4BSResponse(h,1,1,a,function(){e._learnFinish(null,0,f)})})}else this._send4BSResponse(null,0,0,a,function(){e._learnFinish(Error("eep not supported"))})}};e.prototype._send4BSResponse=function(a,f,c,e,h){a||(a=x.hub.m.enocean.SENDER_ID);
var k=e.getFunc(),g=e.getType();e.getManufacturerId();a=new x.hub.m.enocean.ESP3.Telegram.BS4(new Buffer([(k&63)<<2|g>>5&3,(g&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128|f<<6|c<<5|16]),a,0);a.setDstId(e.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){h&&h(a)})};e.prototype._learnUTE=function(a){var e=this._toProfileStr(a.eepRorg,a.eepFunc,a.eepType),c,k=this;if(!this._learnProfile||this._isLearningProfileEquals(e)){e=this._learnProfile?this._learnProfile:
e;var h=x.hub.m.enocean.profiles[e];if(h)switch(h=new h,(c=this._learnSenderID)||(c=h.UNIQUE_GATEWAY_SENDERID?require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID),e={address:a.senderID,data:e,vendor:this._learnVendor,senderID:c},a.subtype){case 0:this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},e,function(e,f){if(0==a.rspExpected){var h=0;e&&404==e.errorCode?
h=3:e||(h=1);k._sendUTEResponse(c,h,a,function(){k._learnFinish(e,0,f)})}else k._learnFinish(e,0,f)});break;case 1:this._controller._deviceHandler.deleteDevice(e,function(e,f){if(0==a.rspExpected){var h=0;e&&404==e.errorCode?h=3:e||(h=2);k._sendUTEResponse(c,h,a,function(){k._learnFinish(e,1,f)})}else k._learnFinish(e,1,f)});break;case 2:this._controller._deviceHandler.onLearnAddDeleteDevice(e,function(e,f,h){if(0==a.rspExpected){var g=0;e&&404==e.errorCode?g=3:e||(0==f?g=1:1==f&&(g=2));k._sendUTEResponse(c,
g,a,function(){k._learnFinish(e,f,h)})}else k._learnFinish(e,f,h)})}}};e.prototype._sendUTEResponse=function(a,e,c,k){a||(a=x.hub.m.enocean.SENDER_ID);a=new x.hub.m.enocean.ESP3.Telegram.UTE(1,c.ute,0,e,c.numChannel,c.manufactureID,c.eepType,c.eepFunc,c.eepRorg,a,0);a.setDstId(c.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){k&&k(a)})};e.prototype._learnFinish=function(a,e,c){var f=this._learnCallback;this._learning=!1;this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=
this._learnCallback=null;this._secTeachInFrames={};var h=this._saParams;this._saParams=null;this._controller._esp3.stopLearn(this,h,function(){});f&&f(a,e,c);!a&&0==e&&c&&c.init&&setTimeout(function(){c.init()},1E3)};e.prototype._toProfileStr=function(a,e,c){for(a=a.toString(16);2>a.length;)a="0"+a;for(e=e.toString(16);2>e.length;)e="0"+e;for(c=c.toString(16);2>c.length;)c="0"+c;return(a+"-"+e+"-"+c).toLowerCase()};e.prototype._fromProfileStr=function(a){a=a.split("-");return{rorg:parseInt(a[0],16),
func:parseInt(a[1],16),type:parseInt(a[2],16)}};e.prototype._getRealProfile=function(a){if(!a)return null;var e=x.hub.m.enocean.profiles[a];if(!e)return a;e=new e;return e._eepAlias?e._eepAlias:a};e.prototype._isLearningProfileEquals=function(a){if(!this._learnProfile)return!1;if(this._learnProfile==a||"bb-aa-cc"==this._learnProfile&&"d2-06-10"==a||"d2-06-10"==this._learnProfile&&"bb-aa-cc"==a)return!0;var e=x.hub.m.enocean.profiles[this._learnProfile];return e?(new e)._eepAlias==a:!1};e.prototype.teachin=
function(a,e,c,k,h){if(this._teaching)h&&h(Error("teach-in process running"));else if(this._learning)h&&h(Error("learning process running"));else if(a){a=a.toLowerCase();e||(e=this._controller._deviceHandler.getNextFreeAddress());var f=this;this._teachCallback=h;this._teachProfile=a;this._teachID=e;this._teachSenderID=c;this._teachVendor=k?k:"general";this._teaching=!0;this._teachingTO=setTimeout(function(){f._teachFinish(Error("teach-in timeout"))},3E4);var g;k=a;if(h=x.hub.m.enocean.profiles[k])h=
new h,h.getTeachinType&&(g=h.getTeachinType()),h.isTeachinBidirectional&&h.isTeachinBidirectional();!g&&(k=this._getRealProfile(k),h=x.hub.m.enocean.profiles[k])&&(h=new h,h.getTeachinType&&(g=h.getTeachinType()),h.isTeachinBidirectional&&h.isTeachinBidirectional());if(!g)switch(k.substr(0,2)){case "f6":g="RPS";break;case "d5":g="1BS";break;case "a5":g="4BS"}switch(g){case "RPS":this._teachinRPS(a,e,c);break;case "1BS":this._teachin1BS(a,e,c);break;case "4BS":this._teachin4BS(a,e,c);break;case "UTE":this._teachinUTE(a,
e,c);break;default:this._teachFinish(Error("profile not supported"))}}else h&&h(Error("profile is null"))};e.prototype._teachinRPS=function(a,e,c){this._teachFinish(Error("RPS teach-in should be done by execute command directly"))};e.prototype._teachin1BS=function(a,e,c){};e.prototype._teachin4BS=function(a,e,c){var f=2,h=x.hub.m.enocean.profiles[a];if(h)f=(new h).TEACH_IN_VARIATION;else if(this._getRealProfile(a),h=x.hub.m.enocean.profiles[a])f=(new h).TEACH_IN_VARIATION;switch(f){case 1:this._teachin4BSV1(a,
e,c);break;case 2:this._teachin4BSV2(a,e,c);break;case 3:this._teachin4BSV3(a,e,c);break;default:this._teachFinish(Error("no supported"))}};e.prototype._teachin4BSV1=function(a,e,c){};e.prototype._teachin4BSV2=function(a,e,c){var f=c;if(!c&&(f=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId(),!f)){this._teachFinish(Error("no more sender ID available"));return}c=a;var h=x.hub.m.enocean.profiles[c];h||(c=this._getRealProfile(c),h=x.hub.m.enocean.profiles[a]);h&&(h=new h,h._eepAlias&&
(a=h._eepAlias));h&&h.getTeachinTelegram?a=h.getTeachinTelegram(e,f,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),a=new x.hub.m.enocean.ESP3.Telegram.BS4(a,f,0));var g=this;this._controller._esp3.sendTelegram(a,!0,function(a){a?g._teachFinish(a):(e||(e=f),g._controller._deviceHandler.addDevice({address:e,data:g._teachProfile,senderID:f,vendor:g._teachVendor},
function(a,c){g._teachFinish(a,c)}))})};e.prototype._teachin4BSV3=function(a,e,c){var f=c;if(!c){f=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!f){this._teachFinish(Error("no more sender ID available"));return}this._teachSenderID=f}c=a;var h=x.hub.m.enocean.profiles[c];h||(c=this._getRealProfile(c),h=x.hub.m.enocean.profiles[a]);h&&(h=new h,h._eepAlias&&(a=h._eepAlias));h&&h.getTeachinTelegram?f=h.getTeachinTelegram(e,f,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),
a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),f=new x.hub.m.enocean.ESP3.Telegram.BS4(a,f,0));var g=this;this._controller._esp3.addListener(this._teachinTelegramCB);this._controller._esp3.sendTelegram(f,!0,function(a){a&&g._teachFinish(a)})};e.prototype._teachinUTE=function(a,e,c){e=c;if(!c){e=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!e){this._teachFinish(Error("no more sender ID available"));
return}this._teachSenderID=e}c=a;var f=x.hub.m.enocean.profiles[c];f||(c=this._getRealProfile(c),f=x.hub.m.enocean.profiles[a]);f&&(f=new f,f._eepAlias&&(a=f._eepAlias));a=a.split("-");a=new x.hub.m.enocean.ESP3.Telegram.UTE(0,1,0,2,255,x.hub.m.enocean.MANUFACTURE_ID,parseInt(a[2],16),parseInt(a[1],16),parseInt(a[0],16),e,0);a.setDstId(reqTelegram.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){a&&self._teachFinish(a)})};e.prototype._teachFinish=function(a,e,c){this._controller._esp3.removeListener(this._teachinTelegramCB);
var f=this._teachCallback;this._teachingTO&&clearTimeout(this._teachingTO);this._teachingTO=null;this._teaching=!1;this._saParams=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;f&&f(a,e,c)};return e}();
x.hub.m.enocean.DeviceHandler=function(){var g=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.DeviceHandler");this._controller=e;this._devices={}};util.inherits(g,EventEmitter);g.prototype.SENSOR_FILE="enocean.json";g.prototype.UNKNOWN_PROFILE_ERR=404;g.prototype.ALREADY_EXISTS_ERR=400;g.prototype.init=function(e){this._logger.log("trace","init");var a=this;this._loadDevices(function(f,c){f&&a._logger.log("warn","init error:"+f.message);c&&(a._devices=c);a._initDevices();
e&&e()})};g.prototype._initDevices=function(){var e=Object.keys(this._devices),a=0,f=this,c=function(){a++;a<e.length&&(f._devices[e[a]]&&f._devices[e[a]].init?f._devices[e[a]].init(c):c())};this._devices[e[a]]&&this._devices[e[a]].init?this._devices[e[a]].init(c):c()};g.prototype.getDevice=function(e){return e?this._devices[e]:null};g.prototype.getAllDevices=function(){return this._devices};g.prototype.findDevice=function(e){return e&&e.address?this._devices[e.address]:null};g.prototype.findDeviceWithData=
function(e){if(!e)return null;var a=[],f;for(f in this._devices){var c=this._devices[f];c&&c.getData()==e&&a.push(c)}return a};g.prototype.addDevice=function(e,a){if(e&&e.data){e.address||(e.address=this.getNextFreeAddress());e.address=e.address.toLowerCase();e.senderID&&(e.senderID=e.senderID.toLowerCase());var f=x.hub.m.enocean.profiles.parseJson(e);if(f){e=f._address;var c=this._devices[e];c&&c._data==f._data&&(f._states=c._states);this._devices[e]=f;this._saveDevices(this._devices,function(c){a&&
a(c,f)})}else e=Error("unknow profile"),e.errorCode=this.UNKNOWN_PROFILE_ERR,a&&a(e)}else e=Error("device json invalid"),a&&a(e)};g.prototype.updateDevice=function(e,a,f){if(e)if(a&&a.data){var c=this._devices[e];a.address||(a.address=e);a.address=a.address.toLowerCase();a.senderID&&(a.senderID=a.senderID.toLowerCase());var g=x.hub.m.enocean.profiles.parseJson(a);g?(c&&c._data==g._data&&(g._params=c._params,g._states=c._states),this._devices[a.address]=g,a.address!=e&&delete this._devices[e],this._saveDevices(this._devices,
function(a){f&&f(a,g)})):(e=Error("unknow profile"),e.errorCode=this.UNKNOWN_PROFILE_ERR,f&&f(e))}else e=Error("device json invalid"),f&&f(e);else e=Error("address invalid"),f&&f(e)};g.prototype.deleteDevice=function(e,a){if(e&&e.address&&this._devices[e.address]){var f=this._devices[e.address];f&&f.finalize&&f.finalize();var c=this._devices[e.address];delete this._devices[e.address];this.emit("deleteDevice",c);this._saveDevices(this._devices,function(c){a&&a(c,f)})}else a&&a()};g.prototype.onLearnAddDeleteDevice=
function(e,a){if(e&&e.address)if(this._devices[e.address])this.deleteDevice(e,function(e,c){a&&a(e,1,c)});else this.onLearnDevice(null,e,function(e,c){a&&a(e,0,c)});else a&&a()};g.prototype.onLearnDevice=function(e,a,f){if(a&&a.address&&a.data){var c=x.hub.m.enocean.profiles.parseJson(a);if(c){var g=a.address;if(this._devices[g]){var h=this._devices[g];g=h.toJSON();if(g.data!=a.data||g.vendor!=a.vendor)a=Error("address "+a.address+" already exists, please delete it first"),a.errorCode=this.ALREADY_EXISTS_ERR,
f&&f(a);else if(g.senderID!=a.senderID){h._senderID=a.senderID;if("bb-aa-cc"==h._data||"d2-06-10"==h._data)h.executeCommand(null,{value:"alertOn"}),h.executeCommand(null,{value:"preAlarmOn"});else if("afriso_water_eco"==c._data)c.onLearn();this._saveDevices(this._devices,function(a){f&&f(a,h)})}else f&&f(null,h)}else{e&&(a=e.address)&&a!=g&&this._devices[a]&&delete this._devices[a];this._devices[g]=c;if("bb-aa-cc"==c._data||"d2-06-10"==c._data)c.executeCommand(null,{value:"alertOn"}),c.executeCommand(null,
{value:"preAlarmOn"});else if("afriso_water_eco"==c._data)c.onLearn();this._saveDevices(this._devices,function(a){f&&f(a,c)})}}else a=Error("unknow profile"),a.errorCode=this.UNKNOWN_PROFILE_ERR,f&&f(a)}else a=Error("device json invalid"),f&&f(a)};g.prototype.deviceParamsUpdated=function(e,a){this._saveDevices(this._devices,function(e){a&&a(e)})};g.prototype.isVirtual=function(e){var a=x.hub.m.enocean.SENDER_ID;if(!a)return!1;var f=parseInt(a,16)+1;a=parseInt(a,16)+128;e=parseInt(e,16);return e>=
f&&e<=a};g.prototype.getVirtualSenderID=function(){var e=x.hub.m.enocean.SENDER_ID;if(!e)return[];var a=parseInt(e,16)+1;e=parseInt(e,16)+128;var f=[],c=this._devices,g;for(g in c){var h=c[g];h&&h._senderID&&(h=parseInt(h._senderID,16),h>=a&&h<=e&&f.push(h))}return f};g.prototype.getVirtualAddress=function(){var e=[],a=this._devices,f;for(f in a)"x"==f.charAt(0)&&(a=parseInt(f.substr(1),16),0<=a&&268435455>=a&&e.push(f));return e};g.prototype.getFreeSenderIdCount=function(){return 128-this.getVirtualSenderID().length};
g.prototype.getNextFreeSenderId=function(){var e=x.hub.m.enocean.SENDER_ID;if(!e)return null;var a=parseInt(e,16)+1;e=parseInt(e,16)+128;for(var f=this.getVirtualSenderID(),c=null;a<=e;a++)if(-1==f.indexOf(a)){c=a;break}if(c)for(c=c.toString(16).toLowerCase();8>c.length;)c="0"+c;return c};g.prototype.getNextFreeAddress=function(){for(var e=this.getVirtualAddress(),a=null,f=0;268435455>=f;f++){for(var c=f.toString(16);7>c.length;)c="0"+c;c="x"+c;if(-1==e.indexOf(c)){a=c;break}}return a};g.prototype.generateVirtual=
function(e,a){if(e&&e.data){var f=e.senderID;if(!f&&(f=this.getNextFreeSenderId(),!f)){a&&a(Error("no sender id available"));return}e.senderID=f;e.address=f;e.virtual=!0;if(f=this.findDevice(e)){var c=f.toJSON();e.data!=c.data?a&&a(Error("device of another type with the same address exists")):e.vendor&&e.vendor!=c.vendor?a&&a(Error("device of another vendor with the same address exists")):a&&a(null,f)}else(e=x.hub.m.enocean.profiles.parseJson(e))?this.addDevice(e.toJSON(),function(c,e){a&&a(c,e)}):
a&&a(Error("unknow profile"))}else a&&a(Error("query is null"))};g.prototype._getFile=function(){var e=fileman.fileManager,a=require("path");e=e.getUserRootDataPath();return a.resolve(e,this.SENSOR_FILE)};g.prototype._loadDevices=function(e){var a=require("fs-extra"),f=this._getFile();a.ensureFile(f,function(c){c?e&&e(c):a.readFile(f,"utf8",function(a,c){if(a)e&&e(a);else if(c)try{a={};var f=JSON.parse(c),g;for(g in f){var h=x.hub.m.enocean.profiles.parseDBJson(f[g]);h&&(a[g]=h)}e&&e(null,a)}catch(v){e&&
e(v)}else e&&e(null,{})})})};g.prototype._saveDevices=function(e,a){var f=this._getFile(),c={},g;for(g in e)c[g]=e[g].toDBJSON();fs_extra.writeFile(f,JSON.stringify(c,null,2),function(c){a&&a(c)})};return g}();
x.hub.m.enocean.ESP3=function(){var g=function(a,c,e){this.type=a;this.data=c;this.optData=e};g.TYPE={1:"RADIO_ERP1",2:"RESPONSE",3:"RADIO_SUB_TEL",4:"EVENT",5:"COMMAND_COMMAND",6:"SMART_ACK_COMMAND",7:"REMOTE_MAN_COMMAND",9:"RADIO_MESSAGE",10:"RADIO_ERP2",16:"RADIO_802_15_4",17:"COMMAND_2_4"};g.prototype.toBuffer=function(){var a=new Buffer(6);a.writeUInt8(85,0);a.writeUInt16BE(this.data.length,1);a.writeUInt8(this.optData?this.optData.length:0,3);a.writeUInt8(this.type,4);a.writeUInt8(0,5);var c=
x.hub.m.enocean.CRC8(a.slice(1,5));a.writeUInt8(c,5);var e=this.optData?Buffer.concat([this.data,this.optData],this.data.length+this.optData.length):this.data;c=x.hub.m.enocean.CRC8(e);a=Buffer.concat([a,e],6+e.length+1);a.writeUInt8(c,a.length-1);return a};g.prototype.toJSON=function(){return{dataLen:this.data.length,optLen:this.optData?this.optData.length:0,type:this.type,typeName:g.TYPE[this.type],data:this.data.toString("hex"),optData:this.optData?this.optData.toString("hex"):null}};g.prototype.toPacket=
function(){return e.resolve(this)};var e=function(){};e.resolve=function(e){switch(e.type){case 1:return f.resolve(e);case 2:return a.resolve(e);case 4:return h.resolve(e);case 5:return k.resolve(e);case 6:return c.resolve(e);default:return null}};var a=function(a,c,e){this.retCode=a;this.resData=c;this.optData=e};a.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};a.prototype.toJSON=function(){return{retCodeName:a.CODE[this.retCode],
retCode:this.retCode.toString(16),resData:this.resData?this.resData.toString("hex"):null,optData:this.optData?this.optData.toString("hex"):null}};a.prototype.toFrame=function(){var a=new Buffer(1);a.writeUInt8(this.retCode,0);this.resData&&(a=Buffer.concat([a,this.resData]));return new g(2,a,this.optData)};a.prototype.toResponse=function(){return t.resolve(this)};a.resolve=function(c){var e;var f=c.data.readUInt8(0);1<c.data.length&&(e=c.data.slice(1));return new a(f,e,c.optData)};var f=function(a,
c,e,f,g,h){this.data=a;if(this.hasOpt=c)this.subTelNum=e,this.dstId=f,this.dBm=g,this.securityLvl=h};f.prototype.toJSON=function(){var a={data:this.data.toString("hex")};this.hasOpt&&(a.subTelNum=this.subTelNum.toString(16),a.dstId=this.dstId,a.dBm=this.dBm.toString(16),a.securityLvl=this.securityLvl);return a};f.prototype.toFrame=function(){var a=this.data,c=null;this.hasOpt&&(c=new Buffer([this.subTelNum]),c=Buffer.concat([c,new Buffer(this.dstId,"hex")]),c=Buffer.concat([c,new Buffer([this.dBm,
this.securityLvl])]));return new g(1,a,c)};f.prototype.toRadioTelegram=function(){return l.resolve(this)};f.resolve=function(a){var c=!1;if(a.optData){c=!0;var e=a.optData.readUInt8(0);var p=a.optData.slice(1,5).toString("hex");var g=a.optData.readUInt8(5);var h=a.optData.readUInt8(6)}return new f(a.data,c,e,p,g,h)};var c=function(a){this.data=a};c.prototype.toJSON=function(){return{data:this.data.toString("hex")}};c.prototype.toFrame=function(){return new g(6,this.data,null)};c.prototype.toSACommand=
function(){return O.resolve(this)};c.resolve=function(a){return new c(a.data)};var k=function(a){this.data=a};k.prototype.toJSON=function(){return{data:this.data.toString("hex")}};k.prototype.toFrame=function(){return new g(5,this.data,null)};k.prototype.toCommandCommand=function(){return oa.resolve(this)};k.resolve=function(a){return new k(a.data)};var h=function(a){this.data=a};h.prototype.toJSON=function(){return{data:this.data.toString("hex")}};h.prototype.toFrame=function(){return new g(4,this.data,
null)};h.prototype.toEvent=function(){return n.resolve(this)};h.resolve=function(a){return new h(a.data)};var l=function(a,c){this.rorg=a;this.optData=c;this.optData||(this.optData={subTelNum:1,dstId:"FFFFFFFF",dBm:255,securityLvl:0})};l.prototype.setDstId=function(a){this.optData.dstId=a?a:"FFFFFFFF"};l.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 208:return C.resolve(a);case 246:return I.resolve(a);case 213:return J.resolve(a);case 165:return z.resolve(a);case 210:return w.resolve(a);
case 212:return V.resolve(a);case 53:return Y.resolve(a);case 49:return P.resolve(a);case 64:return y.resolve(a);case 176:return r.resolve(a);case 178:return v.resolve(a);default:return null}};var r=function(){var a=function(a,c,e){8<=e&&(e=8);0>=e&&(e=1);var f=Math.floor(c/8),p=c%8;c=Math.pow(2,e)-1;if(8<p+e)return e=16-p-e,a.readUInt16BE(f)>>e&c;e=8-p-e;return a.readUInt8(f)>>e&c},c=function(a){this.type=a};c.prototype.getType=function(){return this.type};c.resolve=function(c,p){if(p+2>8*c.length)return null;
var h=a(c,p,2),H=null;switch(h){case 0:H=e.resovle(c,p);break;case 1:H={type:h,sigType:c.readUInt16BE(0)>>6&255,valueType:c.readUInt16BE(0)>>2&3,resolution:c.readUInt16BE(0)&15,engMin:c.readUInt8(2),scalingMin:c.readUInt16BE(3)>>12&15,engMax:c.readUInt16BE(3)>>4&255,scalingMax:c.readUInt16BE(3)&15};break;case 2:H=f.resovle(c,p);break;case 3:H=g.resovle(c,p)}return H};var e=function(a,c,e){this.type=0;this.sigType=a;this.dataLen=c;this.data=e};e.prototype=new c;e.prototype.constructor=e;e.prototype.getBitLength=
function(){return 2==this.sigType?50:18};e.prototype.getProductID=function(){return 2==this.sigType?this.data?this.data.readUInt32BE(0):null:null};e.resovle=function(c,f){if(f+18>8*c.legnth)return null;var p=a(c,f+2,8),g=a(c,f+10,8),h=null;if(2==p){if(f+50>8*c.legnth)return null;h=new Buffer(4);h.writeUInt8(a(c,f+18,8),0);h.writeUInt8(a(c,f+26,8),1);h.writeUInt8(a(c,f+34,8),2);h.writeUInt8(a(c,f+42,8),3)}else 1==p&&(h=null);return new e(p,g,h)};new c;var f=function(a,c){this.type=2;this.sigType=a;
this.valueType=c};f.prototype=new c;f.prototype.constructor=f;f.prototype.getBitLength=function(){return 12};f.resovle=function(c,e){if(e+12>8*c.length)return null;var p=a(c,e+2,8);c=a(c,e+10,2);return new f(p,c)};f.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType}};var g=function(a,c,e){this.type=3;this.sigType=a;this.valueType=c;this.resolution=e};g.prototype=new c;g.prototype.constructor=g;g.prototype.getBitLength=function(){return 16};g.prototype.toJSON=function(){return{sigType:this.sigType,
valueType:this.valueType,resolution:this.resolution}};g.resovle=function(c,e){if(e+16>8*c.length)return null;var f=a(c,e+2,8),p=a(c,e+10,2);c=a(c,e+12,4);return new g(f,p,c)};var h=function(a,c,e){l.call(this,176);this.manufacturerID=a;this.dataDirection=c;this.purpose=e;this.productID=null;this.outboudChannels={};this.inboundChannels={};this.status=this.senderID=null};h.prototype=new l;h.prototype.constructor=h;h.prototype.getManufacturerId=function(){return this.manufacturerID};h.prototype.getProductId=
function(){return this.productID};h.prototype.toJSON=function(){var a={manufacturerID:this.manufacturerID,dataDirection:this.dataDirection,purpose:this.purpose,productID:this.productID,outboudChannels:{},inboundChannels:{}},c;for(c in this.outboudChannels)a.outboudChannels[c]=this.outboudChannels[c].toJSON();for(c in this.inboundChannels)a.inboundChannels[c]=this.inboundChannels[c].toJSON();return a};h.resolve=function(a){var e=a.data;a=e.readUInt16BE(1)>>5&2047;var f=e.readUInt16BE(1)>>4&1,p=e.readUInt16BE(1)>>
2&3;a=new h(a,f,p);f=e.slice(3,e.length-5);p=e.slice(e.length-5,e.length-1);e=e.readUInt8(e.length-1);a.senderID=p.toString("hex");a.status=e;for(var g=p=e=0;;){var H=c.resolve(f,p);if(!H)break;0==e?0==H.getType()?a.productID=H.getProductID():(a.outboudChannels[g]=H,g++,e=1):1==e?0==H.getType()?e=2:(a.outboudChannels[g]=H,g++,e=1):2==e&&(a.inboundChannels[g]=H,g++);p+=H.getBitLength()}return a};return h}(),m=function(){var a=function(a,c,e,f,p){l.call(this,177);this.manufacturerID=a;this.result=c;
this.chnAcknoledgement=e;this.senderID=f;this.status=p};a.prototype=new l;a.prototype.constructor=a;a.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt8(this.rorg,0);a.writeUInt16BE(this.manufacturerID<<5|this.result<<3,1);if(3==this.result){var c=[];if(this.chnAcknoledgement){for(var e=Math.ceil(this.chnAcknoledgement.length/8),p=0;p<e.length;p++)c.push(0);for(e=0;e<this.chnAcknoledgement.length;e++)p=Math.floor(e/8),c[p]|=chnAcknoledgement[e]<<8-e%8-1}a=Buffer.concat([a,new Buffer(c)])}a=
Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);c=1;e="FFFFFFFF";p=255;var g=0;this.optData&&(c=this.optData.subTelNum,e=this.optData.dstId,p=this.optData.dBm,g=this.optData.securityLvl);return new f(a,!0,c,e,p,g)};a.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),manufacturerID:this.manufacturerID.toString(16),result:this.result,chnAcknoledgement:this.chnAcknoledgement,senderID:this.senderID,receiverID:this.receiverID}};return a}(),
v=function(){var a=function(a,c,e){l.call(this,178);this.data=a;this.senderID=c;this.status=e};a.prototype=new l;a.prototype.constructor=a;a.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);this.data&&(a=Buffer.concat([a,this.data]));a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);var c=1,e="FFFFFFFF",p=255,g=0;this.optData&&(c=this.optData.subTelNum,e=this.optData.dstId,p=this.optData.dBm,g=this.optData.securityLvl);return new f(a,
!0,c,e,p,g)};a.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),data:this.data?this.data.toString("hex"):null,senderID:this.senderID,status:this.status}};a.resolve=function(c){var e=c.data;c=e.slice(1,e.length-5);var f=e.slice(e.length-5,e.length-1);e=e.readUInt8(e.length-1);return new a(c,f.toString("hex"),e)};return a}(),y=function(a,c,e,f,g,h,k,m){l.call(this,64,m);this.seq=a;this.idx=c;this.len=e;this.crorg=f;this.data=g;this.senderID=h;this.status=k};y.prototype=new l;y.prototype.constructor=
y;y.prototype.getSenderID=function(){return this.senderID};y.prototype.getSeq=function(){return this.seq};y.prototype.getIdx=function(){return this.idx};y.prototype.getLen=function(){return this.len};y.prototype.getCRORG=function(){return this.crorg};y.prototype.getData=function(){return this.data};y.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),seq:this.seq,idx:this.idx,len:this.len,crorg:this.crorg?this.crorg.toString(16):null,data:this.data.toString("hex"),senderID:this.senderID,
status:this.status}};y.resolve=function(a){var c=a.data,e=c.readUInt8(1)>>6&3,f=c.readUInt8(1)&63;if(0==f){var p=c.readUInt16BE(2);var g=c.readUInt8(4);var h=c.slice(5,c.length-5)}else g=p=null,h=c.slice(2,c.length-5);var k=c.slice(c.length-5,c.length-1).toString("hex");c=c.readUInt8(c.length-1);var l;a.hasOpt&&(l={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new y(e,f,p,g,h,k,c,l)};var C=function(a,c,e,f){l.call(this,208,f);this.messageIndex=a;this.userData=c;
this.senderID=e};C.prototype=new l;C.prototype.constructor=C;C.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),messageIndex:this.messageIndex,userData:this.userData?this.userData.toString("hex"):null,senderID:this.senderID}};C.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.messageIndex,1);this.userData&&(a=Buffer.concat([a,this.userData]));a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);var c=1,e="FFFFFFFF",g=255,h=0;this.optData&&
(c=this.optData.subTelNum,e=this.optData.dstId,g=this.optData.dBm,h=this.optData.securityLvl);return new f(a,!0,c,e,g,h)};C.resolve=function(a){var c=a.data,e=c.readUInt8(1),f=null,p=null;switch(e){case 1:f=0;p=c.slice(2,6).toString("hex");break;case 4:case 6:f=c.slice(2,3),p=c.slice(3,7).toString("hex")}var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new C(e,f,p,g)};var I=function(a,c,e,f,g,h){l.call(this,246,h);this.userData=a?a:0;this.senderID=
c;this.t21=e?e:0;this.nu=f?f:0;this.rc=g?g:0};I.prototype=new l;I.prototype.constructor=I;I.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),senderID:this.senderID,t21:this.t21,nu:this.nu,rc:this.rc}};I.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.userData,1);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.t21<<5|this.nu<<4||this.rc])]);var c=1,e="FFFFFFFF",g=
255,h=0;this.optData&&(c=this.optData.subTelNum,e=this.optData.dstId,g=this.optData.dBm,h=this.optData.securityLvl);return new f(a,!0,c,e,g,h)};I.resolve=function(a){var c=a.data,e=c.readUInt8(1),f=c.slice(2,6).toString("hex"),g=c.readUInt8(6)>>5&1,p=c.readUInt8(6)>>4&1,h;a.hasOpt&&(h={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new I(e,f,g,p,c&15,h)};var J=function(a,c,e,f){l.call(this,213,f);this.userData=a;this.senderID=c;this.rc=e?e:0};J.prototype=new l;J.prototype.constructor=
J;J.prototype.getLearnBit=function(){return this.userData>>3&1};J.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),learn:this.getLearnBit(),senderID:this.senderID,rc:this.rc}};J.resolve=function(a){var c=a.data,e=c.readUInt8(1),f=c.slice(2,6).toString("hex");c=c.readUInt8(6)&15;var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new J(e,f,c,g)};var z=function(a,c,e,f){l.call(this,165,f);this.userData=
a;this.senderID=c;this.rc=e?e:0};z.prototype=new l;z.prototype.constructor=z;z.prototype.getLearnType=function(){return this.userData.readUInt8(3)>>7&1};z.prototype.getLearnBit=function(){return this.userData.readUInt8(3)>>3&1};z.prototype.getLearnStatus=function(){return this.userData.readUInt8(3)>>4&1};z.prototype.getLearnResult=function(){return this.userData.readUInt8(3)>>5&1};z.prototype.getEEPResult=function(){return this.userData.readUInt8(3)>>6&1};z.prototype.getFunc=function(){return this.userData.readUInt8(0)>>
2&63};z.prototype.getType=function(){var a=this.userData.readUInt8(0)&3,c=this.userData.readUInt8(1)>>3&31;return a<<5|c};z.prototype.getManufacturerId=function(){var a=this.userData.readUInt8(1)&7,c=this.userData.readUInt8(2);return a<<8|c};z.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),learnType:this.getLearnType(),learn:this.getLearnBit(),learnStatus:this.getLearnStatus(),learnResult:this.getLearnResult(),eepResult:this.getEEPResult(),func:this.getFunc(),
type:this.getType(),manufacturerId:this.getManufacturerId(),senderID:this.senderID,rc:this.rc}};z.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.rc&15])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};z.resolve=function(a){var c=a.data,e=c.slice(1,5),f=c.slice(5,9).toString("hex");
c=c.readUInt8(9)&15;var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new z(e,f,c,g)};var w=function(a,c,e,f){l.call(this,210,f);this.userData=a;this.senderID=c;this.status=e};w.prototype=new l;w.prototype.constructor=w;w.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};w.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,
0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};w.resolve=function(a){var c=a.data,e=c.slice(1,c.length-5),f=c.slice(c.length-5,c.length-1).toString("hex");c=c.readUInt8(c.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new w(e,
f,c,g)};var Q=function(a,c,e,f,g){l.call(this,166);this.rorg_en=a;this.data=c;this.dstID=e;this.senderID=f;this.status=g};Q.prototype=new l;Q.prototype.constructor=Q;Q.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.rorg_en,1);a=Buffer.concat([a,this.data]);a=Buffer.concat([a,new Buffer(this.dstID,"hex")]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return new f(a,!1)};var V=function(a,c,e,f,g,h,
k,m,r,n,t){l.call(this,212);this.cmd=a;this.ute=c;this.rspExpected=e;this.subtype=f;this.numChannel=g;this.manufactureID=h;this.eepType=k;this.eepFunc=m;this.eepRorg=r;this.senderID=n;this.status=t};V.prototype=new l;V.prototype.constructor=V;V.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),ute:this.ute,rspExpected:this.rspExpected,subtype:this.subtype,cmd:this.cmd,numChannel:this.numChannel,manufactureID:this.manufactureID,eepType:this.eepType.toString(16),eepFunc:this.eepFunc.toString(16),
eepRorg:this.eepRorg.toString(16),senderID:this.senderID,status:this.status}};V.prototype.toPacket=function(){var a=new Buffer(8);a.writeUInt8(this.rorg,0);a.writeUInt8(this.ute<<7|this.rspExpected<<6|this.subtype<<4|this.cmd,1);a.writeUInt8(this.numChannel,2);a.writeUInt16BE(parseInt(this.manufactureID,16),3);a.writeUInt8(this.eepType,5);a.writeUInt8(this.eepFunc,6);a.writeUInt8(this.eepRorg,7);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?
new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};V.resolve=function(a){var c=a.data.slice(1,8),e=a.data.slice(8,12).toString("hex"),f=a.data.readUInt8(12),g=c.readUInt8(0)>>7&1,h=c.readUInt8(0)&15,p=c.readUInt8(1),k=c.slice(2,4).toString("hex"),l=c.readUInt8(4),m=c.readUInt8(5),r=c.readUInt8(6),n=c.readUInt8(0)>>6&1;c=c.readUInt8(0)>>4&3;e=new V(h,g,n,c,p,k,l,m,r,e,f);a.hasOpt&&(e.optData={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});
return e};var Y=function(a,c,e,f){l.call(this,53,f);this.userData=a;this.senderID=c;this.status=e};Y.prototype=new l;Y.prototype.constructor=Y;Y.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};Y.resolve=function(a){var c=a.data,e=c.slice(1,c.length-5),f=c.slice(c.length-5,c.length-1).toString("hex");c=c.readUInt8(c.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,
dBm:a.dBm,securityLvl:a.securityLvl});return new Y(e,f,c,g)};var P=function(a,c,e,f){l.call(this,49,f);this.userData=a;this.senderID=c;this.status=e};P.prototype=new l;P.prototype.constructor=P;P.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};P.prototype.convertToPacket=function(a){a=Buffer.concat([a,new Buffer(this.senderID,"hex"),new Buffer([this.status])]);return this.optData?
new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};P.resolve=function(a){var c=a.data,e=c.slice(1,c.length-5),f=c.slice(c.length-5,c.length-1).toString("hex");c=c.readUInt8(c.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new P(e,f,c,g)};l.SIG=C;l.RPS=I;l.BS1=J;l.BS4=z;l.VLD=w;l.ADT=Q;l.UTE=V;l.TS=Y;l.SM=P;l.GP_TI=r;l.GP_TR=m;l.GP_CD=v;var t=function(a,c){this._code=a;this._rspData=
c};t.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};t.prototype.toJSON=function(){return{code:this._code,rspData:this._rspData?this._rspData.toString("hex"):null}};t.prototype.toPacket=function(){return new a(this._code,this._rspData)};t.resolve=function(a){return new t(a.retCode,a.resData)};m=function(a,c){t.call(this,0);this._responseTime=a;this._confirmCode=c};m.prototype.toPacket=
function(){var c=new Buffer(3);c.writeUInt16BE(this._responseTime,0);c.writeUInt8(this._confirmCode,2);return new a(this._code,c)};m.prototype.toJSON=function(){return{code:this._code,responseTime:this._responseTime,confirmCode:this._confirmCode}};t.Response_OK_SA_CONFIRM_LEARN=m;var n=function(a){this._code=a};n.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 1:return Z.resolve(a);case 2:return K.resolve(a);default:return null}};var Z=function(){this._code=1};Z.prototype=
new n;Z.prototype.constructor=Z;Z.prototype.toJSON=function(){return{code:this._code}};Z.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new h(a)};Z.resolve=function(a){return new Z};var K=function(a,c,e,f,g,h,k){this._code=2;this._priority=a;this._manufacturerId=c;this._eep=e;this._rssi=f;this._pm_candidateId=g;this._sa_clientId=h;this._hop_count=k};K.prototype=new n;K.prototype.constructor=K;K.prototype.getEEP=function(){return this._eep?this._eep.substr(0,2)+
"-"+this._eep.substr(2,2)+"-"+this._eep.substr(4,2):null};K.prototype.getPMCandidateId=function(){return this._pm_candidateId};K.prototype.getSAClientId=function(){return this._sa_clientId};K.prototype.getHopCount=function(){return this._hop_count};K.prototype.toJSON=function(){return{code:this._code,priority:this._priority,manufacturerId:this._manufacturerId,eep:this.getEEP(),rssi:this._rssi,pm_candidateId:this._pm_candidateId,sa_clientId:this._sa_clientId,hop_count:this._hop_count}};K.prototype.toPacket=
function(){var a=new Buffer(4);a.writeUInt8(this._code,0);a.writeUInt8(this._priority,1);a.writeUInt16BE(this._manufacturerId&1023,2);a=Buffer.concat([a,new Buffer(this._eep,"hex")]);a=Buffer.concat([a,new Buffer([this._rssi])]);a=Buffer.concat([a,new Buffer(this._pm_candidateId,"hex")]);a=Buffer.concat([a,new Buffer(this._sa_clientId,"hex")]);a=Buffer.concat([a,new Buffer([this._hop_count])]);return new h(a)};K.resolve=function(a){var c=a.data;a=c.readUInt8(1);var e=c.readUInt16BE(2)&1023,f=c.slice(4,
7).toString("hex"),g=c.readUInt8(7),h=c.slice(8,12).toString("hex"),k=c.slice(12,16).toString("hex");c=c.readUInt8(16);return new K(a,e,f,g,h,k,c)};n.SA_RECLAIM_NOT_SUCCESSFUL=Z;n.SA_CONFIRM_LEARN=K;var oa=function(a){this._code=a};oa.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 9:return CO_WR_REPEATER.resolve(a);default:return null}};CO_WR_REPEATER=function(a,c){this._code=9;this._enable=a;this._level=c};CO_WR_REPEATER.prototype=new oa;CO_WR_REPEATER.prototype.constructor=
CO_WR_REPEATER;CO_WR_REPEATER.prototype.toJSON=function(){return{code:this._code,enable:this._enable,level:this._level}};CO_WR_REPEATER.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt8(this._code,0);a.writeUInt8(this._enable,1);a.writeUInt8(this._level,2);return new k(a)};CO_WR_REPEATER.resolve=function(a){a=a.data.readUInt8(1);var c=CO_WR_REPEATER.readUInt8(2);return new CO_WR_REPEATER(a,c)};oa.CO_WR_REPEATER=CO_WR_REPEATER;var O=function(a){this._code=a};O.resolve=function(a){if(!a.data)return null;
switch(a.data.readUInt8(0)){case 1:return R.resolve(a);case 6:return aa.resolve(a);case 8:return ba.resolve(a);default:return null}};var R=function(a,c,e){this._code=1;this._enable=a;this._extended=c;this._timeout=e};R.prototype=new O;R.prototype.constructor=R;R.prototype.toJSON=function(){return{code:this._code,enable:this._enable,extended:this._extended,timeout:this._timeout}};R.prototype.toPacket=function(){var a=new Buffer(7);a.writeUInt8(this._code,0);a.writeUInt8(this._enable,1);a.writeUInt8(this._extended,
2);a.writeUInt32BE(this._timeout,3);return new c(a)};R.resolve=function(a){var c=a.data;a=c.readUInt8(1);var e=c.readUInt8(2);c=c.readUInt32BE(3);return new R(a,e,c)};var da=function(a){this._code=5;this._saClientId=a};da.prototype=new O;da.prototype.constructor=da;da.prototype.toJSON=function(){return{code:this._code,clientId:this._saClientId}};da.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);a=Buffer.concat([a,new Buffer(this._saClientId,"hex")]);return new c(a)};
da.resolve=function(a){a=a.data.slice(1,5).toString("hex");return new da(a)};var aa=function(){this._code=6};aa.prototype=new O;aa.prototype.constructor=aa;aa.prototype.toJSON=function(){return{code:this._code}};aa.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new c(a)};aa.resolve=function(a){return new aa};var ba=function(a){this._code=8;this._mailBoxCount=a};ba.prototype=new O;ba.prototype.constructor=ba;ba.prototype.toJSON=function(){return{code:this._code,
mailBoxCount:this._mailBoxCount}};ba.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this._code,0);a.writeUInt8(this._mailBoxCount,1);return new c(a)};ba.resolve=function(a){a=a.data.readUInt8(1);return new ba(a)};O.SA_WR_LEARNMODE=R;O.SA_WR_RESET=da;O.SA_RD_LEARNEDCLIENTS=aa;O.SA_WR_POSTMASTER=ba;var Na=function(){var a=function(a){this._esp3=a;this._buffer={}};a.prototype.receiveChainedTelegram=function(a){var c=a.getSenderID(),e=a.getSeq(),f=a.getIdx();this._buffer[c]||(this._buffer[c]=
{});var g=this._buffer[c];g[e]||(g[e]=[]);g=g[e];for(var h=0;h<=f;h++)h!=f?g.length<f&&(g[h]=null):g[h]=a;this._checkChain(c,e)};a.prototype._checkChain=function(a,c){var e=this._buffer[a][c];if(e[0]){var g=e[0],h=g.getLen(),k=g.getCRORG();g=0;var l=new Buffer(1);l.writeUInt8(k);for(k=0;k<e.length;k++){var p=e[k];if(!p)return;p=p.getData();g+=p.length;l=Buffer.concat([l,p])}g>=h&&(delete this._buffer[a][c],l=Buffer.concat([l,new Buffer(a,"hex")]),l=Buffer.concat([l,new Buffer("00","hex")]),a=new f(l,
!1),this._esp3._onEORadio_ERP1(a))}};return a}(),u=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP3");this._controller=a;this._listeners=[];a&&this._listeners.push(a);this._recomm=new x.hub.m.enocean.ReComm(this);this._baseID=this._serial=null;this._rdata=new Buffer([]);this._frameBuffer=[];this._learnHandler=null;this._learning=!1;this._learnTO=null;this._cdmHandler=new Na(this)};u.RESPONSE_TO=1500;u.prototype.attachSerial=function(a,c){var e=this;this._serial=new x.hub.m.enocean.Serial(a);
this._serial.setListener(this);this._serial.open(function(a){a?(e._serial.setListener(null),e._serial=null,c&&c(a)):e.readBaseID(function(a,f){a?(e._serial.setListener(null),e._serial.close(),e._serial=null,c&&c(a)):(x.hub.m.enocean.SENDER_ID||(x.hub.m.enocean.SENDER_ID=f,localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID",f)),e._baseID=f,c&&c())})})};u.prototype.removeSerial=function(a,c){this._serial.setListener(null);this._serial.close();this._baseID=this._serial=null;c&&c()};u.prototype.getSerial=
function(){return this._serial};u.prototype.addListener=function(a){a&&-1==this._listeners.indexOf(a)&&this._listeners.push(a)};u.prototype.removeListener=function(a){a&&(a=this._listeners.indexOf(a),-1!=a&&this._listeners.splice(a,1))};u.prototype.readBaseID=function(a){var c=this,e=new g(5,new Buffer("08","hex"));this.sendFrame(e,!0,function(e,f){e?(c._logger.log("warn","read base id error:"+e.stack),a&&a(e)):f&&f.retCode?(e=Error("read BaseID error"),e.code=f.retCode,c._logger.log("warn","read base id error return code:"+
f.retCode),a&&a(e)):(e=f.resData.toString("hex"),a&&a(null,e.toLowerCase()))},8E3)};u.prototype.startLearn=function(a,c,e,f){if(this._serial){if(!c||0>=c)c=3E4;if(this._learning)f&&f(Error("learning another type right now"));else{this._learnHandler=a;this._learning=!0;var g=this;this._learnTO=setTimeout(function(){g._learning=!1;g._learnTO=null;var a=g._learnHandler;g._learnHandler=null;if(a&&a.onLearnTimeout)a.onLearnTimeout()},c);e?(a=new R(1,e.extended?e.extended:0,0),this.sendSACommand(a,!0,function(a){f&&
f(a)})):f&&f()}}else f&&f(Error("port not opened"))};u.prototype.stopLearn=function(a,c,e){this._learnTO&&clearTimeout(this._learnTO);this._learning=!1;this._learnTO=this._learnHandler=null;if(c){e&&e();var f=this;setTimeout(function(){var a=new R(0,c.extended?c.extended:0,0);f.sendSACommand(a,!0,function(a){e&&e(a)})},2E3)}else e&&e()};u.prototype.sendTelegram=function(a,c,e){this.sendPacket(a.toPacket(),c,e)};u.prototype.sendResponse=function(a,c){this._logger.log("trace","send RESPONSE:"+JSON.stringify(a.toJSON()));
this.sendPacket(a.toPacket(),!1,c)};u.prototype.sendSACommand=function(a,c,e){this._logger.log("trace","send SA_COMMAND:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),c,e)};u.prototype.sendCommandCommand=function(a,c,e){this._logger.log("trace","send COMMAND_COMMAND:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),c,e)};u.prototype.sendPacket=function(a,c,e){this.sendFrame(a.toFrame(),c,e)};u.prototype.sendFrame=function(a,c,e,f){var g=this._frameBuffer.length;this._frameBuffer.push({frame:a,
callback:e,timeout:null,response:c,to:f});0==g&&this._sendNextFrame()};u.prototype._sendNextFrame=function(){if(0!=this._frameBuffer.length){var a=this._frameBuffer[0],c=a.frame,e=a.callback,f=a.response;if(this._serial){var g=this;c=c.toBuffer();this._logger.log("trace","send raw frame:"+c.toString("hex"));this._serial.sendPacket(c,function(c){if(c||!f){try{e&&e(c)}catch(Ea){}g._frameBuffer.splice(0,1);g._sendNextFrame()}else c=a.to,c||(c=u.RESPONSE_TO),a.timeout=setTimeout(function(){var a=g._frameBuffer[0];
if(a){a=a.callback;var c=Error("enocean response timeout");c.code=100;try{a&&a(c)}catch(bb){}}g._frameBuffer.splice(0,1);g._sendNextFrame()},c)})}else e&&e(Error("port not opened")),this._frameBuffer.splice(0,1),this._sendNextFrame()}};u.prototype.onSerialData=function(a){a=this._rdata=Buffer.concat([this._rdata,a]);for(var c=0;c<a.length;)if(85!=a[c])c++;else{if(c+6>=a.length)break;var e=(a[c+1]<<8)+a[c+2],f=a[c+3],h=a[c+5];if(a.length<c+e+f+7)break;if(x.hub.m.enocean.CRC8(a.slice(c+1,c+5))!=h)c++;
else if(h=a[c+e+f+6],x.hub.m.enocean.CRC8(a.slice(c+6,c+6+e+f))!=h)c++;else{h={type:a[c+4],dataLen:e,optLen:f,radioType:a[c+6],data:a.slice(c+6,c+6+e),optData:a.slice(c+6+e,c+6+e+f),rawByte:a.slice(0,c+6+e+f+1).toString("hex")};var k=new g(h.type,h.data,h.optData);if(166==h.radioType||210==h.radioType||165==h.radioType||246==h.radioType||213==h.radioType)h.senderId=h.data.slice(e-5,e-1).toString("hex");try{this._onEOFrame(k,h)}catch(Ea){this._logger.log("warn","process frame exception:"+Ea.stack)}c=
c+6+e+f+1}}0!=c&&0<a.length&&c<=a.length&&(a=a.slice(c));this._rdata=a};u.prototype.onSerialError=function(a){this._serial.setListener(null);this._serial=null};u.prototype._onEOFrame=function(a,c){this._logger.log("trace","receive raw frame:"+c.rawByte);this._logger.log("debug","receive enocean frame:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(e){e._onEOFrame&&e._onEOFrame(a,c.rawByte)});var e=a.toPacket();e&&this._onEOPacket(e)};u.prototype._onEOPacket=function(c){this._logger.log("debug",
"receive enocean packet:"+JSON.stringify(c.toJSON()));this._listeners.forEach(function(a){a._onEOPacket&&a._onEOPacket(c)});c instanceof f?this._onEORadio_ERP1(c):c instanceof a?this._onEOResponse_Packet(c):c instanceof h&&this._onEOEvent_Packet(c)};u.prototype._onEORadio_ERP1=function(a){(a=a.toRadioTelegram())&&this._onEO_ERP1_Telegram(a)};u.prototype._onEOResponse_Packet=function(a){try{var c=a.toResponse();this._onEO_Response(c)}catch(Ma){}if(0!=this._frameBuffer.length){var e=this._frameBuffer[0];
c=e.callback;(e=e.timeout)&&clearTimeout(e);try{c&&c(null,a)}catch(Ma){}this._frameBuffer.splice(0,1);this._sendNextFrame()}};u.prototype._onEOEvent_Packet=function(a){(a=a.toEvent())&&this._onEO_Event(a)};u.prototype._onEO_ERP1_Telegram=function(a){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(a.toJSON()));if(64==a.rorg)this._cdmHandler.receiveChainedTelegram(a);else if(this._listeners.forEach(function(c){c._onEOTelegram&&c._onEOTelegram(a)}),49==a.rorg&&(a=this._controller._secHandler.resolve(a))&&
this._listeners.forEach(function(c){c._onEOTelegram&&c._onEOTelegram(a)}),this._learning&&this._learnHandler&&this._learnHandler.onTelegram)this._learnHandler.onTelegram(a)};u.prototype._onEO_Response=function(a){this._logger.log("debug","receive enocean response:"+JSON.stringify(a.toJSON()))};u.prototype._onEO_Event=function(a){this._logger.log("debug","receive enocean event:"+JSON.stringify(a.toJSON()));if(this._learning&&this._learnHandler&&this._learnHandler.onEvent)this._learnHandler.onEvent(a)};
u.ESP3_Frame=g;u.Telegram=l;u.RADIO_ERP1_Packet=f;u.Event=n;u.Response=t;u.COMMAND_COMMAND=oa;u.SA_COMMAND=O;return u}();
x.hub.m.enocean.profiles=function(){var g=function(b){this._address=b?b.address:null;this._senderID=b?b.senderID:null;this._data=b?b.data:null;this._params=b?b.params:null;this._vendor="general";this._virtual=!1;this._eepAlias=null;this.setDefaultParams();this._states={};this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles."+(this._data?this._data:"Profile"))};g.prototype.getAddress=function(){return this._address};g.prototype.getData=function(){return this._data};g.prototype.finalize=
function(b){b&&b()};g.prototype.evalData=function(b,d,a){(b=this.evalTelegram(d))?(b=this.checkStateChange(b),a&&a(null,b)):a&&a(Error("data format invalid"))};g.prototype.evalTelegram=function(b){return null};g.prototype.getStatesBuffer=function(){return this._states};g.prototype.getBufferedState=function(b){var d=this.getStatesBuffer();return d&&d[b]?d[b].value:null};g.prototype.getCurrentStates=function(){var b={},d=this.getStatesBuffer(),a;for(a in d)d.hasOwnProperty(a)&&d[a]&&(b[a]=d[a].value);
return b};g.prototype.getStatesLegacy=function(){var b=this.getCurrentStates();return{type:"ENOCEAN",adr:this._address,data:this._data,vendor:this._vendor,state:b}};g.prototype.checkStateChange=function(b){var d=this._states,a=[],c=(new Date).getTime(),e;for(e in b){var f={};f.key=e;f.value=b[e];f.changed=!1;var g=d[e]?d[e].value:null;g!=b[e]&&(f.oldvalue=g,f.changed=!0);this._states[e]={value:b[e],time:c};a.push(f)}return a};g.prototype.setDefaultParams=function(){};g.prototype.activeStateChange=
function(b){b=this.checkStateChange(b);0<b.length&&require("x.hub.m.enocean.js")._onEOEvents(this,b)};g.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params}};g.prototype.fromJSON=function(b){if(!b||!b.address||!b.data||b.data!=this._data)return null;this._address=b.address;this._senderID=b.senderID;this._vendor=b.vendor?b.vendor:this._vendor;this._virtual=b.virtual?!0:!1;this._params=
b.params;this.setDefaultParams();return this};g.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual}};g.prototype.fromDBJSON=function(b){if(!b||!b.id||!b.eep||b.eep!=this._data)return null;this._address=b.id;this._senderID=b.senderID;this._vendor=b.vendor?b.vendor:this._vendor;this._virtual=b.virtual?!0:!1;this._params=b.params;this.setDefaultParams();return this};var e=function(b){g.call(this,b);
this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SiegeniaWindow");this._data="d2-06-50";this._vendor="siegenia";this._desc="Window";this._states={counter00:{value:"?",time:-1},counter01:{value:"?",time:-1},counter02:{value:"?",time:-1},counter03:{value:"?",time:-1},counter04:{value:"?",time:-1},counter05:{value:"?",time:-1},counter06:{value:"?",time:-1},counter07:{value:"?",time:-1},counter08:{value:"?",time:-1},counter09:{value:"?",time:-1},counter0A:{value:"?",time:-1},aliveTimeout:{value:!1,
time:-1}};var d=this;this._params=b?b.params:null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});this._aliveTO=setTimeout(function(){d._aliveTimeout()},2E3*this._params.alive)};e.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"SIEGENIA-AUBI KG",vendor:"siegenia",params:{alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}};e.prototype=new g;e.prototype.constructor=e;e.prototype.evalTelegram=function(b){var d={};if(210==b.rorg)if(b=b.userData,1==b[0]&&8==b.length){var a=
b[1]&239,c=(b[2]<<24)+(b[3]<<16)+(b[4]<<8)+b[5],e=b[6]>>7;d={type:1,TBT:!1,batteryOK:!0,battery:b[6]&127,motionSensor:b[7]>>6,accelerationSensor:(b[7]&48)>>4,magneticSensor:(b[7]&12)>>2,error:b[7]&3,count:c};e&&(d.batteryOK=!1);100<d.battery&&(d.battery=100);d.code=a;switch(a){case 0:d.state="?";d.handle="?";d.counter00=c;break;case 1:d.state="closed";d.handle="closed";d.counter01=c;break;case 2:d.state="closed";d.handle="open";d.counter02=c;break;case 3:d.state="closed";d.handle="tilted";d.counter03=
c;break;case 4:d.state="open";d.handle="closed";d.counter04=c;break;case 5:d.state="open";d.handle="open";d.TBT=!0;d.counter05=c;break;case 6:d.state="open";d.handle="tilted";d.TBT=!0;d.counter06=c;break;case 7:d.state="tilted";d.handle="closed";d.TBT=!0;d.counter07=c;break;case 8:d.state="tilted";d.handle="open";d.TBT=!0;d.counter08=c;break;case 9:d.state="tilted";d.handle="tilted";d.counter09=c;break;case 10:d.state="?",d.handle="?",d.counter0A=c}}else if(2==b[0]&&2==b.length)switch(d.type=2,b[1]&
15){case 1:d.burglary=!0;break;default:d.burglary=!1}else if(b[0]=2==b.length){d.type=17;switch((b[1]&192)>>6){case 0:d.calibrationState="ok";break;case 1:d.calibrationState="error";break;case 2:d.calibrationState="invalid";break;case 3:d.calibrationState="not_supported"}b=b[1]&63;d.calibrationStep=b;switch(b){case 0:d.calibrationCasement="none";d.calibrationHandle="none";break;case 1:d.calibrationCasement="closed";d.calibrationHandle="closed";break;case 2:d.calibrationCasement="closed";d.calibrationHandle=
"open";break;case 3:d.calibrationCasement="closed";d.calibrationHandle="tilted";break;case 4:d.calibrationCasement="open";d.calibrationHandle="closed";break;case 5:d.calibrationCasement="open";d.calibrationHandle="open";break;case 6:d.calibrationCasement="open";d.calibrationHandle="tilted";break;case 7:d.calibrationCasement="tilted";d.calibrationHandle="closed";break;case 8:d.calibrationCasement="tilted";d.calibrationHandle="open";break;case 9:d.calibrationCasement="tilted",d.calibrationHandle="tilted"}}return d};
e.prototype.evalData=function(b,d,a){var c=this;c._states.aliveTimeout.value=!1;clearTimeout(this._aliveTO);this._aliveTO=setTimeout(function(){c._aliveTimeout()},2E3*this._params.alive);(b=this.evalTelegram(d))?(d=[],b.aliveMsg||(d=this.checkStateChange(b)),a&&a(null,d)):a&&a(Error("data format invalid"))};e.prototype.checkStateChange=function(b){var d=this._states,a=[],c;for(c in b)if("aliveMsg"!=c){var e={};e.key=c;e.value=b[c];e.changed=!1;var f=d[c]?d[c].value:null;f!=b[c]&&(e.oldvalue=f,e.changed=
!0);"burglary"!=c&&"calibrationState"!=c&&"calibrationCasement"!=c&&"calibrationHandle"!=c&&(this._states[c]={value:b[c],time:(new Date).getTime()});a.push(e)}return a};e.prototype._resolveStates=function(b,d){d={};if(210==b[0])if(b=b.slice(1,b.length-5),1==b[0]&&8==b.length){var a=b[1]&239,c=(b[2]<<24)+(b[3]<<16)+(b[4]<<8)+b[5],e=b[6]>>7;d={aliveMsg:1==(b[1]&128)>>7,TBT:!1,batteryOK:!0,battery:b[6]&127,motionSensor:b[7]>>6,accelerationSensor:(b[7]&48)>>4,magneticSensor:(b[7]&12)>>2,error:b[7]&3,
count:c};e&&(d.batteryOK=!1);100<d.battery&&(d.battery=100);switch(a){case 0:d.state="closed";d.handle="closed";d.counter00=c;break;case 1:d.state="closed";d.handle="open";d.counter01=c;break;case 2:d.state="open";d.handle="open";d.counter02=c;break;case 3:d.state="closed";d.handle="tilted";d.counter03=c;break;case 4:d.state="tilted";d.handle="tilted";d.counter04=c;break;case 5:d.state="closed";d.handle="tilted";d.TBT=!0;d.counter05=c;break;case 6:d.state="tilted";d.handle="tilted";d.TBT=!0;d.counter06=
c;break;case 7:d.state="closed";d.handle="open";d.TBT=!0;d.counter07=c;break;case 8:d.state="open";d.handle="open";d.TBT=!0;d.counter08=c;break;case 9:d.state="open";d.handle="closed";d.counter09=c;break;case 10:d.state="open",d.handle="tilted",d.counter0A=c}}else if(2==b[0]&&2==b.length)switch(b[1]&15){case 1:d.burglary=!0;break;default:d.burglary=!1}else if(b[0]=2==b.length){switch((b[1]&192)>>6){case 0:d.calibrationState="ok";break;case 1:d.calibrationState="error";break;case 2:d.calibrationState=
"invalid";break;case 3:d.calibrationState="not_supported"}switch(b[1]&63){case 0:d.calibrationCasement="none";d.calibrationHandle="none";break;case 1:d.calibrationCasement="closed";d.calibrationHandle="closed";break;case 2:d.calibrationCasement="closed";d.calibrationHandle="open";break;case 3:d.calibrationCasement="closed";d.calibrationHandle="tilted";break;case 4:d.calibrationCasement="open";d.calibrationHandle="closed";break;case 5:d.calibrationCasement="open";d.calibrationHandle="open";break;case 6:d.calibrationCasement=
"open";d.calibrationHandle="tilted";break;case 7:d.calibrationCasement="tilted";d.calibrationHandle="closed";break;case 8:d.calibrationCasement="tilted";d.calibrationHandle="open";break;case 9:d.calibrationCasement="tilted",d.calibrationHandle="tilted"}}return d};e.prototype._aliveTimeout=function(){this.activeStateChange({aliveTimeout:!0})};e.prototype.fromJSON=function(b){if(!g.prototype.fromJSON.call(this,b))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});
return this};e.prototype.fromDBJSON=function(b){if(!g.prototype.fromDBJSON.call(this,b))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};var a=function(b){g.call(this,b);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.MacoWindow");this._data="d5-xx-xx";this._desc="Window";this._vendor="maco"};a.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"Mayer & Co Beschl\u00e4ge GmbH"};a.prototype=new g;a.prototype.constructor=
a;a.prototype.evalData=function(b,d,a){(b=this._resolveStates(b,d))?(b=this.checkStateChange(b),a&&a(null,b)):a&&a(Error("data format invalid"))};a.prototype._resolveStates=function(b,d){d={};if(213==b[0]){b=b.slice(1,b.length-5);var a=(b[0]&8)>>3,c=(b[0]&6)>>1,e=b[0]&1;switch((b[0]&48)>>4){case 0:d.state="unused";break;case 1:d.state="tilted";break;case 2:d.state="open";break;case 3:d.state="closed"}d.learn=a;d.battery=c;d.alarm=e}return d};a.prototype.toDBJSON=function(){return{id:this._address,
eep:this._data,desc:this._desc,manufacturer:"Mayer & Co Beschl\u00e4ge GmbH",vendor:this._vendor}};var f=function(b){g.call(this,b);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SodaHandle");this._data="f6-so-da"};f.TEMPALTE={id:null,eep:null};f.prototype=new g;f.prototype.constructor=f;f.prototype.evalTelegram=function(b){var d={};if(246==b.rorg)switch(b.userData){case 240:d.state="tilted";break;case 192:d.state="open";break;case 208:d.state="closed"}return d};f.prototype.evalData=
function(b,d,a){(b=this.evalTelegram(d))?(b=this.checkStateChange(b),a&&a(null,b)):a&&a(Error("data format invalid"))};f.prototype.toJSON=function(b,d){return{address:this._address,data:this._data,vendor:"soda"}};f.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:"Window_Handle",manufacturer:"SODA",vendor:"soda"}};var c=function(b){g.call(this,b);this._data="f6-??-??"};c.prototype=new g;c.prototype.constructor=c;var k=function(b){c.call(this,b);this._data="f6-01-01";this._longPressThreshold=
1E3};k.STATES=["button"];k.COMMANDS=["shortPress","longPress","press","release"];k.prototype=new c;k.prototype.constructor=h;k.prototype.evalTelegram=function(b){var d={};246==b.rorg&&(d.button=b.userData>>4&1?"pressed":"released");return d};k.prototype.buildData=function(b){return b<<4};k.prototype.checkStateChange=function(b){var d=this._states,a=[],c=(new Date).getTime(),e;for(e in b){var f={};f.key=e;f.value=b[e];f.changed=!1;var g=d[e]?d[e].value:null,h=d[e]?d[e].time:null,k=b[e];g!=k&&(f.oldvalue=
g,f.changed=!0);this._states[e]={value:b[e],time:c};f.changed&&a.push(f);"pressed"==g&&"released"==k&&(!h||c-h<this._longPressThreshold?(f={},f.key=e,f.value="shortPress"):(f={},f.key=e,f.value="longPress"),f.changed=!0,a.push(f))}return a};k.prototype.executeCommand=function(b,d,a){if(this._senderID)if(d&&d.value){var c=this,q=100;switch(d.value){case "longPress":q=this._longPressThreshold;case "shortPress":var e=this.buildData(1);var f=new x.hub.m.enocean.ESP3.Telegram.RPS(e,this._senderID,1,1,
0,null);b.sendTelegram(f,!0,function(d){d?a&&a(d):(c.activeStateChange({button:"pressed"}),setTimeout(function(){e=c.buildData(0);f=new x.hub.m.enocean.ESP3.Telegram.RPS(e,c._senderID,1,1,0,null);b.sendTelegram(f,!0,function(b){c.activeStateChange({button:"released"});a&&a(b)})},q))});break;case "press":e=this.buildData(1);f=new x.hub.m.enocean.ESP3.Telegram.RPS(e,this._senderID,1,1,0,null);b.sendTelegram(f,!0,function(b){c.activeStateChange({button:"pressed"});a&&a(b)});break;case "release":e=this.buildData(0),
f=new x.hub.m.enocean.ESP3.Telegram.RPS(e,this._senderID,1,1,0,null),b.sendTelegram(f,!0,function(b){c.activeStateChange({button:"released"});a&&a(b)})}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var h=function(b){c.call(this,b);this._data="f6-02-01";this._longPressThreshold=1E3};h.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];h.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");
h.prototype=new c;h.prototype.constructor=h;h.prototype.evalTelegram=function(b){var d={};if(246==b.rorg){var a=b.userData>>5&7,c=b.userData>>1&7,e=b.userData&1,f=b.t21,g=b.nu;b=b.userData>>4&1?"pressed":"released";if(1==f&&1==g){switch(a){case 0:var h=b;break;case 1:var k=b;break;case 2:var l=b;break;case 3:var m=b}if(e)switch(c){case 0:h=b;break;case 1:k=b;break;case 2:l=b;break;case 3:m=b}}else if(1==f&&0==g)switch(a){case 0:m=l=k=h=b}h&&(d.buttonAI=h);k&&(d.buttonAO=k);l&&(d.buttonBI=l);m&&(d.buttonBO=
m)}return d};h.prototype.buildData=function(b,d,a,c){return b<<5|d<<4|a<<1|c};h.prototype.checkStateChange=function(b){var d=this._states,a=[],c=(new Date).getTime(),e;for(e in b){var f={};f.key=e;f.value=b[e];f.changed=!1;var g=d[e]?d[e].value:null,h=d[e]?d[e].time:null,k=b[e];g!=k&&(f.oldvalue=g,f.changed=!0);this._states[e]={value:b[e],time:c};f.changed&&("pressed"==k||"released"==k&&"pressed"==g)&&a.push(f);"pressed"==g&&"released"==k&&(!h||c-h<this._longPressThreshold?(f={},f.key=e,f.value="shortPress"):
(f={},f.key=e,f.value="longPress"),f.changed=!0,a.push(f))}return a};h.prototype.executeCommand=function(b,d,a){if(this._senderID)if(d&&d.value){var c=this,e=100,q=d.value.substr(d.value.length-2),f={},g=0;switch(q){case "AI":g=0;break;case "AO":g=1;break;case "BI":g=2;break;case "BO":g=3}switch(d.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":e=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":var h=this.buildData(g,
1,0,0);var k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(d){d?a&&a(d):(f["button"+q]="pressed",c.activeStateChange(f),setTimeout(function(){h=c.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,c._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+q]="released";c.activeStateChange(f);a&&a(b)})},e))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":h=this.buildData(g,1,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,
this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+q]="pressed";c.activeStateChange(f);a&&a(b)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":h=c.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+q]="released";c.activeStateChange(f);a&&a(b)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var l=function(b){h.call(this,
b);this._data="f6-02-02"};h.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];l.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");l.prototype=new h;l.prototype.constructor=l;var r=function(b){c.call(this,b);this._data="f6-02-03"};r.STATES=["state"];r.COMMANDS=["auto","manu","dimUp","dimDown"];r.prototype=new c;r.prototype.constructor=r;r.prototype.evalTelegram=
function(b){var d={};if(246==b.rorg)switch(b.userData){case 48:d.state="auto";break;case 16:d.state="manu";break;case 112:d.state="dimUp";break;case 80:d.state="dimDown"}return d};r.prototype.executeCommand=function(b,d,a){if(this._senderID)if(d&&d.value){switch(d.value){case "auto":var c=48;break;case "manu":c=16;break;case "dimUp":c=112;break;case "dimDown":c=80;break;default:a&&a(Error("unknow command"))}this.activeStateChange({state:d.value});d=new x.hub.m.enocean.ESP3.Telegram.RPS(c,this._senderID,
1,1,0,null);b.sendTelegram(d,!0,function(b){a&&a(b)})}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var m=function(b){h.call(this,b);this._data="f6-02-04";this._longPressThreshold=1E3};m.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","energyBow"];m.prototype=new h;m.prototype.constructor=m;m.prototype.evalTelegram=function(b){var d={};if(246==b.rorg){var a=b.userData>>3&1,c=b.userData>>2&1,e=b.userData>>1&1,f=b.userData&1;d.energyBow=b.userData>>7&1?"pressed":"released";
d.buttonBI=a?"pressed":"released";d.buttonBO=c?"pressed":"released";d.buttonAI=e?"pressed":"released";d.buttonAO=f?"pressed":"released"}return d};var v=function(b){h.call(this,b);this._data="f6-03-01";this._longPressThreshold=1E3};v.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");v.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
v.prototype=new h;v.prototype.constructor=v;v.prototype.evalTelegram=function(b){var d={};if(246==b.rorg){var a=b.userData>>5&7,c=b.userData>>1&7,e=b.userData&1,f=b.t21,g=b.nu;b=b.userData>>4&1?"pressed":"released";if(0==f&&1==g){switch(a){case 0:var h=b;break;case 1:var k=b;break;case 2:var l=b;break;case 3:var m=b;break;case 4:var r=b;break;case 5:var n=b;break;case 6:var p=b;break;case 7:var t=b}if(e)switch(c){case 0:h=b;break;case 1:k=b;break;case 2:l=b;break;case 3:m=b;break;case 4:r=b;break;
case 5:n=b;break;case 6:p=b;break;case 7:t=b}}else if(0==f&&0==g)switch(a){case 0:case 7:t=p=n=r=m=l=k=h=b}h&&(d.buttonAI=h);k&&(d.buttonAO=k);l&&(d.buttonBI=l);m&&(d.buttonBO=m);r&&(d.buttonCI=r);n&&(d.buttonCO=n);p&&(d.buttonDI=p);t&&(d.buttonDO=t)}return d};v.prototype.executeCommand=function(b,d,a){if(this._senderID)if(d&&d.value){var c=this,e=100,q=d.value.substr(d.value.length-2),f={},g=0;switch(q){case "AI":g=0;break;case "AO":g=1;break;case "BI":g=2;break;case "BO":g=3;break;case "CI":g=4;
break;case "CO":g=5;break;case "DI":g=6;break;case "DO":g=7}switch(d.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":case "longPressCI":case "longPressCO":case "longPressDI":case "longPressDO":e=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":case "shortPressCI":case "shortPressCO":case "shortPressDI":case "shortPressDO":var h=this.buildData(g,1,0,0);var k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,
1,1,0,null);b.sendTelegram(k,!0,function(d){d?a&&a(d):(f["button"+q]="pressed",c.activeStateChange(f),setTimeout(function(){h=c.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,c._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+q]="released";c.activeStateChange(f);a&&a(b)})},e))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":case "pressCI":case "pressCO":case "pressDI":case "pressDO":h=this.buildData(g,1,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,
this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+q]="pressed";c.activeStateChange(f);a&&a(b)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":case "releaseCI":case "releaseCO":case "releaseDI":case "releaseDO":h=c.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+q]="released";c.activeStateChange(f);a&&a(b)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"));
else a&&a(Error("sender id is null"))};var y=function(b){v.call(this,b);this._data="f6-03-02"};y.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");y.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
y.prototype=new v;y.prototype.constructor=y;var C=function(b){c.call(this,b);this._data="f6-04-01"};C.STATES=["keycard"];C.prototype=new c;C.prototype.constructor=C;C.prototype.evalTelegram=function(b){var d={};if(246==b.rorg){var a=b.t21,c=b.nu;b=b.userData;1==a&&1==c&&112==b?d.keycard="inserted":1==a&&0==c&&0==b&&(d.keycard="takeout")}return d};var I=function(b){c.call(this,b);this._data="f6-04-02"};I.STATES=["keycard"];I.prototype=new c;I.prototype.constructor=I;I.prototype.evalTelegram=function(b){var d=
{};if(246==b.rorg){var a=b.userData>>7&1;b=b.userData>>2&1;1==a&&1==b?d.keycard="inserted":0==a&&0==b&&(d.keycard="takeout")}return d};var J=function(b){c.call(this,b);this._data="f6-05-00"};J.STATES=["wind","lowbat"];J.prototype=new c;J.prototype.constructor=J;J.prototype.evalTelegram=function(b){var d={};if(246==b.rorg)switch(b.userData){case 0:d.wind="ok";this._states.lowbat||(d.lowbat=!1);break;case 16:d.wind="alarm";this._states.lowbat||(d.lowbat=!1);break;case 48:d.lowbat=!0}return d};var z=
function(b){c.call(this,b);this._data="f6-05-01"};z.COMMANDS=["reset"];z.STATES=["water"];z.prototype=new c;z.prototype.constructor=z;z.prototype.evalTelegram=function(b){var d={};if(246==b.rorg){var a=b.nu,c=b.userData;1==b.t21&&1==a&&17==c&&(d.water="alarm")}return d};z.prototype.executeCommand=function(b,d,a){if(d&&d.value)switch(d.value){case "reset":this.activeStateChange({water:"ok"});a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};var w=function(b){c.call(this,
b);this._data="f6-05-02"};w.STATES=["smoke","lowbat"];w.prototype=new c;w.prototype.constructor=w;w.prototype.evalTelegram=function(b){var d={};if(246==b.rorg)switch(b.userData){case 0:d.smoke="ok";this._states.lowbat||(d.lowbat=!1);break;case 16:d.smoke="alarm";this._states.lowbat||(d.lowbat=!1);break;case 48:d.lowbat=!0}return d};var Q=function(b){c.call(this,b);this._data="f6-10-00"};Q.STATES=["window","handle_pos","handle_raw"];Q.prototype=new c;Q.prototype.constructor=Q;Q.prototype.evalTelegram=
function(b){var d={};246==b.rorg&&(b=b.userData,0==(b&208^192)?(d.window="open",d.handle_pos="middle"):0==(b&240^240)?(d.window="closed",d.handle_pos="down"):0==(b&240^208)&&(d.window="tilted",d.handle_pos="up"),d.handle_raw=b);return d};var V=function(b){c.call(this,b);this._data="f6-10-01"};V.STATES=["window","handle_pos","handle_raw"];V.prototype=new c;V.prototype.constructor=V;V.prototype.evalTelegram=function(b){var d={};246==b.rorg&&(b=b.userData&15,0==(b&13^12)?(d.window="open",d.handle_pos=
"middle"):0==(b&15^15)?(d.window="closed",d.handle_pos="down"):0==(b&15^13)&&(d.window="tilted",d.handle_pos="up"),d.handle_raw=b);return d};var Y=function(b){g.call(this,b);this._data="d5-??-??"};Y.prototype=new g;Y.prototype.constructor=Y;var P=function(b){Y.call(this,b);this._data="d5-00-01"};P.STATES=["contact","contact_raw"];P.prototype=new Y;P.prototype.constructor=P;P.prototype.evalTelegram=function(b){var d={};213==b.rorg&&(b=b.userData,1==(b>>3&1)&&(b&=1,d.contact=b?"closed":"open",d.contact_raw=
b));return d};var t=function(b){g.call(this,b);this._data="a5-??-??";this.TEACH_IN_VARIATION=2;this.UNIQUE_GATEWAY_SENDERID=!0};t.prototype=new g;t.prototype.constructor=t;t.prototype.getTeachinType=function(){return"4BS"};t.prototype.isTeachinBidirectional=function(){return!1};var n=function(b){t.call(this,b);this._data="a5-02-??";this._tmpMin=-40;this._tmpMax=0};n.STATES=["temperature","temperature_raw"];n.prototype=new t;n.prototype.constructor=n;n.prototype.evalTelegram=function(b){var d={};if(165==
b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(2);1==(a>>3&1)&&(d.temperature=parseFloat(((255-b)/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=b)}return d};var Z=function(b){n.call(this,b);this._data="a5-02-01";this._tmpMin=-40;this._tmpMax=0};Z.STATES=["temperature","temperature_raw"];Z.prototype=new n;Z.prototype.constructor=Z;var K=function(b){n.call(this,b);this._data="a5-02-02";this._tmpMin=-30;this._tmpMax=10};K.STATES=["temperature","temperature_raw"];
K.prototype=new n;K.prototype.constructor=K;var oa=function(b){n.call(this,b);this._data="a5-02-03";this._tmpMin=-20;this._tmpMax=20};oa.STATES=["temperature","temperature_raw"];oa.prototype=new n;oa.prototype.constructor=oa;var O=function(b){n.call(this,b);this._data="a5-02-04";this._tmpMin=-10;this._tmpMax=30};O.STATES=["temperature","temperature_raw"];O.prototype=new n;O.prototype.constructor=O;var R=function(b){n.call(this,b);this._data="a5-02-05";this._tmpMin=0;this._tmpMax=40};R.STATES=["temperature",
"temperature_raw"];R.prototype=new n;R.prototype.constructor=R;var da=function(b){n.call(this,b);this._data="a5-02-06";this._tmpMin=10;this._tmpMax=50};da.STATES=["temperature","temperature_raw"];da.prototype=new n;da.prototype.constructor=da;var aa=function(b){n.call(this,b);this._data="a5-02-07";this._tmpMin=20;this._tmpMax=60};aa.STATES=["temperature","temperature_raw"];aa.prototype=new n;aa.prototype.constructor=aa;var ba=function(b){n.call(this,b);this._data="a5-02-08";this._tmpMin=30;this._tmpMax=
70};ba.STATES=["temperature","temperature_raw"];ba.prototype=new n;ba.prototype.constructor=ba;var Na=function(b){n.call(this,b);this._data="a5-02-09";this._tmpMin=40;this._tmpMax=80};Na.STATES=["temperature","temperature_raw"];Na.prototype=new n;Na.prototype.constructor=Na;var u=function(b){n.call(this,b);this._data="a5-02-0a";this._tmpMin=50;this._tmpMax=90};u.STATES=["temperature","temperature_raw"];u.prototype=new n;u.prototype.constructor=u;var p=function(b){n.call(this,b);this._data="a5-02-0b";
this._tmpMin=60;this._tmpMax=100};p.STATES=["temperature","temperature_raw"];p.prototype=new n;p.prototype.constructor=p;var H=function(b){n.call(this,b);this._data="a5-02-10";this._tmpMin=-60;this._tmpMax=20};H.STATES=["temperature","temperature_raw"];H.prototype=new n;H.prototype.constructor=H;var cc=function(b){n.call(this,b);this._data="a5-02-11";this._tmpMin=-50;this._tmpMax=30};cc.STATES=["temperature","temperature_raw"];cc.prototype=new n;cc.prototype.constructor=cc;var Ma=function(b){n.call(this,
b);this._data="a5-02-12";this._tmpMin=-40;this._tmpMax=40};Ma.STATES=["temperature","temperature_raw"];Ma.prototype=new n;Ma.prototype.constructor=Ma;var dc=function(b){n.call(this,b);this._data="a5-02-13";this._tmpMin=-30;this._tmpMax=50};dc.STATES=["temperature","temperature_raw"];dc.prototype=new n;dc.prototype.constructor=dc;var ec=function(b){n.call(this,b);this._data="a5-02-14";this._tmpMin=-20;this._tmpMax=60};ec.STATES=["temperature","temperature_raw"];ec.prototype=new n;ec.prototype.constructor=
ec;var Ea=function(b){n.call(this,b);this._data="a5-02-15";this._tmpMin=-10;this._tmpMax=70};Ea.STATES=["temperature","temperature_raw"];Ea.prototype=new n;Ea.prototype.constructor=Ea;var fc=function(b){n.call(this,b);this._data="a5-02-16";this._tmpMin=0;this._tmpMax=80};fc.STATES=["temperature","temperature_raw"];fc.prototype=new n;fc.prototype.constructor=fc;var bb=function(b){n.call(this,b);this._data="a5-02-17";this._tmpMin=10;this._tmpMax=90};bb.STATES=["temperature","temperature_raw"];bb.prototype=
new n;bb.prototype.constructor=bb;var gc=function(b){n.call(this,b);this._data="a5-02-18";this._tmpMin=20;this._tmpMax=100};gc.STATES=["temperature","temperature_raw"];gc.prototype=new n;gc.prototype.constructor=gc;var hc=function(b){n.call(this,b);this._data="a5-02-19";this._tmpMin=30;this._tmpMax=110};hc.STATES=["temperature","temperature_raw"];hc.prototype=new n;hc.prototype.constructor=hc;var ic=function(b){n.call(this,b);this._data="a5-02-1a";this._tmpMin=40;this._tmpMax=120};ic.STATES=["temperature",
"temperature_raw"];ic.prototype=new n;ic.prototype.constructor=ic;var jc=function(b){n.call(this,b);this._data="a5-02-1b";this._tmpMin=50;this._tmpMax=130};jc.STATES=["temperature","temperature_raw"];jc.prototype=new n;jc.prototype.constructor=jc;var Fa=function(b){t.call(this,b);this._data="a5-02-20";this._tmpMin=-10;this._tmpMax=41.2};Fa.STATES=["temperature","temperature_raw"];Fa.prototype=new t;Fa.prototype.constructor=Fa;Fa.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);
b=b.userData.readUInt16BE(1);1==(a>>3&1)&&(a=b&1023,d.temperature=parseFloat(((1023-a)/1023*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=a)}return d};var kc=function(b){Fa.call(this,b);this._data="a5-02-30";this._tmpMin=-40;this._tmpMax=62.3};kc.STATES=["temperature","temperature_raw"];kc.prototype=new Fa;kc.prototype.constructor=kc;var ia=function(b){t.call(this,b);this._data="a5-04-??";this._humMin=0;this._humMax=100;this._tempMin=0;this._tempMax=40};ia.STATES=["humidity",
"humidity_raw","temperature","temperature_raw","available"];ia.prototype=new t;ia.prototype.constructor=ia;ia.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2);b=b.userData.readUInt8(1);1==(a>>3&1)&&(d.humidity=parseFloat((b/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),d.humidity_raw=b,d.temperature=parseFloat((c/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),d.temperature_raw=c,d.available=a>>1&1?!0:!1)}return d};
var lc=function(b){ia.call(this,b);this._data="a5-04-01"};lc.STATES=ia.STATES;lc.prototype=new ia;lc.prototype.constructor=lc;var Oa=function(b){ia.call(this,b);this._data="a5-04-02";this._tempMin=-20;this._tempMax=60};Oa.STATES=ia.STATES;Oa.prototype=new ia;Oa.prototype.constructor=Oa;var cb=function(b){ia.call(this,b);this._data="a5-04-03";this._tempMin=-20;this._tempMax=60};cb.STATES=["humidity","humidity_raw","temperature","temperature_raw","type"];cb.prototype=new ia;cb.prototype.constructor=
cb;cb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt16BE(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(d.humidity=parseFloat((b/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),d.humidity_raw=b,c&=1023,d.temperature=parseFloat((c/1023*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),d.temperature_raw=c,d.type=a&1?"event":"heartbeat")}return d};var L=function(b){t.call(this,b);this._data="a5-06-??";this._svcMin=0;this._svcMax=
5.1;this._ill2Min=300;this._ill2Max=3E4;this._ill1Min=600;this._ill1Max=6E4};L.STATES="voltage voltage_raw illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw range range_raw".split(" ");L.prototype=new t;L.prototype.constructor=L;L.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=parseFloat((b/255*(this._svcMax-
this._svcMin)+this._svcMin).toFixed(1));d.voltage_raw=b;d.illumination2=parseFloat((e/255*(this._ill2Max-this._ill2Min)+this._ill2Min).toFixed(1));d.illumination2_raw=e;d.illumination1=parseFloat((c/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1));d.illumination1_raw=c;a&=1;switch(a){case 0:d.range="db1";d.illumination=d.illumination1;d.illumination_raw=c;break;case 1:d.range="db2",d.illumination=d.illumination2,d.illumination_raw=c}d.range_raw=a}}return d};var Pa=function(b){L.call(this,
b);this._data="a5-06-01"};Pa.STATES=L.STATES;Pa.prototype=new L;Pa.prototype.constructor=Pa;var Ga=function(b){L.call(this,b);this._data="a5-06-02";this._ill2Min=0;this._ill2Max=510;this._ill1Min=0;this._ill1Max=1020};Ga.STATES=L.STATES;Ga.prototype=new L;Ga.prototype.constructor=Ga;var db=function(b){L.call(this,b);this._data="a5-06-03";this._svcMin=0;this._svcMax=5.1};db.STATES=["voltage","voltage_raw","illumination","illumination_raw"];db.prototype=new L;db.prototype.constructor=db;db.prototype.evalTelegram=
function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt16BE(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((b/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),d.voltage_raw=b,a=c>>6&1023,d.illumination=a,d.illumination_raw=a)}return d};var eb=function(b){L.call(this,b);this._data="a5-06-04";this._tmpMin=-20;this._tmpMax=60};eb.STATES="temperature temperature_raw illumination illumination_raw energy energy_raw temperature_avail energy_avail".split(" ");
eb.prototype=new L;eb.prototype.constructor=eb;eb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt16BE(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(d.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=b,d.illumination=c,d.illumination_raw=c,c=a>>4&15,d.energy=parseFloat((c/15*100).toFixed(1)),d.energy_raw=c,d.temperature_avail=a>>1&1?!0:!1,d.temperature_avail||delete d.temperature,d.energy_avail=
a&1?!0:!1,d.energy_avail||delete d.energy)}return d};var mc=function(b){L.call(this,b);this._data="a5-06-05";this._ill2Min=0;this._ill2Max=5100;this._ill1Min=0;this._ill1Max=10200};mc.STATES=L.STATES;mc.prototype=new L;mc.prototype.constructor=mc;var W=function(b){t.call(this,b);this._data="a5-07-??";this._params||(this._params={reset_timeout:30});this._resetTO=null};W.COMMANDS=["reset"];W.prototype=new t;W.prototype.constructor=W;W.prototype._startPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),
this._resetTO=null);if(this._params.reset_timeout&&!(0>this._params.reset_timeout)){var b=this;this._resetTO=setTimeout(function(){b._resetTO=null;b._reset()},1E3*this._params.reset_timeout)}};W.prototype._stopPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null)};W.prototype._reset=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null);var b={key:"state",value:"off",changed:!1},d=this._states.state?this._states.state.value:null;"off"!=d&&(b.oldvalue=
d,b.changed=!0);this._states.state={value:"off",time:(new Date).getTime()};require("x.hub.m.enocean.js")._onEOEvents(this,[b])};W.prototype.executeCommand=function(b,d,a){if(d&&d.value)switch(d.value){case "reset":this._reset();a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};W.prototype.fromJSON=function(b){if(!g.prototype.fromJSON.call(this,b))return null;this._params||(this._params={reset_timeout:30});return this};W.prototype.fromDBJSON=function(b){if(!g.prototype.fromDBJSON.call(this,
b))return null;this._params||(this._params={reset_timeout:30});return this};var ea=function(b){W.call(this,b);this._data="a5-07-01"};ea.COMMANDS=["reset"];ea.STATES=["voltage","voltage_raw","state","state_raw","voltage_avail"];ea.prototype=new W;ea.prototype.constructor=ea;ea.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2);b=b.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((b/250*5).toFixed(1)),d.voltage_raw=b,d.state=128<=
c?"on":"off",d.state_raw=c,d.voltage_avail=a&1?!0:!1,d.voltage_avail||delete d.voltage)}"on"==d.state?this._startPIROffTO():"off"==d.state&&this._stopPIROffTO();return d};var Qa=function(b){W.call(this,b);this._data="a5-07-02"};Qa.COMMANDS=["reset"];Qa.STATES=["voltage","voltage_raw","state","state_raw"];Qa.prototype=new W;Qa.prototype.constructor=Qa;Qa.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((b/
250*5).toFixed(1)),d.voltage_raw=b,a=a>>7&1,d.state=a?"on":"off",d.state_raw=a)}"on"==d.state?this._startPIROffTO():"off"==d.state&&this._stopPIROffTO();return d};var Ra=function(b){W.call(this,b);this._data="a5-07-03"};Ra.COMMANDS=["reset"];Ra.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");Ra.prototype=new W;Ra.prototype.constructor=Ra;Ra.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt16BE(1);b=
b.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((b/250*5).toFixed(1)),d.voltage_raw=b,c=c>>6&1023,d.illumination=c,d.illumination_raw=c,a=a>>7&1,d.state=a?"on":"off",d.state_raw=a)}"on"==d.state?this._startPIROffTO():"off"==d.state&&this._stopPIROffTO();return d};var wa=function(b){t.call(this,b);this._data="a5-08-??";this._svcMin=0;this._svcMax=5.1;this._illMin=0;this._illMax=510;this._tmpMin=0;this._tmpMax=51};wa.prototype=new t;wa.prototype.constructor=wa;wa.prototype.evalTelegram=function(b){var d=
{};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=parseFloat((b/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));d.voltage_raw=b;d.illumination=parseFloat((e/255*(this._illMax-this._illMin)+this._illMin).toFixed(1));d.illumination_raw=e;d.temperature=parseFloat((c/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1));d.temperature_raw=c;c=a>>1&1;switch(c){case 0:d.state="on";break;case 1:d.state=
"off"}d.state_raw=c;a&=1;switch(a){case 0:d.button="pressed";break;case 1:d.button="released"}d.button_raw=a}}return d};var Sa=function(b){wa.call(this,b);this._data="a5-08-01"};Sa.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");Sa.prototype=new wa;Sa.prototype.constructor=Sa;var nc=function(b){wa.call(this,b);this._data="a5-08-02";this._illMax=1020};nc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");
nc.prototype=new wa;nc.prototype.constructor=nc;var oc=function(b){wa.call(this,b);this._data="a5-08-03";this._illMax=1530;this._tmpMin=-30;this._tmpMax=50};oc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");oc.prototype=new wa;oc.prototype.constructor=oc;var D=function(b){t.call(this,b);this._data="a5-09-??"};D.prototype=new t;D.prototype.constructor=D;var fb=function(b){D.call(this,b);this._data="a5-09-02";this._svcMin=
0;this._svcMax=5.1;this._gasMin=0;this._gasMax=1020;this._tmpMin=0;this._tmpMax=51};fb.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available".split(" ");fb.prototype=new D;fb.prototype.constructor=fb;fb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(d.voltage=parseFloat((b/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),
d.voltage_raw=b,d.gas=parseFloat((e/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),d.gas_raw=e,d.temperature=parseFloat((c/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=c,a=a>>1&1,d.temperature_available=a?!0:!1,a||delete d.temperature)}return d};var gb=function(b){D.call(this,b);this._data="a5-09-04";this._humMin=0;this._humMax=100;this._gasMin=0;this._gasMax=2550;this._tmpMin=0;this._tmpMax=51};gb.STATES="humidity humidity_raw gas gas_raw temperature temperature_raw temperature_available humidity_available".split(" ");
gb.prototype=new D;gb.prototype.constructor=gb;gb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(d.humidity=parseFloat((b/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),d.humidity_raw=b,d.gas=parseFloat((e/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),d.gas_raw=e,d.temperature=parseFloat((c/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),
d.temperature_raw=c,c=a>>2&1,d.humidity_available=c?!0:!1,c||delete d.humidity,a=a>>1&1,d.temperature_available=a?!0:!1,a||delete d.temperature)}return d};var hb=function(b){D.call(this,b);this._data="a5-09-05"};hb.STATES=["voc","voc_raw","voc_id","voc_id_raw","scale"];hb.prototype=new D;hb.prototype.constructor=hb;hb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2);b=b.userData.readUInt16BE(0);if(1==(a>>3&1)){a&=3;var e=1;switch(a){case 0:e=
.01;break;case 1:e=.1;break;case 2:e=1;break;case 3:e=10}d.scale=e;d.voc=b*e;d.voc_raw=b;switch(a){case 0:d.voc_id="VOCT";break;case 1:d.voc_id="Formaldehyde";break;case 2:d.voc_id="Benzene";break;case 3:d.voc_id="Styrene";break;case 4:d.voc_id="Toluene";break;case 5:d.voc_id="Tetrachloroethylene";break;case 6:d.voc_id="Xylene";break;case 7:d.voc_id="n-Hexane";break;case 8:d.voc_id="n-Octane";break;case 9:d.voc_id="Cyclopentane";break;case 10:d.voc_id="Methanol";break;case 11:d.voc_id="Ethanol";break;
case 12:d.voc_id="1-Pentanol";break;case 13:d.voc_id="Acetone";break;case 14:d.voc_id="ethylene Oxide";break;case 15:d.voc_id="Acetaldehyde ue";break;case 16:d.voc_id="Acetic Acid";break;case 17:d.voc_id="Propionice Acid";break;case 18:d.voc_id="Valeric Acid";break;case 19:d.voc_id="Butyric Acid";break;case 20:d.voc_id="Ammoniac";break;case 22:d.voc_id="Hydrogen Sulfide";break;case 23:d.voc_id="Dimethylsulfide";break;case 24:d.voc_id="2-Butanol";break;case 25:d.voc_id="2-Methylpropanol";break;case 26:d.voc_id=
"Diethyl ether";break;case 255:d.voc_id="ozone"}d.voc_id_raw=c}}return d};var ib=function(b){D.call(this,b);this._data="a5-09-06"};ib.STATES=["radon"];ib.prototype=new D;ib.prototype.constructor=ib;ib.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt16BE(0);1==(a>>3&1)&&(d.radon=b>>6&1023)}return d};var jb=function(b){D.call(this,b);this._data="a5-09-07"};jb.STATES="pm10 pm25 pm1 pm10_active pm25_active pm25_active".split(" ");jb.prototype=
new D;jb.prototype.constructor=jb;jb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt16BE(2),e=b.userData.readUInt16BE(1);b=b.userData.readUInt16BE(0);1==(a>>3&1)&&(d.pm10=b>>7&511,d.pm25=e>>6&511,d.pm1=c>>5&511,c=a>>2&1,d.pm10_active=c?!0:!1,c||delete d.pm10,c=a>>1&1,d.pm25_active=c?!0:!1,c||delete d.pm25,a&=1,d.pm1_active=a?!0:!1,a||delete d.pm1)}return d};var kb=function(b){D.call(this,b);this._data="a5-09-08"};kb.STATES=["co2","co2_raw"];
kb.prototype=new D;kb.prototype.constructor=kb;kb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(2);1==(a>>3&1)&&(d.co2=parseFloat((b/255*2E3).toFixed(1)),d.co2_raw=b)}return d};var lb=function(b){D.call(this,b);this._data="a5-09-09"};lb.STATES=["co2","co2_raw","power_failure_detected"];lb.prototype=new D;lb.prototype.constructor=lb;lb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(2);
1==(a>>3&1)&&(d.co2=parseFloat((b/255*2E3).toFixed(1)),d.co2_raw=b,d.power_failure_detected=a>>2&1?!0:!1)}return d};var mb=function(b){D.call(this,b);this._data="a5-09-0a";this._svcMin=2;this._svcMax=5;this._tmpMin=-20;this._tmpMax=60};mb.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available voltage_available".split(" ");mb.prototype=new D;mb.prototype.constructor=mb;mb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=
b.userData.readUInt8(2);b=b.userData.readUInt16BE(0);1==(a>>3&1)&&(d.gas=b,d.gas_raw=b,d.temperature=parseFloat((c/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),d.temperature_raw=c,c=a>>4&15,d.voltage=parseFloat((c/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),d.voltage_raw=c,c=a>>1&1,d.temperature_available=c?!0:!1,c||delete d.temperature,a&=1,d.voltage_available=a?!0:!1,a||delete d.voltage)}return d};var nb=function(b){D.call(this,b);this._data="a5-09-0b";this._svcMin=2;this._svcMax=
5};nb.STATES="voltage voltage_raw radio radio_raw scale unit unit_raw voltage_available".split(" ");nb.prototype=new D;nb.prototype.constructor=nb;nb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt16BE(2);b=b.userData.readUInt8(0);if(1==(a>>3&1)){b=b>>4&15;d.voltage=parseFloat((b/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));d.voltage_raw=b;b=1;switch(a>>4&15){case 0:b=.001;break;case 1:b=.01;break;case 2:b=.1;break;case 3:b=
1;break;case 4:b=10;break;case 5:b=100;break;case 6:b=1E3;break;case 7:b=1E4;break;case 8:b=1E5}d.scale=b;d.radio=c/10*b;d.radio_raw=c;c=a>>1&3;switch(c){case 0:d.unit="\u03bcSv/h";break;case 1:d.unit="cpm";break;case 2:d.unit="Bq/L";break;case 3:d.unit="Bq/kg"}d.unit_raw=c;a&=1;d.voltage_available=a?!0:!1;a||delete d.voltage}}return d};var ob=function(b){D.call(this,b);this._data="a5-09-0c"};ob.STATES="voc voc_raw voc_id voc_id_raw unit unit_raw scale".split(" ");ob.prototype=new D;ob.prototype.constructor=
ob;ob.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2);b=b.userData.readUInt16BE(0);if(1==(a>>3&1)){var e=a&3,f=1;switch(e){case 0:f=.01;break;case 1:f=.1;break;case 2:f=1;break;case 3:f=10}d.scale=f;a=a>>1&1;switch(a){case 0:d.unit="ppb";break;case 1:d.unit="\u03bcSv/m3"}d.unit_raw=a;d.voc=b*f;d.voc_raw=b;switch(e){case 0:d.voc_id="VOCT";break;case 1:d.voc_id="Formaldehyde";break;case 2:d.voc_id="Benzene";break;case 3:d.voc_id="Styrene";
break;case 4:d.voc_id="Toluene";break;case 5:d.voc_id="Tetrachloroethylene";break;case 6:d.voc_id="Xylene";break;case 7:d.voc_id="n-Hexane";break;case 8:d.voc_id="n-Octane";break;case 9:d.voc_id="Cyclopentane";break;case 10:d.voc_id="Methanol";break;case 11:d.voc_id="Ethanol";break;case 12:d.voc_id="1-Pentanol";break;case 13:d.voc_id="Acetone";break;case 14:d.voc_id="ethylene Oxide";break;case 15:d.voc_id="Acetaldehyde ue";break;case 16:d.voc_id="Acetic Acid";break;case 17:d.voc_id="Propionice Acid";
break;case 18:d.voc_id="Valeric Acid";break;case 19:d.voc_id="Butyric Acid";break;case 20:d.voc_id="Ammoniac";break;case 22:d.voc_id="Hydrogen Sulfide";break;case 23:d.voc_id="Dimethylsulfide";break;case 24:d.voc_id="2-Butanol";break;case 25:d.voc_id="2-Methylpropanol";break;case 26:d.voc_id="Diethyl ether";break;case 27:d.voc_id="Naphthalene";break;case 28:d.voc_id="4-Phenylcyclohexene";break;case 29:d.voc_id="Limonene";break;case 30:d.voc_id="Trichloroethylene";break;case 31:d.voc_id="Isovaleric acid";
break;case 32:d.voc_id="Indole";break;case 33:d.voc_id="Cadaverine";break;case 34:d.voc_id="Putrescine";break;case 35:d.voc_id="Caproic acid";break;case 255:d.voc_id="ozone"}d.voc_id_raw=c}}return d};var Ta=function(b){t.call(this,b);this._data="a5-10-??"};Ta.prototype=new t;Ta.prototype.constructor=Ta;var B=function(b){Ta.call(this,b);this._data="a5-10-01";this._params||(this._params={minSP:18,maxSP:26})};B.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");
B.prototype=new Ta;B.prototype.constructor=B;B.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.fan_speed=144>=b?"3":164>=b?"2":189>=b?"1":209>=b?"0":"auto";d.fan_speed_raw=b;d.setpoint=parseFloat((e/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));d.setpoint_raw=e;d.temperature=parseFloat(((255-c)/255*40).toFixed(1));d.temperature_raw=
c;a&=1;switch(a){case 0:d.button="pressed";break;case 1:d.button="released"}d.button_raw=a}}return d};B.prototype.fromJSON=function(b){if(!g.prototype.fromJSON.call(this,b))return null;this._params||(this._params={minSP:18,maxSP:26});return this};B.prototype.fromDBJSON=function(b){if(!g.prototype.fromDBJSON.call(this,b))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var la=function(b){B.call(this,b);this._data="a5-10-02"};la.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
la.prototype=new B;la.prototype.constructor=la;la.prototype.evalTelegram=function(b){var d=B.prototype.evalTelegram.call(this,b);if(0==Object.keys(d).length)return d;delete d.button;delete d.button_raw;b=b.userData.readUInt8(3)&1;d.slider=b?"day":"night";d.slider_raw=b;return d};var Ha=function(b){B.call(this,b);this._data="a5-10-03";this.TEACH_IN_VARIATION=1};Ha.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Ha.prototype=new B;Ha.prototype.constructor=Ha;Ha.prototype.evalTelegram=
function(b){b=B.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;delete b.button;delete b.button_raw;return b};var pb=function(b){B.call(this,b);this._data="a5-10-04"};pb.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw".split(" ");pb.prototype=new B;pb.prototype.constructor=pb;pb.prototype.evalTelegram=function(b){b=B.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.button;
delete b.button_raw;return b};var qb=function(b){B.call(this,b);this._data="a5-10-05"};qb.STATES="setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");qb.prototype=new B;qb.prototype.constructor=qb;qb.prototype.evalTelegram=function(b){b=B.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;return b};var Aa=function(b){la.call(this,b);this._data="a5-10-06"};Aa.STATES="setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
Aa.prototype=new la;Aa.prototype.constructor=Aa;Aa.prototype.evalTelegram=function(b){b=la.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;return b};var rb=function(b){B.call(this,b);this._data="a5-10-07"};rb.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw"];rb.prototype=new B;rb.prototype.constructor=rb;rb.prototype.evalTelegram=function(b){b=B.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;
delete b.setpoint;delete b.setpoint_raw;delete b.button;delete b.button_raw;return b};var pa=function(b){B.call(this,b);this._data="a5-10-08";this._params=null};pa.STATES="fan_speed fan_speed_raw temperature temperature_raw button button_raw".split(" ");pa.prototype=new B;pa.prototype.constructor=pa;pa.prototype.evalTelegram=function(b){b=B.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};pa.prototype.fromJSON=function(b){return g.prototype.fromJSON.call(this,
b)};pa.prototype.fromDBJSON=function(b){return g.prototype.fromDBJSON.call(this,b)};var qa=function(b){la.call(this,b);this._data="a5-10-09";this._params=null};qa.STATES="fan_speed fan_speed_raw temperature temperature_raw slider slider_raw".split(" ");qa.prototype=new la;qa.prototype.constructor=qa;qa.prototype.evalTelegram=function(b){b=la.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};qa.prototype.fromJSON=function(b){return g.prototype.fromJSON.call(this,
b)};qa.prototype.fromDBJSON=function(b){return g.prototype.fromDBJSON.call(this,b)};var Ba=function(b){B.call(this,b);this._data="a5-10-0a"};Ba.STATES="setpoint setpoint_raw temperature temperature_raw contact contact_raw".split(" ");Ba.prototype=new B;Ba.prototype.constructor=Ba;Ba.prototype.evalTelegram=function(b){var d=B.prototype.evalTelegram.call(this,b);if(0==Object.keys(d).length)return d;delete d.fan_speed;delete d.fan_speed_raw;delete d.button;delete d.button_raw;b=b.userData.readUInt8(3)&
1;d.contact=b?"open":"closed";d.contact_raw=b;return d};var Ia=function(b){Ba.call(this,b);this._data="a5-10-0b";this._params=null};Ia.STATES=["temperature","temperature_raw","contact","contact_raw"];Ia.prototype=new Ba;Ia.prototype.constructor=Ia;Ia.prototype.evalTelegram=function(b){b=Ba.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};Ia.prototype.fromJSON=function(b){return g.prototype.fromJSON.call(this,b)};Ia.prototype.fromDBJSON=
function(b){return g.prototype.fromDBJSON.call(this,b)};var sb=function(b){pa.call(this,b);this._data="a5-10-0c"};sb.STATES=["temperature","temperature_raw","button","button_raw"];sb.prototype=new pa;sb.prototype.constructor=sb;sb.prototype.evalTelegram=function(b){b=pa.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;return b};var tb=function(b){qa.call(this,b);this._data="a5-10-0d"};tb.STATES=["temperature","temperature_raw","slider",
"slider_raw"];tb.prototype=new qa;tb.prototype.constructor=tb;tb.prototype.evalTelegram=function(b){b=qa.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;return b};var S=function(b){Ta.call(this,b);this._data="a5-10-10";this._params||(this._params={minSP:18,maxSP:26})};S.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw button button_raw".split(" ");S.prototype=new Ta;S.prototype.constructor=S;S.prototype.evalTelegram=
function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.setpoint=parseFloat((b/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));d.setpoint_raw=b;d.humidity=parseFloat((e/250*100).toFixed(1));d.humidity_raw=e;d.temperature=parseFloat((c/250*40).toFixed(1));d.temperature_raw=c;a&=1;switch(a){case 0:d.button="pressed";break;case 1:d.button="released"}d.button_raw=a}}return d};
S.prototype.fromJSON=function(b){if(!g.prototype.fromJSON.call(this,b))return null;this._params||(this._params={minSP:18,maxSP:26});return this};S.prototype.fromDBJSON=function(b){if(!g.prototype.fromDBJSON.call(this,b))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var Ca=function(b){S.call(this,b);this._data="a5-10-11"};Ca.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");Ca.prototype=new S;Ca.prototype.constructor=
Ca;Ca.prototype.evalTelegram=function(b){var d=S.prototype.evalTelegram.call(this,b);if(0==Object.keys(d).length)return d;delete d.button;delete d.button_raw;b=b.userData.readUInt8(3)&1;d.slider=b?"day":"night";d.slider_raw=b;return d};var ub=function(b){S.call(this,b);this._data="a5-10-12"};ub.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw".split(" ");ub.prototype=new S;ub.prototype.constructor=ub;ub.prototype.evalTelegram=function(b){b=S.prototype.evalTelegram.call(this,
b);if(0==Object.keys(b).length)return b;delete b.button;delete b.button_raw;return b};var vb=function(b){S.call(this,b);this._data="a5-10-13"};vb.STATES="humidity humidity_raw temperature temperature_raw button button_raw".split(" ");vb.prototype=new S;vb.prototype.constructor=vb;vb.prototype.evalTelegram=function(b){b=S.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};var wb=function(b){Ca.call(this,b);this._data="a5-10-14"};
wb.STATES="humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");wb.prototype=new Ca;wb.prototype.constructor=wb;wb.prototype.evalTelegram=function(b){b=Ca.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};var Ua=function(b){t.call(this,b);this._data="a5-11-??"};Ua.prototype=new t;Ua.prototype.constructor=Ua;var xb=function(b){Ua.call(this,b);this._data="a5-11-03"};xb.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw".split(" ");
xb.prototype=new Ua;xb.prototype.constructor=xb;xb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.position=b;b=e&127;d.angle=2*(e>>7&1?0-b:b);e=c>>7&1;d.position_flag=e?!0:!1;d.position_flag_raw=e;e=c>>6&1;d.angle_flag=e?!0:!1;d.angle_flag_raw=e;e=c>>4&3;d.error_raw=e;switch(e){case 0:d.error="no_error";break;case 1:d.error="no_end_position";break;case 2:d.error=
"intern_failure"}e=c>>2&3;d.end_position_raw=e;switch(e){case 0:d.end_position="no_end_position";break;case 1:d.end_position="end_position_not_reach";break;case 2:d.end_position="fully_open";break;case 3:d.end_position="fully_closed"}c&=3;d.state_raw=c;switch(c){case 0:d.state="no_status";break;case 1:d.state="stopped";break;case 2:d.state="opens";break;case 3:d.state="closes"}d.service_mode=a>>7&1;d.position_mode=a>>6&1}}return d};var Va=function(b){Ua.call(this,b);this._data="a5-11-04"};Va.STATES=
"state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");Va.prototype=new Ua;Va.prototype.constructor=Va;Va.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.service_mode=a>>7&1;var f=a>>6&1;d.op_hour_flag=
f?!0:!1;d.op_hour_flag_raw=f;f=a>>4&3;d.error_raw=f;switch(f){case 0:d.error="no_error";break;case 1:d.error="lamp_failure";break;case 2:d.error="intern_failure";break;case 3:d.error="extern_failure"}f=a&1;d.state=f?"on":"off";d.state_raw=f;a=a>>1&3;d.mode_raw=a;switch(a){case 0:d.level=b;d.op_hour=e<<8|c;break;case 1:a=b.toString(16);2>a.length&&(a="0"+a);e=e.toString(16);2>e.length&&(e="0"+e);c=c.toString(16);2>c.length&&(c="0"+c);d.rgb=a.toUpperCase()+e.toUpperCase()+c.toUpperCase();break;case 2:d.power_raw=
b<<8|e,d.power_unit_raw=c,e="mW W kW MW Wh kWh MWh GWh mA 1/10A mV 1/10V".split(" "),3>=c?(d.power=d.power_raw,d.power_unit=e[c]):7>=c?(d.energy=d.power_raw,d.energy_unit=e[c]):9>=c?(d.current=d.power_raw,d.current_unit=e[c]):11>=c&&(d.voltage=d.power_raw,d.voltage_unit=e[c])}}}return d};var fa=function(b){t.call(this,b);this._data="a5-12-??"};fa.STATES="meter_raw channel_raw type_raw scale_raw scale meter current cumulative".split(" ");fa.prototype=new t;fa.prototype.constructor=fa;fa.prototype.evalTelegram=
function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt32BE(0);if(1==(a>>3&1)){b=b>>8&16777215;d.meter_raw=b;d.channel_raw=a>>4&15;var c=a>>2&1;d.type_raw=c;a&=3;d.scale_raw=a;switch(a){case 0:d.scale=1;d.meter=b;break;case 1:d.scale=.1;d.meter=.1*b;break;case 2:d.scale=.01;d.meter=.01*b;break;case 3:d.scale=.001,d.meter=.001*b}c?d.current=d.meter:d.cumulative=d.meter}}return d};var yb=function(b){fa.call(this,b);this._data="a5-12-00"};yb.STATES=["current","counter",
"channel"];yb.prototype=new fa;yb.prototype.constructor=yb;yb.prototype.evalTelegram=function(b){b=fa.prototype.evalTelegram.call(this,b);b.counter=b.cumulative;b.channel=b.channel_raw;return b};var ma=function(b){fa.call(this,b);this._data="a5-12-01"};ma.STATES=["power","energy","tariff"];ma.prototype=new fa;ma.prototype.constructor=ma;ma.prototype.evalTelegram=function(b){b=fa.prototype.evalTelegram.call(this,b);b.energy=b.cumulative;b.power=b.current;b.tariff=b.channel_raw;return b};var Ja=function(b){fa.call(this,
b);this._data="a5-12-02"};Ja.STATES=["volume","flow","tariff"];Ja.prototype=new fa;Ja.prototype.constructor=Ja;Ja.prototype.evalTelegram=function(b){b=fa.prototype.evalTelegram.call(this,b);b.volume=b.cumulative;b.flow=b.current;b.tariff=b.channel_raw;return b};var pc=function(b){Ja.call(this,b);this._data="a5-12-03"};pc.STATES=["volume","flow","tariff"];pc.prototype=new Ja;pc.prototype.constructor=pc;var T=function(b){t.call(this,b);this._data="a5-13-??"};T.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
T.prototype=new t;T.prototype.constructor=T;T.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1),f=b.userData.readUInt8(0);if(1==(a>>3&1))switch(a>>4&15){case 1:d.lux=parseFloat((f/255*1E3).toFixed(1));d.lux_raw=f;var g=e;d.temperature=parseFloat((g/255*120-40).toFixed(1));d.temperature_raw=g;d.wind=parseFloat((c/255*70).toFixed(1));d.wind_raw=c;d.day_night=a>>2&1?"night":"day";d.rain=a>>1&1?"true":"false";
break;case 2:d.sun_west=parseFloat((f/255*150).toFixed(1));d.sun_west_raw=f;d.sun_south=parseFloat((e/255*150).toFixed(1));d.sun_south_raw=g;d.sun_east=parseFloat((c/255*150).toFixed(1));d.sun_east_raw=c;d.hemisphere=a>>2&1?"south":"north";break;case 3:d.day=f&15;d.month=e&7;d.year=(c&127)+2E3;d.date_src=a&1?"gps":"rtc";break;case 4:d.weekday=f>>5&7;d.hour=f&31;d.min=e&63;d.sec=c&63;d.time_format=a>>2&1?"12":"24";d.am_pm=a>>1&1?"pm":"am";d.time_src=a&1?"gps":"rtc";break;case 5:d.elv=f-90;d.elv_raw=
f;c=b.userData.readUInt16BE(1)&511;d.azm=c;d.azm_raw=c;break;case 6:b=(f>>4&15)<<8|e,c|=(f&15)<<8,d.latitude=parseFloat((b/4095*180-90).toFixed(1)),d.latitude_raw=b,d.longitude=parseFloat((c/4095*360-180).toFixed(1)),d.longitude_raw=c}}return d};var qc=function(b){T.call(this,b);this._data="a5-13-01"};qc.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
qc.prototype=new T;qc.prototype.constructor=qc;var rc=function(b){T.call(this,b);this._data="a5-13-02"};rc.STATES="sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere".split(" ");rc.prototype=new T;rc.prototype.constructor=rc;var sc=function(b){T.call(this,b);this._data="a5-13-03"};sc.STATES=["day","month","year","date_src"];sc.prototype=new T;sc.prototype.constructor=sc;var tc=function(b){T.call(this,b);this._data="a5-13-04"};tc.STATES="weekday hour min sec time_format am_pm time_src".split(" ");
tc.prototype=new T;tc.prototype.constructor=tc;var uc=function(b){T.call(this,b);this._data="a5-13-05"};uc.STATES=["elv","azm"];uc.prototype=new T;uc.prototype.constructor=uc;var vc=function(b){T.call(this,b);this._data="a5-13-06"};vc.STATES=["latitude","longitude"];vc.prototype=new T;vc.prototype.constructor=vc;var zb=function(b){g.call(this,b);this._data="a5-14-01"};zb.STATES=["voltage","voltage_raw","state"];zb.prototype=new g;zb.prototype.constructor=zb;zb.prototype.evalTelegram=function(b){var d=
{};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=b/250*5;d.voltage_raw=b;a&=1;switch(a){case 0:d.state="closed";break;case 1:d.state="open"}d.state_raw=a}}return d};var Ab=function(b){g.call(this,b);this._data="a5-14-02"};Ab.STATES=["voltage","voltage_raw","illumination","illumination_raw","state"];Ab.prototype=new g;Ab.prototype.constructor=Ab;Ab.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(1);
b=b.userData.readUInt8(0);if(1==(a>>3&1))switch(d.voltage=b/250*5,d.voltage_raw=b,d.illumination=c/250*1E3,d.illumination_raw=c,a&=1,d.state_raw=a,a){case 0:d.state="closed";break;case 1:d.state="open"}}return d};var Bb=function(b){g.call(this,b);this._data="a5-14-03"};Bb.STATES=["voltage","voltage_raw","state","viberation"];Bb.prototype=new g;Bb.prototype.constructor=Bb;Bb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>
3&1)){d.voltage=b/250*5;d.voltage_raw=b;switch(a&1){case 0:d.state="closed";break;case 1:d.state="open"}switch(a>>1&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}}return d};var Cb=function(b){g.call(this,b);this._data="a5-14-04"};Cb.STATES="voltage voltage_raw illumination illumination_raw state viberation".split(" ");Cb.prototype=new g;Cb.prototype.constructor=Cb;Cb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(1);b=b.userData.readUInt8(0);
if(1==(a>>3&1)){d.voltage=b/250*5;d.voltage_raw=b;d.illumination=c/250*1E3;d.illumination_raw=c;switch(a&1){case 0:d.state="closed";break;case 1:d.state="open"}switch(a>>1&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}}return d};var Db=function(b){g.call(this,b);this._data="a5-14-05"};Db.STATES=["voltage","voltage_raw","viberation"];Db.prototype=new g;Db.prototype.constructor=Db;Db.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);
if(1==(a>>3&1))switch(d.voltage=b/250*5,d.voltage_raw=b,a>>1&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}return d};var Eb=function(b){g.call(this,b);this._data="a5-14-06"};Eb.STATES=["voltage","voltage_raw","illumination","illumination_raw","viberation"];Eb.prototype=new g;Eb.prototype.constructor=Eb;Eb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1))switch(d.voltage=b/250*5,d.voltage_raw=
b,d.illumination=c/250*1E3,d.illumination_raw=c,a>>1&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}return d};var Fb=function(b){g.call(this,b);this._data="a5-14-07"};Fb.STATES=["voltage","voltage_raw","state","lock"];Fb.prototype=new g;Fb.prototype.constructor=Fb;Fb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=b/250*5;d.voltage_raw=b;switch(a>>2&1){case 0:d.state="closed";break;case 1:d.state=
"open"}switch(a>>1&1){case 0:d.lock="locked";break;case 1:d.lock="unlocked"}}}return d};var Gb=function(b){g.call(this,b);this._data="a5-14-08"};Gb.STATES=["voltage","voltage_raw","state","lock","viberation"];Gb.prototype=new g;Gb.prototype.constructor=Gb;Gb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=b/250*5;d.voltage_raw=b;switch(a>>2&1){case 0:d.state="closed";break;case 1:d.state="open"}switch(a>>
1&1){case 0:d.lock="locked";break;case 1:d.lock="unlocked"}switch(a&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}}return d};var Hb=function(b){g.call(this,b);this._data="a5-14-09"};Hb.STATES=["voltage","voltage_raw","state"];Hb.prototype=new g;Hb.prototype.constructor=Hb;Hb.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1))switch(d.voltage=b/250*5,d.voltage_raw=b,a>>1&3){case 0:d.state="closed";break;case 1:d.state=
"tilted";break;case 2:d.state="reserved";break;case 3:d.state="open"}}return d};var Ib=function(b){g.call(this,b);this._data="a5-14-0a"};Ib.STATES=["voltage","voltage_raw","state","viberation"];Ib.prototype=new g;Ib.prototype.constructor=Ib;Ib.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.voltage=b/250*5;d.voltage_raw=b;switch(a>>1&3){case 0:d.state="closed";break;case 1:d.state="tilted";break;case 2:d.state="reserved";
break;case 3:d.state="open"}switch(a&1){case 0:d.viberation=!1;break;case 1:d.viberation=!0}}}return d};var ja=function(b){t.call(this,b);this._data="a5-20-04";this.TEACH_IN_VARIATION=3;this._defaultSetpoint=15;this._defaultWakeupCycle=3;this._defaultDisplay=0;this._states={pending:{value:!1,time:(new Date).getTime()}};this._service_command_new=this._button_lock_new=this._display_new=this._wakeup_cycle_new=this._measurement_new=this._setpoint_new=this._valve_new=null};ja.COMMANDS="setValve setTo up down measureOn measureOff setWakeup setDisplay buttonLock buttonUnlock openValve closeValve init".split(" ");
ja.STATES="valve measurement button_lock temperature_selection feed_temperature setpoint error temperature wakeup_cycle display pending".split(" ");ja.prototype=new t;ja.prototype.constructor=ja;ja.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.wakeup_cycle||null==this._params.wakeup_cycle)this._params.wakeup_cycle=this._defaultWakeupCycle;if("undefined"==typeof this._params.display||null==this._params.display)this._params.display=this._defaultDisplay};
ja.prototype.getStatesBuffer=function(){var b=JSON.parse(JSON.stringify(this._states));b.wakeup_cycle={value:this._params.wakeup_cycle,time:-1};b.display={value:this._params.display,time:-1};"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(b.wakeup_cycle={value:this._wakeup_cycle_new,time:-1});"undefined"!=typeof this._display_new&&null!=this._display_new&&(b.display={value:this._display_new,time:-1});"undefined"!=typeof this._valve_new&&null!=this._valve_new&&(b.valve={value:this._valve_new,
time:-1});"undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new&&(b.setpoint={value:this._setpoint_new,time:-1});"undefined"!=typeof this._measurement_new&&null!=this._measurement_new&&(b.measurement={value:this._measurement_new,time:-1});"undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new&&(b.button_lock={value:this._button_lock_new,time:-1});return b};ja.prototype.getCurrentStates=function(){var b={},d=this.getStatesBuffer(),a;for(a in d)d.hasOwnProperty(a)&&d[a]&&
(b[a]=d[a].value);return b};ja.prototype.executeCommand=function(b,d,a){var c=(new Date).getTime();if(d&&d.value){"setValve"==d.value.substr(0,8)&&8<d.value.length?(b=d.value.substr(8),d={value:"setValve",ext:b}):"setTo"==d.value.substr(0,5)&&5<d.value.length?(b=d.value.substr(5),d={value:"setTo",ext:b}):"up"==d.value.substr(0,2)&&2<d.value.length?(b=d.value.substr(2),d={value:"up",ext:b}):"down"==d.value.substr(0,4)&&4<d.value.length?(b=d.value.substr(4),d={value:"down",ext:b}):"setWakeup"==d.value.substr(0,
9)&&9<d.value.length?(b=d.value.substr(9),d={value:"setWakeup",ext:b}):"setDisplay"==d.value.substr(0,10)&&10<d.value.length&&(b=d.value.substr(10),d={value:"setDisplay",ext:b});var e=[];switch(d.value){case "setValve":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set valve value invalid"));return}b=parseInt(d.ext);0>b&&(b=0);100<b&&(b=100);this._valve_new=b;this._states.pending={value:!0,time:c};d={key:"valve",value:b,changed:!1};c=this._states.valve?this._states.valve.value:null;c!=b&&
(d.oldvalue=c,d.changed=!0);e.push(d);break;case "setTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set valve value invalid"));return}b=parseFloat(d.ext);10>b&&(b=10);30<b&&(b=30);this._setpoint_new=b;this._states.pending={value:!0,time:c};d={key:"setpoint",value:this._setpoint_new,changed:!1};c=this._states.setpoint?this._states.setpoint.value:null;c!=this._setpoint_new&&(d.oldvalue=c,d.changed=!0);e.push(d);break;case "up":(b=d.ext)||(b=.5);b=parseFloat(b);if("undefined"!=typeof this._setpoint_new&&
null!=this._setpoint_new)this._setpoint_new+=b;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value+b;else{a&&a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_new=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,time:c};d={key:"setpoint",value:this._setpoint_new,changed:!1};c=this._states.setpoint?this._states.setpoint.value:
null;c!=this._setpoint_new&&(d.oldvalue=c,d.changed=!0);e.push(d);break;case "down":(b=d.ext)||(b=.5);b=parseFloat(b);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new-=b;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value-b;else{a&&a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_ne=10);30<this._setpoint_new&&
(this._setpoint_new=30);this._states.pending={value:!0,time:c};d={key:"setpoint",value:this._setpoint_new,changed:!1};c=this._states.setpoint?this._states.setpoint.value:null;c!=this._setpoint_new&&(d.oldvalue=c,d.changed=!0);e.push(d);break;case "measureOn":this._measurement_new="active";this._states.pending={value:!0,time:c};d={key:"measurement",value:this._measurement_new,changed:!1};c=this._states.measurement?this._states.measurement.value:null;c!=this._measurement_new&&(d.oldvalue=c,d.changed=
!0);e.push(d);break;case "measureOff":this._measurement_new="inactive";this._states.pending={value:!0,time:c};d={key:"measurement",value:this._measurement_new,changed:!1};c=this._states.measurement?this._states.measurement.value:null;c!=this._measurement_new&&(d.oldvalue=c,d.changed=!0);e.push(d);break;case "setWakeup":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set wakup cycle value invalid"));return}this._wakeup_cycle_new=b=parseInt(d.ext);this._states.pending={value:!0,time:c};d={key:"wakeup_cycle",
value:this._wakeup_cycle_new,changed:!1};c=this._params.wakeup_cycle;c!=this._wakeup_cycle_new&&(d.oldvalue=c,d.changed=!0);e.push(d);break;case "setDisplay":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set display orientation value invalid"));return}this._display_new=b=parseInt(d.ext);this._states.pending={value:!0,time:c};d={key:"display",value:this._display_new,changed:!1};c=this._params.display;c!=this._display_new&&(d.oldvalue=c,d.changed=!0);e.push(d);break;case "buttonLock":this._button_lock_new=
"locked";this._states.pending={value:!0,time:c};d={key:"button_lock",value:this._button_lock_new,changed:!1};c=this._states.button_lock?this._states.button_lock.value:null;c!=this._button_lock_new&&(d.oldvalue=c,d.changed=!0);e.push(d);break;case "buttonUnlock":this._button_lock_new="unlocked";this._states.pending={value:!0,time:c};d={key:"button_lock",value:this._button_lock_new,changed:!1};c=this._states.button_lock?this._states.button_lock.value:null;c!=this._button_lock_new&&(d.oldvalue=c,d.changed=
!0);e.push(d);break;case "openValve":this._service_command_new=1;this._states.pending={value:!0,time:c};break;case "closeValve":this._service_command_new=3;this._states.pending={value:!0,time:c};break;case "init":this._service_command_new=2,this._states.pending={value:!0,time:c}}0<e.length&&require("x.hub.m.enocean.js")._onEOEvents(this,e);a&&a()}else a&&a(Error("command invalid"))};ja.prototype.evalData=function(b,d,a){if(d=this.evalTelegram(d)){var c=this;this._sendResponse(b,d,function(b,d){b=
c.checkStateChange(d);a&&a(null,b)})}else a&&a(Error("data format invalid"))};ja.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){d.valve=b;d.measurement=a>>7&1?"inactive":"active";d.button_lock=a>>2&1?"locked":"unlocked";b=a>>1&1;a&=1;d.temperature_selection=b?"setpoint":"feed_temperature";switch(b){case 0:d.feed_temperature=parseFloat((e/255*60+20).toFixed(1));break;
case 1:d.setpoint=parseFloat((e/255*20+10).toFixed(1))}if(0==a)d.error="no_error",d.temperature=parseFloat((c/255*20+10).toFixed(1));else switch(c){case 17:d.error="measurement_error";break;case 18:d.error="battery_empty";break;case 20:d.error="frost_protection";break;case 33:d.error="blocked_valve";break;case 36:d.error="end_point_detection_error";break;case 40:d.error="no_valve";break;case 49:d.error="not_taught_in";break;case 53:d.error="no_response_from_controller";break;case 54:d.error="teach_in_error";
break;default:d.error="unknow_error"}}}return d};ja.prototype._sendResponse=function(b,d,a){var c=(new Date).getTime(),e=JSON.parse(JSON.stringify(d));this._states.pending={value:!1,time:c};var f=!1;if("undefined"!=typeof this._valve_new&&null!=this._valve_new){var q=this._valve_new;this._states.valve={value:this._valve_new,time:c};this._valve_new=null;delete e.valve}else q="undefined"!=typeof d.valve&&null!=d.valve?d.valve:this._states.valve?this._states.valve.value:null;if("undefined"==typeof q||
null==q)q=0,e.valve=0;if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new){var g=Math.round((this._setpoint_new-10)/20*255);this._states.setpoint={value:this._setpoint_new,time:c};this._setpoint_new=null;delete e.setpoint}else"undefined"!=typeof d.setpoint&&null!=d.setpoint?g=Math.round((d.setpoint-10)/20*255):this._states.setpoint&&"undefined"!=this._states.setpoint.value&&null!=this._states.setpoint.value&&(g=Math.round((this._states.setpoint.value-10)/20*255));if("undefined"==typeof g||
null==g)g=this._defaultSetpoint,g=Math.round((g-10)/20*255),e.setpoint=this._defaultSetpoint;if("undefined"!=typeof this._measurement_new&&null!=this._measurement_new){var h="active"==this._measurement_new?0:1;this._states.measurement={value:this._measurement_new,time:c};this._measurement_new=null;delete e.measurement}else"undefined"!=typeof d.measurement&&null!=d.measurement?h="active"==d.measurement?0:1:this._states.measurement&&"undefined"!=this._states.measurement.value&&null!=this._states.measurement.value&&
(h="active"==this._states.measurement.value?0:1);if("undefined"==typeof h||null==h)h=0,e.measurement="active";var k=this._params.wakeup_cycle;"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(k=this._wakeup_cycle_new,this._params.wakeup_cycle=this._wakeup_cycle_new,f=!0,this._wakeup_cycle_new=null);if("undefined"==typeof k||null==k)k=this._defaultWakeupCycle,this._params.wakeup_cycle=k;var l=this._params.display;"undefined"!=typeof this._display_new&&null!=this._display_new&&
(l=this._display_new,this._params.display=this._display_new,f=!0,this._display_new=null);if("undefined"==typeof l||null==l)l=this._defaultDisplay,this._params.display=l;if("undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new){var m="locked"==this._button_lock_new?1:0;this._states.button_lock={value:this._button_lock_new,time:c};this._button_lock_new=null;delete e.button_lock}else"undefined"!=typeof d.button_lock&&null!=d.button_lock?m="locked"==d.button_lock?1:0:this._states.button_lock&&
this._states.button_lock.value&&(m="locked"==this._states.button_lock.value?1:0);if("undefined"==typeof m||null==m)m=0,e.button_lock="unlocked";d=0;"undefined"!=typeof this._service_command_new&&null!=this._service_command_new&&(d=this._service_command_new,this._service_command_new=null);q=new Buffer([q,g,(h&1)<<6|k&63,(l&3)<<4|8|(m&1)<<2|d&3]);f&&require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated();f=this._senderID;f||(f=x.hub.m.enocean.SENDER_ID);f=new x.hub.m.enocean.ESP3.Telegram.ADT(165,
q,this._address,f,0);b.sendTelegram(f,!0,function(b){a&&a(b,e)})};var Wa=function(b){t.call(this,b);this._data="a5-30-??"};Wa.prototype=new t;Wa.prototype.constructor=Wa;var Ka=function(b){g.call(this,b);this._data="a5-30-01"};Ka.STATES=["battery_low","battery_raw","state","state_raw"];Ka.prototype=new Wa;Ka.prototype.constructor=Ka;Ka.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2);b=b.userData.readUInt8(1);1==(a>>3&1)&&(d.battery_low=
120>=b?!0:!1,d.battery_raw=b,d.state=195>=c?"closed":"open",d.state_raw=c)}return d};var Jb=function(b){g.call(this,b);this._data="a5-30-01\u00b4"};Jb.STATES=["state"];Jb.prototype=new Wa;Jb.prototype.constructor=Jb;Jb.prototype.evalTelegram=function(b){var d={};165==b.rorg&&(b=b.userData.readUInt8(3),1==(b>>3&1)&&(d.state=b&1?"open":"closed"));return d};var X=function(b){g.call(this,b);this._data="a5-30-03"};X.STATES="temperature temperature_raw wake input3 input2 input1 input0".split(" ");X.prototype=
new Wa;X.prototype.constructor=X;X.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2);b=b.userData.readUInt8(1);1==(a>>3&1)&&(d.temperature=(255-b)/255*40,d.temperature_raw=b,d.wake=c>>4&1,d.input3=c>>3&1,d.input2=c>>2&1,d.input1=c>>1&1,d.input0=c&1)}return d};var Kb=function(b){g.call(this,b);this._data="a5-30-04"};Kb.STATES=["analog_input","input2","input1","input0"];Kb.prototype=new Wa;Kb.prototype.constructor=Kb;Kb.prototype.evalTelegram=
function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(2);1==(a>>3&1)&&(d.analog_input=b,d.input2=a>>2&1,d.input1=a>>1&1,d.input0=a&1)}return d};var wc=function(b){t.call(this,b);this._data="a5-38-??"};wc.prototype=new t;wc.prototype.constructor=wc;var M=function(b){wc.call(this,b);this._data="a5-38-08"};M.prototype=new wc;M.prototype.constructor=M;M.prototype.evalTelegram=function(b){var d={};if(165==b.rorg){var a=b.userData.readUInt8(3),c=b.userData.readUInt8(2),
e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1))switch(b){case 2:d.level=Math.round(e/255*100),d.ramp=c,d.dim_range=a>>2&1?"relative":"absolute",d.store_final_value=a>>1&1,d.state=a&1?"on":"off"}}return d};M.prototype.switching=function(b,d,a){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new Buffer([1,d.TIM>>8&255,d.TIM&255,8|(d.LCK&1)<<2|(d.DEL&1)<<1|d.SW&1]);c=new x.hub.m.enocean.ESP3.Telegram.BS4(d,c,0);c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&
a(b)})};M.prototype.dimming=function(b,d,a){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new Buffer([2,d.EDIM,d.RMP,8|(d.EDIMR&1)<<2|(d.STR&1)<<1|d.SW&1]);c=new x.hub.m.enocean.ESP3.Telegram.BS4(d,c,0);c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&a(b)})};M.prototype.blind=function(b,d,a){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new Buffer([7,d.P1,d.P2,(d.FUNC&15)<<4|8|(d.SSF&1)<<2|(d.PAF&1)<<1|d.SMF&1]);c=new x.hub.m.enocean.ESP3.Telegram.BS4(d,
c,0);c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&a(b)})};var xc=function(b){t.call(this,b);this._data="a5-3F-7F"};xc.prototype=new t;xc.prototype.constructor=xc;var ha=function(b){g.call(this,b);this._data="d2-??-??";this.UNIQUE_GATEWAY_SENDERID=!0};ha.prototype=new g;ha.prototype.constructor=ha;var E=function(b){ha.call(this,b);this._data="d2-01-??";this._lastQuery={};this._initCount=0};E.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");
E.prototype=new ha;E.prototype.constructor=E;E.prototype.init=function(b){var d=this.getIOs();if(0<d.length){var a=require("x.hub.m.enocean.js")._esp3,c=0,e=this,f=function(){c++;c<d.length?e.statusQuery(a,{IO:d[c]},f):b&&b()};this.statusQuery(a,{IO:d[c]},f)}else b&&b()};E.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):
this._initCount=0;return this._states};E.prototype.getIOs=function(){return[]};E.prototype.setOutput=function(b,d,a){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new Buffer([1,(d.DV&7)<<5|d.IO&31,d.OV&127]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(d,c,0);this._senderID!=this._address&&c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&a(b)})};E.prototype.setLocal=function(b,d,a){d=new Buffer([(d.DE&1)<<7|2,(d.OC&1)<<7|(d.RO&1)<<6|(d.LC&1)<<5|d.IO&31,(d.DT2&15)<<4|
d.DT3&15,(d.DN&1)<<7|(d.PF&1)<<6|(d.DS&3)<<4|d.DT1&15]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(d,x.hub.m.enocean.SENDER_ID,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&a(b)})};E.prototype.statusQuery=function(b,d,a){this._senderID?(this._lastQuery[d.IO]=(new Date).getTime(),d=new Buffer([3,d.IO&31]),d=new x.hub.m.enocean.ESP3.Telegram.VLD(d,this._senderID,0),d.setDstId(this._address),b.sendTelegram(d,!0,function(b){a&&a(b)})):a&&a(Error("no senderID"))};E.prototype.measurementQuery=
function(b,d,a){d=new Buffer([6,(d.QU&1)<<5|d.IO&31]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(d,this._senderID,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&a(b)})};E.prototype.evalTelegram=function(b){var d={};if(210==b.rorg){var a=b.userData.readUInt8(0);switch(a&15){case 4:if(3==b.userData.length){var c=a>>7&1,e=a>>6&1;a=b.userData.readUInt8(1);var f=a>>7&1,g=a>>5&3,h=a&31;a=b.userData.readUInt8(2);b=a&127;d.power_failure_detection=c?!0:!1;d.power_failure=e?!0:!1;d.over_current_switch_off=
f;d.error_level=g;d.io_channel=h;d.local_control=a>>7&1?!0:!1;d.output_value=b;d.output_state=b?"on":"off"}break;case 7:if(6==b.userData.length){a=b.userData.readUInt8(1);c=a>>5&7;h=a&31;a=b.userData.readUInt32BE(2);switch(c){case 0:d.unit="Ws";break;case 1:d.unit="Wh";break;case 2:d.unit="KWh";break;case 3:d.unit="W";break;case 4:d.unit="KW"}d.io_channel=h;d.value=a}}}return d};var na=function(b){E.call(this,b);this._data="d2-01-00"};na.COMMANDS=["on","off","toggle"];na.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");
na.prototype=new E;na.prototype.constructor=na;na.prototype.getIOs=function(){return[0]};na.prototype.executeCommand=function(b,d,a){if(d&&d.value){var c=this;switch(d.value){case "on":this.activeStateChange({output_value:100,output_state:"on"});this.setOutput(b,{DV:0,IO:0,OV:100},a);break;case "off":this.activeStateChange({output_value:0,output_state:"off"});this.setOutput(b,{DV:0,IO:0,OV:0},a);break;case "toggle":this._states.output_state?this.executeCommand(b,{value:"on"==this._states.output_state.value?
"off":"on"},a):this.init(function(){setTimeout(function(){c._states.output_state?c.executeCommand(b,d,a):a&&a(Error("unkown current status"))},200)})}}else a&&a(Error("command invalid"))};var Lb=function(b){na.call(this,b);this._data="d2-01-01"};Lb.COMMANDS=["on","off","toggle"];Lb.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");Lb.prototype=new na;Lb.prototype.constructor=Lb;var Mb=function(b){na.call(this,
b);this._data="d2-01-03";this._lastOnLevel=-1};Mb.prototype=new na;Mb.prototype.constructor=Mb;Mb.prototype.evalData=function(b,d,a){(b=this.evalTelegram(d))?((0==b.output_value||"off"==b.output_state)&&this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value),b=this.checkStateChange(b),a&&a(null,b)):a&&a(Error("data format invalid"))};Mb.prototype.executeCommand=function(b,d,a){if(d&&d.value){if("dimTo"==d.value.substr(0,5)&&5<d.value.length){var c=
d.value.substr(5);d={value:"dimTo",ext:c}}else"toggleTo"==d.value.substr(0,8)&&8<d.value.length&&(c=d.value.substr(8),d={value:"toggleTo",ext:c});(new Date).getTime();var e=this;switch(d.value){case "on":c=this._lastOnLevel;if(-1==c||0==c)c=100;this.setOutput(b,{DV:0,IO:0,OV:c},function(b){b||e.activeStateChange({output_value:c,output_state:"on"});a&&a(b)});break;case "off":this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value);this.setOutput(b,
{DV:0,IO:0,OV:0},function(b){b||e.activeStateChange({output_value:0,output_state:"off"});a&&a(b)});break;case "toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(b,d,a):a&&a(Error("unkown current status"))},200)});break}this.executeCommand(b,{value:"on"==this._states.output_state.value?"off":"on"},a);break;case "toggleTo":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(b,
d,a):a&&a(Error("unkown current status"))},200)});break}"on"==this._states.output_state.value?this.executeCommand(b,{value:"off"},a):this.executeCommand(b,{value:"dimTo",ext:d.ext},a);break;case "dimTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("dim to value invalid"));break}c=parseFloat(d.ext);0>c&&(c=0);100<c&&(c=100);this.setOutput(b,{DV:0,IO:0,OV:c},function(b){b||e.activeStateChange({output_value:c,output_state:0==c?"off":"on"});a&&a(b)});break;case "dimUp":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?
e.executeCommand(b,d,a):a&&a(Error("unkown current status"))},200)});break}c=parseInt(this._states.output_value.value);c+=5;100<c&&(c=100);this.executeCommand(b,{value:"dimTo",ext:c},a);break;case "dimDown":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(b,d,a):a&&a(Error("unkown current status"))},200)});break}c=parseInt(this._states.output_value.value);c-=5;0>c&&(c=0);this.executeCommand(b,{value:"dimTo",ext:c},a);break;default:a&&
a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var Da=function(b){E.call(this,b);this._data="d2-01-11"};Da.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle".split(" ");Da.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state".split(" ");Da.prototype=new E;Da.prototype.constructor=Da;Da.prototype.getIOs=function(){return[0,1]};Da.prototype.evalTelegram=
function(b){if(b=E.prototype.evalTelegram.call(this,b))switch(b.io_channel){case 0:b.ch1_output_value=b.output_value;b.ch1_output_state=b.output_state;break;case 1:b.ch2_output_value=b.output_value,b.ch2_output_state=b.output_state}return b};Da.prototype.executeCommand=function(b,d,a){if(d&&d.value){var c=this;switch(d.value){case "ch1On":this.activeStateChange({ch1_output_value:100,ch1_output_state:"on"});this.setOutput(b,{DV:0,IO:0,OV:100},a);break;case "ch1Off":this.activeStateChange({ch1_output_value:0,
ch1_output_state:"off"});this.setOutput(b,{DV:0,IO:0,OV:0},a);break;case "ch1Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){c._states.output_state?c.executeCommand(b,d,a):a&&a(Error("unkown current status"))},200)});break}var e="on"==this._states.ch1_output_state.value?"off":"on";this.activeStateChange({ch1_output_value:"on"==e?100:0,ch1_output_state:e});this.executeCommand(b,{value:"on"==e?"ch1On":"ch1Off"},a);break;case "ch2On":this.activeStateChange({ch2_output_value:100,
ch2_output_state:"on"});this.setOutput(b,{DV:0,IO:1,OV:100},a);break;case "ch2Off":this.activeStateChange({ch2_output_value:0,ch2_output_state:"off"});this.setOutput(b,{DV:0,IO:1,OV:0},a);break;case "ch2Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){c._states.output_state?c.executeCommand(b,d,a):a&&a(Error("unkown current status"))},200)});break}e="on"==this._states.ch2_output_state.value?"off":"on";this.activeStateChange({ch2_output_value:"on"==e?100:0,ch2_output_state:e});
this.executeCommand(b,{value:"on"==e?"ch2On":"ch2Off"},a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var ra=function(b){E.call(this,b);this._data="d2-01-13";this._queryInterval=3E4};ra.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle".split(" ");ra.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state".split(" ");
ra.prototype=new E;ra.prototype.constructor=ra;ra.prototype.getStatesBuffer=function(){var b=[];this._states.ch1_output_state||(!this._lastQuery[0]||now-this._lastQuery[0]>this._queryInterval)&&b.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||now-this._lastQuery[1]>this._queryInterval)&&b.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||now-this._lastQuery[2]>this._queryInterval)&&b.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||now-this._lastQuery[3]>this._queryInterval)&&
b.push(3);0<b.length&&this._queryStates(b);return this._states};ra.prototype._queryStates=function(b,d){var a=require("x.hub.m.enocean.js")._esp3,c=0,e=this,f=function(){c++;c<b.length?e.statusQuery(a,{IO:b[c]},f):d&&d()};this.statusQuery(a,{IO:b[c]},f)};ra.prototype.getIOs=function(){return[0,1,2,3]};ra.prototype.evalTelegram=function(b){if(b=E.prototype.evalTelegram.call(this,b))switch(b.io_channel){case 0:b.ch1_output_value=b.output_value;b.ch1_output_state=b.output_state;break;case 1:b.ch2_output_value=
b.output_value;b.ch2_output_state=b.output_state;break;case 2:b.ch3_output_value=b.output_value;b.ch3_output_state=b.output_state;break;case 3:b.ch4_output_value=b.output_value,b.ch4_output_state=b.output_state}return b};ra.prototype.executeCommand=function(b,d,a){if(d&&d.value){var c=this;switch(d.value?d.value.substr(0,3):null){case "ch1":var e=0;var f="ch1_output_value";var q="ch1_output_state";break;case "ch2":e=1;f="ch2_output_value";q="ch2_output_state";break;case "ch3":e=2;f="ch3_output_value";
q="ch3_output_state";break;case "ch4":e=3,f="ch4_output_value",q="ch4_output_state"}switch(d.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":var g={};g[f]=100;g[q]="on";var h={DV:0,IO:e,OV:100};this.activeStateChange(g);this.setOutput(b,h,a);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":g={};g[f]=0;g[q]="off";h={DV:0,IO:e,OV:0};this.activeStateChange(g);this.setOutput(b,h,a);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){c._states.output_state?
c.executeCommand(b,d,a):a&&a(Error("unkown current status"))},200)});break}if(!this._states[q]){a&&a(Error("state unknown"));break}h="on"==this._states[q].value?"off":"on";g={};g[f]="on"==h?100:0;g[q]=h;h={DV:0,IO:e,OV:"on"==h?100:0};this.activeStateChange(g);this.setOutput(b,h,a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var sa=function(b){E.call(this,b);this._data="d2-01-14";this._queryInterval=3E4};sa.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle ch5On ch5Off ch5Toggle ch6On ch6Off ch6Toggle ch7On ch7Off ch7Toggle ch8On ch8Off ch8Toggle".split(" ");
sa.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state ch5_output_value ch5_output_state ch6_output_value ch6_output_state ch7_output_value ch7_output_state ch8_output_value ch8_output_state".split(" ");sa.prototype=new E;sa.prototype.constructor=sa;sa.prototype._queryStates=function(b,
d){var a=require("x.hub.m.enocean.js")._esp3,c=0,e=this,f=function(){c++;c<b.length?e.statusQuery(a,{IO:b[c]},f):d&&d()};this.statusQuery(a,{IO:b[c]},f)};sa.prototype.getStatesBuffer=function(){var b=(new Date).getTime(),d=[];this._states.ch1_output_state||(!this._lastQuery[0]||b-this._lastQuery[0]>this._queryInterval)&&d.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||b-this._lastQuery[1]>this._queryInterval)&&d.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||b-this._lastQuery[2]>
this._queryInterval)&&d.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||b-this._lastQuery[3]>this._queryInterval)&&d.push(3);this._states.ch5_output_state||(!this._lastQuery[4]||b-this._lastQuery[4]>this._queryInterval)&&d.push(4);this._states.ch6_output_state||(!this._lastQuery[5]||b-this._lastQuery[5]>this._queryInterval)&&d.push(5);this._states.ch7_output_state||(!this._lastQuery[6]||b-this._lastQuery[6]>this._queryInterval)&&d.push(6);this._states.ch8_output_state||(!this._lastQuery[7]||
b-this._lastQuery[7]>this._queryInterval)&&d.push(7);0<d.length&&this._queryStates(d);return this._states};sa.prototype.getIOs=function(){return[0,1,2,3,4,5,6,7]};sa.prototype.evalTelegram=function(b){if(b=E.prototype.evalTelegram.call(this,b))switch(b.io_channel){case 0:b.ch1_output_value=b.output_value;b.ch1_output_state=b.output_state;break;case 1:b.ch2_output_value=b.output_value;b.ch2_output_state=b.output_state;break;case 2:b.ch3_output_value=b.output_value;b.ch3_output_state=b.output_state;
break;case 3:b.ch4_output_value=b.output_value;b.ch4_output_state=b.output_state;break;case 4:b.ch5_output_value=b.output_value;b.ch5_output_state=b.output_state;break;case 5:b.ch6_output_value=b.output_value;b.ch6_output_state=b.output_state;break;case 6:b.ch7_output_value=b.output_value;b.ch7_output_state=b.output_state;break;case 7:b.ch8_output_value=b.output_value,b.ch8_output_state=b.output_state}return b};sa.prototype.executeCommand=function(b,d,a){if(d&&d.value){var c=this;switch(d.value?d.value.substr(0,
3):null){case "ch1":var e=0;var f="ch1_output_value";var q="ch1_output_state";break;case "ch2":e=1;f="ch2_output_value";q="ch2_output_state";break;case "ch3":e=2;f="ch3_output_value";q="ch3_output_state";break;case "ch4":e=3;f="ch4_output_value";q="ch4_output_state";break;case "ch5":e=4;f="ch5_output_value";q="ch5_output_state";break;case "ch6":e=5;f="ch6_output_value";q="ch6_output_state";break;case "ch7":e=6;f="ch7_output_value";q="ch7_output_state";break;case "ch8":e=7,f="ch8_output_value",q="ch8_output_state"}switch(d.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":case "ch5On":case "ch6On":case "ch7On":case "ch8On":var g=
{};g[f]=100;g[q]="on";var h={DV:0,IO:e,OV:100};this.activeStateChange(g);this.setOutput(b,h,a);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":case "ch5Off":case "ch6Off":case "ch7Off":case "ch8Off":g={};g[f]=0;g[q]="off";h={DV:0,IO:e,OV:0};this.activeStateChange(g);this.setOutput(b,h,a);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":case "ch5Toggle":case "ch6Toggle":case "ch7Toggle":case "ch8Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){c._states.output_state?
c.executeCommand(b,d,a):a&&a(Error("unkown current status"))},200)});break}if(!this._states[q]){a&&a(Error("state unknown"));break}h="on"==this._states[q].value?"off":"on";g={};g[f]="on"==h?100:0;g[q]=h;h={DV:0,IO:e,OV:"on"==h?100:0};this.activeStateChange(g);this.setOutput(b,h,a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var yc=function(b){ha.call(this,b);this._data="d2-05-??"};yc.prototype=new ha;yc.prototype.constructor=yc;var N=function(b){yc.call(this,
b);this._data="d2-05-00"};N.COMMANDS="moveUp moveDown moveTo stepUp stepDown lamellaUp lamellaDown lamellaTo stop setRunTime setRotationTime setParams[15.2s]:[10,20,30ms]:[0-3]".split(" ");N.STATES=["state","angle","lock","channel"];N.prototype=new yc;N.prototype.constructor=N;N.prototype.init=function(b){var d=require("x.hub.m.enocean.js")._esp3;this.query(d,{CHN:0},b)};N.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length&&this.init();return this._states};N.prototype.goToPositionAngle=
function(b,d,a){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new Buffer([d.POS&127,d.ANG&127,(d.REPO&7)<<4|d.LOCK&7,(d.CHN&15)<<4|1]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(d,c,0);c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&a(b)})};N.prototype.stop=function(b,d,a){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new Buffer([(d.CHN&15)<<4|2]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(d,c,0);c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&
a(b)})};N.prototype.query=function(b,d,a){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new Buffer([(d.CHN&15)<<4|3]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(d,c,0);c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&a(b)})};N.prototype.setParameters=function(b,d,a){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);d=new Buffer([d.VERT>>8&127,d.VERT&255,d.ROT&255,d.AA&7,(d.CHN&15)<<4|5]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(d,c,0);c.setDstId(this._address);
b.sendTelegram(c,!0,function(b){a&&a(b)})};N.prototype.evalTelegram=function(b){var d={};if(210==b.rorg)switch(b.userData.readUInt8(b.userData.length-1)&15){case 4:if(4==b.userData.length){var a=b.userData.readUInt8(0);d.state=a&127;a=b.userData.readUInt8(1);d.angle=a&127;a=b.userData.readUInt8(2);switch(a&7){case 0:d.lock="normal";break;case 1:d.lock="blockage_mode";break;case 2:d.lock="alarm_mode"}a=b.userData.readUInt8(3);d.channel=a>>4&15}}return d};N.prototype.executeCommand=function(b,d,a){if(d&&
d.value){if("moveTo"==d.value.substr(0,6)&&6<d.value.length){var c=d.value.substr(6);d={value:"moveTo",ext:c}}else"lamellaTo"==d.value.substr(0,9)&&9<d.value.length?(c=d.value.substr(9),d={value:"lamellaTo",ext:c}):"setRunTime"==d.value.substr(0,10)&&10<d.value.length?(c=d.value.substr(10),d={value:"setRunTime",ext:c}):"setRotationTime"==d.value.substr(0,15)&&15<d.value.length?(c=d.value.substr(15),d={value:"setRotationTime",ext:c}):"setParams"==d.value.substr(0,9)&&9<d.value.length&&(c=d.value.substr(9),
d={value:"setParams",ext:c});var e=(new Date).getTime(),f=this;switch(d.value){case "moveUp":this.goToPositionAngle(b,{POS:0,ANG:0,REPO:0,LOCK:0,CHN:0},a);break;case "moveDown":this.goToPositionAngle(b,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:0},a);break;case "moveTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("move to value invalid"));break}c=parseFloat(d.ext);0>c&&(c=0);100<c&&(c=100);this._states.state={value:c,time:e};this.goToPositionAngle(b,{POS:c,ANG:255,REPO:0,LOCK:0,CHN:0},a);break;
case "stepUp":if(!this._states.state){this.init(function(){setTimeout(function(){f._states.state?f.executeCommand(b,d,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){a&&a(Error("device status unknonw"));break}0!=this._states.angle.value?(c=this._states.angle.value-10,0>c&&(c=0),this._states.angle={value:c,time:e},this.goToPositionAngle(b,{POS:255,ANG:c,REPO:0,LOCK:0,CHN:0},a)):(c=this._states.state.value-5,0>c&&(c=0),this._states.state=
{value:c,time:e},this.goToPositionAngle(b,{POS:c,ANG:0,REPO:0,LOCK:0,CHN:0},a));break;case "stepDown":if(!this._states.state){this.init(function(){setTimeout(function(){f._states.state?f.executeCommand(b,d,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){a&&a(Error("device status unknonw"));break}100!=this._states.angle.value?(c=this._states.angle.value+10,100<c&&(c=100),this._states.angle={value:c,time:e},this.goToPositionAngle(b,
{POS:255,ANG:c,REPO:0,LOCK:0,CHN:0},a)):(c=this._states.state.value+5,100<c&&(c=100),this._states.state={value:c,time:e},this.goToPositionAngle(b,{POS:c,ANG:100,REPO:0,LOCK:0,CHN:0},a));break;case "lamellaUp":this.goToPositionAngle(b,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:0},a);break;case "lamellaDown":this.goToPositionAngle(b,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:0},a);break;case "lamellaTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("lamella to value invalid"));break}c=parseFloat(d.ext);0>c&&
(c=0);100<c&&(c=100);this._states.angle={value:c,time:e};this.goToPositionAngle(b,{POS:255,ANG:c,REPO:0,LOCK:0,CHN:0},a);break;case "stop":this.stop(b,{CHN:0},a);break;case "setRunTime":if(!d.ext){a&&a(Error("parameters is null"));break}c=100*parseFloat(d.ext);499>=c&&(c=500);this.setParameters(b,{VERT:c,ROT:255,AA:7,CHN:0},a);break;case "setRotationTime":if(!d.ext){a&&a(Error("parameters is null"));break}c=32767;e=parseInt(d.ext)/10;this.setParameters(b,{VERT:c,ROT:e,AA:7,CHN:0},a);break;case "setParams":if(!d.ext){a&&
a(Error("parameters is null"));break}var g=d.ext.split(":");if(3!=g.length){a&&a(Error("parameters format invalid"));break}c=g[0]?100*parseFloat(g[0]):32767;499>=c&&(c=32767);e=g[1]?parseInt(g[1])/10:255;g=g[2]?parseInt(g[2]):7;this.setParameters(b,{VERT:c,ROT:e,AA:g,CHN:0},a);break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var xa=function(b){N.call(this,b);this._data="d2-05-01";this._ch1QueryCount=0;this._ch1QueryTO=null;this._ch1QueryTimestamp=0};xa.COMMANDS="ch1moveUp ch1moveDown ch1moveTo ch1stepUp ch1stepDown ch1lamellaUp ch1lamellaDown ch1lamellaTo ch1stop ch2moveUp ch2moveDown ch2moveTo ch2stepUp ch2stepDown ch2lamellaUp ch2lamellaDown ch2lamellaTo ch2stop ch3moveUp ch3moveDown ch3moveTo ch3stepUp ch3stepDown ch3lamellaUp ch3lamellaDown ch3lamellaTo ch3stop ch4moveUp ch4moveDown ch4moveTo ch4stepUp ch4stepDown ch4lamellaUp ch4lamellaDown ch4lamellaTo ch4stop ch1setRunTime ch2setRunTime ch3setRunTime ch4setRunTime ch1setRotationTime ch2setRotationTime ch3setRotationTime ch4setRotationTime ch1setParams[15.2s]:[10,20,30ms]:[0-3] ch2setParams ch3setParams ch4setParams".split(" ");
xa.STATES="ch1state ch1angle ch1lock ch2state ch2angle ch2lock ch3state ch3angle ch3lock ch4state ch4angle ch4lock channel".split(" ");xa.prototype=new N;xa.prototype.constructor=xa;xa.prototype.init=function(b){this._queryStates([0,1,2,3],b)};N.prototype.getStatesBuffer=function(){var b=[];this._states.ch1state||b.push(0);this._states.ch2state||b.push(1);this._states.ch3state||b.push(2);this._states.ch4state||b.push(3);0<b.length&&this._queryStates(b);return this._states};xa.prototype._queryStates=
function(b,d){var a=require("x.hub.m.enocean.js")._esp3,c=0,e=this,f=function(){c++;c<b.length?e.query(a,{CHN:b[c]},f):d&&d()};this.query(a,{CHN:b[c]},f)};xa.prototype.evalTelegram=function(b){if(b=N.prototype.evalTelegram.call(this,b))switch(b.channel){case 0:b.ch1state=b.state;b.ch1angle=b.angle;b.ch1lock=b.lock;break;case 1:b.ch2state=b.state;b.ch2angle=b.angle;b.ch2lock=b.lock;break;case 2:b.ch3state=b.state;b.ch3angle=b.angle;b.ch3lock=b.lock;break;case 3:b.ch4state=b.state,b.ch4angle=b.angle,
b.ch4lock=b.lock}return b};xa.prototype.executeCommand=function(b,d,a){if(d&&d.value){d=JSON.parse(JSON.stringify(d));var c=null;switch(d.value.substr(0,3)){case "ch1":c=0;var e="ch1state";var f="ch1angle";break;case "ch2":c=1;e="ch2state";f="ch2angle";break;case "ch3":c=2;e="ch3state";f="ch3angle";break;case "ch4":c=3;e="ch4state";f="ch4angle";break;default:a&&a(Error("unknown command"))}d.value=d.value.substr(3);if("moveTo"==d.value.substr(0,6)&&6<d.value.length){var g=d.value.substr(6);d={value:"moveTo",
ext:g}}else"lamellaTo"==d.value.substr(0,9)&&9<d.value.length?(g=d.value.substr(9),d={value:"lamellaTo",ext:g}):"setRunTime"==d.value.substr(0,10)&&10<d.value.length?(g=d.value.substr(10),d={value:"setRunTime",ext:g}):"setRotationTime"==d.value.substr(0,15)&&15<d.value.length?(g=d.value.substr(15),d={value:"setRotationTime",ext:g}):"setParams"==d.value.substr(0,9)&&9<d.value.length&&(g=d.value.substr(9),d={value:"setParams",ext:g});(new Date).getTime();var h=this;switch(d.value){case "moveUp":this.goToPositionAngle(b,
{POS:0,ANG:0,REPO:0,LOCK:0,CHN:c},a);break;case "moveDown":this.goToPositionAngle(b,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:c},a);break;case "moveTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("move to value invalid"));break}g=parseFloat(d.ext);0>g&&(g=0);100<g&&(g=100);var q={};q[e]=g;this.activeStateChange(q);this.goToPositionAngle(b,{POS:g,ANG:255,REPO:0,LOCK:0,CHN:c},a);break;case "stepUp":if(!this._states[e]){this.init(function(){setTimeout(function(){h._states[e]?h.executeCommand(b,d,
a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states[e].value||255==this._states[f].value){a&&a(Error("device status unknonw"));break}0!=this._states[f].value?(g=this._states[f].value-10,0>g&&(g=0),q={},q[f]=g,this.activeStateChange(q),this.goToPositionAngle(b,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:c},a)):(g=this._states[e].value-5,0>g&&(g=0),q={},q[e]=g,this.activeStateChange(q),this.goToPositionAngle(b,{POS:g,ANG:0,REPO:0,LOCK:0,CHN:c},a));break;case "stepDown":if(!this._states[e]){this.init(function(){setTimeout(function(){h._states[e]?
h.executeCommand(b,d,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states[e].value||255==this._states[f].value){a&&a(Error("device status unknonw"));break}100!=this._states[f].value?(g=this._states[f].value+10,100<g&&(g=100),q={},q[f]=g,this.activeStateChange(q),this.goToPositionAngle(b,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:c},a)):(g=this._states[e].value+5,100<g&&(g=100),q={},q[e]=g,this.activeStateChange(q),this.goToPositionAngle(b,{POS:g,ANG:100,REPO:0,LOCK:0,CHN:c},a));break;
case "lamellaUp":this.goToPositionAngle(b,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:c},a);break;case "lamellaDown":this.goToPositionAngle(b,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:c},a);break;case "lamellaTo":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("lamella to value invalid"));break}g=parseFloat(d.ext);0>g&&(g=0);100<g&&(g=100);q={};q[f]=g;this.goToPositionAngle(b,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:c},a);break;case "stop":this.stop(b,{CHN:c},a);break;case "setRunTime":if(!d.ext){a&&a(Error("parameters is null"));
break}f=100*parseFloat(d.ext);499>=f&&(f=500);this.setParameters(b,{VERT:f,ROT:255,AA:7,CHN:c},a);break;case "setRotationTime":if(!d.ext){a&&a(Error("parameters is null"));break}f=32767;q=parseInt(d.ext)/10;this.setParameters(b,{VERT:f,ROT:q,AA:7,CHN:c},a);break;case "setParams":if(!d.ext){a&&a(Error("parameters is null"));break}g=d.ext.split(":");if(3!=g.length){a&&a(Error("parameters format invalid"));break}f=g[0]?100*parseFloat(g[0]):32767;499>=f&&(f=32767);q=g[1]?parseInt(g[1])/10:255;g=g[2]?
parseInt(g[2]):7;this.setParameters(b,{VERT:f,ROT:q,AA:g,CHN:c},a);break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var zc=function(b){ha.call(this,b);this._data="d2-06-??"};zc.prototype=new ha;zc.prototype.constructor=zc;var ya=function(b){ha.call(this,b);this._data="d2-06-01";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbir_new=this._suir_new=this._blcr_new=this._hccr_new=this._vacation_new=null};ya.COMMANDS="vacationOn vacationOff handleClosedClickOn handleClosedClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
ya.STATES="bal ppal state handle window br bl motion vacation temperature humidity illumination battery hccr blcr suir vbir".split(" ");ya.prototype=new zc;ya.prototype.constructor=ya;ya.prototype.executeCommand=function(b,d,a){b=(new Date).getTime();if(d&&d.value){"setSensorUpdateInterval"==d.value.substr(0,23)&&23<d.value.length?(d=d.value.substr(23),d={value:"setSensorUpdateInterval",ext:d}):"setVacationBlinkInterval"==d.value.substr(0,24)&&24<d.value.length&&(d=d.value.substr(24),d={value:"setVacationBlinkInterval",
ext:d});switch(d.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({vacation:"off"});break;case "handleClosedClickOn":this._hccr_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({hccr:"on"});break;case "handleClosedClickOff":this._hccr_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcr_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcr_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set sensor update interval value invalid"));return}d=parseInt(d.ext);5>d&&(d=5);65535<d&&(d=65535);this._suir_new=d;this._states.pending={value:!0,time:b};
this.activeStateChange({suir:d});break;case "setVacationBlinkInterval":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set vacation blink interval value invalid"));return}d=parseInt(d.ext);3>d&&(d=3);255<d&&(d=255);this._vbir_new=d;this._states.pending={value:!0,time:b};this.activeStateChange({vbir:d})}a&&a()}else a&&a(Error("command invalid"))};ya.prototype.evalData=function(b,d,a){var c=this.evalTelegram(d);this._vacation_new&&delete c.vacation;this._hccr_new&&delete c.hccr;this._blcr_new&&
delete c.blcr;this._suir_new&&delete c.suir;this._vbir_new&&delete c.vbir;210==d.rorg&&0==d.userData.readUInt8(0)&&this._sendResponse(b);c?(b=this.checkStateChange(c),a&&a(null,b)):a&&a(Error("data format invalid"))};ya.prototype.evalTelegram=function(b){var d={};if(210==b.rorg)switch(b.userData.readUInt8(0)){case 0:var a=b.userData.readUInt8(1);var c=b.userData.readUInt8(2);var e=b.userData.readUInt8(3);var f=b.userData.readUInt8(4);var g=b.userData.readUInt8(5);var h=b.userData.readUInt8(6);var k=
b.userData.readUInt16BE(7);b=b.userData.readUInt8(9);b=b>>3&31;switch(a>>4&15){case 0:d.bal="ok";break;case 1:d.bal="alarm";break;case 14:d.bal="invalid";break;case 15:d.bal="unsupported"}switch(a&15){case 0:d.ppal="ok";break;case 1:d.ppal="alarm";break;case 14:d.ppal="invalid";break;case 15:d.ppal="unsupported"}switch(c>>4&15){case 0:d.handle="undefined";break;case 1:d.handle="up";break;case 2:d.handle="down";break;case 3:d.handle="left";break;case 4:d.handle="right";break;case 14:d.handle="invalid";
break;case 15:d.handle="unsupported"}switch(c&15){case 0:d.window="undefined";break;case 1:d.window="not_tilted";break;case 2:d.window="tilted";break;case 14:d.window="invalid";break;case 15:d.window="unsupported"}switch(e>>4&15){case 0:d.br="unchanged";break;case 1:d.br="pressed";break;case 2:d.br="releaseed";break;case 14:d.br="invalid";break;case 15:d.br="unsupported"}switch(e&15){case 0:d.bl="unchanged";break;case 1:d.bl="pressed";break;case 2:d.bl="releaseed";break;case 14:d.bl="invalid";break;
case 15:d.bl="unsupported"}switch(f>>4&15){case 0:d.motion="ok";break;case 1:d.motion="alarm";break;case 14:d.motion="invalid";break;case 15:d.motion="unsupported"}switch(f&15){case 0:d.vacation="unchanged";break;case 1:d.vacation="on";break;case 2:d.vacation="off";break;case 14:d.vacation="invalid";break;case 15:d.vacation="unsupported"}254==g?d.temperature="invalid":255==g?d.temperature="unsupported":250>=g&&(d.temperature=parseFloat((g/250*80-20).toFixed(2)));254==h?d.humidity="invalid":255==h?
d.humidity="unsupported":200>=h&&(d.humidity=parseFloat((h/2).toFixed(1)));65534==k?d.illumination="invalid":65535==k?d.illumination="unsupported":60001==k?d.illumination="over_range":6E4>=k&&(d.illumination=k);20>=b&&(d.battery=5*b);if("undefined"==d.window||"invalid"==d.window||"unsupported"==d.window||"not_tilted"==d.window)switch(d.handle){case "undefined":d.state="undefined";break;case "up":d.state="tilted";break;case "down":d.state="closed";break;case "left":d.state="open";break;case "right":d.state=
"open";break;case "invalid":d.state="invalid";break;case "unsupported":d.state="undefined"}else"tilted"==d.window&&(d.state="tilted");break;case 16:h=b.userData.readUInt8(1),k=b.userData.readUInt16BE(2),b=b.userData.readUInt8(4),a=k,c=b,d.vacation=h>>7&1?"on":"off",d.hccr=h>>6&1?"on":"off",d.blcr=h>>5&1?"on":"off",5<=a&&(d.suir=a),3<=c&&(d.vbir=c)}return d};ya.prototype._sendResponse=function(b,d){var a=0;this._vacation_new&&"on"==this._vacation_new&&(a=1);var c=0;this._hccr_new&&"off"==this._hccr_new?
c=1:this._hccr_new&&"on"==this._hccr_new&&(c=2);var e=0;this._blcr_new&&"off"==this._blcr_new?e=1:this._blcr_new&&"on"==this._blcr_new&&(e=2);var f=0;this._suir_new&&(f=this._suir_new);var g=0;this._vbir_new&&(g=this._vbir_new);var h=new Buffer([128,128|(a&1)<<5|(c&3)<<3|(e&3)<<1,f>>8&255,f&255,g]),k=this._senderID;k||(k=x.hub.m.enocean.SENDER_ID);h=new x.hub.m.enocean.ESP3.Telegram.VLD(h,k,0);var l=this;b.sendTelegram(h,!0,function(b){l._vacation_new=null;l._hccr_new=null;l._blcr_new=null;l._suir_new=
null;l._vbir_new=null;var h={pending:!1};h.vacation=a?"on":"off";c&&(h.hccr=1==c?"off":"on");e&&(h.blcr=1==e?"off":"on");f&&(h.suir=f);g&&(h.vbir=g);l.activeStateChange(h);d&&d(b)})};var za=function(b){ha.call(this,b);this._data="d2-06-02";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbis_new=this._suis_new=this._blcs_new=this._lacs_new=this._vacation_new=null};za.COMMANDS="vacationOn vacationOff lockActiveClickOn lockActiveClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
za.STATES="operation_mode handle window state temperature humidity battery vacation hccr blcr suir vbir".split(" ");za.prototype=new zc;za.prototype.constructor=za;za.prototype.executeCommand=function(b,d,a){b=(new Date).getTime();if(d&&d.value){"setSensorUpdateInterval"==d.value.substr(0,23)&&23<d.value.length?(d=d.value.substr(23),d={value:"setSensorUpdateInterval",ext:d}):"setVacationBlinkInterval"==d.value.substr(0,24)&&24<d.value.length&&(d=d.value.substr(24),d={value:"setVacationBlinkInterval",
ext:d});switch(d.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({vacation:"off"});break;case "lockActiveClickOn":this._lacs_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({hccr:"on"});break;case "lockActiveClickOff":this._lacs_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcs_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcs_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set sensor update interval value invalid"));return}d=parseInt(d.ext);5>d&&(d=5);65535<d&&(d=65535);this._suis_new=d;this._states.pending={value:!0,time:b};
this.activeStateChange({suir:d});break;case "setVacationBlinkInterval":if("undefined"==typeof d.ext||null==d.ext){a&&a(Error("set vacation blink interval value invalid"));return}d=parseInt(d.ext);3>d&&(d=3);255<d&&(d=255);this._vbis_new=d;this._states.pending={value:!0,time:b};this.activeStateChange({vbir:d})}a&&a()}else a&&a(Error("command invalid"))};za.prototype.evalData=function(b,d,a){var c=this.evalTelegram(d);this._vacation_new&&delete c.vacation;this._lacs_new&&delete c.hccr;this._blcs_new&&
delete c.blcr;this._suis_new&&delete c.suir;this._vbis_new&&delete c.vbir;210==d.rorg&&0==d.userData.readUInt8(0)&&this._sendResponse(b);c?(b=this.checkStateChange(c),a&&a(null,b)):a&&a(Error("data format invalid"))};za.prototype.evalTelegram=function(b){var d={};if(210==b.rorg)switch(b.userData.readUInt8(0)){case 0:var a=b.userData.readUInt8(1);var c=b.userData.readUInt8(2);var e=b.userData.readUInt8(3);b=b.userData.readUInt8(4);b=b>>3&31;switch(a>>6&3){case 0:d.operation_mode="standard";break;case 1:d.operation_mode=
"hst"}switch(a>>4&3){case 0:d.lock="unlocked";break;case 1:d.lock="locked"}switch(a>>2&3){case 0:d.window="not_tilted";break;case 1:d.window="tilted"}switch(a&3){case 0:d.alarm="ok";break;case 1:d.alarm="burglary_alarm";break;case 2:d.alarm="unlock_alarm"}254==c?d.temperature="invalid":255==c?d.temperature="unsupported":250>=c&&(d.temperature=parseFloat((c/250*80-20).toFixed(2)));254==e?d.humidity="invalid":255==e?d.humidity="unsupported":200>=e&&(d.humidity=parseFloat((e/2).toFixed(1)));20>=b&&(d.battery=
5*b);if("tilted"==d.window)d.state="tilted";else switch(d.lock){case "unlocked":d.state="open";break;case "locked":d.state="closed"}break;case 16:a=b.userData.readUInt8(1),c=b.userData.readUInt16BE(2),e=b=b.userData.readUInt8(4),d.vacation=a>>7&1?"on":"off",d.hccr=a>>6&1?"on":"off",d.blcr=a>>5&1?"on":"off",5<=c&&(d.suir=c),3<=e&&(d.vbir=e)}return d};za.prototype._sendResponse=function(b,d){var a=0;this._vacation_new&&"on"==this._vacation_new?a=1:this._vacation_new&&"off"==this._vacation_new&&(a=2);
var c=0;this._lacs_new&&"off"==this._lacs_new?c=1:this._lacs_new&&"on"==this._lacs_new&&(c=2);var e=0;this._blcs_new&&"off"==this._blcs_new?e=1:this._blcs_new&&"on"==this._blcs_new&&(e=2);var f=0;this._suis_new&&(f=this._suis_new);var g=0;this._vbis_new&&(g=this._vbis_new);var h=new Buffer([128,128|(a&3)<<4|(c&3)<<2|e&3,f>>8&255,f&255,g]),k=this._senderID;k||(k=x.hub.m.enocean.SENDER_ID);h=new x.hub.m.enocean.ESP3.Telegram.VLD(h,k,0);var l=this;b.sendTelegram(h,!0,function(b){l._vacation_new=null;
l._lacs_new=null;l._blcs_new=null;l._suis_new=null;l._vbis_new=null;var h={pending:!1};h.vacation=a?"on":"off";c&&(h.hccr=1==c?"off":"on");e&&(h.blcr=1==e?"off":"on");f&&(h.suir=f);g&&(h.vbir=g);l.activeStateChange(h);d&&d(b)})};var Ac=function(b){ha.call(this,b);this._data="d2-20-??"};Ac.prototype=new ha;Ac.prototype.constructor=Ac;var ca=function(b){Ac.call(this,b);this._data="d2-20-00";this._poller=null;this._pollInterval=6E4};ca.COMMANDS="setFanLevel fanLevelUp fanLevelDown requestStatus setHumLevel setCo2Level".split(" ");
ca.STATES="filter_remaining_time operating_time temperature message_code anti_freeze current_fan_level set_fan_level".split(" ");ca.prototype=new Ac;ca.prototype.constructor=ca;ca.prototype.init=function(b){var a=this;setTimeout(function(){var d=require("x.hub.m.enocean.js")._esp3;a.executeCommand(d,{value:"requestStatus"},b);a._restartPoller(d)},Math.floor(6E3*Math.random())+1E3)};ca.prototype.finalize=function(b){this._poller&&clearInterval(this._poller);b&&b()};ca.prototype._restartPoller=function(b){this._poller&&
clearInterval(this._poller);var a=this;this._poller=setInterval(function(){a.executeCommand(b,{value:"requestStatus"})},this._pollInterval)};ca.prototype.executeCommand=function(b,a,c){(new Date).getTime();if(a&&a.value){if("setFanLevel"==a.value.substr(0,11)&&11<a.value.length)a=a.value.substr(11),a={value:"setFanLevel",ext:a};else if("fanLevelUp"==a.value){var d=this.getBufferedState("set_fan_level");if("undefined"==typeof d||null==d){c&&c(Error("fanLevelUp unknown current fan level"));return}if(6==
d){c&&c();return}a={value:"setFanLevel",ext:d+1}}else if("fanLevelDown"==a.value){d=this.getBufferedState("set_fan_level");if("undefined"==typeof d||null==d){c&&c(Error("fanLevelUp unknown current fan level"));return}if(0==d){c&&c();return}a={value:"setFanLevel",ext:d-1}}else if("setHumLevel"==a.value.substr(0,11)&&11<a.value.length){d=this.getBufferedState("set_fan_level");if(5!=d){c&&c(Error("humidity regulation not active"));return}a=a.value.substr(11);a={value:"setHumLevel",ext:a}}else if("setCo2Level"==
a.value.substr(0,11)&&11<a.value.length){d=this.getBufferedState("set_fan_level");if(6!=d){c&&c(Error("co2 regulation not active"));return}a=a.value.substr(11);a={value:"setCo2Level",ext:a}}var e=this;switch(a.value){case "setFanLevel":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("setFanLevel value invalid"));break}var f=parseInt(a.ext);if(0>f||6<f){c&&c(Error("setFanLevel value invalid"));break}if(5==f||6==f){this.activeStateChange({set_fan_level:f});this._activateSensorRegulation(f);c&&
c();break}this._deactivateSensorRegulation();this._sendResponse(b,{LS:f,RS:1},function(a){a||e.activeStateChange({set_fan_level:f});e._restartPoller(b);c&&c(a)});break;case "setHumLevel":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("setHumLevel value invalid"));break}f=parseInt(a.ext);if(0>f||4<f){c&&c(Error("setHumLevel value invalid"));break}this._sendResponse(b,{LS:f,RS:1},function(a){e._restartPoller(b);c&&c(a)});break;case "setCo2Level":if("undefined"==typeof a.ext||null==a.ext){c&&
c(Error("setCo2Level value invalid"));break}f=parseInt(a.ext);if(0>f||4<f){c&&c(Error("setCo2Level value invalid"));break}this._sendResponse(b,{LS:f,RS:1},function(a){e._restartPoller(b);c&&c(a)});break;case "requestStatus":this._sendResponse(b,{LS:5,RS:1},function(b){c&&c(b)});break;default:c&&c(Error("unknown command"))}}else c&&c(Error("command invalid"))};ca.prototype.evalData=function(b,a,c){b=this.evalTelegram(a);this._states&&this._states.set_fan_level||(b.set_fan_level=b.current_fan_level);
this._states&&this._states.set_fan_level&&5!=this._states.set_fan_level.value&&6!=this._states.set_fan_level.value&&(b.set_fan_level=b.current_fan_level);b=this.checkStateChange(b);c&&c(null,b)};ca.prototype.evalTelegram=function(b){var a={};if(210==b.rorg)if(1==b.userData.length){var c=b.userData.readUInt8(0)&7;a.current_fan_level=c}else{c=b.userData.readUInt8(0);var e=b.userData.readUInt8(1),f=b.userData.readUInt16LE(2),g=b.userData.readUInt8(4),h=b.userData.readUInt8(5),k=b.userData.readUInt8(6),
l=b.userData.readUInt16LE(7),m=b.userData.readUInt8(9),r=b.userData.readUInt8(10),n=b.userData.readInt16BE(11);b=b.userData.readUInt8(13);a.filter_remaining_time=g+":"+f+":"+e+":"+c;a.operating_time=m+":"+l+":"+k+":"+h;a.temperature=n/10;a.message_code=r;a.anti_freeze=b>>4&1?"on":"off";a.current_fan_level=b&7}return a};ca.prototype._sendResponse=function(b,a,c){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);a=new Buffer([a.LS,a.RS]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(a,d,
0);this._senderID!=this._address&&d.setDstId(this._address);b.sendTelegram(d,!0,function(b){c&&c(b)})};ca.prototype._activateSensorRegulation=function(b){var a=require("x.hub.m.enocean.js").getRehauHandler();a&&a.activateSensorRegulation(this.getAddress(),b)};ca.prototype._deactivateSensorRegulation=function(){var b=require("x.hub.m.enocean.js").getRehauHandler();b&&b.deactivateSensorRegulation(this.getAddress())};var Nb=function(b){Q.call(this,b);this._data="eltako_contact";this._vendor="eltako";
this._eepAlias="f6-10-00"};Nb.STATES=["contact","contact_raw"];Nb.prototype=new Q;Nb.prototype.constructor=Nb;Nb.prototype.evalTelegram=function(b){var a={};246==b.rorg&&(b=b.userData,240==b?a.contact="closed":224==b&&(a.contact="open"),a.contact_raw=b);return a};var La=function(b){Sa.call(this,b);this._data="eltako_motion";this._vendor="eltako";this._eepAlias="a5-08-01"};La.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");La.prototype=new Sa;La.prototype.constructor=
La;La.prototype.evalTelegram=function(b){var a={};if(165==b.rorg){var c=b.userData.readUInt8(3);b.userData.readUInt8(2);var e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(c>>3&1)){a.voltage=parseFloat((b/255*5.1).toFixed(1));a.voltage_raw=b;a.illumination=parseFloat((e/255*2048).toFixed(1));a.illumination_raw=e;c=c>>1&1;switch(c){case 0:a.state="on";break;case 1:a.state="off"}a.state_raw=c}}return a};var ka=function(b){M.call(this,b);this._data="eltako_switch";this._vendor="eltako";this._eepAlias=
"f6-02-01"};ka.COMMANDS=["on","off","toggle"];ka.STATES=["state"];ka.prototype=new M;ka.prototype.constructor=ka;ka.prototype.getTeachinType=function(){return"4BS"};ka.prototype.handleLearnTelegram=function(b,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._learnAddress,senderID:b._learnSenderID,data:b._learnProfile,vendor:b._learnVendor},{address:a.senderID,senderID:b._learnSenderID,data:this._data,vendor:this._vendor},function(a,d){b._learnFinish(a,0,d)})};
ka.prototype.getTeachinTelegram=function(b,a,c){b=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(b,a,0)};ka.prototype.evalTelegram=function(b){var a={};if(246==b.rorg)switch(b.userData){case 112:a.state="on";break;case 80:a.state="off"}return a};ka.prototype.executeCommand=function(b,a,c){if(a&&a.value)switch((new Date).getTime(),a.value){case "on":this.switching(b,{TIM:0,LCK:0,DEL:0,SW:1},function(b){c&&c(b)});break;case "off":this.switching(b,{TIM:0,LCK:0,DEL:0,SW:0},function(b){c&&
c(b)});break;case "toggle":if(!this._states.state){c&&c(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(b,{value:"off"},c):this.executeCommand(b,{value:"on"},c);break;default:c&&c(Error("unknow command"))}else c&&c(Error("command invalid"))};var Nc=function(){var b=function(b){ka.call(this,b);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_switch"};b.prototype=new ka;b.prototype.constructor=b;b.prototype.handleTeachinTelegram=function(b,a){if(a&&165==
a.rorg&&a.userData){var d=a.userData.toString("hex"),c=b._teachSenderID;if(d&&c&&c.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._teachID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},{address:a.senderID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},function(a,d){b._teachFinish(a,d)})}};return b}(),F=function(b){M.call(this,b);this._data="eltako_dimmer";this._vendor="eltako";this._eepAlias="a5-38-08";
this._lastOnLevel=-1};F.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");F.STATES=["state","level","ramp_time"];F.prototype=new M;F.prototype.constructor=F;F.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.ramp_time||null==this._params.ramp_time)this._params.ramp_time=0};F.prototype.handleLearnTelegram=function(b,a){if(a&&165==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._learnAddress,
senderID:b._learnSenderID,data:b._learnProfile,vendor:b._learnVendor},{address:a.senderID,senderID:b._learnSenderID,data:this._data,vendor:this._vendor},function(a,d){b._learnFinish(a,0,d)})};F.prototype.getTeachinTelegram=function(b,a,c){b=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(b,a,0)};F.prototype.getStatesBuffer=function(){var b=JSON.parse(JSON.stringify(this._states));b.ramp_time={value:this._params.ramp_time,time:-1};return b};F.prototype.getCurrentStates=function(){var b=
{},a=this.getStatesBuffer();a.level&&0==a.level.value&&a.state&&(a.state.value="off");a.state&&"off"==a.state.value&&a.level&&(a.level.value=0);for(var c in a)a.hasOwnProperty(c)&&a[c]&&(b[c]=a[c].value);return b};F.prototype.evalData=function(b,a,c){(b=this.evalTelegram(a))?(0==b.level&&(b.state="off"),"off"==b.state&&(b.level=0),(0==b.level||"off"==b.state)&&this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value),b=this.checkStateChange(b),c&&c(null,b)):c&&c(Error("data format invalid"))};
F.prototype.evalTelegram=function(b){var a={};if(165==b.rorg){var c=b.userData.readUInt8(3),e=b.userData.readUInt8(2),f=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(c>>3&1))switch(b){case 2:a.level=f,a.ramp=e,a.dim_range=c>>2&1?"relative":"absolute",a.store_final_value=c>>1&1,a.state=c&1?"on":"off"}}return a};F.prototype.executeCommand=function(b,a,c){if(a&&a.value){if("dimTo"==a.value.substr(0,5)&&5<a.value.length){var d=a.value.substr(5);a={value:"dimTo",ext:d}}else"toggleTo"==a.value.substr(0,
8)&&8<a.value.length?(d=a.value.substr(8),a={value:"toggleTo",ext:d}):"setRampTime"==a.value.substr(0,11)&&11<a.value.length&&(d=a.value.substr(11),a={value:"setRampTime",ext:d});(new Date).getTime();var e=this;switch(a.value){case "on":d=this._lastOnLevel;if(-1==d||0==d)d=100;this.dimming(b,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(b){b||e.activeStateChange({level:d,state:"on"});c&&c(b)});break;case "off":this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value);
this.dimming(b,{EDIM:0,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:0},function(b){b||e.activeStateChange({level:0,state:"off"});c&&c(b)});break;case "toggle":if(!this._states.state){c&&c(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(b,{value:"off"},c):this.executeCommand(b,{value:"on"},c);break;case "toggleTo":if(!this._states.state){c&&c(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(b,{value:"off"},
c):this.executeCommand(b,{value:"dimTo",ext:a.ext},c);break;case "dimTo":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("dim to value invalid"));break}d=parseFloat(a.ext);0>d&&(d=0);100<d&&(d=100);if(0==d){this.executeCommand(b,{value:"off"},c);break}this.dimming(b,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(b){b||e.activeStateChange({level:d,state:"on"});c&&c(b)});break;case "dimUp":if(!this._states.level){c&&c(Error("unknow previous dimmer level"));break}d=parseInt(this._states.level.value);
d+=5;100<d&&(d=100);this.dimming(b,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(b){b||e.activeStateChange({level:d,state:"on"});c&&c(b)});break;case "dimDown":if(!this._states.level){c&&c(Error("unknow previous dimmer level"));break}d=parseInt(this._states.level.value);d-=5;0>d&&(d=0);if(0==d){this.executeCommand(b,{value:"off"},c);break}this.dimming(b,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(b){b||e.activeStateChange({level:d,state:"on"});c&&c(b)});break;
case "setRampTime":if(!a.ext){c&&c(Error("parameters is null"));break}d=parseInt(d);255<d&&(d=255);0>d&&(d=0);this._params.ramp_time=d;require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(b){c&&c(b)});break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};var Oc=function(){var b=function(b){F.call(this,b);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_dimmer"};b.prototype=new F;b.prototype.constructor=b;b.prototype.handleTeachinTelegram=function(b,
a){if(a&&165==a.rorg&&a.userData){var d=a.userData.toString("hex"),c=b._teachSenderID;if(d&&c&&c.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._teachID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},{address:a.senderID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},function(a,d){b._teachFinish(a,d)})}};return b}(),Xa=function(b){F.call(this,b);this._data="eltako_dimmer2";this._vendor="eltako";this._eepAlias=
"f6-02-01"};Xa.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");Xa.STATES=["state","ramp_time"];Xa.prototype=new F;Xa.prototype.constructor=F;Xa.prototype.handleLearnTelegram=function(b,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._learnAddress,senderID:b._learnSenderID,data:b._learnProfile,vendor:b._learnVendor},{address:a.senderID,senderID:b._learnSenderID,data:this._data,vendor:this._vendor},function(a,d){b._learnFinish(a,
0,d)})};Xa.prototype.evalTelegram=function(b){var a={};if(246==b.rorg)switch(b.userData){case 112:a.state="on";break;case 80:a.state="off"}return a};var Ob=function(b){F.call(this,b);this._data="eltako_fsud"};Ob.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");Ob.STATES=["state","ramp_time"];Ob.prototype=new F;Ob.prototype.constructor=F;Ob.prototype.getTeachinTelegram=function(b,a,c){b=new Buffer([2,0,0,0]);return new x.hub.m.enocean.ESP3.Telegram.BS4(b,a,0)};var U=function(b){xc.call(this,
b);this._data="eltako_blind";this._vendor="eltako";this._eepAlias="f6-02-01";this._syncRunning=!1;this._syncCB=this._syncTO=null};U.COMMANDS="up down stop stepUp stepDown setRV setRunTime moveTo sync".split(" ");U.STATES=["pos","sync"];U.prototype=new xc;U.prototype.constructor=U;U.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.rv||null==this._params.rv)this._params.rv=200;if("undefined"==typeof this._params.rt||null==this._params.rt)this._params.rt=
200};U.prototype.handleLearnTelegram=function(b,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._learnAddress,senderID:b._learnSenderID,data:b._learnProfile,vendor:b._learnVendor},{address:a.senderID,senderID:b._learnSenderID,data:this._data,vendor:this._vendor},function(a,d){b._learnFinish(a,0,d)})};U.prototype.getTeachinTelegram=function(b,a,c){b=new Buffer([255,248,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(b,a,0)};U.prototype.getStatesBuffer=
function(){var b=JSON.parse(JSON.stringify(this._states));b.sync||(b.sync={value:!1,time:-1});b.rv={value:this._params.rv,time:-1};b.rt={value:this._params.rt,time:-1};return b};U.prototype.evalData=function(b,a,c){(b=this.evalTelegram(a))?(a=this.checkStateChange(b),b.sync&&this._syncRunning&&(this._syncRunning=!1,this._syncTO&&(clearTimeout(this._syncTO),this._syncTO=null),this._syncCB&&(this._syncCB(),this._syncCB=null)),c&&c(null,a)):c&&c(Error("data format invalid"))};U.prototype.evalTelegram=
function(b){var a={};if(246==b.rorg)switch(b.userData){case 112:a.sync=!0;a.pos=0;break;case 80:a.sync=!0,a.pos=100}else if(165==b.rorg){var c=b.userData.readUInt16BE(0);b=b.userData.readUInt8(2);var e=this._params.rt;e||(e=200);var f=this._states.pos?this._states.pos.value:null;f||(f=0);if("undefined"!=typeof f&&null!=f)switch(c=10*c/e,b){case 1:a.pos=Math.max(0,Math.round(f-c));break;case 2:a.pos=Math.min(100,Math.round(f+c))}}return a};U.prototype.executeCommand=function(b,a,c){if(a&&a.value){if("stepUp"==
a.value.substr(0,6)&&6<a.value.length){var d=a.value.substr(6);a={value:"stepUp",ext:d}}else"stepDown"==a.value.substr(0,8)&&8<a.value.length?(d=a.value.substr(8),a={value:"stepDown",ext:d}):"setRV"==a.value.substr(0,5)&&5<a.value.length?(d=a.value.substr(5),a={value:"setRV",ext:d}):"setRunTime"==a.value.substr(0,10)&&10<a.value.length?(d=a.value.substr(10),a={value:"setRunTime",ext:d}):"moveTo"==a.value.substr(0,6)&&6<a.value.length&&(d=a.value.substr(6),a={value:"moveTo",ext:d});(new Date).getTime();
var e=this._params.rv;e||(e=200);var f=this._params.rt;f||(f=200);switch(a.value){case "up":this.doReq(b,{TIME:e,CMD:1,LCK:0,TYPE:0},function(b){c&&c(b)});break;case "down":this.doReq(b,{TIME:e,CMD:2,LCK:0,TYPE:0},function(b){c&&c(b)});break;case "stop":this.doReq(b,{TIME:0,CMD:0,LCK:0,TYPE:0},function(b){c&&c(b)});break;case "stepUp":f="undefined"==typeof a.ext||null==a.ext?f/100:parseFloat(a.ext)/100*f;1>f&&(f=1);this.doReq(b,{TIME:f,CMD:1,LCK:0,TYPE:0},function(b){c&&c(b)});break;case "stepDown":f=
"undefined"==typeof a.ext||null==a.ext?f/100:parseFloat(a.ext)/100*f;1>f&&(f=1);this.doReq(b,{TIME:f,CMD:2,LCK:0,TYPE:0},function(b){c&&c(b)});break;case "moveTo":if("undefined"==typeof a.ext||null==a.ext){c&&c(Error("value invalid"));break}a=parseInt(a.ext);d=0;this._states&&this._states.pos&&"undefined"!=typeof this._states.pos.value&&null!=this._states.pos.value&&(d=this._states.pos.value);f*=(a-d)/100;if(0<f)var g=2;else if(0>f)f=0-f,g=1;else if(0==f){c&&c();break}this.doReq(b,{TIME:f,CMD:g,LCK:0,
TYPE:1},function(b){c&&c(b)});break;case "sync":this.snyc(b,function(b){c&&c(b)});break;case "setRV":if(!a.ext){c&&c(Error("parameters is null"));break}d=parseInt(d);200<d&&(d=200);0>d&&(d=0);this._params.rv=d;b=require("x.hub.m.enocean.js")._deviceHandler;b.deviceParamsUpdated(this,function(b){c&&c(b)});break;case "setRunTime":if(!a.ext){c&&c(Error("parameters is null"));break}d=parseInt(d);200<d&&(d=200);0>d&&(d=0);this._params.rt=d;b=require("x.hub.m.enocean.js")._deviceHandler;b.deviceParamsUpdated(this,
function(b){c&&c(b)});break;default:c&&c(Error("unknow command"))}}else c&&c(Error("command invalid"))};U.prototype.snyc=function(b,a){if(this._syncRunning)a&&a(Error("sync running"));else{var d=this,c=this._params.rv;c||(c=200);this._syncRunning=!0;this._syncTO=setTimeout(function(){d._syncRunning=!1;d._syncTO=null;d._states.pos={value:0,time:(new Date).getTime()}},1E3*(c+2));this.doReq(b,{TIME:c,CMD:1,LCK:0,TYPE:0},function(b){a&&a(b)})}};U.prototype.doReq=function(b,a,c){var d=this._senderID;this._senderID||
(d=x.hub.m.enocean.SENDER_ID);if(a.TYPE){var e=Math.round(10*a.TIME)>>8&255;var f=Math.round(10*a.TIME)&255}else e=0,f=Math.round(a.TIME)&255;a=new Buffer([e,f,a.CMD,8|(a.LCK&1)<<2|(a.TYPE&1)<<1]);d=new x.hub.m.enocean.ESP3.Telegram.BS4(a,d,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){c&&c(b)})};var Pc=function(){var b=function(b){U.call(this,b);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_blind"};b.prototype=new U;b.prototype.constructor=b;b.prototype.handleTeachinTelegram=function(b,
a){if(a&&165==a.rorg&&a.userData){var d=a.userData.toString("hex"),c=b._teachSenderID;if(d&&c&&c.substr(2)==d.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._teachID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},{address:a.senderID,senderID:b._teachSenderID,data:b._teachProfile,vendor:b._teachVendor},function(a,d){b._teachFinish(a,d)})}};return b}(),Pb=function(b){Oa.call(this,b);this._data="eltako_weather";this._vendor="eltako";this._eepAlias=
"a5-04-02";this._engMax=7.2;this._engMin=0};Pb.STATES="energy energy_raw humidity humidity_raw temperature temperature_raw available".split(" ");Pb.prototype=new Oa;Pb.prototype.constructor=Pb;Pb.prototype.evalTelegram=function(b){var a={};if(165==b.rorg){var c=b.userData.readUInt8(3),e=b.userData.readUInt8(2),f=b.userData.readUInt8(1);b=b.userData.readUInt8(0);1==(c>>3&1)&&(a.energy=parseFloat((b/250*(this._engMax-this._engMin)+this._engMin).toFixed(1)),a.energy_raw=b,a.humidity=parseFloat((f/250*
(this._humMax-this._humMin)+this._humMin).toFixed(1)),a.humidity_raw=f,a.temperature=parseFloat((e/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),a.temperature_raw=e,a.available=c>>1&1?!0:!1)}return a};var Qb=function(b){Pa.call(this,b);this._data="eltako_lux";this._vendor="eltako";this._eepAlias="a5-06-01";this._ill1Max=3E4;this._ill1Min=300};Qb.STATES="illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw".split(" ");Qb.prototype=new Pa;Qb.prototype.constructor=
Qb;Qb.prototype.evalTelegram=function(b){var a={};if(165==b.rorg){var c=b.userData.readUInt8(3);b.userData.readUInt8(2);var e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);1==(c>>3&1)&&(a.illumination2=b,a.illumination2_raw=b,a.illumination1=parseFloat((e/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1)),a.illumination1_raw=e,a.illumination=e?a.illumination1:a.illumination2,a.illumination_raw=e?a.illumination1_raw:a.illumination2_raw)}return a};var Bc=function(b){Ga.call(this,b);this._data=
"eltako_lux2";this._vendor="eltako";this._eepAlias="a5-06-02";this._ill2Min=0;this._ill2Max=1024};Bc.STATES=Ga.STATES;Bc.prototype=new Ga;Bc.prototype.constructor=Bc;var G=function(b){c.call(this,b);this._data="eltako_buttons";this._vendor="eltako";this._eepAlias="f6-02-01";this._longPressThreshold=1E3;this.BUTTONS=["button1","button2","button3","button4"]};G.STATES=["button1","button2","button3","button4"];G.EVENTS=["shortPress","longPress","press","release"];G.prototype=new c;G.prototype.constructor=
G;G.prototype.evalTelegram=function(b){var a={};if(246==b.rorg)switch(b.userData){case 112:this.BUTTONS[0]&&(a[this.BUTTONS[0]]="pressed");break;case 80:this.BUTTONS[1]&&(a[this.BUTTONS[1]]="pressed");break;case 48:this.BUTTONS[2]&&(a[this.BUTTONS[2]]="pressed");break;case 16:this.BUTTONS[3]&&(a[this.BUTTONS[3]]="pressed");break;case 0:for(b=0;b<this.BUTTONS.length;b++)this.BUTTONS[b]&&(a[this.BUTTONS[b]]="released")}return a};G.prototype.checkStateChange=function(a){var b=this._states,c=[],e=(new Date).getTime(),
f;for(f in a){var g={};g.key=f;g.value=a[f];g.changed=!1;var h=b[f]?b[f].value:null,k=b[f]?b[f].time:null,l=a[f];if(h!=l||"pressed"==l)g.oldvalue=h,g.changed=!0;this._states[f]={value:a[f],time:e};g.changed&&("pressed"==l||"released"==l&&"pressed"==h)&&c.push(g);"pressed"==h&&"released"==l&&(!k||e-k<this._longPressThreshold?(g={},g.key=f,g.value="shortPress"):(g={},g.key=f,g.value="longPress"),g.changed=!0,c.push(g))}return c};var Cc=function(a){G.call(this,a);this._data="eltako_button1";this.BUTTONS=
[null,null,null,"button"]};Cc.STATES=["button"];Cc.prototype=new G;Cc.prototype.constructor=Cc;var Dc=function(a){G.call(this,a);this._data="eltako_sender2";this.BUTTONS=["A1","A3"]};Dc.STATES=["A1","A3"];Dc.prototype=new G;Dc.prototype.constructor=Dc;var Ec=function(a){G.call(this,a);this._data="eltako_sender4";this.BUTTONS=["E1","E2","E3","E4"]};Ec.STATES=["E1","E2","E3","E4"];Ec.prototype=new G;Ec.prototype.constructor=Ec;var Fc=function(a){G.call(this,a);this._data="eltako_button2";this.BUTTONS=
["buttonO","buttonI"]};Fc.STATES=["buttonO","buttonI"];Fc.prototype=new G;Fc.prototype.constructor=Fc;var Gc=function(a){G.call(this,a);this._data="eltako_button4";this.BUTTONS=["BO","BI","AO","AI"]};Gc.STATES=["BO","BI","AO","AI"];Gc.prototype=new G;Gc.prototype.constructor=Gc;var Rb=function(a){G.call(this,a);this._data="eltako_fsm60b"};Rb.STATES=["button"];Rb.prototype=new G;Rb.prototype.constructor=Rb;Rb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:case 80:case 16:b.button=
"pressed";break;case 0:b.button="released"}return b};var Sb=function(a){c.call(this,a);this._data="eltako_fkf";this._vendor="eltako";this._eepAlias="f6-04-01"};Sb.STATES=["keycard"];Sb.prototype=new c;Sb.prototype.constructor=Sb;Sb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var Tb=function(a){c.call(this,a);this._data="eltako_fkc";this._vendor="eltako";this._eepAlias="f6-04-01"};Tb.STATES=["keycard"];
Tb.prototype=new c;Tb.prototype.constructor=Tb;Tb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.keycard="guest_card";case 32:b.keycard="service_card";case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var ta=function(a){Aa.call(this,a);this._data="eltako_thermo";this._vendor="eltako";this._eepAlias="a5-10-06"};ta.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");ta.prototype=new Aa;ta.prototype.constructor=
ta;ta.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),e=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.night_reduce=6>=a?0:12>=a?1:19>=a?2:25>=a?3:31>=a?4:5,b.night_reduce_raw=a,b.setpoint=parseFloat((f/255*40).toFixed(1)),b.setpoint_raw=f,b.temperature=parseFloat(((255-e)/255*40).toFixed(1)),b.temperature_raw=e)}return b};var Ub=function(a){ta.call(this,a);this._data="eltako_ftr65hb";this._vendor="eltako";this._eepAlias=
"a5-10-06"};Ub.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Ub.prototype=new ta;Ub.prototype.constructor=Ub;Ub.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),e=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.setpoint=parseFloat((a/255*40).toFixed(1)),b.setpoint_raw=a,b.temperature=parseFloat(((255-e)/255*40).toFixed(1)),b.temperature_raw=e)}return b};var Hc=function(a){ta.call(this,a);this._data="eltako_futh65d";this._vendor=
"eltako";this._eepAlias="a5-10-12"};Hc.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");Hc.prototype=new ta;Hc.prototype.constructor=Hc;var Vb=function(a){Ha.call(this,a);this._data="eltako_ftr78s";this._vendor="eltako";this._eepAlias="a5-10-03"};Vb.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Vb.prototype=new Ha;Vb.prototype.constructor=Vb;Vb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),
e=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.setpoint=parseFloat((a/255*22+8).toFixed(1)),b.setpoint_raw=a,b.temperature=parseFloat(((255-e)/255*40).toFixed(1)),b.temperature_raw=e)}return b};var Ya=function(a){ma.call(this,a);this._data="eltako_powermeter";this._vendor="eltako";this._eepAlias="a5-12-01"};Ya.STATES=["power","energy","tariff"];Ya.prototype=new ma;Ya.prototype.constructor=Ya;Ya.prototype.evalTelegram=function(a){var b=ma.prototype.evalTelegram.call(this,a);165==
a.rorg&&143==a.userData.readUInt8(3)&&(b={});return b};var Ic=function(a){ma.call(this,a);this._data="eltako_powermeter2";this._vendor="eltako";this._eepAlias="a5-12-01"};Ic.STATES=["power","tariff"];Ic.prototype=new ma;Ic.prototype.constructor=Ya;Ic.prototype.evalTelegram=function(a){a=ma.prototype.evalTelegram.call(this,a);delete a.energy;delete a.tariff;return a};var Za=function(a){G.call(this,a);this._data="eltako_fzs"};Za.STATES=["button"];Za.prototype=new G;Za.prototype.constructor=Za;Za.prototype.evalTelegram=
function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.button="pressed";break;case 0:b.button="released"}return b};Za.prototype.checkStateChange=function(a){var b=this._states,c=[],e=(new Date).getTime(),f;for(f in a){var g={};g.key=f;g.value=a[f];g.changed=!1;var h=b[f]?b[f].value:null,k=b[f]?b[f].time:null,l=a[f];h!=l&&(g.oldvalue=h,g.changed=!0);this._states[f]={value:a[f],time:e};g.changed&&c.push(g);"pressed"==h&&"released"==l&&(!k||e-k<this._longPressThreshold?(g={},g.key=f,g.value=
"shortPress"):(g={},g.key=f,g.value="longPress"),g.changed=!0,c.push(g))}return c};var Wb=function(a){h.call(this,a);this._data="eltako_relay2";this._vendor="eltako";this._eepAlias="f6-02-01"};Wb.STATES=["ch1","ch2"];Wb.prototype=new h;Wb.prototype.constructor=Wb;Wb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.ch1="on";break;case 80:b.ch1="off";break;case 48:b.ch2="on";break;case 16:b.ch2="off"}return b};var Xb=function(a){h.call(this,a);this._data="eltako_relay";
this._vendor="eltako";this._eepAlias="f6-02-01"};Xb.STATES=["state"];Xb.prototype=new h;Xb.prototype.constructor=Xb;Xb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state="on";break;case 80:b.state="off"}return b};var Yb=function(a){X.call(this,a);this._data="eltako_heat";this._vendor="eltako";this._eepAlias="a5-30-03"};Yb.STATES=["temperature","temperature_raw","alarm","alarm_raw"];Yb.prototype=new X;Yb.prototype.constructor=Yb;Yb.prototype.evalTelegram=
function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),e=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(c>>3&1)&&(b.temperature=parseFloat(((255-f)/255*40).toFixed(1)),b.temperature_raw=f,b.alarm=15==e?"alarm":"ok",b.alarm_raw=e)}return b};var Zb=function(a){X.call(this,a);this._data="eltako_water_m3";this._vendor="eltako";this._eepAlias="a5-30-03"};Zb.STATES=["water","water_raw"];Zb.prototype=new X;Zb.prototype.constructor=Zb;Zb.prototype.evalTelegram=function(a){var b=
{};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.water=15==a,b.water_raw=a)}return b};var $b=function(a){Ka.call(this,a);this._data="eltako_water_m4";this._vendor="eltako";this._eepAlias="a5-30-01"};$b.STATES=["water","water_raw"];$b.prototype=new Ka;$b.prototype.constructor=$b;$b.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.water=0==a,b.water_raw=a)}return b};var ua=function(a){M.call(this,
a);this.TEACH_IN_VARIATION=3;this._data="peha_powerswitch";this._vendor="peha";this._eepAlias="a5-38-08"};ua.COMMANDS=["on","off","toggle"];ua.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");ua.prototype=new M;ua.prototype.constructor=ua;ua.prototype.getTeachinType=function(){return"4BS"};ua.prototype.evalTelegram=function(a){return Va.prototype.evalTelegram.call(this,
a)};ua.prototype.executeCommand=function(a,c,e){if(c&&c.value){(new Date).getTime();var b=this;switch(c.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(a){a||b.activeStateChange({state:"on"});e&&e(a)});break;case "off":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:0},function(a){a||b.activeStateChange({state:"off"});e&&e(a)});break;case "toggle":if(!this._states.state){e&&e(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},
e):this.executeCommand(a,{value:"on"},e);break;default:e&&e(Error("unknow command"))}}else e&&e(Error("command invalid"))};var $a=function(a){ua.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_switch";this._vendor="peha";this._eepAlias="a5-38-08"};$a.COMMANDS=["on","off","toggle"];$a.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");
$a.prototype=new ua;$a.prototype.constructor=$a;$a.prototype.evalTelegram=function(a){a=Va.prototype.evalTelegram.call(this,a);delete a.power;delete a.energy;delete a.current;delete a.voltage;delete a.power_unit;delete a.energy_unit;delete a.current_unit;delete a.voltage_unit;return a};var va=function(a){M.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_blind";this._vendor="peha";this._eepAlias="a5-38-08";this._initCount=0};va.COMMANDS="up down stop stepUp stepDown moveTo lamellaUp lamellaDown lamellaStepUp lamellaStepDown lamellaTo setRunTime setLamellaRuntime".split(" ");
va.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode".split(" ");va.prototype=new M;va.prototype.constructor=va;va.prototype.init=function(a){var b=require("x.hub.m.enocean.js")._esp3;this.blind(b,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0},function(b){a&&a()})};va.prototype.getTeachinType=function(){return"4BS"};va.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?
(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};va.prototype.evalTelegram=function(a){return xb.prototype.evalTelegram.call(this,a)};va.prototype.executeCommand=function(a,c,e){if(c&&c.value){(new Date).getTime();var b=this;if("stepUp"==c.value.substr(0,6)&&6<c.value.length){var d=c.value.substr(6);c={value:"stepUp",ext:d}}else"stepDown"==
c.value.substr(0,8)&&8<c.value.length?(d=c.value.substr(8),c={value:"stepDown",ext:d}):"setRunTime"==c.value.substr(0,10)&&10<c.value.length?(d=c.value.substr(10),c={value:"setRunTime",ext:d}):"moveTo"==c.value.substr(0,6)&&6<c.value.length&&(d=c.value.substr(6),c={value:"moveTo",ext:d});switch(c.value){case "up":this.blind(a,{P1:0,P2:0,FUNC:2,SSF:0,PAF:0,SMF:0},function(a){e&&e(a)});break;case "down":this.blind(a,{P1:0,P2:0,FUNC:3,SSF:0,PAF:0,SMF:0},function(a){e&&e(a)});break;case "stop":this.blind(a,
{P1:0,P2:0,FUNC:1,SSF:0,PAF:0,SMF:0},function(a){e&&e(a)});break;case "stepUp":d="undefined"==typeof c.ext||null==c.ext?5:parseInt(c.ext);var f=this._states.position?this._states.position.value:null;if("undefined"==typeof f||null==f){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});e&&e(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(d=f+d,100<d&&(d=100)):(d=f-d,0>d&&(d=0));this.blind(a,{P1:d,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||b.activeStateChange({position:d});
e&&e(a)});break;case "stepDown":d="undefined"==typeof c.ext||null==c.ext?5:parseInt(c.ext);f=this._states.position?this._states.position.value:null;if("undefined"==typeof f||null==f){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});e&&e(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(d=f-d,0>d&&(d=0)):(d=f+d,100<d&&(d=100));this.blind(a,{P1:d,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||b.activeStateChange({position:d});e&&e(a)});break;case "moveTo":if("undefined"==
typeof c.ext||null==c.ext){e&&e(Error("value invalid"));break}f=parseInt(c.ext);this.blind(a,{P1:f,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||b.activeStateChange({position:f});e&&e(a)});break;case "setRunTime":if(!c.ext||-1==c.ext.indexOf(":")){e&&e(Error("value invalid"));break}var g=c.ext.split(":");c=g[0];g=g[1];if(!c&&g)c=g;else if(c&&!g)g=c;else if(!c&&!g){e&&e(Error("value invalid"));break}c=parseInt(c);g=parseInt(g);this.blind(a,{P1:c,P2:g,FUNC:7,SSF:0,PAF:0,SMF:0},function(a){a||b.activeStateChange({position:d});
e&&e(a)});break;default:e&&e(Error("unknow command"))}}else e&&e(Error("command invalid"))};var A=function(a){g.call(this,a);this._data="bb-aa-cc";this._vendor="rehau";this._eepAlias="d2-06-10";this._hopCount=0;this._saLearnMode=1;this._originalEEP="bb-aa-cc";this._reset_pre_alarm_new=this._reset_alarm_new=null;this._deviceTO=this._startTimeoutTimer();this._prealarmTO=this._alarmTO=null};A.COMMANDS="alertOn alertOff alertToggle resetAlarm resetPreAlarm preAlarmOn preAlarmOff preAlarmToggle".split(" ");
A.STATES="battery pre_alarm alarm window pre_alarm_enabled error pending alarm_enabled pre_alarm_enabled_device timeout".split(" ");A.prototype=new g;A.prototype.constructor=A;A.prototype.setDefaultParams=function(){var a=require("x.hub.m.enocean.js")._rehauHandler;if(a){var c=a.getSmartguardSetting(this._address),e=!0,f=!0;c&&(e=c.isAlarmActive(),f=c.isPreAlarmActive());this.activeStateChange({pending:!1,alarm_enabled:e,pre_alarm_enabled:f,timeout:!1,alarm_task_active:a.getAlarm(),pre_alarm_task_active:a.getAlarm()})}};
A.prototype.getStatesBuffer=function(){return this._states};A.prototype.evalData=function(a,c,e){var b=this.evalTelegram(c);if(b){b.timeout=!1;this._deviceTO&&(clearTimeout(this._deviceTO),this._deviceTO=this._startTimeoutTimer());if(208==c.rorg)c=this.checkStateChange(b);else{var d=!1;210==c.rorg&&2==c.userData.length&&(d=!0);c=this.getBufferedState("alarm_task_active");var f=this.getBufferedState("pre_alarm_task_active"),g=this.getBufferedState("alarm_enabled"),h=this.getBufferedState("pre_alarm_enabled");
b.pre_alarm?f?h?this._startPreAlarmTimer():b.pre_alarm=!1:b.pre_alarm=!1:this._clearPreAlarmTimer();b.alarm?c?g?this._startAlarmTimer():b.alarm=!1:b.alarm=!1:this._clearAlarmTimer();c=this.checkStateChange(b);var k=this;this._executePendingCommand(a,function(){k._reportStates(b)},d)}e&&e(null,c)}else e&&e(Error("data format invalid"))};A.prototype.evalTelegram=function(a){var b={},c=!1;if(210==a.rorg){if(1==a.userData.length)c=a.userData.readUInt8(0);else{var e=a.userData.readUInt8(0);c=a.userData.readUInt8(1)}2==
a.userData.length&&(b.battery=e);b.pre_alarm=c>>7&1?!0:!1;b.alarm=c>>6&1?!0:!1;b.window=c>>5&1?"closed":"open";b.pre_alarm_enabled_device=c>>4&1?!0:!1;b.error=c&15;c=!0}else 208==a.rorg&&(c=a.userData.readUInt8(0),b.battery=Math.round(c/100*255),b.battery_raw=c,c=!0);return c?b:null};A.prototype.executeCommand=function(a,c,e){if(c&&c.value){switch(c.value){case "alertOn":this._setAlarm(!0);break;case "alertOff":this._setAlarm(!1);break;case "alertToggle":this._states&&this._states.alarm_enabled?this._setAlarm(!this._states.alarm_enabled.value):
this._setAlarm(!0);break;case "resetAlarm":this._reset_alarm_new="on";this.activeStateChange({pending:!0});break;case "resetPreAlarm":this._reset_pre_alarm_new="on";this.activeStateChange({pending:!0});break;case "preAlarmOn":this._setPreAlarm(!0);break;case "preAlarmOff":this._setPreAlarm(!1);break;case "preAlarmToggle":this._states&&this._states.pre_alarm_enabled?this._setPreAlarm(!this._states.pre_alarm_enabled.value):this.pre_alarm_enabled(!0);break;case "alarmTaskOn":this._setAlarmTask(!0);break;
case "alarmTaskOff":this._setAlarmTask(!1);break;case "preAlarmTaskOn":this._setPreAlarmTask(!0);break;case "preAlarmTaskOff":this._setPreAlarmTask(!1);break;default:e&&e(Error("unknow command"));return}e&&e()}else e&&e(Error("command invalid"))};A.prototype._executePendingCommand=function(a,c,e){var b={AL:1,RSA:0,RSP:0,PAE:1},d=this._isAlarmActive();b.AL=d?1:0;d=this._isPreAlarmActive();b.PAE=d?1:0;this._reset_alarm_new&&(b.RSA="on"==this._reset_alarm_new?1:0);this._reset_pre_alarm_new&&(b.RSP="on"==
this._reset_pre_alarm_new?1:0);var f={pending:!1};1==b.RSP&&(f.pre_alarm=!1);1==b.RSA&&(f.alarm=!1);this._reset_pre_alarm_new=this._reset_alarm_new=null;var g=this;this._sendVLD(a,b,function(a){g.activeStateChange(f);c&&c(a)},e)};A.prototype._sendVLD=function(a,c,e,f){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);c=(c.AL&1)<<7|(c.RSA&1)<<6|(c.RSP&1)<<5|(c.PAE&1)<<4;f=f?new Buffer([0,c]):new Buffer([c]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(f,b,0);b.setDstId(this._address);a.sendTelegram(b,
!0,function(a){e&&e(a)})};A.prototype._reportStates=function(a){if(a&&0<Object.keys(a).length){var b=require("x.hub.m.enocean.js").getRehauHandler();b&&(a.alarm_enabled=this.getBufferedState("alarm_enabled"),a.pre_alarm_enabled=this.getBufferedState("pre_alarm_enabled"),b.onReceiveWindowSensorStates(this,a))}};A.prototype._setAlarm=function(a){this.activeStateChange({alarm_enabled:a});require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardAlarm(this._address,a)};A.prototype._setPreAlarm=function(a){this.activeStateChange({pre_alarm_enabled:a});
require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardPreAlarm(this._address,a)};A.prototype._setAlarmTask=function(a){this.activeStateChange({alarm_task_active:a})};A.prototype._setPreAlarmTask=function(a){this.activeStateChange({pre_alarm_task_active:a})};A.prototype._isAlarmActive=function(){var a=!0,c=!0;this._states&&this._states.alarm_enabled&&(c=this._states.alarm_enabled.value,"undefined"==typeof c||null==c)&&(c=!0);if(!c)return!1;this._states&&this._states.alarm_task_active&&(a=this._states.alarm_task_active.value,
"undefined"==typeof a||null==a)&&(a=!1);return a};A.prototype._isPreAlarmActive=function(){var a=!0,c=!0;this._states&&this._states.pre_alarm_enabled&&(c=this._states.pre_alarm_enabled.value,"undefined"==typeof c||null==c)&&(c=!0);if(!c)return!1;this._states&&this._states.pre_alarm_task_active&&(a=this._states.pre_alarm_task_active.value,"undefined"==typeof a||null==a)&&(a=!1);return a};A.prototype._startTimeoutTimer=function(){var a=this;return setTimeout(function(){a.activeStateChange({timeout:!0})},
36E5)};A.prototype._startPreAlarmTimer=function(){this._prealarmTO&&clearTimeout(this._prealarmTO);var a=this;this._prealarmTO=setTimeout(function(){a.activeStateChange({pre_alarm:!1});var b=a.getCurrentStates();a._reportStates(b)},1E4)};A.prototype._clearPreAlarmTimer=function(){this._prealarmTO&&(clearTimeout(this._prealarmTO),this._prealarmTO=null)};A.prototype._startAlarmTimer=function(){this._alarmTO&&clearTimeout(this._alarmTO);var a=this;this._alarmTO=setTimeout(function(){a.activeStateChange({alarm:!1});
var b=a.getCurrentStates();a._reportStates(b)},12E4)};A.prototype._clearAlarmTimer=function(){this._alarmTO&&(clearTimeout(this._alarmTO),this._alarmTO=null)};A.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params,hopCount:this._hopCount,saLearnMode:this._saLearnMode,originalEEP:this._originalEEP}};A.prototype.fromJSON=function(a){if(!a||!a.address||!a.data||a.data!=this._data)return null;
this._address=a.address;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};A.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual,hopCount:this._hopCount,saLearnMode:this._saLearnMode,
originalEEP:this._originalEEP}};A.prototype.fromDBJSON=function(a){if(!a||!a.id||!a.eep||a.eep!=this._data)return null;this._address=a.id;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};var Lc=function(a){A.call(this,a);this._data="d2-06-10"};Lc.prototype=new A;Lc.prototype.constructor=
Lc;var Jc=function(a){X.call(this,a);this._data="afriso_water_con";this._vendor="afriso";this._eepAlias="a5-30-03"};Jc.prototype=new X;Jc.prototype.constructor=Jc;Jc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),e=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.temperature=(255-a)/255*40,b.temperature_raw=a,b.water=0==(e>>4&1)?!0:!1)}return b};var ac=function(a){z.call(this,a);this._data="afriso_water_eco";this._vendor="afriso";this._eepAlias=
"f6-05-01"};ac.prototype=new z;ac.prototype.constructor=ac;ac.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(a=a.nu,1==a?b.water="true":0==a&&(b.water="false"));return b};ac.prototype.onLearn=function(){this._states.water={value:!1,time:(new Date).getTime()}};var Kc=function(a){X.call(this,a);this._data="afriso_asd_10";this._vendor="afriso";this._eepAlias="a5-30-03"};Kc.prototype=new X;Kc.prototype.constructor=Kc;Kc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),
e=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.temperature=(255-a)/255*40,b.temperature_raw=a,b.smoke=0==(e>>4&1)?!0:!1)}return b};var bc=function(a){Q.call(this,a);this._data="hoppe_door";this._vendor="hoppe";this._eepAlias="f6-10-00"};bc.STATES=["door"];bc.prototype=new Q;bc.prototype.constructor=bc;bc.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(a=a.userData,0==(a&208^192)?b.door="open":0==(a&240^240)&&(b.door="closed"),b.handle_raw=a);return b};var Mc=function(){var a=
function(a){g.call(this,a);this._data="gp";this._gpInfo=null};a.prototype=new g;a.prototype.constructor=a;a.prototype.toJSON=function(){var a=g.prototype.toJSON.call(this);a.gpInfo=this._gpInfo;return a};a.prototype.fromJSON=function(a){if(!g.prototype.fromJSON.call(this,a))return null;a&&a.gpInfo&&(this._gpInfo=a.gpInfo);return this};a.prototype.toDBJSON=function(){var a=g.prototype.toDBJSON.call(this);a.gpInfo=this._gpInfo;return a};a.prototype.fromDBJSON=function(a){if(!g.prototype.fromDBJSON.call(this,
a))return null;a&&a.gpInfo&&(this._gpInfo=a.gpInfo);return this};return a}(),Qc=function(){var a=function(a){Mc.call(this,a);this._data="afriso_ais_10";this._vendor="afriso";this._eepAlias="gp"};a.prototype=new Mc;a.prototype.constructor=a;a.prototype.isGPMatch=function(a,b){return 45!=a?!1:8==b};a.prototype.evalTelegram=function(a){var b={};if(178==a.rorg){var c=a.data.readUInt8(0)>>7&1,d=a.data.readUInt8(0)>>6&1;a=a.data.readUInt8(0)>>5&1;b.alarm=1==c?"on":"off";b.active=1==d?"on":"off";b.powerAlarm=
1==a?"alarm":"no_change"}return b};a.prototype.executeCommand=function(a,b,c){if(b&&b.value){switch(b.value){case "arming":this._setActive(a,!0,c);break;case "disarming":this._setActive(a,!1,c);break;case "toggleArming":this._states&&this._states.active?this._setActive(a,"off"==this._states.active.value,c):this._setActive(a,!0,c);break;case "alarmOn":this._setAlarm(a,!0,c);break;case "alarmOff":this._setAlarm(a,!1,c);break;case "toggleAlarm":this._states&&this._states.alarm?this._setAlarm(a,"off"==
this._states.alarm.value,c):this._setAlarm(a,!1,c);break;default:c&&c(Error("unknow command"));return}c&&c()}else c&&c(Error("command invalid"))};a.prototype._setActive=function(a,b,c){var d=!1;this._states&&this._states.alarm&&"on"==this._states.alarm.value&&(d=!0);this._sendGPCD(a,d,b,c)};a.prototype._setAlarm=function(a,b,c){var d=!0;this._states&&this._states.active&&"off"==this._states.active.value&&(d=!1);this._sendGPCD(a,b,d,c)};a.prototype._sendGPCD=function(a,b,c,e){var d=this._senderID;
this._senderID||(d=x.hub.m.enocean.SENDER_ID);var f=0;b&&(f|=128);c&&(f|=64);b=new Buffer(1);b.writeUInt8(f,0);d=new x.hub.m.enocean.ESP3.Telegram.GP_CD(b,d,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(a){e&&e(a)})};return a}(),ab=function(){var a=function(a){ea.call(this,a);this._data="eltako_tf_ttb";this._vendor="eltako";this._eepAlias="a5-07-01";this._params={reset_timeout:300}};a.prototype=new ea;a.prototype.constructor=a;a.prototype.evalTelegram=function(a){return 246==a.rorg?k.prototype.evalTelegram.call(this,
a):165==a.rorg?ea.prototype.evalTelegram.call(this,a):{}};a.prototype.checkStateChange=function(a){return a.button?k.prototype.checkStateChange.call(this,a):ea.prototype.checkStateChange.call(this,a)};a.prototype.fromJSON=function(a){ea.prototype.fromJSON.call(this,a);this._params={reset_timeout:300};return this};var c=function(a){X.call(this,a);this._data="eltako_tf_smoke";this._vendor="eltako";this._eepAlias="a5-30-03"};c.STATES=["temperature","temperature_raw","smoke","smoke_raw"];c.prototype=
new X;c.prototype.constructor=c;c.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(c>>3&1)&&(b.temperature=parseFloat(((255-e)/255*40).toFixed(1)),b.temperature_raw=e,b.smoke=15==d?!0:!1,b.smoke_raw=d)}return b};var e=function(a){Q.call(this,a);this._data="eltako_tf_contact";this._vendor="eltako";this._eepAlias="d5-00-01"};e.STATES=["contact","contact_raw","voltage","voltage_raw"];
e.prototype=new P;e.prototype.constructor=e;e.prototype.evalTelegram=function(a){var b={};if(213==a.rorg){var c=a.userData;1==(c>>3&1)&&(c&=1,b.contact=c?"closed":"open",b.contact_raw=c)}else if(165==a.rorg){c=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.voltage=parseFloat(d/255*5).toFixed(1),b.voltage_raw=d,b.energy=parseFloat(a/255*5).toFixed(1),b.energy_raw=a)}return b};var f=function(a){La.call(this,a);this._data="eltako_motion2";
this._vendor="eltako";this._eepAlias="a5-08-01"};f.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");f.prototype=new La;f.prototype.constructor=f;f.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=parseFloat((a/255*5.1).toFixed(1));b.voltage_raw=a;b.illumination=parseFloat((d/255*510).toFixed(1));b.illumination_raw=d;
switch(c){case 13:b.state="on";break;case 15:b.state="off"}b.motion_raw=c}}return b};var g=function(a){ea.call(this,a);this._data="eltako_tf_motion";this._vendor="eltako";this._eepAlias="a5-07-01"};g.STATES=["motion","motion_raw"];g.prototype=new ea;g.prototype.constructor=g;g.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.motion=200==a||255==a?!0:!1,b.motion_raw=a)}return b};var h=function(a){M.call(this,a);this._data=
"eltako_tf_input";this._vendor="eltako";this._eepAlias="a5-38-08"};h.STATES=["state","state_raw"];h.prototype=new M;h.prototype.constructor=h;h.prototype.evalTelegram=function(a){var b={};165==a.rorg&&(a=a.userData.readUInt8(3),1==(a>>3&1)&&(b.input=8==a?!1:!0,b.input_raw=a));return b};var l=function(a){Aa.call(this,a);this._data="eltako_thermo2";this._vendor="eltako";this._eepAlias="a5-10-06"};l.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");l.prototype=
new ta;l.prototype.constructor=l;l.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(c>>3&1)&&(b.setpoint=parseFloat((e/255*40).toFixed(1)),b.setpoint_raw=e,b.temperature=parseFloat(((255-d)/255*40).toFixed(1)),b.temperature_raw=d)}return b};return{TF_TTB:a,TF_RWB:c,TF_FKB:e,TF_BHSB:g,TF_BHSB_FBH:f,TF_Input:h,Eltako_Thermo2:l}}();return{"f6-??-??":c,"f6-01-01":k,"f6-02-01":h,"f6-02-02":l,
"f6-02-03":r,"f6-02-04":m,"f6-03-01":v,"f6-03-02":y,"f6-04-01":C,"f6-04-02":I,"f6-05-00":J,"f6-05-01":z,"f6-05-02":w,"f6-10-00":Q,"f6-10-01":V,"d5-xx-xx":a,"d5-??-??":Y,"d5-00-01":P,"f6-so-da":f,"a5-??-??":t,"a5-02-01":Z,"a5-02-02":K,"a5-02-03":oa,"a5-02-04":O,"a5-02-05":R,"a5-02-06":da,"a5-02-07":aa,"a5-02-08":ba,"a5-02-09":Na,"a5-02-0a":u,"a5-02-0b":p,"a5-02-10":H,"a5-02-11":cc,"a5-02-12":Ma,"a5-02-13":dc,"a5-02-14":ec,"a5-02-15":Ea,"a5-02-16":fc,"a5-02-17":bb,"a5-02-18":gc,"a5-02-19":hc,"a5-02-1a":ic,
"a5-02-1b":jc,"a5-02-20":Fa,"a5-02-30":kc,"a5-04-01":lc,"a5-04-02":Oa,"a5-04-03":cb,"a5-06-01":Pa,"a5-06-02":Ga,"a5-06-03":db,"a5-06-04":eb,"a5-06-05":mc,"a5-07-01":ea,"a5-07-02":Qa,"a5-07-03":Ra,"a5-08-01":Sa,"a5-08-02":nc,"a5-08-03":oc,"a5-09-02":fb,"a5-09-04":gb,"a5-09-05":hb,"a5-09-06":ib,"a5-09-07":jb,"a5-09-08":kb,"a5-09-09":lb,"a5-09-0a":mb,"a5-09-0b":nb,"a5-09-0c":ob,"a5-10-01":B,"a5-10-02":la,"a5-10-03":Ha,"a5-10-04":pb,"a5-10-05":qb,"a5-10-06":Aa,"a5-10-07":rb,"a5-10-08":pa,"a5-10-09":qa,
"a5-10-0a":Ba,"a5-10-0b":Ia,"a5-10-0c":sb,"a5-10-0d":tb,"a5-10-10":S,"a5-10-11":Ca,"a5-10-12":ub,"a5-10-13":vb,"a5-10-14":wb,"a5-12-00":yb,"a5-12-01":ma,"a5-12-02":Ja,"a5-12-03":pc,"a5-13-01":qc,"a5-13-02":rc,"a5-13-03":sc,"a5-13-04":tc,"a5-13-05":uc,"a5-13-06":vc,"a5-14-01":zb,"a5-14-02":Ab,"a5-14-03":Bb,"a5-14-04":Cb,"a5-14-05":Db,"a5-14-06":Eb,"a5-14-07":Fb,"a5-14-08":Gb,"a5-14-09":Hb,"a5-14-0a":Ib,"a5-20-04":ja,"a5-30-01":Ka,"a5-30-02":Jb,"a5-30-03":X,"a5-30-04":Kb,"a5-38-08":M,"d2-??-??":ha,
"d2-01-00":na,"d2-01-01":Lb,"d2-01-03":Mb,"d2-01-11":Da,"d2-01-13":ra,"d2-01-14":sa,"d2-05-00":N,"d2-05-01":xa,"d2-06-01":ya,"d2-06-02":za,"d2-06-10":Lc,"d2-06-50":e,"d2-20-00":ca,eltako_dimmer:F,eltako_dimmer2:Xa,eltako_fsud:Ob,eltako_motion:La,eltako_contact:Nb,eltako_weather:Pb,eltako_lux:Qb,eltako_lux2:Bc,eltako_sender2:Dc,eltako_sender4:Ec,eltako_button1:Cc,eltako_button2:Fc,eltako_button4:Gc,eltako_blind:U,eltako_fsm60b:Rb,eltako_fkf:Sb,eltako_fkc:Tb,eltako_thermo:ta,eltako_ftr65hb:Ub,eltako_futh65d:Hc,
eltako_ftr78s:Vb,eltako_powermeter:Ya,eltako_powermeter2:Ic,eltako_fzs:Za,eltako_switch:ka,eltako_relay:Xb,eltako_relay2:Wb,eltako_heat:Yb,eltako_water_m3:Zb,eltako_water_m4:$b,eltako_tf_switch:Nc,eltako_tf_dimmer:Oc,eltako_tf_blind:Pc,peha_switch:$a,peha_powerswitch:ua,peha_blind:va,"bb-aa-cc":A,afriso_water_con:Jc,afriso_water_eco:ac,afriso_asd_10:Kc,hoppe_door:bc,gp:Mc,afriso_ais_10:Qc,eltako_tf_ttb:ab.TF_TTB,eltako_tf_smoke:ab.TF_RWB,eltako_tf_contact:ab.TF_FKB,eltako_tf_motion:ab.TF_BHSB,eltako_motion2:ab.TF_BHSB_FBH,
eltako_thermo2:ab.Eltako_Thermo2,eltako_tf_input:ab.TF_Input,parseDBJson:function(a){if(!a||!a.eep)return null;var b=this[a.eep];if(!b)return null;b=new b;return b=b.fromDBJSON(a)},parseJson:function(a){if(!a||!a.data)return null;var b=this[a.data];if(!b)return null;b=new b;return b=b.fromJSON(a)}}}();
x.hub.m.enocean.SiegeniaHandler=function(){var g=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SiegeniaHandler");this._esp3=e;this._calibateListener=this._window=this._windowID=this._esp3Listener=null};g.prototype.startCalibateWindow=function(e,a){if(this._calibateListener)a&&a(Error("configuraion of window running"));else{this._calibateListener=a;this._windowID=e;this._window=new x.hub.m.enocean.profiles["d2-06-50"];var f=this;this._esp3Listener={_onEOTelegram:function(a){var c=
!1;f._windowID&&f._windowID==a.senderID?c=!0:f._windowID||210!=a.rorg||(c=!0);c&&f._calibateListener&&(c=f._window.evalTelegram(a))&&17==c.type&&f._calibateListener(null,a.senderID,c)}};this._esp3.addListener(this._esp3Listener)}};g.prototype.stopCalibateWindow=function(){this._esp3Listener&&this._esp3.removeListener(this._esp3Listener);this._window=this._windowID=this._calibateListener=this._esp3Listener=null};g.prototype.configWindow=function(e,a,f,c){a="FFFFFFFF";c||(c=x.hub.m.enocean.SENDER_ID);
this._logger.log("info","config siegenia window:"+JSON.stringify(e));this._logger.log("info","window id:"+a+" sender id:"+c);var g=parseInt(e.alive),h=parseInt(e.sync),l=parseInt(e.eep),r=parseInt(e.type),m=parseInt(e.alarm);e=parseInt(e.alarm_sens);var v=[128,2,127,240,1,140,57,45,245],y=[192,13,127,242,49,0,0,2,g>>8&255],C=[193,g&255,0,1,2,h>>8&255,h&255,0,2],I=[194,1,l,0,3,1,r,0,4],J=[195,1,m,0,5,1,e,0,0],z=[128,2,127,240,2,140,57,45,245],w=this;this._logger.log("info","send config siegenia window (data1):"+
(new Buffer(v)).toString("hex"));this._esp3._recomm.sendRawSysEx(new Buffer(v),a,c,function(e){if(e&&(w._logger.log("warn","config siegenia window error (data1):"+e.message+" ["+e.code+"]"),100!=e.code)){f&&f(e);return}w._logger.log("info","send config siegenia window (data2):"+(new Buffer(y)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(y),a,c,function(e){if(e&&(w._logger.log("warn","config siegenia window error (data2):"+e.message+" ["+e.code+"]"),100!=e.code)){f&&f(e);return}w._logger.log("info",
"send config siegenia window (data3):"+(new Buffer(C)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(C),a,c,function(e){if(e&&(w._logger.log("warn","config siegenia window error (data3):"+e.message+" ["+e.code+"]"),100!=e.code)){f&&f(e);return}w._logger.log("info","send config siegenia window (data4):"+(new Buffer(I)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(I),a,c,function(e){if(e&&(w._logger.log("warn","config siegenia window error (data4):"+e.message+" ["+e.code+"]"),
100!=e.code)){f&&f(e);return}w._logger.log("info","send config siegenia window (data5):"+(new Buffer(J)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(J),a,c,function(e){if(e&&(w._logger.log("warn","config siegenia window error (data5):"+e.message+" ["+e.code+"]"),100!=e.code)){f&&f(e);return}w._logger.log("info","send config siegenia window (data6):"+(new Buffer(z)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(z),a,c,function(a){a&&w._logger.log("warn","config siegenia window error (data5):"+
a.message+" ["+a.code+"]");a&&100!=a.code?f&&f(a):f&&f()})})})})})})};return g}();
x.hub.m.enocean.RehauHandler=function(){var g=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.InoventAccessory");this._inoventID=a;this._co2SensorID=this._humiditySensorID=null;this._co2RegulationActive=this._humRegulationActive=!1;this._humidityState=null;this._humidityLevel=0;this._co2State=null;this._co2Level=0};g.prototype.getHumiditySensorID=function(){return this._humiditySensorID};g.prototype.setHumiditySensorID=function(a){this._humiditySensorID=a};
g.prototype.getCo2SensorID=function(){return this._co2SensorID};g.prototype.setCo2SensorID=function(a){this._co2SensorID=a};g.prototype.activateSensorRegulation=function(a){if(5==a)this._humRegulationActive=!0,this._co2RegulationActive=!1;else if(6==a)this._humRegulationActive=!1,this._co2RegulationActive=!0;else{this._co2RegulationActive=this._humRegulationActive=!1;return}this._co2Level=this._humidityLevel=0;this._humRegulationActive&&this._humiditySensorID&&null!=this._humidityState&&this.executeHumidityRegulation(this._humidityState);
this._co2RegulationActive&&this._co2SensorID&&null!=this._co2State&&this.executeCo2Regulation(this._co2State)};g.prototype.deactivateSensorRegulation=function(){this._co2RegulationActive=this._humRegulationActive=!1;this._co2Level=this._humidityLevel=0};g.prototype.executeHumidityRegulation=function(a){this._humidityState=a;this._logger.log("trace","["+this._inoventID+"] receive hum:"+a);if(this._humRegulationActive){var c=this._calculateHumidityLevel(a);this._logger.log("trace","["+this._inoventID+
"] target level:"+c);(!this._humidityLevel||c!=this._humidityLevel&&this._exceedHumidityHysteresis(this._humidityLevel,a))&&this._changeHumLevel(c)}};g.prototype._calculateHumidityLevel=function(a){return 50>=a?1:60>=a?2:70>=a?3:4};g.prototype._exceedHumidityHysteresis=function(a,e){switch(a){case 1:return 55<=e;case 2:return 45>=e||65<=e;case 3:return 55>=e||75<=e;case 4:return 65>=e}};g.prototype._changeHumLevel=function(a){var c=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},
{value:"setHumLevel"+a},function(e){e&&e.error||(c._humidityLevel=a)})};g.prototype.executeCo2Regulation=function(a){this._co2State=a;this._logger.log("trace","["+this._inoventID+"] receive co2:"+a);if(this._co2RegulationActive){var c=this._calculateCo2Level(a);this._logger.log("trace","["+this._inoventID+"] target level:"+c);(!this._co2Level||c!=this._co2Level&&this._exceedCo2Hysteresis(this._co2Level,a))&&this._changeCo2Level(c)}};g.prototype._calculateCo2Level=function(a){return 600>=a?1:1E3>=
a?2:1500>=a?3:4};g.prototype._exceedCo2Hysteresis=function(a,e){switch(a){case 1:return 700<=e;case 2:return 500>=e||1100<=e;case 3:return 900>=e||1600<=e;case 4:return 1400>=e}};g.prototype._changeCo2Level=function(a){var c=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setCo2Level"+a},function(e){e&&e.error||(c._co2Level=a)})};g.prototype.toJSON=function(){return{humidity:this._humiditySensorID,co2:this._co2SensorID}};g.prototype.fromJSON=function(a){a&&(this._humiditySensorID=
a.humidity,this._co2SensorID=a.co2)};var e=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.WindowAlarm");this._handler=a;this._active=!1;this._sensors={}};e.prototype.setAlarm=function(a){this._logger.log("trace","set alarm active:"+a);this._active=a};e.prototype.getAlarm=function(){return this._active};e.prototype.onReceiveWindowSensorStates=function(a,e){this._logger.log("trace","receive window:"+a.getAddress()+" states:"+JSON.stringify(e));if(this._active){var c=
a.getAddress(),f=this._sensors[c];f||(this._sensors[c]={lastEvent:"IDLE"},f=this._sensors[c]);this._logger.log("trace","last event for window:"+a.getAddress()+" is:"+f.lastEvent);e&&(e.pre_alarm&&"PRE_ALARM"!=f.lastEvent?(f.lastEvent="PRE_ALARM",this._logger.log("trace","window:"+a.getAddress()+" pre_alarm triggered"),this.triggerAlarm(!0)):e.alarm&&"ALARM"!=f.lastEvent?(f.lastEvent="ALARM",this._logger.log("trace","window:"+a.getAddress()+" alarm triggered"),this.triggerAlarm()):e.alarm||e.pre_alarm||
(this._logger.log("trace","new event for window:"+a.getAddress()+" is:IDLE and stop timer"),f.lastEvent="IDLE"))}};e.prototype.triggerAlarm=function(a){require("x.hub.taskman.js").getRehauAlarmTaskManager().onWindowSensorAlarmTriggered(a)};var a=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.SmartguardSetting");this._smartguardID=a;this._prealarmActive=this._alarmActive=!0};a.prototype.isAlarmActive=function(){return this._alarmActive?!0:!1};a.prototype.isPreAlarmActive=
function(){return this._prealarmActive?!0:!1};a.prototype.setAlarm=function(a){this._alarmActive=a?!0:!1};a.prototype.setPreAlarm=function(a){this._prealarmActive=a?!0:!1};a.prototype.toJSON=function(){return{alarm:this._alarmActive,pre_alarm:this._prealarmActive}};a.prototype.fromJSON=function(a){a&&(this._alarmActive=a.alarm,this._prealarmActive=a.pre_alarm)};var f=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler");this._mainHandler=null;this._windowAlarm=new e(this);
this._inoventAccessories={};this._smartguardSettings={}};f.prototype.REHAU_FILE="enocean_rehau.json";f.prototype.init=function(a,e){this._logger.log("trace","init");var c=this;if(this._mainHandler=a)if(a=a.getDeviceHandler())a.on("deleteDevice",function(a){c.onDeleteDevice(a)});this._loadInoventAccessories(function(a,f,g){a&&c._logger.log("warn","init error:"+a.message);f&&(c._inoventAccessories=f);g&&(c._smartguardSettings=g);e&&e()})};f.prototype.getInoventAccessory=function(a){return a?this._inoventAccessories[a]:
null};f.prototype.deleteInoventAccessory=function(a,e){a&&this._inoventAccessories[a]?(delete this._inoventAccessories[a],this._saveData(e)):e&&e()};f.prototype.getSmartguardSetting=function(a){return a?this._smartguardSettings[a]:null};f.prototype.deleteSmartguardSetting=function(a,e){a&&this._smartguardSettings[a]?(delete this._smartguardSettings[a],this._saveData(e)):e&&e()};f.prototype.setHumidityAccessory=function(a,e,f){if(a){var c=this.getInoventAccessory(a);c||(c=new g(a),this._inoventAccessories[a]=
c);c.setHumiditySensorID(e);this._saveData(f)}else f&&f(Error("inoventID is null"))};f.prototype.setCo2Accessory=function(a,e,f){if(a){var c=this.getInoventAccessory(a);c||(c=new g(a),this._inoventAccessories[a]=c);c.setCo2SensorID(e);this._saveData(f)}else f&&f(Error("inoventID is null"))};f.prototype.activateSensorRegulation=function(a,e){(a=this.getInoventAccessory(a))&&a.activateSensorRegulation(e)};f.prototype.deactivateSensorRegulation=function(a){(a=this.getInoventAccessory(a))&&a.deactivateSensorRegulation()};
f.prototype.isWindowOpen=function(){var a=this._mainHandler.getDeviceHandler(),e=a.findDeviceWithData("bb-aa-cc");(a=a.findDeviceWithData("d2-06-10"))&&(e=e.concat(a));a=!1;for(var f=0;f<e.length;f++){var g=e[f];if(g&&"open"==g.getBufferedState("window")){a=!0;break}}return a};f.prototype.setAlarm=function(a,e){this._windowAlarm.setAlarm(a);var c=this._mainHandler.getDeviceHandler(),f=c.findDeviceWithData("bb-aa-cc");(c=c.findDeviceWithData("d2-06-10"))&&(f=f.concat(c));c=this._mainHandler.getESP3();
for(var g=0;g<f.length;g++){var k=f[g];k&&(k.executeCommand(c,{value:a?"alarmTaskOn":"alarmTaskOff"}),k.executeCommand(c,{value:a?"preAlarmTaskOn":"preAlarmTaskOff"}))}e&&e()};f.prototype.getAlarm=function(){return this._windowAlarm.getAlarm()};f.prototype.setSmartGuardAlarm=function(c,e,f){if(c){var g=this._smartguardSettings[c];g||(g=new a(c),this._smartguardSettings[c]=g);g.setAlarm(e);this._saveData(f)}else f&&f(Error("smartguardID invalid"))};f.prototype.setSmartGuardPreAlarm=function(c,e,f){if(c){var g=
this._smartguardSettings[c];g||(g=new a(c),this._smartguardSettings[c]=g);g.setPreAlarm(e);this._saveData(f)}else f&&f(Error("smartguardID invalid"))};f.prototype.onReceiveWindowSensorStates=function(a,e){this._windowAlarm.onReceiveWindowSensorStates(a,e)};f.prototype.onDeleteDevice=function(a){if(a&&(a=a.getAddress()))if(this.getInoventAccessory(a))this.deleteInoventAccessory(a);else if(this.getSmartguardSetting(a))this.deleteSmartguardSetting(a);else{var c=!1,e;for(e in this._inoventAccessories){var f=
this._inoventAccessories[e];f&&(f.getHumiditySensorID()==a&&(f.setHumiditySensorID(null),c=!0),f.getCo2SensorID()==a&&(f.setCo2SensorID(null),c=!0))}c&&this._saveData()}};f.prototype.onDeviceEvent=function(a,e){var c=function(a){for(var c=null,e=0;e<a.length;e++){var f=a[e];if(f&&"humidity"==f.key){c=f.value;break}}return c},f=function(a){for(var c=null,e=0;e<a.length;e++){var f=a[e];if(f&&"co2"==f.key){c=f.value;break}}return c};if(a){var g=a.getAddress();if(g){var k=null;switch(a.getData()){case "a5-04-01":case "a5-04-03":case "a5-10-12":k=
c(e);break;case "a5-09-08":case "a5-09-09":k=f(e);break;default:return}if(void 0!=k&&null!=k)for(var v in this._inoventAccessories)if(a=this._inoventAccessories[v])a.getHumiditySensorID()==g&&a.executeHumidityRegulation(k),a.getCo2SensorID()==g&&a.executeCo2Regulation(k)}}};f.prototype._loadInoventAccessories=function(a){var c=this;this._loadFile(function(e,f){e?a&&a(e):(e=c._jsonToAccessoriesMap(f),f=c._jsonToSmartGuardSettingsMap(f),a&&a(null,e,f))})};f.prototype._jsonToAccessoriesMap=function(a){if(!a||
!a.inovent)return{};var c={},e;for(e in a.inovent){var f=a.inovent[e];if(f){var r=new g(e);r.fromJSON(f);c[e]=r}}return c};f.prototype._jsonToSmartGuardSettingsMap=function(c){if(!c||!c.smartguard)return{};var e={},f;for(f in c.smartguard){var g=c.smartguard[f];if(g){var r=new a(f);r.fromJSON(g);e[f]=r}}return e};f.prototype._loadFile=function(a){var c=this._getFilePath();fs_extra.ensureFile(c,function(e){e?a&&a(e):fs_extra.readFile(c,"utf8",function(c,e){if(c)a&&a(c);else if(e)try{var f=JSON.parse(e);
a&&a(null,f)}catch(v){a&&a(v)}else a&&a(null,{})})})};f.prototype._getFilePath=function(){var a=require("x.hub.fileman.js").fileManager,e=require("path");require("fs");a=a.getUserRootDataPath();return e.resolve(a,this.REHAU_FILE)};f.prototype._saveData=function(a){var c=this._accessoriesMapToJson(this._inoventAccessories),e=this._settingsMapToJson(this._smartguardSettings);this._saveFile({inovent:c?c:{},smartguard:e?e:{}},function(c){a&&a(c)})};f.prototype._accessoriesMapToJson=function(a){if(!a)return{};
var c={},e;for(e in a){var f=a[e];f&&(f=f.toJSON(),c[e]=f)}return c};f.prototype._settingsMapToJson=function(a){if(!a)return{};var c={},e;for(e in a){var f=a[e];f&&(f=f.toJSON(),c[e]=f)}return c};f.prototype._saveFile=function(a,e){var c=this._getFilePath();fs_extra.writeFile(c,JSON.stringify(a,null,2),function(a){e&&e(a)})};return f}();
x.hub.m.enocean.SDK=function(){var g=function(e){this._handler=e};g.prototype.send_SA_RD_LEARNEDCLIENTS=function(e,a){e=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_RD_LEARNEDCLIENTS;this._handler._esp3.sendSACommand(e,!0,function(e,c){a&&a(e,c)})};g.prototype.send_SA_WR_RESET=function(e,a){e&&e.saClientId?(e=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_RESET(e.saClientId),this._handler._esp3.sendSACommand(e,!0,function(e,c){a&&a(e,c)})):a&&a(Error("params invalid"))};g.prototype.send_SA_WR_POSTMASTER=function(e,
a){e?(e.mailboxCount||(e.mailboxCount=0),e=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_POSTMASTER(e.mailboxCount),this._handler._esp3.sendSACommand(e,!0,a)):a&&a(Error("params invalid"))};g.prototype.send_CO_WR_REPEATER=function(e,a){e?(e.enable||(e.enable=0),e.level||(e.level=0),e=new x.hub.m.enocean.ESP3.COMMAND_COMMAND.CO_WR_REPEATER(e.enable,e.level),this._handler._esp3.sendCommandCommand(e,!0,a)):a&&a(Error("params invalid"))};return g}();
x.hub.m.enocean.USBHandler=function(){var g=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.USBHandler");this._handler=e;this._usbDevices=[];this._connectedDevice=null};g.prototype.attachSerial=function(e){this._logger.log("debug","attach usb port:"+e);var a=this._usbDevices.length;this._usbDevices.push({port:e});0==a&&this._attachNextDevice()};g.prototype.removeSerial=function(e){this._logger.log("debug","remove usb port:"+e);var a=this._handler._esp3.getSerial();a&&a.getPort()==
e&&this._handler._esp3.removeSerial(e);this._connectedDevice&&this._connectedDevice.port==e&&(this._connectedDevice=null)};g.prototype._attachNextDevice=function(){if(0!=this._usbDevices.length){var e=this._usbDevices[0],a=this;this._logger.log("debug","connect usb port:"+e.port);this._handler._esp3.attachSerial(e.port,function(f){f?(a._logger.log("debug",e.port+" is not a enocean usb device, error:"+f.message),a._usbDevices.splice(0,1),a._attachNextDevice()):(a._logger.log("debug","success to connect to enocean usb device on port:"+
e.port),a._connectedDevice=e,a._usbDevices=[])})}};return g}();
x.hub.m.enocean.Handler=function(){var g=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Handler");this._secHandler=new this.SecurityHandler(this);this._deviceHandler=new this.DeviceHandler(this);this._esp3=new x.hub.m.enocean.ESP3(this);this._learnHandler=new this.LearnHandler(this);this._siegeniaHandler=new x.hub.m.enocean.SiegeniaHandler(this._esp3);this._rehauHandler=new x.hub.m.enocean.RehauHandler;this._trackers=[];this._sdk=new x.hub.m.enocean.SDK(this);this._usb=
new x.hub.m.enocean.USBHandler(this)};util.inherits(g,EventEmitter);g.prototype.SENSOR_FILE="enocean.json";g.prototype.SECURITY_FILE="enocean_sec.json";g.prototype.ESP3=x.hub.m.enocean.ESP3;g.prototype.SecurityHandler=x.hub.m.enocean.SecurityHandler;g.prototype.LearnHandler=x.hub.m.enocean.LearnHandler;g.prototype.DeviceHandler=x.hub.m.enocean.DeviceHandler;g.prototype.getDeviceHandler=function(){return this._deviceHandler};g.prototype.getRehauHandler=function(){return this._rehauHandler};g.prototype.getESP3=
function(){return this._esp3};g.prototype.init=function(e){localStorage&&localStorage.getItem("x.hub.m.enocean.SENDER_ID")&&(x.hub.m.enocean.SENDER_ID=localStorage.getItem("x.hub.m.enocean.SENDER_ID"));var a=this,f=require("x.hub.eventbus.js");f.on("x.hub.peripheralman.ADD_ENOCEAN",function(c){console.log("ADD_ENOCEAN",c);a._usb.attachSerial(c.port)});f.on("x.hub.peripheralman.REMOVE_ENOCEAN",function(c){console.log("REMOVE_ENOCEAN",c);a._usb.removeSerial(c.port)});f.on("x.hub.peripheralman.ADD_SEIRAL",
function(c){console.log("ADD_SEIRAL",c);c.type||a._usb.attachSerial(c.port)});f.on("x.hub.peripheralman.REMOVE_SEIRAL",function(c){console.log("REMOVE_SEIRAL",c);c.type||a._usb.removeSerial(c.port)});global.ENOCEAN_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&a._usb.attachSerial(global.ENOCEAN_PORT);this._secHandler.init(function(){a._rehauHandler.init(a,function(){a._deviceHandler.init(function(){e&&e({})})})})};g.prototype.getSystems=function(){return["enocean"]};g.prototype.addStateDevice=
function(e,a){a&&a({})};g.prototype.getAllStates=function(){var e=[],a=this._deviceHandler.getAllDevices(),f;for(f in a)if(a.hasOwnProperty(f)){var c=a[f];c&&e.push({device:c.toJSON(),states:c.getStatesBuffer()})}return e};g.prototype.getStates=function(e){if(!e||!e.address)return null;var a=null;(e=this._deviceHandler.getDevice(e.address.toLowerCase()))&&(a=e.getStatesBuffer());return a};g.prototype.getState=function(e,a,f){var c=this.getStates(e),g=null;c&&"undefined"!=typeof c[a]&&null!=c[a]?(g=
c[a],f&&f({data:g})):f&&this.updateStates(e,function(e){e.error?f&&f(e):(e.data&&(g=c[a]),f({data:g}))});return g};g.prototype.executeCommand=function(e,a,f){this._esp3._baseID?this._esp3._baseID.toLowerCase()!=x.hub.m.enocean.SENDER_ID.toLowerCase()?f&&f({error:Error("enocean stick has a different baseID")}):e&&e.address?((e=e.address)&&(e=e.toLowerCase()),(e=this._deviceHandler.getDevice(e))?e.executeCommand?e.executeCommand(this._esp3,a,function(a){f&&f({error:a})}):f&&f({error:Error("device dese not support command")}):
f&&f({error:Error("no such device")})):f&&f({error:Error("device invalid")}):f&&f({error:Error("enocean stick not found")})};g.prototype.checkDeviceMatch=function(e,a){if(!(a&&a.device&&e&&e.device))return!1;(e=e.device.address)&&(e=e.toLowerCase());(a=a.device.address)&&(a=a.toLowerCase());return e==a};g.prototype.updateStates=function(e,a){a&&a({error:Error("not supported yet")})};g.prototype.executeCommandLegacy=function(e,a,f,c){e?c&&c({error:Error("not supported yet")}):this._esp3?a?this.executeCommand({address:a},
{value:f},function(a){c&&c({error:a?a.error:null})}):c&&c({error:Error("address invalid")}):c&&c({error:Error("not inited")})};g.prototype.getAllStatesLegacy=function(e,a){var f=[],c=this.getAllStates(),g=this._secHandler.getUnsyncDevice(),h=this;c.forEach(function(c){if(c&&c.device&&c.states){var e=c.device.address,k={type:"ENOCEAN",adr:e,data:c.device.data,vendor:c.device.vendor,state:{}},l;for(l in c.states)k.state[l]=c.states[l].value;h._secHandler.isSecureDevice(e)?(k.deviceProtocol="secure",
k.state.security_state=g[e]?"nok":"ok"):k.deviceProtocol="normal";a&&"1"==a.config&&(k.senderID=c.device.senderID,k.virtual=c.device.virtual,k.params=c.device.params,e&&g[e]&&(k.rlc_unsync=!0));f.push(k)}});e&&e({data:f})};g.prototype.getEnoceanInfo=function(){return{baseID:x.hub.m.enocean.SENDER_ID,usb_connected:null!=this._esp3._serial,usb_baseID:this._esp3._baseID,num_free_senderID:this._deviceHandler.getFreeSenderIdCount()}};g.prototype.learnDevice=function(e,a){var f=e?e.senderID:null,c=e?e.data:
null,g=e?e.vendor:null,h=e?e.address:null;if(h){c=this._deviceHandler.findDevice(e);if(!c){a&&a({error:Error("device not found")});return}var l=c.toJSON();c=l.data;g=l.vendor;f||(sednerID=l.senderID)}l={};l.saLearnMode=e?e.saLearnMode:null;this._learnHandler.learn(c,h,f,g,null,function(c,e,f){c?a&&a({error:c}):(c={},1==e?c.op=1:(c=f.toJSON(),c.op=0),a&&a({data:c}))},l)};g.prototype.learnSoda=function(e){if(this._esp3._serial){var a=this,f=setTimeout(function(){a._esp3.removeListener(c);e&&e({error:Error("learn timeout")})},
2E4),c={_onEOTelegram:function(g){if(246==g.rorg&&(192==g.userData||208==g.userData||240==g.userData)){clearTimeout(f);a._esp3.removeListener(c);var h={address:g.senderID,data:"f6-so-da",vendor:"soda"};a.addSensor(g.senderID,"f6-so-da","soda",null,function(a){a.error?e&&e(a):e&&e({data:h})})}}};this._esp3.addListener(c)}else e&&e({error:Error("port not opened")})};g.prototype.teachinDevice=function(e,a){if(e)if(e.data){var f=this._deviceHandler.findDevice(e);!f&&e.address?a&&a({error:Error("device not found")}):
(f=f?f.toJSON():e,e.data!=f.data?a&&a({error:Error("device of another type with the same address exists")}):e.vendor&&e.vendor!=f.vendor?a&&a({error:Error("device of another vendor with the same address exists")}):this._learnHandler.teachin(f.data,f.address,f.senderID,f.vendor,function(c,e,f){c?a&&a({error:c}):(c={},e&&(c=e.toJSON()),f&&(c.op=f),a&&a({data:c}))}))}else a&&a({error:Error("data is null")});else a&&a({error:Error("query is null")})};g.prototype.generateVirtualDevice=function(e,a){this._deviceHandler.generateVirtual(e,
function(e,c){a&&a({error:e,data:c?c.toJSON():null})})};g.prototype._onEOFrame=function(e,a){this._trackers.forEach(function(f){f.onFrame(e,a)})};g.prototype._onEOTelegram=function(e){this._trackers.forEach(function(a){a.onTelegram(e)});var a=this._deviceHandler.getDevice(e.senderID);if(a){var f=this;a.evalData(this._esp3,e,function(c,e){c||0==e.length||f._onEOEvents(a,e)})}};g.prototype._onEOEvents=function(e,a){var f=require("x.hub.eventbus.js");this._trackers.forEach(function(c){c.onResolveEvents(e._address,
a)});this._rehauHandler.onDeviceEvent(e,a);var c=e.toJSON();c.sys="aio";c.type="ENOCEAN";for(var g=0,h=0;h<a.length;h++){var l=a[h];if(l&&("shortPress"==l.value||"longPress"==l.value||"pressed"==l.value||"released"==l.value)){g++;var r={type:"ENOCEAN",adr:c.address,data:c.data,vendor:c.vendor,state:{}};r.state[l.key]=l.value;f.emit("gatewayevent",r,{address:"ENOCEAN"},"BTN")}}if(g==a.length)(c=e.getStatesLegacy())&&f.emit("udpevent",c,"STA");else if(c=e.getStatesLegacy())f.emit("gatewayevent",c,{address:"ENOCEAN"},
"STA"),f.emit("udpevent",c,"STA")};g.prototype._saveEnoceanEvents=function(e,a){var f=require("x.hub.datastore.js").dataStore;f&&f.openDB(function(c,f){if(!c){c=e._address;for(var g=[],k=(new Date).toISOString(),r=0;r<a.length;r++){var m=a[r];if(m&&m.changed){m=m.key+":"+m.value;var v=null;v=0==g.length?"SELECT '"+c+"' AS 'window', '"+m+"' AS 'state', '"+k+"' AS 'time'":"UNION ALL SELECT '"+c+"', '"+m+"', '"+k+"'";g.push(v)}}0<g.length&&(c=g.join(" "),f.run("INSERT INTO windowstate(window, state, time) "+
c+";",function(a){f.close()}))}})};g.prototype.addSensor=function(e,a){e?e.data?"siegenia"!=e.vendor||e.params?this._deviceHandler.addDevice(e,function(e,c){a&&a({error:e,data:c?c.toJSON():null})}):a&&a({error:Error("siegenia windows params is null")}):a&&a({error:Error("enocean profile is null")}):a&&a({error:Error("enocean device is null")})};g.prototype.updateSensor=function(e,a,f){e?a?this._deviceHandler.updateDevice(e,a,function(a,e){f&&f({error:a,data:e?e.toJSON():null})}):f&&f({error:Error("device info is null")}):
f&&f({error:Error("device address is null")})};g.prototype.delSensor=function(e,a){e?this._deviceHandler.deleteDevice({address:e},function(e){a&&a({error:e})}):a&&a({error:Error("enocean id is null")})};g.prototype.resetDefaultSenderID=function(e){x.hub.m.enocean.SENDER_ID=null;localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID","");e&&e({})};g.prototype.setRehauAlarm=function(e,a){this._rehauHandler.setAlarm(e,a)};g.prototype.isRehauWindowOpen=function(){return this._rehauHandler.isWindowOpen()};
g.prototype.setInoventHumidityAccessory=function(e,a,f){this._rehauHandler.setHumidityAccessory(e,a,function(a){f&&f({error:a})})};g.prototype.setInoventCo2Accessory=function(e,a,f){this._rehauHandler.setCo2Accessory(e,a,function(a){f&&f({error:a})})};g.prototype.getInoventAccessories=function(e,a){e=this._rehauHandler.getInoventAccessory(e);a&&a({data:e?e.toJSON():{}})};g.prototype.__addTelegramTracker=function(e){e&&e.onTelegram&&e.onResolveEvents&&-1==this._trackers.indexOf(e)&&this._trackers.push(e)};
g.prototype.__removeTelegramTracker=function(e){e&&(e=this._trackers.indexOf(e),-1!=e&&this._trackers.splice(e,1))};g.prototype.__sendEspFrame=function(e,a,f,c,g){a=a?new Buffer(a,"hex"):null;f=f?new Buffer(f,"hex"):null;c=c?!0:!1;e=new x.hub.m.enocean.ESP3.ESP3_Frame(e,a,f);this._esp3.sendFrame(e,c,function(a,c){g&&g({error:a,data:c?c.toJSON():null})})};g.prototype.__simulateRawEnoceanPacket=function(e,a){this._esp3.onSerialData(new Buffer(e,"hex"));a&&a()};g.prototype._doSDK=function(e,a){if(e&&
e.method){var f="send_"+e.method;if(this._sdk[f])this._sdk[f](e.params,function(c){a&&a({error:c})});else a&&a({error:Error("no such method")})}else a&&a({error:Error("data invalid")})};return g}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.enocean.Handler);
