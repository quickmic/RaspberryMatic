var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,k,n){b instanceof String&&(b=String(b));for(var g=b.length,h=0;h<g;h++){var l=b[h];if(k.call(n,l,h,b))return{i:h,v:l}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,k,n){b!=Array.prototype&&b!=Object.prototype&&(b[k]=n.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,k,n,g){if(k){n=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var h=b[g];h in n||(n[h]={});n=n[h]}b=b[b.length-1];g=n[b];k=k(g);k!=g&&null!=k&&$jscomp.defineProperty(n,b,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(k,b){return $jscomp.findInternal(this,k,b).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(k){return $jscomp.SYMBOL_PREFIX+(k||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var k=0;return $jscomp.iteratorPrototype(function(){return k<b.length?{done:!1,value:b[k++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,k){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var n=0,g={next:function(){if(n<b.length){var h=n++;return{value:k(h,b[h]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(k){return k})}},"es6","es3");var util=require("util"),EventEmitter=require("events"),async=require("async"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.hm=x.hub.m.hm||{};x.hub.m.hm.CCU_INIT_STATE=!0;x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js");
x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,
CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,
"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,
KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,
"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,
"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,
"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,
"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,
"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62};
x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong2"},{type:"gong"},{type:"gong"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",
channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",
channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},
{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}];
x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"HmIP-SWDM":1,"HmIP-SWDM-B2":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HmIP-eTRV-B":3,"HmIP-eTRV-B1":3,"HmIP-eTRV-B-UK":3,"HmIP-eTRV-C":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,
"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31,"HmIP-SAM":32,
"HmIP-WGC":33,"HmIP-BSL":34,"HmIP-MOD-TM":35,"HmIP-DBB":36,"HmIP-FCI1":37,"HmIP-FCI6":37,"HmIP-SLO":38,"HmIP-BRC2":4,"HmIP-PMFS":39,"HmIP-MOD-RC8":37,"HmIP-MOD-OC8":1};
x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},
{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"},{type:"ip_acce"},{type:"ip_garagedoor"},{type:"ip_bsl"},{type:"ip_tormatic"},{type:"ip_button"},{type:"ip_multi_input_bat"},{type:"ip_lux"},{type:"ip_pmfs"}];
x.hub.m.hm.Util={clearHttpOptionForLog:function(b){try{var k=JSON.parse(JSON.stringify(b));k.auth&&(k.auth="xxxxxx:xxxxxx");if(k.headers)for(var n in headers)if(n&&"authorization"==n.toLocaleLowerCase()){var g=headers[n];if(g){var h=g.indexOf(" ");headers[n]=-1==h?"xxxxxx":g.substr(0,h)+" xxxxxx"}}return k}catch(l){return b}}};
x.hub.m.hm.Client=function(){var b=function(k,b,g,h,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client");this.ip=k;this.port=b;this.port||(this.port=2001);this.username=g;this.password=h;this.useHttps=l;this.timeout=2E4;this.xml2js=null};b.prototype._doRequest=function(k,b,g){var h=require("http");this.useHttps&&(h=require("https"));k={host:this.ip,port:this.port,path:"/",method:k,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(k.auth=this.username+":"+(this.password?
this.password:""));b&&(k.headers["Content-Length"]=b.length);var l=g,n=this;this._logger.log("trace","send http request:"+x.hub.m.hm.Util.clearHttpOptionForLog(k));this._logger.log("trace","send http data:"+b);g=h.request(k,function(h){var g="";h.setEncoding("utf-8");h.on("data",function(h){g+=h});h.on("end",function(){n._logger.log("trace","http response status:"+h.statusCode);n._logger.log("trace","http response data:"+g);var m=null;200!=h.statusCode&&(m=Error("http response "+h.statusCode));l&&
l(m,g,h.statusCode)})});g.on("error",function(h){n._logger.log("trace","http request error:"+h.stack);l&&l(h);l=null});g.setTimeout(this.timeout,function(){n._logger.log("trace","http request timeout");l&&l(Error("http timeout"));l=null});b&&g.write(b);g.end()};b.prototype._doXMLRpcRequest=function(k,b,g){var h=require("x.xmlrpc.js");k='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+k+"</methodName><params>";for(var l=0;l<b.length;l++)k=b[l]&&b[l].type&&void 0!=b[l].value?k+
("<param>"+h.serializeValue(b[l].value,b[l].type)+"</param>"):k+("<param>"+h.serializeValue(b[l])+"</param>");this._doRequest("POST",k+"</params></methodCall>",function(l,m){if(l)g&&g(l);else if(m)try{var k=h.deserializeRsp(m);k.error?g&&g(Error("xml rcp return error:"+k.error.faultString+" @code:"+k.error.faultCode),k.error):g&&g(null,k.params)}catch(p){g&&g(p)}else g&&g(Error("xml rcp response format invalid"))})};b.prototype.convertHmIPKeyBase32ToBase16=function(k){k=k.replace(/-/g,"").toUpperCase();
var b="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),g=new ArrayBuffer(16);g=new Uint8Array(g);for(var h=0,l=k.length-1,q=0,m=g.length-1,r="";0<=l;){for(var p=0;p<b.length;p++)if(b[p]==k.charAt(l)){h|=p<<q;break}q+=5;for(l--;8<q&&0<=m;)g[m]=h&255,h>>=8,q-=8,m--}for(p=0;p<g.length;p++)16>g[p]&&(r+="0"),r+=g[p].toString(16);return r.toUpperCase()};b.prototype._getValue=function(k){var b=null;if(this.xml2js)if(k["boolean"]&&k["boolean"][0])b=parseInt(k["boolean"][0])?!0:!1;else if(k.i4&&k.i4[0])b=parseInt(k.i4[0]);
else if(k.double&&k.double[0])b=parseFloat(k.double[0]);else if(k.array&&k.array[0]&&k.array[0].data&&k.array[0].data[0]&&k.array[0].data[0].value){b=[];k=k.array[0].data[0].value;for(var g in k)b.push(k[g])}else b=k;else if(g=k,k=k.find("value"),0<k.length&&(g=$(k[0])),g&&(b=g.text(),!b&&g.children()&&0<g.children().length))if(k=$(g.children()[0]),"boolean"==k.prop("tagName"))b=parseInt(k.text())?!0:!1;else if("i4"==k.prop("tagName"))b=parseInt(k.text());else if("double"==k.prop("tagName"))b=parseFloat(k.text());
else if("array"==k.prop("tagName"))for(b=[],k=k.find("data value"),g=0;g<k.length;g++){var h=$(k[g]).text();h&&b.push(h)}else XC.debugf("unknown valuetype:"),XC.debugf(k.getXMLString());return b};b.prototype._getStructData=function(k){var b={};if(k.struct&&k.struct[0]&&k.struct[0].member){k=k.struct[0].member;for(var g in k)k[g].name&&k[g].name[0]&&k[g].value&&k[g].value[0]&&(b[k[g].name[0]]=this._getValue(k[g].value[0]))}return b};b.prototype._waitForNewDevices=function(k,b,g){var h=this;this.getDeviceList(function(l){if(0>=
b||Object.keys(l).length>Object.keys(k).length){for(var n in l)k[n]||XC.debugf("new device: "+n);g&&g(l)}else setTimeout(function(){h._waitForNewDevices(k,b-4,g)},4E3)})};b.prototype.init=function(k,b,g){this._doXMLRpcRequest("init",[k,b],function(h){g&&g(h)})};b.prototype.getIP=function(){return this.ip};b.prototype.getPort=function(){return this.port};b.prototype.setPort=function(k){this.port=k};b.prototype.getValue=function(k,b,g,h){k=[k,b];"undefined"!=typeof g&&null!=g&&k.push(g);this._doXMLRpcRequest("getValue",
k,function(g,k){var l=null;!g&&k?l=k[0]:g&&k&&(l=k);h&&h(g,l)})};b.prototype.setValue=function(k,b,g,h){this._doXMLRpcRequest("setValue",[k,b,g],function(g){h&&h(g)})};b.prototype.getParamset=function(k,b,g,h){this._doXMLRpcRequest("getParamset",[k,b,g],function(g,k){var l=null;!g&&k?l=k[0]:g&&k&&(l=k);h&&h(g,l)})};b.prototype.putParamset=function(k,b,g,h){this._doXMLRpcRequest("putParamset",[k,b,g],function(g,k){var l=null;!g&&k?l=k[0]:g&&k&&(l=k);h&&h(g,l)})};b.prototype.listDevices=function(k){this._doXMLRpcRequest("listDevices",
[],function(b,g){var h=[];!b&&g&&(h=g[0]);k&&k(b,h)})};b.prototype.deleteDevice=function(k,b,g){this._doXMLRpcRequest("deleteDevice",[k,b],function(h){g&&g(h)})};b.prototype.setInstallMode=function(k,b,g,h){var l=[];l.push(k);"undefined"!=typeof b&&null!=b&&l.push(b);"undefined"!=typeof g&&null!=g&&l.push(g);this._doXMLRpcRequest("setInstallMode",l,function(g){h&&h(g)})};b.prototype.setInstallModeWithWhitelist=function(k,b,g,h){var l=[];l.push(k);"undefined"!=typeof b&&null!=b&&l.push(b);"undefined"!=
typeof g&&null!=g&&l.push(g);this._doXMLRpcRequest("setInstallModeWithWhitelist",l,function(g){h&&h(g)})};b.prototype.addNewDevice=function(k){var b=this;this.getDeviceList(function(g){b._doRequest("setInstallMode",[!0,30,2],function(h){setTimeout(function(){b._waitForNewDevices(g,30,k)},4E3)})})};b.prototype.addNewDeviceWithSGTN=function(k,b,g){var h=this;this.getDeviceList(function(l){h._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:b,KEY_MODE:"LOCAL",KEY:g}]],function(g){setTimeout(function(){h._waitForNewDevices(l,
30,k)},4E3)})})};b.prototype.listBidcosInterfaces=function(k){this._doXMLRpcRequest("listBidcosInterfaces",[],function(b,g){var h=[];!b&&g&&(h=g[0]);k&&k(b,h)})};b.prototype.reportValueUsage=function(k,b,g,h){this._doXMLRpcRequest("reportValueUsage",[k,b,g],function(g,k){var l;!g&&k&&(l=k[0]);h&&h(g,l)})};b.prototype.ping=function(k,b){this._doXMLRpcRequest("ping",[k],function(g){b&&b(g)})};return b}();
x.hub.m.hm.Server=function(){var b=function(k){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server");this._port=9099;k&&0<k&&(this._port=k);this._server=null;this._servlet={}};b.prototype.getPort=function(){return this._port};b.prototype.stop=function(k){this._server?this._server.close():k&&k()};b.prototype.start=function(k){if(this._server)k&&k();else{var b=k,g=this,h=require("http").createServer(function(h,k){g._logger.log("trace","receive request method:"+h.method);g._logger.log("trace",
"receive request path:"+h.url);g._logger.log("trace","receive request header:"+JSON.stringify(h.headers));var l="";h.on("data",function(h){l+=h.toString()});h.on("end",function(){g._logger.log("trace","receive request body:"+l);"POST"==h.method?g._handleRequest(l,h,k):(g._logger.log("trace","send 404 response"),k.writeHead(404,"Not found"),k.end())})});h.on("error",function(h){g._logger.log("trace","xmlrpc server err:"+h.stack);b&&b(h);b=null;g._server=null});h.listen(this._port,function(){g._logger.log("trace",
"xmlrpc server listening on port:"+g._port);g._server=h;b&&b();b=null})}};b.prototype.registServlet=function(k,b){k&&b&&(this._servlet[k]=b)};b.prototype.unregistServlet=function(k){k&&delete this._servlet[k]};b.prototype._handleRequest=function(k,b,g){var h=b.url,l=require("x.xmlrpc.js"),n=this;try{var m=l.deserializeReq(k);if("system.multicall"==m.methodName)this._handleMultiCall(m.params[0],b,g);else if(this._logger.log("debug","receive method call:"+m.methodName),this._logger.log("debug","params:"+
JSON.stringify(m.params)),"system.listMethods"==m.methodName)this._sendSuccessResponse(["event listDevices newDevices deleteDevices updateDevice replaceDevice readdedDevice".split(" ")],g);else if(this._servlet[h])this._servlet[h](m.methodName,m.params,function(h,l){h?n._sendErrorResponse(h,g):n._sendSuccessResponse([l],g)});else this._sendSuccessResponse([[]],g)}catch(r){this._sendErrorResponse(r,g)}};b.prototype._handleMultiCall=function(k,b,g){b=b.url;this._logger.log("trace","---------------------------------");
this._logger.log("trace","receive system.multicall");for(var h=0;h<k.length;h++){var l=k[h];this._logger.log("trace","receive method call:"+l.methodName);this._logger.log("trace","params:"+JSON.stringify(l.params));if(this._servlet[b])this._servlet[b](l.methodName,l.params)}this._logger.log("trace","---------------------------------");this._sendSuccessResponse([[]],g)};b.prototype._sendSuccessResponse=function(k,b){k=require("x.xmlrpc.js").serializeRsp(null,k);this._logger.log("trace","send xml success response:"+
k);b.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(k)+""});b.write(k);b.end()};b.prototype._sendErrorResponse=function(k,b){var g=require("x.xmlrpc.js"),h=-1;k.errCode&&(h=k.errCode);k=g.serializeRsp({faultCode:h,faultString:k.message});this._logger.log("trace","send xml fault response:"+k);b.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(k)+""});b.write(k);b.end()};return b}();
x.hub.m.hm._Controller=function(){var b=function(h,g,k,m,b,n){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller");this._client=new x.hub.m.hm.Client(h,g,k,m,b);this._initStates=n;this.interface=null;this._devices={};this._status={};this._learnDeviceCbs=[];this._learnDeviceTO=null;this._readValueCbs={}};util.inherits(b,EventEmitter);b.prototype.getIP=function(){return this._client.getIP()};b.prototype.getPort=function(){return this._client.getPort()};b.prototype.setPort=function(h){return this._client.setPort(h)};
b.prototype.getAllBufferedStates=function(){var h={},g;for(g in this._devices){var k=this._devices[g];!k.PARENT&&k.CHILDREN?h[g]={device:{type:k.TYPE,"interface":this.interface,address:k.ADDRESS,channels:{}},states:{}}:k.PARENT&&(h[k.PARENT].device.channels[k.ADDRESS]={type:k.TYPE,address:k.ADDRESS});if(k.CHILDREN)for(var m=0,b=k.CHILDREN.length;m<b;m++){var n=k.CHILDREN[m];if(this._status[n]){h[g].states[n]={};for(var v in this._status[n])h[g].states[n][v]=this._status[n][v]}}}return h};b.prototype.getBufferedState=
function(h){if(!h)return null;var g=h.indexOf(":");-1!=g&&(h=h.substr(0,g));h=this._devices[h];if(!h)return null;var k={};if(h.CHILDREN){var m=this;h.CHILDREN.forEach(function(h){if(m._status[h]){k[h]={};for(var g in m._status[h])k[h][g]=m._status[h][g]}})}return k};b.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices)};b.prototype.getState=function(h,g,k){var l=this.getBufferedState(h);if(l&&l[h]&&l[h][g]){l=l[h][g];var b=l.value;if("undefined"!=typeof b&&null!=b){k&&
k(null,l);return}}this.updateState(h,g,function(h,g){k&&k(h,g)})};b.prototype.updateState=function(h,g,k){var l=this;this.readValue(h,g,function(m,b){m?setTimeout(function(){var m,b=l.getBufferedState(h);b&&b[h]&&b[h][g]&&(m=b[h][g]);k&&k(null,m)},1E3):k&&k(null,{value:b,time:(new Date).getTime()})})};b.prototype.reset=function(h){var g=[];Object.keys(this._devices).forEach(function(h){h&&-1==h.indexOf(":")&&"BidCoS-RF"!=h&&g.push(h)});if(0==g.length)h&&h();else{var k=0,m=this,b=function(l){k++;k<
g.length?m.deleteDevice(g[k],b):h&&h()};this.deleteDevice(g[k],b)}};b.prototype.register=function(h,g,k){if(h){this._logger.log("debug","register:"+g+" to "+h);var l=this;this._client.init(h,g,function(h){l._logger.log("debug","registed:"+g+(h?" err:"+h.message:""));k&&k(h,h?null:g)})}else k&&k(Error("arguments invalid"))};b.prototype.unregister=function(h,g){h?this._client.init(h,"",function(h){g&&g(h)}):g&&g(Error("url invalid"))};b.prototype.getDevices=function(h){this._client.listDevices(function(g,
k){if(g)h&&h(g);else for(g=0;g<k.length;g++);})};b.prototype.learnNewDevice=function(h){var g=this._learnDeviceCbs.length;h&&-1==this._learnDeviceCbs.indexOf(h)&&this._learnDeviceCbs.push(h);if(0==g){var k=this;this._learnDeviceTO=setTimeout(function(){var h=k._learnDeviceCbs;k._learnDeviceCbs=[];for(var g=0;g<h.length;g++){var l=h[g];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,1,function(h){if(h){k._learnDeviceTO&&(clearTimeout(k._learnDeviceTO),k._learnDeviceTO=
null);var g=k._learnDeviceCbs;k._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var m=g[l];m&&m(h)}}})}};b.prototype.learnNewDeviceSN=function(h,g){var l=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==l){var k=this;this._learnDeviceTO=setTimeout(function(){var h=k._learnDeviceCbs;k._learnDeviceCbs=[];for(var g=0;g<h.length;g++){var l=h[g];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,h,function(h){if(h){k._learnDeviceTO&&
(clearTimeout(k._learnDeviceTO),k._learnDeviceTO=null);var g=k._learnDeviceCbs;k._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var m=g[l];m&&m(h)}}})}};b.prototype.learnNewIPDevice=function(h,g,k){var l=this._learnDeviceCbs.length;k&&-1==this._learnDeviceCbs.indexOf(k)&&this._learnDeviceCbs.push(k);if(0==l){var b=this;this._learnDeviceTO=setTimeout(function(){var h=b._learnDeviceCbs;b._learnDeviceCbs=[];for(var g=0;g<h.length;g++){var l=h[g];l&&l(Error("learn device timeout"))}},6E4);h={ADDRESS:h.replace(/-/g,
"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(g)};this._client.setInstallModeWithWhitelist(!0,60,[h],function(h){if(h){b._learnDeviceTO&&(clearTimeout(b._learnDeviceTO),b._learnDeviceTO=null);var g=b._learnDeviceCbs;b._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var k=g[l];k&&k(h)}}})}};b.prototype.learnNewIPDeviceQR=function(h,g){var l=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==l){var k=this;this._learnDeviceTO=
setTimeout(function(){var h=k._learnDeviceCbs;k._learnDeviceCbs=[];for(var g=0;g<h.length;g++){var l=h[g];l&&l(Error("learn device timeout"))}},3E4);g=h.substr(6,24);h=h.substring(h.length-32,h.length);h={ADDRESS:g.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:h.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[h],function(h){if(h){k._learnDeviceTO&&(clearTimeout(k._learnDeviceTO),k._learnDeviceTO=null);var g=k._learnDeviceCbs;k._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var b=
g[l];b&&b(h)}}})}};b.prototype.deleteDevice=function(h,g){if(h){var l=h.indexOf(":");-1!=l&&(h=h.substr(0,l));this._client.deleteDevice(h,2,g)}else g&&g(Error("address is empty"))};b.prototype.readValue=function(h,g,k){var l=h+"."+g,b=this._readValueCbs[l];b||(b=[],this._readValueCbs[l]=b);var n=b.length;k&&-1==b.indexOf(k)&&b.push(k);if(0==n){var q=this;this._client.getValue(h,g,null,function(k,b){k||q._updateStatusBuffer(h,g,b);var m=q._readValueCbs[l];delete q._readValueCbs[l];m.forEach(function(h){h&&
h(k,b)})})}};b.prototype.writeValue=function(h,g,k,b){var l=this;this._client.setValue(h,g,k,function(m){m||l._updateStatusBuffer(h,g,k.type?k.value:k);b&&b(m)})};b.prototype.getValuesParamset=function(h,g){this._logger.log("trace","getValuesParamset:"+h);var l=this;this._client.getParamset(h,"VALUES",0,function(k,b){if(k)l._logger.log("trace","getValuesParamset error:"+k.message),g&&g(k);else{if(b){k=0;var m=h.indexOf(":");-1!=m&&(k=h.substr(m+1));for(var n in b)b.hasOwnProperty(n)&&(0==k?"INSTALL_MODE"!=
n&&l._updateStatusBuffer(h,n,b[n]):l._updateStatusBuffer(h,n,b[n]))}l._logger.log("trace","getValuesParamset finish:"+JSON.stringify(b));g&&g(null,b)}})};b.prototype.getParamset=function(h,g,k){this._client.getParamset(h,g,0,function(g,h){k&&k(g,h)})};b.prototype.setParamset=function(g,l,k,b){this._client.putParamset(g,l,k,function(g){b&&b(g)})};b.prototype.reportValueUsage=function(g,l,k,b){this._client.reportValueUsage(g,l,k,function(g,h){b&&b(g,h)})};b.prototype.getDevice=function(g){if(!g)return null;
var h=g,k=g.indexOf(":");-1!=k&&(h=g.substr(0,k));if(!this._devices[h])return null;var b=[];g=this._devices[h];b.push(g);if(g.CHILDREN){var n=this;g.CHILDREN.forEach(function(g){g&&n._devices[g]&&b.push(n._devices[g])})}return(g=this._getDeviceStructs(b))?g[h]:null};b.prototype._getDeviceStructs=function(g){if(!g)return null;var h={},k=this;g.forEach(function(g){if(g.ADDRESS&&g.TYPE)if(!g.PARENT&&g.CHILDREN)h[g.ADDRESS]={type:g.TYPE,"interface":k.interface,address:g.ADDRESS,channels:{}};else if(g.PARENT){var l=
h[g.PARENT];l&&(l.channels[g.ADDRESS]={type:g.TYPE,address:g.ADDRESS})}});return h};b.prototype._updateStatusBuffer=function(g,l,k,b){if("CENTRAL"!=g||"PONG"!=l){if("PRESS_SHORT"==l||"PRESS_LONG"==l||"PRESS_CONT"==l||"PRESS_LONG_RELEASE"==l){var h={};b={value:k,time:(new Date).getTime()};var m=!0}else{var n=this._status[g];n||(n={},this._status[g]=n);h=n[l];h||(h={},n[l]=h);b={value:k,time:b?b:(new Date).getTime()};h&&h.time&&b&&b.time&&h.time>b.time?m=!1:(n[l]=b,m=!0)}n=this.getDevice(g);m&&this.emit("event",
{device:n,"interface":this.interface,channel:g,datapoint:l,value:b,changed:h.value!=b.value,oldValue:h});h=g.indexOf(":");-1!=h&&(b=g.substr(0,h),"1"==g.substr(h+1)&&"STATE"==l&&0==k&&n&&n.channels&&n.channels[b+":2"]&&"POWERMETER"==n.channels[b+":2"].type&&(this._updateStatusBuffer(b+":2","POWER",0),this._updateStatusBuffer(b+":2","CURRENT",0)))}};b.prototype._initNewDeviceStates=function(g,l){if(this._initStates){var h=this,k=function(g,l){g.ADDRESS&&g.PARAMSETS&&-1!=g.PARAMSETS.indexOf("VALUES")?
h.getValuesParamset(g.ADDRESS,l):l()},b=0,n=function(){b++;b<g.length?k(g[b],n):l&&l()};k(g[b],n)}else l&&l()};b.prototype._convertHmIPKeyBase32ToBase16=function(g){g=g.replace(/-/g,"").toUpperCase();var h="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),k=new ArrayBuffer(16);k=new Uint8Array(k);for(var b=0,n=g.length-1,p=0,v=k.length-1,w="";0<=n;){for(var u=0;u<h.length;u++)if(h[u]==g.charAt(n)){b|=u<<p;break}p+=5;for(n--;8<p&&0<=v;)k[v]=b&255,b>>=8,p-=8,v--}for(u=0;u<k.length;u++)16>k[u]&&(w+="0"),
w+=k[u].toString(16);return w.toUpperCase()};b.prototype._xmlrpcCall=function(g,l,k){this._logger.log("trace","receive call:"+g);this._logger.log("trace","params:"+JSON.stringify(l));var h=[],b;switch(g){case "newDevices":if(l[1]){this._initNewDeviceStates(l[1],null);for(b=0;b<l[1].length;b++)(g=l[1][b])&&g.ADDRESS&&(this._devices[g.ADDRESS]=g);g=this._getDeviceStructs(l[1]);try{this.emit("newDevices",g)}catch(v){}if(!l[1]||!l[1][0]||"HM-RCV-50"!=l[1][0].TYPE)for(l=this._learnDeviceCbs,this._learnDeviceCbs=
[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),b=0;b<l.length;b++){var n=l[b];n&&n(null,g)}}break;case "readdedDevice":if(l[1]&&l[1][0])for(b=this.getDevice(l[1][0]),g={},g[l[1][0]]=b,l=this._learnDeviceCbs,this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),b=0;b<l.length;b++)(n=l[b])&&n(null,
g);break;case "listDevices":if(l[1]){l=[];for(b in this._devices)this._devices.hasOwnProperty(b)&&this._devices[b]&&l.push(this._devices[b]);h.push(l)}break;case "deleteDevices":if(l[1])for(b=0;b<l[1].length;b++)if(g=l[1][b])delete this._devices[g],delete this._status[g];break;case "event":this._logger.log("trace","get event:"+JSON.stringify(l)),this._updateStatusBuffer(l[1],l[2],l[3])}k&&k(null,h)};var k=function(g,l,k,b,n,p){x.hub.m.hm._Controller.call(this,g,l,k,b,n,p);this.interface="BidCos-RF";
this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF")};k.prototype=new b;k.prototype.constructor=k;k.prototype.listBidcosInterfaces=function(g){this._client.listBidcosInterfaces(function(h,k){g&&g(h,k)})};k.prototype.ping=function(g,l){this._client.ping(g,function(g){l&&l(g)})};var n=function(g,l,k,b,n,p){x.hub.m.hm._Controller.call(this,g,l,k,b,n,p);this.interface="BidCos-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired")};util.inherits(n,b);var g=
function(g,l,k,b,n,p){x.hub.m.hm._Controller.call(this,g,l,k,b,n,p);this.interface="HmIP-RF";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP")};util.inherits(g,b);g.prototype.deleteDevice=function(g,l){var h=g.indexOf(":");-1!=h&&(g=g.substr(0,h));this._client.deleteDevice(g,2,l)};b.getController=function(h,l,b){switch(h){case "BidCos-RF":h=k;break;case "BidCos-Wired":h=n;break;case "HmIP-RF":h=g;break;default:return null}return new h(l.ip,l.port,l.username,l.password,b.useHttps,
b.initStates)};return b}();
x.hub.m.hm.Monitor=function(){var b=function(g,h,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor");this._type=l;this._monitor=g;this._controller=h;this._xmlrpcServer=null;this._retryWait=1E4;this._retryCount=0;this._retryTO=null;this._state=0;this._err=null};b.prototype.start=function(g,h){0==this._state&&(this._xmlrpcServer=g,this._connect(g));h&&h()};b.prototype.stop=function(g,h){var l=this._state;this._retryTO&&clearTimeout(this._retryTO);this._retryTO=null;
this._state=0;this._err=null;this._retryCount=0;0!=l?this._unregister(g,function(){h&&h()}):h&&h()};b.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null}};b.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort());this._state=1;var g=this;this._register(this._xmlrpcServer,function(h){h?(g._logger.log("warn","regist "+g._type+" monitor at "+g._controller.getIP()+
":"+g._controller.getPort()+" error:"+h.message),g._state=3,g._err=h,g._retryCount++,g._retryTO=setTimeout(function(){g._logger.log("trace","retry timeout for regist "+g._type+" monitor at "+g._controller.getIP()+":"+g._controller.getPort()+" expired");g._connect()},Math.min(6E4,Math.ceil(g._retryCount/10)*g._retryWait))):(g._logger.log("info","regist "+g._type+" monitor at "+g._controller.getIP()+":"+g._controller.getPort()+" success"),g._state=2,g._err=null,g._retryCount=0,g._monitor._onControllerMonitorConnected(g._type))})};
b.prototype._register=function(g,h){var l=this._monitor.localMac.replace(/:/g,""),k="/"+this._monitor.serialNumber;g=g.getPort();this._controller.register("http://"+this._monitor.localIP+":"+(g?g:80)+k,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+l,h)};b.prototype._unregister=function(g,h){var l="/"+this._monitor.serialNumber;g=g.getPort();this._controller.unregister("http://"+this._monitor.localIP+":"+(g?g:80)+l,h)};var k=function(g){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler");
this._monitor=g;this._pingWait=3E4;this._pingTO=null;this._pingMiss=0};k.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._startPingTO()};k.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0};k.prototype._startPingTO=function(){var g=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingTO=setTimeout(function(){g._pingMiss++;4>g._pingMiss?(g._ping(),g._startPingTO()):
g._pingFail()},this._pingWait)};k.prototype._ping=function(g){var h=this._monitor._rfController;h?(this._logger.log("trace","send PING"),h.ping(this._monitor.localMac,function(h){g&&g(h)})):g&&g(Error("no rf controller for ping"))};k.prototype._pingFail=function(){this._logger.log("warn","PING Fail");this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._monitor._onPingFail()};k.prototype._onPong=function(){this._pingMiss=0};var n=function(g,h){this.ip=g.ip;this.serialNumber=
g.uuid;this.ccuType=g.type;this.ccuType||(this.ccuType=2);this.localIP=h?h.localIP:null;this.localMac=h?h.localMac:null;this.isChip=h?"chip"==h.localChip:!1;this.isCCU3=h?"ccu3"==h.localChip:!1;this.persistant=h?h.persistant:!1;this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");g={ip:this.ip,port:null,username:g.username,password:g.password};h={useHttps:!1,initStates:this.isChip?!0:!1};g.port=this.isCCU3?32001:2001;this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",
g,h);this._rfController.on("event",this._onEvent.bind(this));this._rfController.on("newDevices",this._onNewDevices.bind(this));g.port=this.isCCU3?32010:2010;this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",g,h);this._ipController.on("event",this._onEvent.bind(this));this._ipController.on("newDevices",this._onNewDevices.bind(this));g.port=this.isCCU3?32E3:2E3;this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",g,h);this._wiredController.on("event",this._onEvent.bind(this));
this._wiredController.on("newDevices",this._onNewDevices.bind(this));this._wiredMonitor=this._ipMonitor=this._rfMonitor=null;this._pingpong=new k(this);this._pingTO=this._manager=this._xmlrpcServer=null;this._pingMiss=0;this._wiredRegisted=this._ipRegisted=this._rfRegisted=!1;this._reconnectTO=null;this._reconnectCount=0};util.inherits(n,EventEmitter);n.prototype.getMonitorState=function(g){var h={chip:this.isChip};if(this._rfMonitor){var l=this._rfMonitor.getMonitorState();h.bidcos=l}this._ipMonitor&&
(l=this._ipMonitor.getMonitorState(),h.hmip=l);this._wiredMonitor&&(l=this._wiredMonitor.getMonitorState(),h.bidcos_wired=l);h.bidcos&&2==h.bidcos.state?this._rfController.listBidcosInterfaces(function(l,k){k&&(h.info=k);g&&g(null,h)}):g&&g(null,h)};n.prototype.getAllBufferedStates=function(){var g={},h,l=this._rfController.getAllBufferedStates();if(l)for(h in l)l.hasOwnProperty(h)&&(g[h]=l[h]);if(l=this._wiredController.getAllBufferedStates())for(h in l)l.hasOwnProperty(h)&&(g[h]=l[h]);if(l=this._ipController.getAllBufferedStates())for(h in l)l.hasOwnProperty(h)&&
(g[h]=l[h]);return g};n.prototype.getBufferedDevice=function(g,h){switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:return null}return g.getDevice(h)};n.prototype.getState=function(g,h){if(!(g&&g.interface&&g.channel&&g.datapoint))return h&&h(Error("argument invalid")),null;switch(g.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=
this._ipController;break;default:return null}l.getState(g.channel,g.datapoint,h)};n.prototype.updateState=function(g,h){if(!(g&&g.interface&&g.channel&&g.datapoint))return h&&h(Error("argument invalid")),null;switch(g.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:return null}l.updateState(g.channel,g.datapoint,h)};n.prototype.init=function(g,h){this._logger.log("info","init monitor ("+
this.ip+")");this._xmlrpcServer=g;this._init(h)};n.prototype._init=function(g){var h=this;this.getSerialNumber(function(l){l?g&&g(l):h.register(h._xmlrpcServer,function(){g&&g()})})};n.prototype.update=function(g,h,l,k){l&&this.serialNumber!=l&&(this.serialNumber=l);var b=this;g&&this.ip!=g||h&&this.localIP!=h?this.unregister(this._xmlrpcServer,function(){b.ip=g;b.localIP=h;b.register(b._xmlrpcServer,k)}):k&&k()};n.prototype.finalize=function(g){this.removeAllListeners();this._manager&&this._manager.deleteMonitor(this.ip);
this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);this.unregister(this._xmlrpcServer,function(){g&&g()})};n.prototype.getSerialNumber=function(g){var h=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),h.getRFInterfaces(function(l,k){l?(h._rfController.setPort(2001),h.getRFInterfaces(function(l,k){l?g&&g():(h.serialNumber=k[0].ADDRESS,g&&g(null,h.serialNumber))})):(h._ipController.setPort(32010),
h._wiredController.setPort(32E3),h.serialNumber=k[0].ADDRESS,g&&g(null,h.serialNumber))})):this.getRFInterfaces(function(l,k){l?g&&g():(h.serialNumber=k[0].ADDRESS,g&&g(null,h.serialNumber))})};n.prototype.getRFInterfaces=function(g){this._rfController.listBidcosInterfaces(function(h,l){g&&g(h,l)})};n.prototype.register=function(g,h){var l=this;g.registServlet("/"+this.serialNumber,function(g,h,k){l._xmlrpcCall(g,h,k)});this._rfMonitor=new b(this,this._rfController,"rf");this._ipMonitor=new b(this,
this._ipController,"ip");this._wiredMonitor=new b(this,this._wiredController,"wired");this._rfMonitor.start(g);this._ipMonitor.start(g);this.isChip||this._wiredMonitor.start(g);h&&h()};n.prototype.unregister=function(g,h){g.unregistServlet("/"+this.serialNumber);this._rfMonitor.stop(g);this._ipMonitor.stop(g);this.isChip||this._wiredMonitor.stop(g);h&&h()};n.prototype._onControllerMonitorConnected=function(g){"rf"==g&&this._pingpong.start()};n.prototype._onPingFail=function(){var g=this;this.unregister(this._xmlrpcServer,
function(){g.register(g._xmlrpcServer,function(){})})};n.prototype._onPong=function(){this._pingpong._onPong()};n.prototype.reset=function(g){var h=this;this._rfController.reset(function(){h._ipController.reset(function(){h._wiredController.reset(function(){g&&g()})})})};n.prototype.learnRF=function(g){this._rfController.learnNewDevice(function(h,l){g&&g(h,l)})};n.prototype.learnRFSN=function(g,h){this._rfController.learnNewDeviceSN(g,function(g,k){h&&h(g,k)})};n.prototype.learnIP=function(g,h,l){this._ipController.learnNewIPDevice(g,
h,function(g,h){l&&l(g,h)})};n.prototype.learnIPQR=function(g,h){this._ipController.learnNewIPDeviceQR(g,function(g,k){h&&h(g,k)})};n.prototype.deleteDevice=function(g,h,l){if(!g||!h)return l&&l(Error("argument invalid")),null;switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:l&&l(Error("no such interface"));return}g.deleteDevice(h,l)};n.prototype.getDevices=function(g){var h=0;this._rfController&&
h++;this._ipController&&h++;this._wiredController&&h++;var l=[],k=function(k){h--;k?g&&g(k):0==h&&g&&g(null,l)},b=this;this._rfController&&this._rfController.getBufferedDevices(function(g,h){g?(k&&k(g),k=null):(l=l.concat(b._parseDevices(h,"BidCos-RF")),k&&k())});this._ipController&&this._ipController.getBufferedDevices(function(g,h){g?(k&&k(g),k=null):(l=l.concat(b._parseDevices(h,"HmIP-RF")),k&&k())});this._wiredController&&this._wiredController.getBufferedDevices(function(g,h){g?(k&&k(g),k=null):
(l=l.concat(b._parseDevices(h,"BidCos-Wired")),k&&k())})};n.prototype.getParamset=function(g,h,k,b){if(g&&h&&k){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:b&&b(Error("unknow interface"));return}l.getParamset(h,k,function(g,h){b&&b(g,h)})}else b&&b(Error("argument invalid"))};n.prototype.setParamset=function(g,h,k,b,m){if(g&&h&&k&&b){var l=null;switch(g){case "BidCos-RF":l=this._rfController;
break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:m&&m(Error("unknow interface"));return}l.setParamset(h,k,b,function(g,h){m&&m(g,h)})}else m&&m(Error("argument invalid"))};n.prototype.readValue=function(g,h,k,b){if(g&&h&&k){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:b&&b(Error("unknow interface"));return}l.readValue(h,k,
function(g,h){b&&b(g,h)})}else b&&b(Error("argument invalid"))};n.prototype.writeValue=function(g,h,k,b,m){if(g&&h&&k){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:m&&m(Error("unknow interface"));return}l.writeValue(h,k,b,function(g){m&&m(g)})}else m&&m(Error("argument invalid"))};n.prototype.reportValueUsage=function(g,h,k,b){if(g&&h&&k){var l=null;switch(g){case "BidCos-RF":l=
this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:b&&b(Error("unknow interface"));return}l.reportValueUsage(h,k,1,function(g,h){b&&b(g,h)})}else b&&b(Error("argument invalid"))};n.prototype.updateStatusBuffer=function(g,h,k,b,m){if(g&&h&&k){switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:return}g._updateStatusBuffer(h,
k,b,m)}};n.prototype._parseDevices=function(g,h){h||(h="BidCos-RF");var k=new (require("xnm.aio.hm.js").CCU),b={},m;for(m in g)if(g.hasOwnProperty(m)){var n=g[m],p={typename:"DEVICE",hsstype:n.TYPE,address:n.ADDRESS,interface:h,rfAddr:n.RF_ADDRESS,channels:{}};if(n.CHILDREN)for(var v=0,w=n.CHILDREN.length;v<w;v++){var u=n.CHILDREN[v];p.channels[u]={hsstype:g[u].TYPE,address:u}}b[m]=p}return k._parseDevices(b)};n.prototype._xmlrpcCall=function(g,h,k){this._logger.log("trace","receive call:"+g);this._logger.log("trace",
"params:"+JSON.stringify(h));if("event"==g&&"CENTRAL"==h[1]&&"PONG"==h[2])this._onPong(),k&&k(null,[]);else{var b=h[0].split("_");3<=b.length?(b=b[1],-1!=b.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(g,h,k):-1!=b.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(g,h,k):-1!=b.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(g,h,k):k&&k(null,[])):k&&k(null,[])}};n.prototype._onNewDevices=function(g){this._logger.log("debug","find new devices");
this._logger.log("debug",JSON.stringify(g));this.emit("new_devices",g)};n.prototype._onEvent=function(g){this._logger.log("trace","receive event:"+JSON.stringify(g));this._logger.log("debug","EVENT:\t"+g.interface+"\t"+g.device.type+"\t"+g.channel+"\t"+g.datapoint+"\t"+g.value.value);g.ip=this.ip;g.serialNumber=this.serialNumber;this.emit("event",g,this)};return n}();
x.hub.m.hm.MonitorManager=function(){var b=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager");this._monitors=[];this._xmlrpcServer=null;this._tmpMonitors={};this._monitorEvtListener=this.onDeviceEvent.bind(this)};b.prototype.init=function(k,b){this._xmlrpcServer=k;b&&b()};b.prototype.startMonitorForIP=function(k,b,g){this.startMonitor({ip:k},{localIP:b},g)};b.prototype.startMonitor=function(k,b,g){if(this._xmlrpcServer)if(k&&k.ip){var h=this.getMonitor(k.ip,k.uuid);
if(h)g&&g();else if(b||(b={}),b.localIP||(b.localIP=x.hub.m.hm._Util.getLocalIP(null,k.ip)),b.localIP){b.localMac||(b.localMac=x.hub.m.hm._Util.getLocalMac(b.localIP));var l=k.ip;this._tmpMonitors[l]||(this._tmpMonitors[l]=[]);var n=this._tmpMonitors[l].length,m=this._tmpMonitors[l];g||(g=function(){});-1==m.indexOf(g)&&m.push(g);if(!(0<n)){var r=this;h=new x.hub.m.hm.Monitor(k,b);h._manager=this;h.init(this._xmlrpcServer,function(g){g||(r._monitors.push(h),h.on("event",r._monitorEvtListener));var k=
r._tmpMonitors[l];delete r._tmpMonitors[l];k.forEach(function(h){h&&h(g)})})}}else g&&g(Error("local ip address invalid"))}else g&&g(Error("gateway invalid"));else g&&g(Error("xml rpc server not started"))};b.prototype.getAllMonitor=function(){return this._monitors};b.prototype.getMonitor=function(k,b){var g=null,h=null;this._monitors.forEach(function(l){l&&l.ip==k&&(g=l);l&&l.serialNumber==b&&(h=l)});return h?h:g};b.prototype.getMonitorStates=function(k){if(0==this._monitors.length)k&&k(null,[]);
else{var b=this,g=0,h=[],l=function(n,m){!n&&m&&(m.ip=b._monitors[g].ip,m.serialNumber=b._monitors[g].serialNumber,h.push(m));g++;g<b._monitors.length?b._monitors[g].getMonitorState(l):k&&k(null,h)};this._monitors[g].getMonitorState(l)}};b.prototype.deleteMonitor=function(k){for(var b=-1,g=0,h=this._monitors.length;g<h;g++){var l=this._monitors[g];if(l&&l.ip==k){b=g;break}}-1!=g&&this._monitors.splice(b,1)};b.prototype.onFindHomeMatic=function(k,b,g){var h=this.getMonitor(null,g),l=this.getMonitor(k);
l?(l.update(k,b,g),h&&h!=l&&(h.finalize(),this.deleteMonitor(h.ip))):(h&&(h.finalize(),this.deleteMonitor(h.ip)),this.startMonitorForIP(k,b))};b.prototype.onDeviceEvent=function(k,b){require("x.hub.m.hm.js").onDeviceEvent(k,b.isChip)};return b}();
x.hub.m.hm._Channel=function(){var b=function(){var g=[];this.map.forEach(function(h){h&&h.dpt&&h.state&&0<h.state.length&&-1==g.indexOf(h.dpt)&&g.push(h.dpt)});return g},k=function(g){var h=null;this.map.forEach(function(k){k&&k.dpt&&k.state&&-1!=k.state.indexOf(g)&&(h=k.dpt)});return h},n=function(g){var h=null;this.map.forEach(function(k){k&&k.dpt&&k.command&&-1!=k.command.indexOf(g)&&(h=k.dpt)});return h};return{"HmIP-RF":{T_MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},
{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]},{dpt:"ACTUAL_TEMPERATURE",state:["maintainTemp"],event:["maintainTemp"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){switch(g){case "UNREACH":return{timeout:h};case "LOW_BAT":return{lowbat:h};
case "SABOTAGE":return{sabotage:h};case "OPERATING_VOLTAGE":return{voltage:parseFloat(h)};case "ERROR_CODE":return{errorCode:parseInt(h)};case "ACTUAL_TEMPERATURE":return{maintainTemp:parseFloat(h)}}return null}},MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){switch(g){case "UNREACH":return{timeout:h};case "LOW_BAT":return{lowbat:h};
case "SABOTAGE":return{sabotage:h}}return null}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){switch(g){case "UNREACH":return{timeout:h};
case "LOW_BAT":return{lowbat:h};case "SABOTAGE":return{sabotage:h};case "OPERATING_VOLTAGE":return{voltage:parseFloat(h)};case "ERROR_CODE":return{errorCode:parseInt(h)};case "SENSOR_ERROR":return{sensorError:h}}return null}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"ERROR_NON_FLAT_POSITIONING",state:["sabotage"],event:["sabotage"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){switch(g){case "UNREACH":return{timeout:h};
case "LOW_BAT":return{lowbat:h};case "ERROR_NON_FLAT_POSITIONING":return{sabotage:h}}return null}},SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "STATE":k=1==h?{switchTState:"on"}:0==h?{switchTState:"off"}:{switchTState:"?"}}return k}},SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:b,
getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "STATE":k=1==h?{switchState:"on"}:0==h?{switchState:"off"}:{switchState:"?"}}return k},executeCommand:function(g,h,k,b,m){var l=n.call(this,b);"onFor"==b.substr(0,5)&&(l="STATE");if(l)switch(b){case "on":g.writeValue(h,k,l,!0,m);break;case "off":g.writeValue(h,k,l,!1,m);break;case "toggle":g.getState({interface:h,channel:k,datapoint:l},function(b,n){b?m&&m(b):n?(b=!0,n.value&&(b=!1),g.writeValue(h,k,l,b,m)):m&&m(Error("get switch current value return invalid"))});
break;default:"onFor"==b.substr(0,5)?(b=parseFloat(b.substr(5)),isNaN(b)?m&&m(Error("onFor command invalid")):(l="ON_TIME",g.writeValue(h,k,l,{type:"double",value:b},function(b){b?m&&m(b):(l="STATE",g.writeValue(h,k,l,!0,m))}))):m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+b))}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",
state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],event:["meterVoltage"]},{dpt:"FREQUENCY",state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){switch(g){case "ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(h).toFixed(2)};case "POWER":return{meterPower:parseFloat(h).toFixed(2)};case "CURRENT":return{meterCurrent:parseFloat(h).toFixed(2)};case "VOLTAGE":return{meterVoltage:parseFloat(h).toFixed(2)};
case "FREQUENCY":return{meterFrequency:parseFloat(h).toFixed(2)}}return null}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["dimmerTLevel"],event:["dimmerTLevel"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "LEVEL":k={dimmerTLevel:Math.round(100*parseFloat(h))};break;case "COLOR":k={dimmerTColor:"off blue green torqoise red purple yellow white".split(" ")[parseInt(h)]}}return k}},DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],
command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]},{dpt:"COLOR",state:["dimmerColor"],event:["dimmerColor"],command:["colorTo"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "LEVEL":k={dimmerLevel:Math.round(100*parseFloat(h))}}return k},executeCommand:function(g,h,k,b,m){if(b){if("dimOff"==b.substr(0,6))var l="dimOff";else if("dimUp"==b.substr(0,5)){l="dimUp";var p=b.substr(5)}else if("dimDown"==b.substr(0,7))l="dimDown",p=b.substr(7);else if("dimTo"==
b.substr(0,5)){if(l="dimTo",p=b.substr(5),!p){m&&m(Error("dimTo has no value"));return}}else if("toggleTo"==b.substr(0,8)){if(l="toggleTo",p=b.substr(8),!p){m&&m(Error("toggleTo has no value"));return}}else if("colorTo"==b.substr(0,7)&&(l="colorTo",p=b.substr(7),!p)){m&&m(Error("colorTo has no value"));return}var q=n.call(this,l);if(q)switch(l){case "dimOff":g.writeValue(h,k,q,{type:"double",value:0},m);break;case "dimUp":p||(p=10);p=parseInt(p)/100;g.getState({interface:h,channel:k,datapoint:q},
function(b,l){b?m&&m(b):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(h,k,q,{type:"double",value:p},m))});break;case "dimDown":p||(p=10);p=parseInt(p)/100;g.getState({interface:h,channel:k,datapoint:q},function(b,l){b?m&&m(b):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(h,k,q,{type:"double",value:p},m))});break;case "toggleTo":p=parseInt(p)/100;
g.getState({interface:h,channel:k,datapoint:q},function(b,l){b?m&&m(b):l?(l.value&&(p=0),g.writeValue(h,k,q,{type:"double",value:p},m)):m&&m(Error("get switch current value return invalid"))});break;case "dimTo":p=parseInt(p)/100;g.writeValue(h,k,q,{type:"double",value:p},m);break;case "colorTo":p=p.toLowerCase();p="off blue green torqoise red purple yellow white".split(" ").indexOf(p);if(-1==p){m&&m(Error("unknown color"));break}g.writeValue(h,k,q,{type:"double",value:p},m);break;default:m&&m(Error("no such command"))}else m&&
m(Error("can not find datapoint for command:"+b))}else m&&m(Error("command in null"))}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "MOTION":k={state:h?
"on":"off"};break;case "ILLUMINATION":k={illumination:h};break;case "MOTION_DETECTION_ACTIVE":k={active:h}}return k},executeCommand:function(g,h,k,b,m){if(b){var l=n.call(this,b);if(l)switch(b){case "reset":g.writeValue(h,k,l,!0,m);break;case "activate":g.writeValue(h,k,l,!0,m);break;case "deactivate":g.writeValue(h,k,l,!1,m);break;case "toggleActivate":g.getState({interface:h,channel:k,datapoint:l},function(b,n){b?m&&m(b):n?(b=!0,n.value&&(b=!1),g.writeValue(h,k,l,b,m)):m&&m(Error("get switch current value return invalid"))});
break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+b))}else m&&m(Error("command in null"))}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){h=null;switch(g){case "PRESS_SHORT":h={pressShort:!0};break;case "PRESS_LONG":h={pressLong:!0}}return h}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},
{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},{dpt:"DURATION_VALUE",command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "STATE":k=1==h?{state:"on"}:0==h?{state:"off"}:{state:"?"}}return k},executeCommand:function(g,h,k,b,m){if(b){var l=null;if("triggerAlarm"==b.substr(0,12)){l="triggerAlarm";var p=b.substr(12);if(!p){m&&m(Error("triggerAlarm format invalid"));
return}}if(n.call(this,l)||"triggerAlarm"==l)switch(l){case "triggerAlarm":var q=p.split(",");if(4>q.length){m&&m(Error("triggerAlarm format invalid"));break}g.writeValue(h,k,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(q[0])},function(b,l){b?m&&m(b):g.writeValue(h,k,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(q[1])},function(b,l){b?m&&m(b):g.writeValue(h,k,"DURATION_VALUE",{type:"double",value:parseInt(q[2])},function(b,l){b?m&&m(b):g.writeValue(h,k,"DURATION_UNIT",{type:"double",
value:parseInt(q[3])},m)})})});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+b))}else m&&m(Error("command in null"))}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},
{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},{dpt:"WINDOW_STATE",command:["winOpen","winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp","valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k={};switch(g){case "ACTIVE_PROFILE":k.profile=
parseInt(h);break;case "ACTUAL_TEMPERATURE":k.temp=parseFloat(h);break;case "BOOST_MODE":k.boost=h;break;case "FROST_PROTECTION":k.frost=h;break;case "HUMIDITY":k.hum=parseInt(h);break;case "SET_POINT_MODE":0==h?k.mode="auto":1==h&&(k.mode="manu");break;case "SET_POINT_TEMPERATURE":k.state=parseFloat(h);break;case "LEVEL":k.valve=Math.round(100*parseFloat(h));break;case "WINDOW_STATE":switch(h){case 0:k.window="closed";break;case 1:k.window="open"}break;default:return null}return k},executeCommand:function(g,
h,k,b,m){if(b){var l=b;if("tempTo"==b.substr(0,6)){l="tempTo";var p=b.substr(6);if(!p){m&&m(Error("tempTo has no value"));return}}else if("tempUp"==b.substr(0,6))l="tempUp",p=b.substr(6);else if("tempDown"==b.substr(0,8))l="tempDown",p=b.substr(8);else if("setProfile"==b.substr(0,10)){if(l="setProfile",p=b.substr(10),!p){m&&m(Error("setProfile has no value"));return}}else if("setValve"==b.substr(0,8)){if(l="setValve",p=b.substr(8),!p){m&&m(Error("setValve has no value"));return}}else"valveUp"==b.substr(0,
7)?(l="valveUp",p=b.substr(7)):"valveDown"==b.substr(0,9)&&(l="valveDown",p=b.substr(9));var q=n.call(this,l);if(q)switch(l){case "tempTo":p=parseFloat(p);if(isNaN(p)){m&&m(Error("tempTo value invalid"));break}30.5<p&&(p=30.5);4.5>p&&(p=4.5);g.writeValue(h,k,q,{type:"double",value:p},m);break;case "tempUp":p||(p=1);p=parseFloat(p);if(isNaN(p)){m&&m(Error("tempUp value invalid"));break}g.getState({interface:h,channel:k,datapoint:q},function(b,l){b?m&&m(b):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):
(p=l.value+p,30.5<p&&(p=30.5),g.writeValue(h,k,q,{type:"double",value:p},m))});break;case "tempDown":p||(p=1);p=parseFloat(p);if(isNaN(p)){m&&m(Error("tempDown value invalid"));break}g.getState({interface:h,channel:k,datapoint:q},function(b,l){b?m&&m(b):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,4.5>p&&(p=4.5),g.writeValue(h,k,q,{type:"double",value:p},m))});break;case "auto":g.writeValue(h,k,q,{type:"double",value:0},m);break;case "manu":g.writeValue(h,
k,q,{type:"double",value:1},m);break;case "setProfile":p=parseInt(p);if(isNaN(p)){m&&m(Error("setTemp value invalid"));break}g.writeValue(h,k,q,p,m);break;case "winOpen":g.writeValue(h,k,q,1,m);break;case "winClose":g.writeValue(h,k,q,0,m);break;case "boostOn":g.writeValue(h,k,q,!0,m);break;case "boostOff":g.writeValue(h,k,q,!1,m);break;case "setValve":p=parseInt(p);if(isNaN(p)){m&&m(Error("setValve value invalid"));break}p/=100;1<p&&(p=1);0>p&&(p=0);g.writeValue(h,k,q,{type:"double",value:p},m);
break;case "valveUp":p||(p=10);p=parseInt(p);if(isNaN(p)){m&&m(Error("tempUp value invalid"));break}p/=100;g.getState({interface:h,channel:k,datapoint:q},function(b,l){b?m&&m(b):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(h,k,q,{type:"double",value:p},m))});break;case "valveDown":p||(p=10);p=parseInt(p);if(isNaN(p)){m&&m(Error("tempUp value invalid"));break}p/=100;g.getState({interface:h,channel:k,datapoint:q},function(b,
l){b?m&&m(b):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(h,k,q,{type:"double",value:p},m))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+b))}else m&&m(Error("command in null"))}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "STATE":k={state:0==
h?"closed":"open"}}return k}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:"reservedAlarmOff intrusionAlarmOff intrusionAlarmOn smokeTest commTest commTestRepeated".split(" ")},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:b,getDptFromState:k,
parseDptState:function(g,h){var k=null;switch(g){case "SMOKE_DETECTOR_ALARM_STATUS":k={state:0==h?"ok":"smoke"};k.alarmDetail=h;break;case "SMOKE_DETECTOR_TEST_RESULT":switch(h){case 0:k={testResult:"none"};break;case 1:k={testResult:"smoke_ok"};break;case 2:k={testResult:"smoke_nok"};break;case 3:k={testResult:"comm_sent"};break;case 4:k={testResult:"comm_ok"}}break;case "ERROR_CODE":k={error:h}}return k},executeCommand:function(g,h,k,b,m){if(b){var l=n.call(this,b);if(l)switch(b){case "reservedAlarmOff":case "intrusionAlarmOff":case "intrusionAlarmOn":case "smokeTest":case "commTest":case "commTestRepeated":switch(b){case "reservedAlarmOff":var p=
0;break;case "intrusionAlarmOff":p=1;break;case "intrusionAlarmOn":p=2;break;case "smokeTest":p=3;break;case "commTest":p=4;break;case "commTestRepeated":p=5}g.writeValue(h,k,l,p,m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+b))}else m&&m(Error("command in null"))}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "STATE":switch(h){case 0:k=
{state:"closed"};break;case 1:k={state:"tilted"};break;case 2:k={state:"open"}}}return k}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "LEVEL":k={blindTLevel:Math.round(100*parseFloat(h))}}return k}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],
getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "LEVEL":k={blindLevel:Math.round(100*parseFloat(h))}}return k},executeCommand:function(g,h,k,b,m){if(b){if("moveUp"==b.substr(0,6))var l="moveUp";else if("moveDown"==b.substr(0,8)){l="moveDown";var p=b.substr(8)}else if("stepUp"==b.substr(0,6))l="stepUp",p=b.substr(6);else if("stepDown"==b.substr(0,8))l="stepDown",p=b.substr(8);else if("moveTo"==b.substr(0,6)){if(l="moveTo",p=b.substr(6),!p){m&&m(Error("moveTo has no value"));
return}}else"stop"==b.substr(0,4)&&(l="stop");var q=n.call(this,l);if(q)switch(l){case "moveUp":g.writeValue(h,k,q,{type:"double",value:1},m);break;case "moveDown":g.writeValue(h,k,q,{type:"double",value:0},m);break;case "stop":g.writeValue(h,k,q,!0,m);break;case "stepUp":p||(p=5);p=parseInt(p)/100;g.getState({interface:h,channel:k,datapoint:q},function(b,l){b?m&&m(b):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(h,k,q,{type:"double",
value:p},m))});break;case "stepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:h,channel:k,datapoint:q},function(b,l){b?m&&m(b):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(h,k,q,{type:"double",value:p},m))});break;case "moveTo":p=parseInt(p)/100;g.writeValue(h,k,q,{type:"double",value:p},m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+b))}else m&&m(Error("command in null"))}},
BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "LEVEL":k={blindTPos:Math.round(100*parseFloat(h))};break;case "LEVEL_2":k={lamellaTPos:Math.round(100*parseFloat(h))}}return k}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp",
"stepDown","moveTo"]},{dpt:"LEVEL_2",state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var k=null;switch(g){case "LEVEL":k={blindPos:Math.round(100*parseFloat(h))};break;case "LEVEL_2":k={lamellaPos:Math.round(100*parseFloat(h))}}return k},executeCommand:function(g,h,k,b,m){if(b){var l=b;if("lamellaStepUp"==b.substr(0,13)){l="lamellaStepUp";var p=b.substr(13)}else if("lamellaStepDown"==
b.substr(0,15))l="lamellaStepDown",p=b.substr(15);else if("lamellaTo"==b.substr(0,9)){if(l="lamellaTo",p=b.substr(9),!p){m&&m(Error("lamellaTo has no value"));return}}else if("stepUp"==b.substr(0,6))l="stepUp",p=b.substr(6);else if("stepDown"==b.substr(0,8))l="stepDown",p=b.substr(8);else if("moveTo"==b.substr(0,6)){if(l="moveTo",p=b.substr(6),!p){m&&m(Error("moveTo has no value"));return}}else"stop"==b.substr(0,4)&&(l="stop");var q=n.call(this,l);if(q)switch(l){case "moveUp":case "moveDown":g.writeValue(h,
k,"LEVEL_2",{type:"double",value:"moveUp"==l?1:0},function(b){b?m&&m(b):g.writeValue(h,k,"LEVEL",{type:"double",value:"moveUp"==l?1:0},function(g){m&&m(g)})});break;case "stop":g.writeValue(h,k,q,!0,m);break;case "moveTo":p=parseInt(p)/100;g.writeValue(h,k,"LEVEL",{type:"double",value:p},m);break;case "lamellaUp":case "lamellaDown":g.getState({interface:h,channel:k,datapoint:"LEVEL"},function(b,n){b?m&&m(b):g.writeValue(h,k,"LEVEL",{type:"double",value:n.value},function(b){b?m&&m(b):g.writeValue(h,
k,"LEVEL_2",{type:"double",value:"lamellaUp"==l?1:0},function(g){m&&m(g)})})});break;case "stepUp":case "stepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:h,channel:k,datapoint:"LEVEL"},function(b,n){b?m&&m(b):"undefined"==typeof n||null==n?m&&m(Error("get jalousie current value return invalid")):(p="stepUp"==l?n.value+p:n.value-p,1<p&&(p=1),0>p&&(p=0),g.writeValue(h,k,"LEVEL",{type:"double",value:p},m))});break;case "lamellaStepUp":case "lamellaStepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:h,
channel:k,datapoint:"LEVEL"},function(b,n){if(b)m&&m(b);else if("undefined"==typeof n||null==n)m&&m(Error("get jalousie current value return invalid"));else{var q=n.value;g.getState({interface:h,channel:k,datapoint:"LEVEL_2"},function(b,n){b?m&&m(b):"undefined"==typeof n||null==n?m&&m(Error("get jalousie current value return invalid")):(p="lamellaStepUp"==l?n.value+p:n.value-p,1<p&&(p=1),0>p&&(p=0),g.writeValue(h,k,"LEVEL_2",{type:"double",value:p},function(b){b?m&&m(b):g.writeValue(h,k,"LEVEL",{type:"double",
value:q},m)}))})}});break;case "lamellaTo":p=parseInt(p)/100;g.writeValue(h,k,"LEVEL_2",{type:"double",value:p},m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+b))}else m&&m(Error("command in null"))}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],
event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "PRESENCE_DETECTION_STATE":b={state:h?"on":"off"};break;case "ILLUMINATION":b={illumination:h};break;case "CURRENT_ILLUMINATION":b={current_illumination:h};break;case "PRESENCE_DETECTION_ACTIVE":b={active:h}}return b},executeCommand:function(g,h,b,k,m){if(k){var l=
n.call(this,k);if(l)switch(k){case "reset":g.writeValue(h,b,l,!0,m);break;case "activate":g.writeValue(h,b,l,!0,m);break;case "deactivate":g.writeValue(h,b,l,!1,m);break;case "toggleActivate":g.getState({interface:h,channel:b,datapoint:l},function(k,n){k?m&&m(k):n?(k=!0,n.value&&(k=!1),g.writeValue(h,b,l,k,m)):m&&m(Error("get switch current value return invalid"))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+k))}else m&&m(Error("command in null"))}},
CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "EMERGENCY_OPERATION":b={cl_fd_emergencyOP:h};break;
case "FROST_PROTECTION":b={cl_fd_frostProtection:h};break;case "STATE":b=1==h?{cl_fd_state:"on"}:0==h?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case "HUMIDITY_ALARM":b={cl_fd_humidityAlarm:h}}return b}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_fp_humidityLimiter"],event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},
{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "HUMIDITY_LIMITER":b={cl_fp_humidityLimiter:h};break;case "EMERGENCY_OPERATION":b={cl_fp_emergencyOP:h};break;case "FROST_PROTECTION":b={cl_fp_frostProtection:h};break;case "STATE":b=1==
h?{cl_fp_state:"on"}:0==h?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case "DEW_POINT_ALARM":b={cl_fp_dewPointAlarm:h};break;case "EXTERNAL_CLOCK":b={cl_fp_externalClock:h}}return b}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],
event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "HUMIDITY_LIMITER":b={cl_f_humidityLimiter:h};break;case "EMERGENCY_OPERATION":b={cl_f_emergencyOP:h};break;case "FROST_PROTECTION":b={cl_f_frostProtection:h};break;case "STATE":b=1==h?{cl_f_state:"on"}:0==h?{cl_f_state:"off"}:
{cl_f_state:"?"};break;case "DEW_POINT_ALARM":b={cl_f_dewPointAlarm:h};break;case "EXTERNAL_CLOCK":b={cl_f_externalClock:h}}return b}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},
{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",
state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "ACTUAL_TEMPERATURE":b={weatherActualTemp:h};break;case "HUMIDITY":b={weatherHum:h};break;case "ILLUMINATION":b={weatherIllu:h};break;case "SUNSHINEDURATION":b={weatherSunD:h};break;case "SUNSHINEDURATION_OVERFLOW":b={weatherSunDOF:h};break;case "SUNSHINE_THRESHOLD_OVERRUN":b={weatherSunTOR:h};break;case "WIND_SPEED":b={weatherWindS:h};break;case "WIND_THRESHOLD_OVERRUN":b=
{weatherWindTOR:h};break;case "RAINING":b={weatherRain:h};break;case "RAIN_COUNTER":b={weatherRainC:h};break;case "RAIN_COUNTER_OVERFLOW":b={weatherRainCOF:h};break;case "WIND_DIR":b={weatherWindD:h};break;case "WIND_DIR_RANGE":b={weatherWindDR:h}}return b}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "ACTUAL_TEMPERATURE":b=
{temperature:h};break;case "HUMIDITY":b={humidity:h}}return b}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:b,getDptFromState:k,
parseDptState:function(g,h){var b=null;switch(g){case "CURRENT_PASSAGE_DIRECTION":b={current_direction:h};break;case "LAST_PASSAGE_DIRECTION":b={last_direction:h};break;case "PASSAGE_COUNTER_OVERFLOW":b={passage_counter_overflow:h};break;case "PASSAGE_COUNTER_VALUE":b={passage_counter:h}}return b}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",
state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "CHANGE_OVER":b={genInputChangeOver:h};break;case "EXTERNAL_CLOCK":b={genInputExtClock:h};break;case "HUMIDITY_LIMITER":b=
{genInputHumidityLimiter:h};break;case "STATE":b=1==h?{genInputState:"on"}:0==h?{genInputState:"off"}:{genInputState:"?"};break;case "TACTILE_SWITCH":b={genInputTactileSwitch:h};break;case "TEMPERATURE_LIMITER":b={genInputTempLimiter:h}}return b}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "LEVEL":b=
{outputLevel:Math.round(100*parseFloat(h))}}return b},executeCommand:function(g,h,b,k,m){if(k){if("outputOff"==k.substr(0,9))var l="outputOff";else if("outputUp"==k.substr(0,8)){l="outputUp";var p=k.substr(8)}else if("outputDown"==k.substr(0,10))l="outputDown",p=k.substr(10);else if("outputTo"==k.substr(0,8)){if(l="outputTo",p=k.substr(8),!p){m&&m(Error("outputTo has no value"));return}}else if("toggleTo"==k.substr(0,8)){if(l="toggleTo",p=k.substr(8),!p){m&&m(Error("toggleTo has no value"));return}}else isNaN(parseInt(k))||
(l="outputTo",p=parseInt(k));var q=n.call(this,l);if(q)switch(l){case "outputOff":g.writeValue(h,b,q,{type:"double",value:0},m);break;case "outputUp":p||(p=10);p=parseInt(p)/100;g.getState({interface:h,channel:b,datapoint:q},function(k,l){k?m&&m(k):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(h,b,q,{type:"double",value:p},m))});break;case "outputDown":p||(p=10);p=parseInt(p)/100;g.getState({interface:h,channel:b,datapoint:q},
function(k,l){k?m&&m(k):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(h,b,q,{type:"double",value:p},m))});break;case "toggleTo":p=parseInt(p)/100;g.getState({interface:h,channel:b,datapoint:q},function(k,l){k?m&&m(k):l?(l.value&&(p=0),g.writeValue(h,b,q,{type:"double",value:p},m)):m&&m(Error("get switch current value return invalid"))});break;case "outputTo":p=parseInt(p)/100;g.writeValue(h,b,q,{type:"double",value:p},m);
break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+k))}else m&&m(Error("command in null"))}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],event:["water"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "ALARMSTATE":b={alarm:h};break;case "MOISTURE_DETECTED":b={moisture:h};
break;case "WATERLEVEL_DETECTED":b={water:h}}return b}},ACCELERATION_TRANSCEIVER:{map:[{dpt:"MOTION",state:["motion"],event:["motion"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "MOTION":b={motion:h}}return b}},DOOR_RECEIVER:{map:[{dpt:"DOOR_STATE",state:["doorState"],event:["doorState"]},{dpt:"DOOR_COMMAND",command:["open","close","partialOpen","stop"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,h){var b=null;switch(g){case "DOOR_STATE":h=
parseInt(h),b=0==h?{doorState:"closed"}:1==h?{doorState:"open"}:2==h?{doorState:"ventilation"}:{doorState:"unknown"}}return b},executeCommand:function(g,b,k,q,m){if(q){var h=n.call(this,q);if(h)switch(q){case "open":g.writeValue(b,k,h,{type:"double",value:1},m);break;case "stop":g.writeValue(b,k,h,{type:"double",value:2},m);break;case "close":g.writeValue(b,k,h,{type:"double",value:3},m);break;case "partialOpen":g.writeValue(b,k,h,{type:"double",value:4},m);break;default:m&&m(Error("no such command"))}else m&&
m(Error("can not find datapoint for command:"+q))}else m&&m(Error("command in null"))}},SIMPLE_SWITCH_RECEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"],command:["on","off","toggle"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){var h=null;switch(g){case "STATE":h=1==b?{state:"on"}:0==b?{state:"off"}:{state:"?"}}return h},executeCommand:function(g,b,k,q,m){var h=n.call(this,q);if(h)switch(q){case "on":g.writeValue(b,k,h,!0,m);break;case "off":g.writeValue(b,k,h,!1,m);
break;case "toggle":g.getState({interface:b,channel:k,datapoint:h},function(l,n){l?m&&m(l):n?(l=!0,n.value&&(l=!1),g.writeValue(b,k,h,l,m)):m&&m(Error("get switch current value return invalid"))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+q))}},MULTI_MODE_INPUT_TRANSMITTER:{map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,
b){var h=null;switch(g){case "STATE":h=1==b?{state:"on"}:0==b?{state:"off"}:{state:"?"};break;case "PRESS_SHORT":h={pressShort:!0};break;case "PRESS_LONG":h={pressLong:!0}}return h}},BRIGHTNESS_TRANSMITTER:{map:[{dpt:"AVERAGE_ILLUMINATION",state:["avgIllu"],event:["avgIllu"]},{dpt:"CURRENT_ILLUMINATION",state:["illu"],event:["illu"]},{dpt:"HIGHEST_ILLUMINATION",state:["maxIllu"],event:["maxIllu"]},{dpt:"LOWEST_ILLUMINATION",state:["minIllu"],event:["minIllu"]}],getReadableDpts:b,getDptFromState:k,
parseDptState:function(g,b){var h=null;switch(g){case "AVERAGE_ILLUMINATION":h={avgIllu:parseFloat(parseFloat(b).toFixed(2))};break;case "CURRENT_ILLUMINATION":h={illu:parseFloat(parseFloat(b).toFixed(2))};break;case "HIGHEST_ILLUMINATION":h={maxIllu:parseFloat(parseFloat(b).toFixed(2))};break;case "LOWEST_ILLUMINATION":h={minIllu:parseFloat(parseFloat(b).toFixed(2))}}return h}},POWER_MAINS_TRANSMITTER:{map:[{dpt:"POWER_MAINS_FAILURE",state:["powerMainsFailure"],event:["powerMainsFailure"]}],getReadableDpts:b,
getDptFromState:k,parseDptState:function(g,b){var h=null;switch(g){case "POWER_MAINS_FAILURE":h={powerMainsFailure:b}}return h}}},"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){switch(g){case "LOWBAT":return{lowbat:b};case "UNREACH":return{timeout:b};default:return null}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],
command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){switch(g){case "PRESS_SHORT":return{pressShort:b};case "PRESS_LONG":return{pressLong:b};case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}},executeCommand:function(g,b,k,q,m){var h=n.call(this,q);switch(q){case "pressShort":g.writeValue(b,
k,h,!0,m);break;case "pressLong":g.writeValue(b,k,h,!0,m);break;default:m&&m(Error("no such command"))}}},SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function(g,b){switch(g){case "PRESS":return{press:!0};default:return null}},executeCommand:function(g,b,k,q,m){var h=n.call(this,q);switch(q){case "press":g.writeValue(b,k,h,!0,m);break;default:m&&m(Error("no such command"))}}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],
event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){switch(g){case "STATE":return{state:b?"open":"closed"};case "ERROR":return{error:1==b?"sabotage":"no_error"};case "LOWBAT":return{lowbat:b};default:return null}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},
{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){var h=null;switch(g){case "LEVEL":b=Math.round(100*parseFloat(b));h={jalState:b};break;case "LEVEL_SLATS":b=Math.round(100*parseFloat(b)),h={jalLmlState:b}}return h},executeCommand:function(g,b,k,q,m){var h=n.call(this,q);switch(q){case "moveUp":g.writeValue(b,k,h,{type:"double",value:1},
m);break;case "moveDown":g.writeValue(b,k,h,{type:"double",value:0},m);break;case "stepUp":g.getState({interface:b,channel:k,datapoint:h},function(l,n){if(l)m&&m(l);else if(n){var p=n.value+.05;1<p&&(p=1);g.writeValue(b,k,h,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(b,k,h,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current jalousie state result invalid"))});break;case "stepDown":g.getState({interface:b,channel:k,datapoint:h},function(l,n){if(l)m&&m(l);else if(n){var p=
n.value-.05;0>p&&(p=0);g.writeValue(b,k,h,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(b,k,h,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "stop":g.writeValue(b,k,h,!0,m);break;case "lamellaUp":g.writeValue(b,k,h,{type:"double",value:1},m);break;case "lamellaDown":g.writeValue(b,k,h,{type:"double",value:0},m);break;case "lamellaStepUp":g.getState({interface:b,channel:k,datapoint:h},function(l,n){if(l)m&&m(l);else if(n){var p=
n.value+.05;1<p&&(p=1);g.writeValue(b,k,h,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(b,k,h,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current lamella state result invalid"))});break;case "lamellaStepDown":g.getState({interface:b,channel:k,datapoint:h},function(l,n){if(l)m&&m(l);else if(n){var p=n.value-.05;0>p&&(p=0);g.writeValue(b,k,h,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(b,k,h,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current lamella state result invalid"))});
break;default:if("lamellaTo"==q.substr(0,9)){q=q.substr(9);var l=parseInt(q);l/=100;h="LEVEL_SLATS";g.writeValue(b,k,h,{type:"double",value:l},function(n){n?m&&m(n):(g.updateStatusBuffer(b,k,h,l,(new Date).getTime()+1E3),m&&m())})}else"moveTo"==q.substr(0,6)||q.match(/^[-+]?[0-9]+$/)?("moveTo"==q.substr(0,6)&&(q=q.substr(6)),l=parseInt(q),l/=100,h="LEVEL",g.writeValue(b,k,h,{type:"double",value:l},function(n){n?m&&m(n):(g.updateStatusBuffer(b,k,h,l,(new Date).getTime()+1E3),m&&m())})):m&&m(Error("no such command"))}}},
MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){var h=null;switch(g){case "STATE":b=parseInt(b);h={state8bit:b};break;case "LOWBAT":h={lowbat:b}}return h}},KEYMATIC:{device:"keymatic",map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},
{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){switch(g){case "STATE":return{state:b?"open":"closed"};case "STATE_UNCERTAIN":return{uncertain:b};case "ERROR":switch(b){case 0:b="no_error";break;case 1:b="cluth_failure";break;case 2:b="motor_aborted"}return{error:b}}return null},executeCommand:function(g,b,k,q,m){var h=n.call(this,q);switch(q){case "open":g.writeValue(b,k,h,!0,m);break;case "close":g.writeValue(b,k,h,!1,m);break;case "openDoor":g.writeValue(b,
k,h,!0,m);break;default:m&&m(Error("no such command"))}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){var k={};switch(g){case "BRIGHTNESS":k.bri=b;break;case "MOTION":k.state=b?"motion":"ok";break;case "ERROR":k.error=b?"sabotage":"no_error";break;default:return null}return k}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",
map:[{dpt:"DIRECTION",state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){var k={};switch(g){case "DIRECTION":k.direction=
b;break;case "ERROR_OVERHEAT":k.error_overheat=b?!0:!1;break;case "ERROR_REDUCED":k.error_reduced=b?!0:!1;break;case "LEVEL":k.bri=Math.round(100*parseFloat(b));break;case "LEVEL_REAL":k.bri_real=Math.round(100*parseFloat(b));break;default:return null}return k},executeCommand:function(g,b,k,q,m){var h=n.call(this,q);switch(q){case "on":g.writeValue(b,k,h,!0,m);break;case "off":g.writeValue(b,k,h,{type:"double",value:0},m);break;case "dimUp":g.getState({interface:b,channel:k,datapoint:h},function(l,
n){if(l)m&&m(l);else if(n){var p=n.value+.05;1<p&&(p=1);g.writeValue(b,k,h,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(b,k,h,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current jalousie state result invalid"))});break;case "dimDown":g.getState({interface:b,channel:k,datapoint:h},function(l,n){if(l)m&&m(l);else if(n){var p=n.value-.05;0>p&&(p=0);g.writeValue(b,k,h,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(b,k,h,p,(new Date).getTime()+
1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "toggle":h="LEVEL";g.getState({interface:b,channel:k,datapoint:h},function(l,n){l?m&&m(l):n?0!=n.value?g.writeValue(b,k,h,{type:"double",value:0},m):g.writeValue(b,k,"OLD_LEVEL",!0,m):m&&m(Error("get current dimmer state result invalid"))});break;default:if("dimTo"==q.substr(0,5)){q=q.substr(5);var l=parseInt(q);l/=100;h="LEVEL";g.writeValue(b,k,h,{type:"double",value:l},function(n){n?m&&m(n):(g.updateStatusBuffer(b,
k,h,l,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("no such command"))}}},DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:b,getDptFromState:k,parseDptState:function(g,b){var k={};switch(g){case "DIRECTION":k.direction=
b;break;case "LEVEL":k.color=Math.round(100*parseFloat(b));break;case "LEVEL_REAL":k.color_real=Math.round(100*parseFloat(b));break;default:return null}return k},executeCommand:function(g,b,k,q,m){var h=n.call(this,q);switch(q){case "colorOn":g.writeValue(b,k,h,!0,m);break;case "colorOff":g.writeValue(b,k,h,{type:"double",value:0},m);break;case "colorUp":g.getState({interface:b,channel:k,datapoint:h},function(l,n){if(l)m&&m(l);else if(n){var p=n.value+.05;1<p&&(p=1);g.writeValue(b,k,h,{type:"double",
value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(b,k,h,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current jalousie state result invalid"))});break;case "colorDown":g.getState({interface:b,channel:k,datapoint:h},function(l,n){if(l)m&&m(l);else if(n){var p=n.value-.05;0>p&&(p=0);g.writeValue(b,k,h,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(b,k,h,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "colorToggle":h=
"LEVEL";g.getState({interface:b,channel:k,datapoint:h},function(l,n){l?m&&m(l):n?0!=n.value?g.writeValue(b,k,h,{type:"double",value:0},m):g.writeValue(b,k,"OLD_LEVEL",!0,m):m&&m(Error("get current dimmer state result invalid"))});break;default:if("colorTo"==q.substr(0,7)){q=q.substr(7);var l=parseInt(q);l/=100;h="LEVEL";g.writeValue(b,k,h,{type:"double",value:l},function(n){n?m&&m(n):(g.updateStatusBuffer(b,k,h,l,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("no such command"))}}}}}}();
x.hub.m.hm._Device=function(){var b=function(f,a,c){this.deviceType=f;this.deviceIF=a;this.deviceAdr=c;this.legacyType=null};b.prototype.initStates=function(f,a){var c=this._getReadableDpts();this._initDptStates(f,c,a)};b.prototype._getReadableDpts=function(){return[]};b.prototype._getDptFromRef=function(f){return null};b.prototype._initDptStates=function(f,a,c){if(a&&0!=a.length){var e=0,g=this,b=function(k,h){e++;e==a.length?c&&c():f.readValue(g.deviceIF,a[e].channel,a[e].dpt,b)};f.readValue(this.deviceIF,
a[e].channel,a[e].dpt,b)}else c&&c()};b.prototype.parseDptState=function(f,a,c){return null};b.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr};b.prototype.toLegacyType=function(){return this.legacyType};b.prototype.getSerial=function(){var f=this.deviceAdr,a=this.deviceAdr.indexOf(":");-1!=a&&(f=f.substr(0,a));return f};b.prototype.parseChnState=function(f,a){var c={},e;for(e in a){var g=this.parseDptState(f,e,a[e].value);if(g){var b={},k=a[e].time,h;
for(h in g)b[h]={value:g[h],time:k};c=x.hub.m.hm._Util.mergeObj(c,b)}}return c};b.prototype.parseStates=function(f){var a={},c;for(c in f){var e=this.parseChnState(c,f[c]);e&&(a=x.hub.m.hm._Util.mergeObj(a,e))}return a};b.prototype.executeCommand=function(f,a,c){c&&c()};b.prototype.getState=function(f,a,c){switch(a){case "timeout":var e={channel:0,dataPoint:"UNREACH"};break;default:e=this._getDptFromRef(a)}if(e){var g=this;f.getState({interface:this.deviceIF,channel:e.channel,datapoint:e.dataPoint},
function(f,b){f?c&&c(f):b?(f=g.parseDptState(e.channel,e.dataPoint,b.value))?c&&c(null,{value:f[a],time:b.time}):c&&c(null,null):c&&c(null,null)})}else c&&c(Error("no such state"))};b.prototype.isButton=function(){return!1};var k=function(f,a,c){b.call(this,f,a,c);this.channel=0;this.legacyType="maintenance"};util.inherits(k,b);k.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();c&&c.forEach(function(c){f.push({channel:a.deviceAdr+
":0",dpt:c})});return f};k.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};k.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var g=f.substr(0,e);f=f.substr(e+1);var b=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(b=this.deviceAdr.substr(0,e));if(g!=b||f!=this.channel)return null;
e={};"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c;return e};var n=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="button"};util.inherits(n,b);n.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};n.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=
0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};n.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var g=f.substr(0,e);f=f.substr(e+1);var b=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(b=this.deviceAdr.substr(0,e));if(g!=b||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "PRESS_SHORT":return{pressShort:c};
case "PRESS_LONG":return{pressLong:c};case "PRESS_CONT":return{pressCont:c};case "PRESS_LONG_RELEASE":return{pressLongRel:c};default:return null}};n.prototype.isButton=function(){return!0};n.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(g,b){g&&console.error("button claim PRESS_SHORT event error:"+g.stack);f.reportValueUsage(e.deviceIF,c,"PRESS_LONG",function(c,e){c&&
console.error("button claim PRESS_LONG event error:"+c.stack);a&&a()})})};var g=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="button"};util.inherits(g,b);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};g.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};g.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var g=f.substr(0,e);f=f.substr(e+1);var b=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(b=this.deviceAdr.substr(0,e));if(g!=b||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "PRESS_SHORT":return{pressShort:c};case "PRESS_LONG":return{pressLong:c};
case "PRESS_CONT":return{pressCont:c};case "PRESS_LONG_RELEASE":return{pressLongRel:c};default:return null}};g.prototype.isButton=function(){return!1};g.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(g,b){g&&console.error("button claim PRESS_SHORT event error:"+g.stack);f.reportValueUsage(e.deviceIF,c,"PRESS_LONG",function(c,e){c&&console.error("button claim PRESS_LONG event error:"+
c.stack);a&&a()})})};var h=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="switch"};util.inherits(h,b);h.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}]};h.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&
this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};h.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr;-1==e.indexOf(":")&&this.channel&&(e+=":"+this.channel);var g=this;switch(a){case "on":var b="STATE";
f.writeValue(this.deviceIF,e,b,!0,c);break;case "off":b="STATE";f.writeValue(this.deviceIF,e,b,!1,c);break;case "toggle":b="STATE";f.getState({interface:this.deviceIF,channel:e,datapoint:b},function(a,k){a?c&&c(a):k?(a=!0,k.value&&(a=!1),f.writeValue(g.deviceIF,e,b,a,c)):c&&c(Error("get switch current value return invalid"))});break;default:"onFor"==a.substr(0,5)?(a=parseFloat(a.substr(5)),isNaN(a)?c&&c(Error("onFor command invalid")):(b="ON_TIME",f.writeValue(this.deviceIF,e,b,{type:"double",value:a},
function(a){a?c&&c(a):(b="STATE",f.writeValue(g.deviceIF,e,b,!0,c))}))):c&&c(Error("no such command"))}};h.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;var k;switch(a){case "STATE":return 1==c?k="on":
0==c&&(k="off"),{state:k};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};default:return null}};h.prototype.getConfig=function(f,a){var c=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)a&&a(e);else{var b={},g=null;f&&(g={AES_ACTIVE:f.AES_ACTIVE});b[c]=g;a&&a(e,b)}})};h.prototype.setConfig=function(f,a,c){if(a){var e=this.deviceAdr+":"+this.channel;if(a=a[e]){var b={};b.AES_ACTIVE=a.AES_ACTIVE;f.setParamset(this.deviceIF,e,"MASTER",b,function(e){c&&
c(e)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};var l=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="dimmer"};util.inherits(l,b);l.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}]};l.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "levelReal":a.dataPoint="LEVEL_REAL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};l.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr+":"+this.channel,b=this,g=null;switch(a){case "on":var k="OLD_LEVEL";f.writeValue(this.deviceIF,e,k,!0,c);break;case "off":k="LEVEL";f.writeValue(this.deviceIF,
e,k,{type:"double",value:0},c);break;case "dimUp":k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(a,g){a?c&&c(a):g?(a=g.value+.05,1<a&&(a=1),f.writeValue(b.deviceIF,e,k,{type:"double",value:a},c)):c&&c(Error("get current dimmer state result invalid"))});break;case "dimDown":k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(a,g){a?c&&c(a):g?(a=g.value-.05,0>a&&(a=0),f.writeValue(b.deviceIF,e,k,{type:"double",value:a},c)):c&&c(Error("get current dimmer state result invalid"))});
break;case "toggle":k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(a,g){a?c&&c(a):g?0!=g.value?f.writeValue(b.deviceIF,e,k,{type:"double",value:0},c):f.writeValue(b.deviceIF,e,"OLD_LEVEL",!0,c):c&&c(Error("get current dimmer state result invalid"))});break;default:"toggleTo"==a.substr(0,8)?(g=parseInt(a.substr(8)),isNaN(g)?c&&c(Error("toggleTo command invalid")):(k="LEVEL",g/=100,f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(a,h){a?c&&c(a):h?(a=
g,h.value&&(a=0),f.writeValue(b.deviceIF,e,k,{type:"double",value:a},c)):c&&c(Error("get current dimmer state result invalid"))}))):"onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)?("onTo"==a.substr(0,4)&&(a=a.substr(4)),g=parseInt(a),g/=100,k="LEVEL",f.writeValue(this.deviceIF,e,k,{type:"double",value:g},c)):c&&c(Error("no such command"))}};l.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var g=f.substr(0,e);f=f.substr(e+1);var b=this.deviceAdr;e=this.deviceAdr.indexOf(":");
-1!=e&&(b=this.deviceAdr.substr(0,e));if(g!=b||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(c)),{state:a};case "LEVEL_REAL":return a=Math.round(100*parseFloat(c)),{levelReal:a};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};case "DIRECTION":return{direction:c};default:return null}};var q=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="blind"};
util.inherits(q,b);q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}]};q.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};q.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr+":"+this.channel,g=this,b=0;"stepUpFor"==a.substr(0,9)?((b=a.substr(9))||(b=1),b=parseFloat(b),a="stepUpFor"):"stepUp"==a.substr(0,6)?((b=a.substr(6))||(b=5),b=parseInt(b)/100,a="stepUp"):"stepDownFor"==a.substr(0,
11)?((b=a.substr(11))||(b=1),b=parseFloat(b),a="stepDownFor"):"stepDown"==a.substr(0,8)&&((b=a.substr(8))||(b=5),b=parseInt(b)/100,a="stepDown");switch(a){case "stepUp":var k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(a,h){if(a)c&&c(a);else if(h){b||(b=.05);var A=h.value+b;1<A&&(A=1);f.writeValue(g.deviceIF,e,k,{type:"double",value:A},function(a){a?c&&c(a):(f.updateStatusBuffer(g.deviceIF,e,k,A,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("get current blind state result invalid"))});
break;case "stepDown":k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(a,h){if(a)c&&c(a);else if(h){b||(b=.05);var A=h.value-b;0>A&&(A=0);f.writeValue(g.deviceIF,e,k,{type:"double",value:A},function(a){a?c&&c(a):(f.updateStatusBuffer(g.deviceIF,e,k,A,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("get current blind state result invalid"))});break;case "stepUpFor":k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:1},function(a){a?c&&c(a):setTimeout(function(){k=
"STOP";f.writeValue(g.deviceIF,e,k,!0,c)},1E3*b)});break;case "stepDownFor":k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:0},function(a){a?c&&c(a):setTimeout(function(){k="STOP";f.writeValue(g.deviceIF,e,k,!0,c)},1E3*b)});break;case "up":k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:1},c);break;case "down":k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:0},c);break;case "stop":k="STOP";f.writeValue(this.deviceIF,e,k,!0,c);break;default:if("moveTo"==a.substr(0,
6)||a.match(/^[-+]?[0-9]+$/)){"moveTo"==a.substr(0,6)&&(a=a.substr(6));var h=parseInt(a);h/=100;k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:h},function(a){a?c&&c(a):(f.updateStatusBuffer(g.deviceIF,e,k,h,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("no such command"))}};q.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(b!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(c)),{state:a};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};case "DIRECTION":return{direction:c};default:return null}};q.prototype.getConfig=function(f,a){var c=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)a&&a(e);else{var b={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,
REFERENCE_RUNNING_TIME_BOTTOM_TOP:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});b[c]=g;a&&a(e,b)}})};q.prototype.setConfig=function(f,a,c){if(a){var e=this.deviceAdr+":"+this.channel;if(a=a[e]){var b={};b.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};b.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP};b.REFERENCE_RUNNING_TIME_TOP_BOTTOM=
{__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM};b.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;f.setParamset(this.deviceIF,e,"MASTER",b,function(e){c&&c(e)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};var m=function(f,a,c){h.call(this,f,a,c);this.legacyType="powerswitch";this.powChannel=2};util.inherits(m,h);m.prototype._getReadableDpts=function(){var f=h.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.powChannel,
dpt:"BOOT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"});return f};m.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";
break;case "state":a.channel+=":1";a.dataPoint="STATE";break;case "inhibit":a.channel+=":1";a.dataPoint="INHIBIT";break;case "working":a.channel+=":1";a.dataPoint="WORKING";break;case "boot":a.channel+=":2";a.dataPoint="BOOT";break;case "energy_counter":a.channel+=":2";a.dataPoint="ENERGY_COUNTER";break;case "power":a.channel+=":2";a.dataPoint="POWER";break;case "current":a.channel+=":2";a.dataPoint="CURRENT";break;case "voltage":a.channel+=":2";a.dataPoint="VOLTAGE";break;case "frequency":a.channel+=
":2";a.dataPoint="FREQUENCY";break;default:return null}return a};m.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);e=f.substr(e+1);return b!=this.deviceAdr?null:0==e?(f={},"UNREACH"==a?f.timeout=c:f["0_"+a.toLowerCase()]=c,f):"1"==e?h.prototype.parseDptState.call(this,f,a,c):"2"==e?(f={},f[a.toLowerCase()]=c,f):null};m.prototype.getConfig=function(f,a){var c=this,e=null;h.prototype.getConfig.call(this,f,function(b,g){b?a&&a(b):(e=g,c._getCh2Config(f,
function(c,f){if(c)a&&a(c);else{for(var b in f)f.hasOwnProperty(b)&&(e[b]=f[b]);a&&a(null,e)}}))})};m.prototype.setConfig=function(f,a,c){if(a){var e=Object.keys(a);if(e&&0!=e.length){var b=this;async.eachSeries(e,function(c,e){var g=c.indexOf(":");-1==g&&e(Error("channel address is null"));g=c.substr(g+1);1==g?h.prototype.setConfig.call(b,f,a,e):2==g?b._setCh2Config(f,a[c],e):e(Error("unknow channel:"+g))},function(e){c&&c(e)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};
m.prototype._getCh2Config=function(f,a){var c=this.deviceAdr+":2";f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)a&&a(e);else{var b={},g=null;f&&(g={AES_ACTIVE:f.AES_ACTIVE});b[c]=g;a&&a(e,b)}})};m.prototype._setCh2Config=function(f,a,c){if(a){var e=this.deviceAdr+":2",b={};b.AES_ACTIVE=a.AES_ACTIVE;f.setParamset(this.deviceIF,e,"MASTER",b,function(e){c&&c(e)})}else c&&c(Error("config data invalid"))};var r=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="weather"};util.inherits(r,
b);r.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}]};r.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;case "hum":a.dataPoint="HUMIDITY";break;default:return null}return a};r.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "TEMPERATURE":return a=parseFloat(c),{temp:a};case "HUMIDITY":return a=
parseInt(c),{hum:a};default:return null}};var p=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="weather2"};util.inherits(p,r);p.prototype._getReadableDpts=function(){var f=r.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"});return f};p.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "air":a.dataPoint="AIR_PRESSURE";break;default:return r.prototype._getDptFromRef.call(this,
f)}return a};p.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e),g=f.substr(e+1),k=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(k=this.deviceAdr.substr(0,e));if(b!=k||0!=g&&g!=this.channel)return null;if(0==g)return f={},"UNREACH"==a?f.timeout=c:"LOWBAT"==a?f.lowbat=c:f["0_"+a.toLowerCase()]=c,f;f=r.prototype.parseDptState.call(this,f,a,c);switch(a){case "AIR_PRESSURE":f||(f={}),f.air=parseInt(c)}return f};var v=function(f,a,c){b.call(this,
f,a,c);this.channel=1;this.legacyType="weatherstation"};util.inherits(v,b);v.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},
{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}]};v.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint=
"TEMPERATURE";break;case "hum":a.dataPoint="HUMIDITY";break;case "rain":a.dataPoint="RAINING";break;case "rainC":a.dataPoint="RAIN_COUNTER";break;case "windS":a.dataPoint="WIND_SPEED";break;case "windD":a.dataPoint="WIND_DIRECTION";break;case "windDR":a.dataPoint="WIND_DIRECTION_RANGE";break;case "sunD":a.dataPoint="SUNSHINEDURATION";break;case "bri":a.dataPoint="BRIGHTNESS";break;default:return null}return a};v.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=
f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "TEMPERATURE":e.temp=parseFloat(c);break;case "HUMIDITY":e.hum=parseInt(c);break;case "RAINING":e.rain=c;break;case "RAIN_COUNTER":e.rainC=parseFloat(c);break;case "WIND_SPEED":e.windS=parseFloat(c);break;case "WIND_DIRECTION":e.windD=
c;break;case "WIND_DIRECTION_RANGE":e.windDR=c;break;case "SUNSHINEDURATION":e.sunD=c;break;case "BRIGHTNESS":e.bri=c;break;default:return null}return e};var w=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="heater"};util.inherits(w,b);w.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"});return f};w.prototype._getDptFromRef=
function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "error":a.dataPoint="ERROR";break;case "state":a.dataPoint="VALVE_STATE";break;default:return null}return a};w.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e={};if(0==f)return"UNREACH"==
a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;if(f==this.channel){switch(a){case "ERROR":switch(c){case 0:e.error="no_error";break;case 1:e.error="VALVE_DRIVE_BLOCKED";break;case 2:e.error="VALVE_DRIVE_LOOSE";break;case 3:e.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:e.error="lowbat"}break;case "VALVE_STATE":e.state=c}return e}return null};var u=function(f,a,c){b.call(this,f,a,c);this.channel=4;this.legacyType="thermostat"};util.inherits(u,b);u.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"});return f};u.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "mode":a.dataPoint="CONTROL_MODE";break;case "error":a.dataPoint="FAULT_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "valveLvl":a.dataPoint="VALVE_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";break;case "act_temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};u.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr+":"+this.channel,b=this;switch(a){case "setAuto":var g=
"AUTO_MODE";f.writeValue(this.deviceIF,e,g,!0,function(a){a||f.updateStatusBuffer(b.deviceIF,e,"CONTROL_MODE",0);c&&c(a)});break;case "setManu":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,k){a?c&&c(a):(g="MANU_MODE",f.writeValue(b.deviceIF,e,g,{type:"double",value:k.value},function(a){a||f.updateStatusBuffer(b.deviceIF,e,"CONTROL_MODE",1);c&&c(a)}))});break;case "setBoost":g="BOOST_MODE";f.writeValue(this.deviceIF,e,g,!0,function(a){a||f.updateStatusBuffer(b.deviceIF,
e,"CONTROL_MODE",3);c&&c(a)});break;case "tempUp":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,k){a?c&&c(a):k?(a=k.value+.5,30.5<a&&(a=30.5),f.writeValue(b.deviceIF,e,g,{type:"double",value:a},c)):c&&c(Error("get current temp state result invalid"))});break;case "tempDown":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,k){a?c&&c(a):k?(a=k.value-.5,4.5>a&&(a=4.5),f.writeValue(b.deviceIF,e,g,{type:"double",value:a},
c)):c&&c(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),g="SET_TEMPERATURE",f.writeValue(this.deviceIF,e,g,{type:"double",value:a},c)):c&&c(Error("no such command"))}};u.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(b!=g)return null;e={};if(0==f)return e["0_"+a.toLowerCase()]=c,e;if(f==this.channel){switch(a){case "CONTROL_MODE":switch(c){case 0:e.mode="auto";break;case 1:e.mode="manu";break;case 2:e.mode="party";break;case 3:e.mode="boost"}break;case "FAULT_REPORTING":switch(c){case 0:e.error="no_error";break;case 1:e.error="valve_tight";break;case 2:e.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:e.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:e.error="comm_error";break;case 5:e.error="";break;case 6:e.error=
"lowbat";break;case 7:e.error="VALVE_ERROR_POSITION"}break;case "BATTERY_STATE":e.batLvl=c;break;case "VALVE_STATE":e.valveLvl=c;break;case "BOOST_STATE":e.boostTime=c;break;case "ACTUAL_TEMPERATURE":e.act_temp=c;break;case "SET_TEMPERATURE":e.state=c;break;default:return null}return e}return null};var na=function(f,a,c){b.call(this,f,a,c);this.channel=4;this.legacyType="thermostat"};util.inherits(na,u);na.prototype._getReadableDpts=function(){var f=u.prototype._getReadableDpts.callback(this);f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"WINDOW_STATE"});return f};na.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "window":a.dataPoint="WINDOW_STATE";break;default:return u.prototype._getDptFromRef.call(this,f)}return a};na.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e),g=f.substr(e+1),k=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(k=this.deviceAdr.substr(0,e));if(b!=k)return null;e=
{};if(0==g)return e["0_"+a.toLowerCase()]=c,e;if(g==this.channel)switch(a){case "WINDOW_STATE":return e.window=c?"closed":"open",e;default:return u.prototype.parseDptState.call(this,f,a,c)}else return null};var R=function(f,a,c){b.call(this,f,a,c);this.weatherChannel=1;this.thermoChannel=2;this.legacyType="wallthermo"};util.inherits(R,b);R.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"});f.push({channel:this.deviceAdr+
":"+this.weatherChannel,dpt:"TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_DATA"});return f};R.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a,dataPoint:null};switch(f){case "timeout":c.channel=a+":0";c.dataPoint="UNREACH";
break;case "lowbat":c.channel=a+":0";c.dataPoint="LOWBAT";break;case "temp":c.channel=a+":1";c.dataPoint="TEMPERATURE";break;case "hum":c.channel=a+":1";c.dataPoint="HUMIDITY";break;case "state":c.channel=a+":2";c.dataPoint="SETPOINT";break;case "adjusting_command":c.channel=a+":2";c.dataPoint="ADJUSTING_COMMAND";break;case "adjusting_data":c.channel=a+":2";c.dataPoint="ADJUSTING_DATA";break;default:return null}return c};R.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr+":"+this.thermoChannel;
switch(a){case "tempUp":var b="SETPOINT";f.getState({interface:this.deviceIF,channel:e,datapoint:b},function(a,g){a?c&&c(a):g?(a=g.value+.5,30<a&&(a=30),f.writeValue(self.deviceIF,e,b,{type:"double",value:a},c)):c&&c(Error("get current temp state result invalid"))});break;case "tempDown":b="SETPOINT";f.getState({interface:this.deviceIF,channel:e,datapoint:b},function(a,g){a?c&&c(a):g?(a=g.value-.5,6>a&&(a=6),f.writeValue(self.deviceIF,e,b,{type:"double",value:a},c)):c&&c(Error("get current temp state result invalid"))});
break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),b="SETPOINT",f.writeValue(this.deviceIF,e,b,{type:"double",value:a},c)):c&&c(Error("no such command"))}};R.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);if(b!=this.deviceAdr)return null;b={};if(0==f)return"UNREACH"==a?b.timeout=c:"LOWBAT"==a?b.lowbat=c:b["0_"+a.toLowerCase()]=c,b;if("1"==f){switch(a){case "TEMPERATURE":b.temp=
c;break;case "HUMIDITY":b.hum=c}return b}if("2"==f){switch(a){case "SETPOINT":b.state=c;break;case "ADJUSTING_COMMAND":b.adjusting_command=c;break;case "ADJUSTING_DATA":b.adjusting_data=c}return b}return null};var S=function(f,a,c){b.call(this,f,a,c);this.thermoChannel=2;this.legacyType="wallthermostat"};util.inherits(S,b);S.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,
dpt:"LOWBAT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"});
f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"});return f};S.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(f){case "mode":a.dataPoint="CONTROL_MODE";break;case "lowbat":a.dataPoint="LOWBAT_REPORTING";break;case "comm":a.dataPoint="COMMUNICATION_REPORTING";break;case "window":a.dataPoint="WINDOW_OPEN_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";
break;case "temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "hum":a.dataPoint="ACTUAL_HUMIDITY";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};S.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr+":"+this.thermoChannel,b=this;switch(a){case "setAuto":var g="AUTO_MODE";f.writeValue(this.deviceIF,e,g,!0,function(a){a||f.updateStatusBuffer(b.deviceIF,e,"CONTROL_MODE",0);c&&c(a)});break;case "setManu":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,
channel:e,datapoint:g},function(a,k){a?c&&c(a):(g="MANU_MODE",f.writeValue(b.deviceIF,e,g,{type:"double",value:k.value},function(a){a||f.updateStatusBuffer(b.deviceIF,e,"CONTROL_MODE",1);c&&c(a)}))});break;case "setBoost":g="BOOST_MODE";f.writeValue(this.deviceIF,e,g,!0,function(a){a||f.updateStatusBuffer(b.deviceIF,e,"CONTROL_MODE",3);c&&c(a)});break;case "tempUp":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,k){a?c&&c(a):k?(a=k.value+.5,30.5<a&&(a=30.5),
f.writeValue(b.deviceIF,e,g,{type:"double",value:a},c)):c&&c(Error("get current temp state result invalid"))});break;case "tempDown":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,k){a?c&&c(a):k?(a=k.value-.5,4.5>a&&(a=4.5),f.writeValue(b.deviceIF,e,g,{type:"double",value:a},c)):c&&c(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),
g="SET_TEMPERATURE",f.writeValue(this.deviceIF,e,g,{type:"double",value:a},c)):"setWeekProfile"==a.substr(0,14)?(a=parseInt(a.substr(14)),f.setParamset(this.deviceIF,this.deviceAdr,"MASTER",{WEEK_PROGRAM_POINTER:a-1},function(a){c&&c(a)})):c&&c(Error("no such command"))}};S.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);if(b!=this.deviceAdr)return null;b={};if(0==f)return b["0_"+a.toLowerCase()]=c,b;if("2"==f){switch(a){case "CONTROL_MODE":switch(c){case 0:b.mode=
"auto";break;case 1:b.mode="manu";break;case 2:b.mode="party";break;case 3:b.mode="boost"}break;case "LOWBAT_REPORTING":b.lowbat=c;break;case "COMMUNICATION_REPORTING":b.comm=c;break;case "WINDOW_OPEN_REPORTING":b.window=c;break;case "BATTERY_STATE":b.batLvl=c;break;case "BOOST_STATE":b.boostTime=c;break;case "ACTUAL_TEMPERATURE":b.temp=c;break;case "ACTUAL_HUMIDITY":b.hum=c;break;case "SET_TEMPERATURE":b.state=c}return b}return null};var oa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType=
"contact"};util.inherits(oa,b);oa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};oa.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};oa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "STATE":return{state:c?"open":"closed"};
case "ERROR":return{error:1==c?"sabotage":"no_error"};case "LOWBAT":return{lowbat:c};default:return null}};var T=function(f,a,c){b.call(this,f,a,c);this.rainChannel=1;this.heatChannel=2;this.legacyType="rain"};util.inherits(T,b);T.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+
":"+this.heatChannel,dpt:"WORKING"}]};T.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a,dataPoint:null};switch(f){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "rain":c.channel=a+":"+this.rainChannel;c.dataPoint="STATE";break;case "heat":c.channel=a+":"+this.heatChannel;c.dataPoint="STATE";break;case "inhibit":c.channel=a+":"+this.heatChannel;c.dataPoint="INHIBIT";break;case "working":c.channel=a+":"+this.heatChannel;c.dataPoint="WORKING";break;default:return null}return c};
T.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr;-1==e.indexOf(":")&&this.heatChannel&&(e+=":"+this.heatChannel);var b=this;switch(a){case "heaterOn":var g="STATE";f.writeValue(this.deviceIF,e,g,!0,c);break;case "heaterOff":g="STATE";f.writeValue(this.deviceIF,e,g,!1,c);break;case "heaterToggle":g="STATE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,k){a?c&&c(a):k?(a=!0,k.value&&(a=!1),f.writeValue(b.deviceIF,e,g,a,c)):c&&c(Error("get switch current value return invalid"))});
break;default:c&&c(Error("no such command"))}};T.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;if(1==f){switch(a){case "STATE":e.rain=1==c?"rain":"dry";break;default:return null}return e}if(2==f){switch(a){case "STATE":e.heat=c?"on":"off";break;case "INHIBIT":e.inhibit=
c;break;case "WORKING":e.working=c;break;default:return null}return e}};var D=function(f,a,c){b.call(this,f,a,c);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong2"};util.inherits(D,b);D.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,
dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}]};D.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a,dataPoint:null};switch(f){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "led":c.channel=a+":"+this.ledChannel;c.dataPoint="STATE";break;case "led_inhibit":c.channel=a+":"+this.ledChannel;c.dataPoint="INHIBIT";break;case "led_working":c.channel=a+":"+this.ledChannel;c.dataPoint=
"WORKING";break;case "chime":c.channel=a+":"+this.chimeChannel;c.dataPoint="STATE";break;case "chime_inhibit":c.channel=a+":"+this.chimeChannel;c.dataPoint="INHIBIT";break;case "chime_working":c.channel=a+":"+this.chimeChannel;c.dataPoint="WORKING";break;default:return null}return c};D.prototype.executeCommand=function(f,a,c){switch(a){case "ledOn":a=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,a,"STATE",!0,c);break;case "ledOff":a=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,
a,"STATE",!1,c);break;case "chimeOn":a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"STATE",!0,c);break;case "chimeOff":a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"STATE",!1,c);break;default:c&&c(Error("no such command"))}};D.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=
{};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;if(1==f){switch(a){case "STATE":e.led=c?"on":"off";break;case "INHIBIT":e.led_inhibit=c;break;case "WORKING":e.led_working=c;break;default:return null}return e}if(2==f){switch(a){case "STATE":e.chime=c?"on":"off";break;case "INHIBIT":e.chime_inhibit=c;break;case "WORKING":e.chime_working=c;break;default:return null}return e}};var Ma=function(f,a,c){b.call(this,f,a,c);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong"};
util.inherits(Ma,D);Ma.prototype.executeCommand=function(f,a,c){if(0==a.indexOf("vChannel")){var e=a.substr(8);e=parseInt(e);a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"SUBMIT","0.8,1,5,"+e,c)}else if(0==a.indexOf("setChime")){var b=a.substr(8);parseInt(e);a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"SUBMIT",b,c)}else 0==a.indexOf("ledGreen")?((e=a.substr(8))||(e=10),a=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+
e+",34",c)):0==a.indexOf("ledRed")?((e=a.substr(6))||(e=10),a=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+e+",18",c)):D.prototype.executeCommand.call(this,f,a,c)};var pa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="window"};util.inherits(pa,b);pa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},
{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};pa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};pa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=
this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "STATE":switch(c){case 0:e.state="closed";break;case 1:e.state="tilted";break;case 2:e.state="open"}break;case "ERROR":switch(c){case 0:e.error="no_error";break;case 1:case 7:e.error="sabotage"}break;case "LOWBAT":e.lowbat=c;break;default:return null}return e};var qa=function(f,a,c){b.call(this,f,a,c);this.channel=
1;this.legacyType="temp"};util.inherits(qa,b);qa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}]};qa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;default:return null}return a};qa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "TEMPERATURE":return{temp:parseFloat(c)};default:return null}};var ra=function(f,a,c){b.call(this,f,a,
c);this.temp1=1;this.temp2=2;this.tempDiff12=3;this.tempDiff21=4;this.legacyType="temp2"};util.inherits(ra,b);ra.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}]};ra.prototype._getDptFromRef=
function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "lowbat":a.channel=this.temp1;a.dataPoint="LOWBAT";break;case "temp1":a.channel=this.temp1;a.dataPoint="TEMPERATURE";break;case "temp2":a.channel=this.temp2;a.dataPoint="TEMPERATURE";break;case "tempDiff12":a.channel=this.tempDiff12;a.dataPoint="TEMPERATURE";break;case "tempDiff21":a.channel=this.tempDiff21;a.dataPoint="TEMPERATURE";break;default:return null}return a};
ra.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "LOWBAT":return{lowbat:c};case "TEMPERATURE":return 1==f?{temp1:parseFloat(c)}:2==f?{temp2:parseFloat(c)}:3==f?{tempDiff12:parseFloat(c)}:4==f?{tempDiff21:parseFloat(c)}:null;default:return null}};
var sa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="co2"};util.inherits(sa,b);sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};sa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};sa.prototype.parseDptState=
function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "STATE":switch(c){case 0:e.state="normal";break;case 1:e.state="medium";break;case 2:e.state="high"}break;default:return null}return e};var ta=function(f,a,c){b.call(this,f,a,c);this.channel=
1;this.legacyType="motion"};util.inherits(ta,b);ta.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};ta.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "bri":a.dataPoint="BRIGHTNESS";break;case "state":a.dataPoint="MOTION";break;case "error":a.dataPoint="ERROR";break;default:return null}return a};ta.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==
a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "BRIGHTNESS":e.bri=c;break;case "MOTION":e.state=c?"motion":"ok";break;case "ERROR":e.error=c?"sabotage":"no_error";break;default:return null}return e};var ua=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="smoke"};util.inherits(ua,b);ua.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,
dpt:"STATE"}]};ua.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};ua.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "STATE":e.state=c?"smoke":"ok";break;default:return null}return e};var U=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="siren"};util.inherits(U,b);U.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,
dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};U.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error_power":a.dataPoint="ERROR_POWER";break;case "error_sabotage":a.dataPoint="ERROR_SABOTAGE";break;case "error_battery":a.dataPoint="ERROR_BATTERY";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};U.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr+":"+this.channel,b=this;switch(a){case "on":var g="STATE";f.writeValue(this.deviceIF,e,g,!0,c);break;case "off":g="STATE";f.writeValue(this.deviceIF,
e,g,!1,c);break;case "toggle":g="STATE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,k){a?c&&c(a):(a=!0,k.value&&(a=!1),f.writeValue(b.deviceIF,e,g,a,c))});break;default:c&&c(Error("no such command"))}};U.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==
a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "STATE":e.state=c?"on":"off";break;case "ERROR_POWER":e.error_power=c?"power_failure":"no_error";break;case "ERROR_SABOTAGE":e.error_sabotage=c?"sabotage":"no_error";break;case "ERROR_BATTERY":e.error_battery=c?"battery_defect":"no_error";break;case "INHIBIT":e.inhibit=c;break;case "WORKING":e.working=c;break;default:return null}return e};var va=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="capacity"};util.inherits(va,b);
va.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"FILLING_LEVEL"}]};va.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="FILLING_LEVEL";break;default:return null}return a};va.prototype.parseDptState=
function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "FILLING_LEVEL":e.state=c;break;default:return null}return e};var L=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="switch_interface"};util.inherits(L,
b);L.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};L.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};L.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==
e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "PRESS":return{press:c};default:return null}};L.prototype.isButton=function(){return!0};L.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);f.reportValueUsage(this.deviceIF,
c,"PRESS",function(c,f){c&&console.error("switch interface claim PRESS event error:"+c.stack);a&&a()})};var wa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="tilt"};util.inherits(wa,b);wa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};wa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};wa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "STATE":e.state=
c?"open":"closed";break;case "LOWBAT":e.lowbat=c;break;default:return null}return e};var xa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="water"};util.inherits(xa,b);xa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};xa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};xa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "STATE":switch(c){case 0:e.state=
"ok";break;case 1:e.state="moist";break;case 2:e.state="water"}break;case "LOWBAT":e.lowbat=c;break;default:return null}return e};var ya=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="energymeter"};util.inherits(ya,b);ya.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+
":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"POWER"}]};ya.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "boot":a.dataPoint="BOOT";break;case "gas_energy":a.dataPoint="GAS_ENERGY_COUNTER";break;case "gas_power":a.dataPoint="GAS_POWER";
break;case "energy":a.dataPoint="ENERGY_COUNTER";break;case "power":a.dataPoint="POWER";break;default:return null}return a};ya.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "BOOT":e.boot=
c;break;case "GAS_ENERGY_COUNTER":e.gas_energy=c;break;case "GAS_POWER":e.gas_power=c;break;case "ENERGY_COUNTER":e.energy=c;break;case "POWER":e.power=c;break;default:return null}return e};var M=function(f,a,c){b.call(this,f,a,c);this.dimChannel=1;this.rgbChannel=2;this.autoChannel=3;this.legacyType="rgb"};util.inherits(M,b);M.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+
this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}]};M.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a,dataPoint:null};switch(f){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.channel=a+":"+this.dimChannel;c.dataPoint="LEVEL";break;case "color":c.channel=a+":"+this.rgbChannel;c.dataPoint="COLOR";break;case "program":c.channel=a+":"+this.autoChannel;c.dataPoint="PROGRAM";break;case "inhibit":c.channel=a+":"+this.dimChannel;
c.dataPoint="INHIBIT";break;case "working":c.channel=a+":"+this.dimChannel;c.dataPoint="WORKING";break;case "direction":c.channel=a+":"+this.dimChannel;c.dataPoint="DIRECTION";break;default:return null}return c};M.prototype.executeCommand=function(f,a,c){var e=this;switch(a){case "on":var b=this.deviceAdr+":"+this.dimChannel;var g="OLD_LEVEL";f.writeValue(this.deviceIF,b,g,!0,c);break;case "off":b=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.writeValue(this.deviceIF,b,g,{type:"double",value:0},
c);break;case "white":b=this.deviceAdr+":"+this.rgbChannel;g="COLOR";f.writeValue(this.deviceIF,b,g,200,c);break;case "dimUp":b=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.getState({interface:this.deviceIF,channel:b,datapoint:g},function(a,k){a?c&&c(a):k?(a=k.value+.05,1<a&&(a=1),f.writeValue(e.deviceIF,b,g,{type:"double",value:a},c)):c&&c(Error("get current dimmer state result invalid"))});break;case "dimDown":b=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.getState({interface:this.deviceIF,
channel:b,datapoint:g},function(a,k){a?c&&c(a):k?(a=k.value-.05,0>a&&(a=0),f.writeValue(e.deviceIF,b,g,{type:"double",value:a},c)):c&&c(Error("get current dimmer state result invalid"))});break;default:if("onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)){"onTo"==a.substr(0,4)&&(a=a.substr(4));var k=parseInt(a);b=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.writeValue(this.deviceIF,b,g,{type:"double",value:k/100},c)}else if("setProg"==a.substr(0,7))a=a.substr(7),k=parseInt(a),b=this.deviceAdr+":"+
this.autoChannel,g="PROGRAM",f.writeValue(this.deviceIF,b,g,k,c);else if("setRampTime"==a.substr(0,11))a=a.substr(11),k=parseFloat(a),b=this.deviceAdr+":"+this.dimChannel,g="RAMP_TIME",f.writeValue(this.deviceIF,b,g,{type:"double",value:k},c);else if(a.toLowerCase().match(/^([0-9a-f]{6})$/i)){k=parseInt(a.substr(0,2),16);var h=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);var l=0;k=this._RGBToHSV(k,h,a);l=.1>k[1]?200:Math.round(k[0]/1.8);b=this.deviceAdr+":"+this.rgbChannel;g="COLOR";f.writeValue(this.deviceIF,
b,g,l,c)}else c&&c(Error("no such command"))}};M.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.dimChannel&&f!=this.rgbChannel&&f!=this.autoChannel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "LEVEL":e.state=100*parseFloat(c);break;case "COLOR":e.color=c;break;case "PROGRAM":e.program=
c;break;case "INHIBIT":e.inhibit=c;break;case "WORKING":e.working=c;break;case "DIRECTION":e.direction=c;break;default:return null}return e};M.prototype._RGBToHSV=function(f,a,c){f/=255;a/=255;c/=255;var e=Math.min(f,Math.min(a,c)),b=Math.max(f,Math.max(a,c));return e==b?[0,0,e]:[60*((f==e?3:c==e?1:5)-(f==e?a-c:c==e?f-a:c-f)/(b-e)),(b-e)/b,b]};var za=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="lux"};util.inherits(za,b);za.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}]};za.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LUX";break;default:return null}return a};za.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,
e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "LUX":e.state=c;break;default:return null}return e};var V=function(f,a,c){b.call(this,f,a,c);this.swChannel1=1;this.swChannel2=2;this.panicChannel=3;this.armingChannel=4;this.legacyType="siren2"};util.inherits(V,b);V.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+
":"+this.armingChannel,dpt:"LOWBAT"}]};V.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a,dataPoint:null};switch(f){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "switchSensorInState":c.channel=a+":"+this.swChannel1;c.dataPoint="STATE";break;case "switchSensorExState":c.channel=a+":"+this.swChannel2;c.dataPoint="STATE";break;case "switchPanicState":c.channel=a+":"+this.panicChannel;c.dataPoint="STATE";break;case "arming":c.channel=a+":"+this.armingChannel;c.dataPoint=
"ARMSTATE";break;case "inhibit":c.channel=a+":"+this.armingChannel;c.dataPoint="INHIBIT";break;case "working":c.channel=a+":"+this.armingChannel;c.dataPoint="WORKING";break;case "sabotage":c.channel=a+":"+this.armingChannel;c.dataPoint="ERROR_SABOTAGE";break;case "lowbat":c.channel=a+":"+this.armingChannel;c.dataPoint="LOWBAT";break;default:return null}return c};V.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;
e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=c:e["0_"+a.toLowerCase()]=c,e;if(1==f){switch(a){case "STATE":e.switchSensorInState=c?"on":"off";break;default:return null}return e}if(2==f){switch(a){case "STATE":e.switchSensorExState=c?"on":"off";break;default:return null}return e}if(3==f){switch(a){case "STATE":e.switchPanicState=c?"on":"off";break;default:return null}return e}if(4==f){switch(a){case "ARMSTATE":switch(c){case 0:e.arming=
"disarmed";break;case 1:e.arming="ex_armed";break;case 2:e.arming="all_armed";break;case 3:e.arming="blocked"}break;case "INHIBIT":e.inhibit=c;break;case "WORKING":e.working=c;break;case "ERROR_SABOTAGE":switch(c){case 0:e.sabotage="no_error";break;case 1:e.sabotage="ex_armed"}break;case "LOWBAT":e.lowbat=c;break;default:return null}return e}};V.prototype.executeCommand=function(f,a,c){var e=this;switch(a){case "switchSensorInOn":var b="STATE";var g=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,
g,b,!0,c);break;case "switchSensorInOff":b="STATE";g=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,g,b,!1,c);break;case "switchSensorInToggle":b="STATE";g=this.deviceAdr+":"+this.swChannel1;f.getState({interface:this.deviceIF,channel:g,datapoint:b},function(a,k){a?c&&c(a):(a=!0,k.value&&(a=!1),f.writeValue(e.deviceIF,g,b,a,c))});break;case "switchSensorExOn":b="STATE";g=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,g,b,!0,c);break;case "switchSensorExOff":b="STATE";
g=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,g,b,!1,c);break;case "switchSensorExToggle":b="STATE";g=this.deviceAdr+":"+this.swChannel2;f.getState({interface:this.deviceIF,channel:g,datapoint:b},function(a,k){a?c&&c(a):(a=!0,k.value&&(a=!1),f.writeValue(e.deviceIF,g,b,a,c))});break;case "switchPanicOn":b="STATE";g=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,g,b,!0,c);break;case "switchPanicOff":b="STATE";g=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,
g,b,!1,c);break;case "switchPanicToggle":b="STATE";g=this.deviceAdr+":"+this.panicChannel;f.getState({interface:this.deviceIF,channel:g,datapoint:b},function(a,k){a?c&&c(a):(a=!0,k.value&&(a=!1),f.writeValue(e.deviceIF,g,b,a,c))});break;case "armingDisarm":b="ARMSTATE";g=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,g,b,0,c);break;case "armingIntern":b="ARMSTATE";g=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,g,b,1,c);break;case "armingAll":b="ARMSTATE";g=this.deviceAdr+
":"+this.armingChannel;f.writeValue(this.deviceIF,g,b,2,c);break;default:c&&c(Error("no such command"))}};var W=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="jalousie"};util.inherits(W,b);W.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});(c=c.JALOUSIE.getReadableDpts())&&c.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});return f};W.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint="UNREACH";break;default:if(c.channel=a+":"+this.channel,c.dataPoint=e.JALOUSIE.getDptFromState(f),!c.dataPoint)return null}return c};W.prototype.executeCommand=function(f,a,c){x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,c)};W.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==
e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a)return{timeout:c};e={};e["0_"+a.toLowerCase()]=c;return e}return f==this.channel?e.JALOUSIE.parseDptState(a,c):null};var E=function(f,a,c){b.call(this,f,a,c);this.keyChannel1=1;this.keyChannel2=2;this.em8bitChannel=3;this.legacyType="mod_em_8bit"};util.inherits(E,b);E.prototype._getReadableDpts=
function(){var f=[],a=this,c=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var e=c.KEY.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c});f.push({channel:a.deviceAdr+":2",dpt:c})});(e=c.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});return f};E.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null};switch(f){case "timeout":c.channel=
a+":0";c.dataPoint="UNREACH";break;case "lowbat":c.channel=a+":3";c.dataPoint="LOWBAT";break;case "state8bit":c.channel=a+":3";c.dataPoint="STATE";break;default:return null}return c};E.prototype.executeCommand=function(f,a,c){var e=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "ch1pressShort":a=this.deviceAdr+":"+this.keyChannel1;e.KEY.executeCommand(f,this.deviceIF,a,"pressShort",c);break;case "ch1pressLong":a=this.deviceAdr+":"+this.keyChannel1;e.KEY.executeCommand(f,this.deviceIF,a,"pressLong",
c);break;case "ch2pressShort":a=this.deviceAdr+":"+this.keyChannel2;e.KEY.executeCommand(f,this.deviceIF,a,"pressShort",c);break;case "ch2pressLong":a=this.deviceAdr+":"+this.keyChannel2;e.KEY.executeCommand(f,this.deviceIF,a,"pressLong",c);break;default:c&&c(Error("no such command"))}};E.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=
g)return null;b=x.hub.m.hm._Channel["BidCos-RF"];e=null;if(0==f){if("UNREACH"==a)return{timeout:c};e={};e["0_"+a.toLowerCase()]=c;return e}if(f==this.keyChannel1){if(a=b.KEY.parseDptState(a,c))e={},a.pressShort&&(e.ch1pressShort=!0),a.pressLong&&(e.ch1pressLong=!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(e.ch1pressCont=!0),a.pressLongRel&&(e.ch1pressLongRel=!0);return e}if(f==this.keyChannel2){if(a=b.KEY.parseDptState(a,c))e={},a.pressShort&&(e.ch2pressShort=!0),a.pressLong&&(e.ch2pressLong=
!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(e.ch2pressCont=!0),a.pressLongRel&&(e.ch2pressLongRel=!0);return e}return f==this.em8bitChannel?b.MOD_EM8BIT_TRANSMITTER.parseDptState(a,c):null};E.prototype.isButton=function(){return!0};E.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,c+":1","PRESS_SHORT",function(b,g){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);
f.reportValueUsage(e.deviceIF,c+":1","PRESS_LONG",function(b,g){b&&console.error("button claim PRESS_LONG event error:"+b.stack);f.reportValueUsage(e.deviceIF,c+":2","PRESS_SHORT",function(b,g){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(e.deviceIF,c+":2","PRESS_LONG",function(c,e){a&&a()})})})})};var F=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="mod_em_8"};util.inherits(F,b);F.prototype._getReadableDpts=function(){var f=[],a=this,c=
x.hub.m.hm._Channel["BidCos-RF"],e=c.KEY.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":"+a.channel,dpt:c})});(e=c.SWITCH_INTERFACE.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":"+a.channel,dpt:c})});(e=c.SHUTTER_CONTACT.getReadableDpts())&&e.forEach(function(c){"ERROR"!=c&&f.push({channel:a.deviceAdr+":"+a.channel,dpt:c})});return f};F.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "state":a.dataPoint=
"STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};F.prototype.executeCommand=function(f,a,c){var e=x.hub.m.hm._Channel["BidCos-RF"],b=this.deviceAdr+":"+this.channel;switch(a){case "pressShort":e.KEY.executeCommand(f,this.deviceIF,b,"pressShort",c);break;case "pressLong":e.KEY.executeCommand(f,this.deviceIF,b,"pressLong",c);break;case "press":e.SWITCH_INTERFACE.executeCommand(f,this.deviceIF,b,"press",c);break;default:c&&c(Error("no such command"))}};F.prototype.parseDptState=
function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];b=null;if(f==this.channel){b={};if(f=e.KEY.parseDptState(a,c))f.pressShort&&(b.pressShort=!0),f.pressLong&&(b.pressLong=!0),"undefined"!=typeof f.pressCont&&null!=f.pressCont&&(b.pressCont=!0),f.pressLongRel&&(b.pressCont=!0);(f=e.SWITCH_INTERFACE.parseDptState(a,
c))&&f.press&&(b.press=!0);if(f=e.SHUTTER_CONTACT.parseDptState(a,c))f.state&&(b.state=f.state),"undefined"!=typeof f.lowbat&&null!=f.lowbat&&(b.lowbat=f.lowbat)}return b};F.prototype.isButton=function(){return!0};F.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(b,g){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(e.deviceIF,c,"PRESS_LONG",
function(b,g){b&&console.error("button claim PRESS_LONG event error:"+b.stack);f.reportValueUsage(e.deviceIF,c,"PRESS",function(c,e){c&&console.error("button claim PRESS_SHORT event error:"+c.stack);a&&a()})})})};var X=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="keymatic"};util.inherits(X,b);X.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["BidCos-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});
(e=c.KEYMATIC.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});return f};X.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null};switch(f){case "timeout":c.channel=a+":0";c.dataPoint="UNREACH";break;case "lowbat":c.channel=a+":0";c.dataPoint="LOWBAT";break;case "state":c.channel=a+":1";c.dataPoint="STATE";break;case "uncertain":c.channel=a+":1";c.dataPoint="STATE_UNCERTAIN";break;case "error":c.channel=a+":1";c.dataPoint=
"ERROR";break;default:return null}return c};X.prototype.executeCommand=function(f,a,c){var e=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "open":a=this.deviceAdr+":"+this.channel;e.KEYMATIC.executeCommand(f,this.deviceIF,a,"open",c);break;case "close":a=this.deviceAdr+":"+this.channel;e.KEYMATIC.executeCommand(f,this.deviceIF,a,"close",c);break;case "openDoor":a=this.deviceAdr+":"+this.channel;e.KEYMATIC.executeCommand(f,this.deviceIF,a,"openDoor",c);break;default:c&&c(Error("no such command"))}};
X.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a||"LOWBAT"==a)return e.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return f==this.channel?a=e.KEYMATIC.parseDptState(a,c):null};var G=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType=
"ou_led16"};util.inherits(G,b);G.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}]};G.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "led":a.dataPoint="LED_STATUS";break;default:return null}return a};G.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;
e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==a?e.timeout=c:"LOWBAT"==a?e.lowbat=c:e["0_"+a.toLowerCase()]=c,e;switch(a){case "LED_STATUS":switch(c){case 0:return{led:"off"};case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};default:return null}default:return null}};G.prototype.executeCommand=function(f,a,c){var e=this.deviceAdr;-1==e.indexOf(":")&&this.channel&&(e+=":"+this.channel);
switch(a){case "pressShort":f.writeValue(this.deviceIF,e,"PRESS_SHORT",!0,c);break;case "ledOff":f.writeValue(this.deviceIF,e,"LED_STATUS",0,c);break;case "ledRed":f.writeValue(this.deviceIF,e,"LED_STATUS",1,c);break;case "ledGreen":f.writeValue(this.deviceIF,e,"LED_STATUS",2,c);break;case "ledOrange":f.writeValue(this.deviceIF,e,"LED_STATUS",3,c);break;case "ledSleepOff":f.writeValue(this.deviceIF,e,"LED_SLEEP_MODE",0,c);break;case "ledSleepOn":f.writeValue(this.deviceIF,e,"LED_SLEEP_MODE",1,c);
break;default:c&&c(Error("no such command"))}};G.prototype.isButton=function(){return!0};G.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);f.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(c,f){c&&console.error("button claim PRESS_SHORT event error:"+c.stack);a&&a()})};var Na=function(f,a,c){b.call(this,f,a,c);this.channel=3;this.legacyType="hm_dis_ep_wm55"};util.inherits(Na,b);Na.prototype.executeCommand=function(f,a,c){if("submit"==
a.substr(0,6)){var e=a.substr(6);a=this.deviceAdr+":"+this.channel;f.writeValue(this.deviceIF,a,"SUBMIT",e,c)}else c&&c(Error("no such command"))};var Y=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="dualwhite"};util.inherits(Y,b);Y.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["BidCos-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&
e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});(e=c.DUAL_WHITE_COLOR.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":2",dpt:c})});return f};Y.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "bri":case "bri_real":case "error_overheat":case "error_reduced":case "direction":c.channel=
a+":1";c.dataPoint=e.DUAL_WHITE_BRIGHTNESS.getDptFromState(f);break;case "color":case "color_real":case "color_direction":c.channel=a+":2";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return c};Y.prototype.executeCommand=function(f,a,c){var e=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "off":case "on":case "toggle":case "dimUp":case "dimDown":e.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,c);break;case "colorOff":case "colorOn":case "colorToggle":case "colorUp":case "colorDown":e.DUAL_WHITE_COLOR.executeCommand(f,
this.deviceIF,this.deviceAdr+":2",a,c);break;default:"dimTo"==a.substr(0,5)?e.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,c):"colorTo"==a.substr(0,7)?e.DUAL_WHITE_COLOR.executeCommand(f,this.deviceIF,this.deviceAdr+":2",a,c):c&&c(Error("no such command"))}};Y.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=
g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.DUAL_WHITE_BRIGHTNESS.parseDptState(a,c):2==f?e.DUAL_WHITE_COLOR.parseDptState(a,c):null};var Oa=function(f,a,c){h.call(this,f,a,c);this.channel=3;this.legacyType="ip_switch"};util.inherits(Oa,h);var Aa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_contact"};util.inherits(Aa,b);Aa.prototype._getReadableDpts=
function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});return f};Aa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=
a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":c.channel=a+":1";c.dataPoint=e.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};Aa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==
a)return e.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(a,c):null};var Z=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_heater"};util.inherits(Z,b);Z.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&
e.forEach(function(c){"HUMIDITY"!=c&&f.push({channel:a.deviceAdr+":1",dpt:c})});return f};Z.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "mode":case "state":case "window":c.channel=a+":1";c.dataPoint=e.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);
break;default:return null}return c};Z.prototype.executeCommand=function(f,a,c){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,c)};Z.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==f){if("UNREACH"==
a||"LOW_BAT"==a)return e.MAINTENANCE.parseDptState(a,c);b={};b["0_"+a.toLowerCase()]=c;return b}return 1==f?e.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,c):b};var aa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_powerswitch"};util.inherits(aa,b);aa.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&
e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});(e=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":6",dpt:c})});return f};aa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "switchState":c.channel=a+":3";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=a+":6";c.dataPoint=e.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return c};aa.prototype.executeCommand=function(f,a,c){var e=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var b=this.deviceAdr+":3";e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,b,"on",c);break;case "off":b=this.deviceAdr+":3";e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
b,"off",c);break;case "toggle":b=this.deviceAdr+":3";e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,b,"toggle",c);break;default:"onFor"==a.substr(0,5)?(b=this.deviceAdr+":3",e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,b,a,c)):c&&c(Error("no such command"))}};aa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;
e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 3==f?e.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,c):6==f?e.ENERGIE_METER_TRANSMITTER.parseDptState(a,c):null};var ba=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_energyactor"};util.inherits(ba,b);ba.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==
c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.SWITCH_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});(e=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":4",dpt:c});f.push({channel:a.deviceAdr+":5",dpt:c});f.push({channel:a.deviceAdr+":6",dpt:c})});(e=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":7",dpt:c})});return f};ba.prototype._getDptFromRef=
function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "switchState":c.channel=a+":3";c.dataPoint=e.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch4State":c.channel=a+":4";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch5State":c.channel=a+":5";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch6State":c.channel=a+":6";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=a+":7";c.dataPoint=e.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return c};ba.prototype.executeCommand=function(f,a,c){var e=null,b=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch4on":case "ch5on":case "ch6on":switch(a){case "on":case "ch4on":e=
this.deviceAdr+":4";break;case "ch5on":e=this.deviceAdr+":5";break;case "ch6on":e=this.deviceAdr+":6"}b.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"on",c);break;case "off":case "ch4off":case "ch5off":case "ch6off":switch(a){case "off":case "ch4off":e=this.deviceAdr+":4";break;case "ch5off":e=this.deviceAdr+":5";break;case "ch6off":e=this.deviceAdr+":6"}b.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"off",c);break;case "toggle":case "ch4toggle":case "ch5toggle":case "ch6toggle":switch(a){case "toggle":case "ch4toggle":e=
this.deviceAdr+":4";break;case "ch5toggle":e=this.deviceAdr+":5";break;case "ch6toggle":e=this.deviceAdr+":6"}b.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggle",c);break;default:c&&c(Error("no such command"))}};ba.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==
f){if("UNREACH"==a)return b.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(3==f){if(a=b.SWITCH_TRANSMITTER.parseDptState(a,c))e={},e.switchState=a.switchTState;return e}if(4==f||5==f||6==f){if(a=b.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,c))switch(e={},parseInt(f)){case 4:e.ch4State=a.switchState;break;case 5:e.ch5State=a.switchState;break;case 6:e.ch6State=a.switchState}return e}return 7==f?b.ENERGIE_METER_TRANSMITTER.parseDptState(a,c):null};var ca=function(f,a,c){b.call(this,
f,a,c);this.channel=1;this.legacyType="ip_energyactor2"};util.inherits(ca,b);ca.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.SWITCH_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});(e=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":2",dpt:c});
f.push({channel:a.deviceAdr+":3",dpt:c});f.push({channel:a.deviceAdr+":4",dpt:c})});(e=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":5",dpt:c})});return f};ca.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "switchState":c.channel=a+":1";c.dataPoint=e.SWITCH_TRANSMITTER.getDptFromState("switchTState");
break;case "ch2State":c.channel=a+":2";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":c.channel=a+":3";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":c.channel=a+":4";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=a+":5";c.dataPoint=e.ENERGIE_METER_TRANSMITTER.getDptFromState(f);
break;default:return null}return c};ca.prototype.executeCommand=function(f,a,c){var e=null,b=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch2on":case "ch3on":case "ch4on":switch(a){case "on":case "ch2on":e=this.deviceAdr+":2";break;case "ch3on":e=this.deviceAdr+":3";break;case "ch4on":e=this.deviceAdr+":4"}b.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"on",c);break;case "off":case "ch2off":case "ch3off":case "ch4off":switch(a){case "off":case "ch2off":e=this.deviceAdr+":2";
break;case "ch3off":e=this.deviceAdr+":3";break;case "ch4off":e=this.deviceAdr+":4"}b.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"off",c);break;case "toggle":case "ch2toggle":case "ch3toggle":case "ch4toggle":switch(a){case "toggle":case "ch2toggle":e=this.deviceAdr+":2";break;case "ch3toggle":e=this.deviceAdr+":3";break;case "ch4toggle":e=this.deviceAdr+":4"}b.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggle",c);break;default:c&&c(Error("no such command"))}};ca.prototype.parseDptState=
function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a)return b.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(1==f){if(a=b.SWITCH_TRANSMITTER.parseDptState(a,c))e={},e.switchState=a.switchTState;return e}if(2==f||3==f||4==f){if(a=b.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,
c))switch(e={},parseInt(f)){case 2:e.ch2State=a.switchState;break;case 3:e.ch3State=a.switchState;break;case 4:e.ch4State=a.switchState}return e}return 5==f?b.ENERGIE_METER_TRANSMITTER.parseDptState(a,c):null};var da=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_dimmer"};util.inherits(da,b);da.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:a.deviceAdr+
":0",dpt:c})});(e=c.DIMMER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});(e=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":4",dpt:c});f.push({channel:a.deviceAdr+":5",dpt:c});f.push({channel:a.deviceAdr+":6",dpt:c})});return f};da.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=
a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":c.channel=a+":3";c.dataPoint=e.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":c.channel=a+":4";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch5Level":c.channel=a+":5";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":c.channel=a+":6";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return c};
da.prototype.executeCommand=function(f,a,c){var e=null,b=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("dimUp")){var k=a.indexOf("dimUp");g=a.substr(0,k+5);var h=a.substr(k+5)}else-1!=a.indexOf("dimDown")?(k=a.indexOf("dimDown"),g=a.substr(0,k+7),h=a.substr(k+7)):-1!=a.indexOf("dimTo")?(k=a.indexOf("dimTo"),g=a.substr(0,k+5),h=a.substr(k+5)):-1!=a.indexOf("toggleTo")&&(k=a.indexOf("toggleTo"),g=a.substr(0,k+8),h=a.substr(k+8));var l=this;switch(g){case "dimOff":b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","dimOff",function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimOff",function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimOff",c)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value+
h,1<h&&(h=1),h=Math.round(100*h),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+h,c)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==
typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+h,c)})}))});break;case "dimTo":if(!h){c&&c(Error("dimTo has no value"));break}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(a))})})});break;case "toggleTo":if(!h){c&&c(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(e.value&&(h=0),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+h,c)})}))});break;case "ch4dimOff":case "ch5dimOff":case "ch6dimOff":switch(g){case "ch4dimOff":e=
this.deviceAdr+":4";break;case "ch5dimOff":e=this.deviceAdr+":5";break;case "ch6dimOff":e=this.deviceAdr+":6"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimOff",c);break;case "ch4dimUp":case "ch5dimUp":case "ch6dimUp":switch(g){case "ch4dimUp":e=this.deviceAdr+":4";break;case "ch5dimUp":e=this.deviceAdr+":5";break;case "ch6dimUp":e=this.deviceAdr+":6"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimUp"+h,c);break;case "ch4dimDown":case "ch5dimDown":case "ch6dimDown":switch(g){case "ch4dimDown":e=
this.deviceAdr+":4";break;case "ch5dimDown":e=this.deviceAdr+":5";break;case "ch6dimDown":e=this.deviceAdr+":6"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimDown"+h,c);break;case "ch4dimTo":case "ch5dimTo":case "ch6dimTo":switch(g){case "ch4dimTo":e=this.deviceAdr+":4";break;case "ch5dimTo":e=this.deviceAdr+":5";break;case "ch6dimTo":e=this.deviceAdr+":6"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimTo"+h,c);break;case "ch4toggleTo":case "ch5toggleTo":case "ch6toggleTo":switch(g){case "ch4toggleTo":e=
this.deviceAdr+":4";break;case "ch5toggleTo":e=this.deviceAdr+":5";break;case "ch6toggleTo":e=this.deviceAdr+":6"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggleTo"+h,c);break;default:c&&c(Error("no such command"))}};da.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=
null;if(0==f){if("UNREACH"==a)return b.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(3==f){if(a=b.DIMMER_TRANSMITTER.parseDptState(a,c))e={},e.dimmerLevel=a.dimmerTLevel;return e}if(4==f||5==f||6==f){if(a=b.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,c))switch(e={},parseInt(f)){case 4:e.ch4Level=a.dimmerLevel;break;case 5:e.ch5Level=a.dimmerLevel;break;case 6:e.ch6Level=a.dimmerLevel}return e}return null};var ea=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType=
"ip_dimmer2"};util.inherits(ea,b);ea.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.DIMMER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":2",dpt:c})});(e=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c});f.push({channel:a.deviceAdr+":4",dpt:c});
f.push({channel:a.deviceAdr+":5",dpt:c})});return f};ea.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":c.channel=a+":2";c.dataPoint=e.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":c.channel=a+":3";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;
case "ch5Level":c.channel=a+":4";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":c.channel=a+":5";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return c};ea.prototype.executeCommand=function(f,a,c){var e=null,b=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("dimUp")){var k=a.indexOf("dimUp");g=a.substr(0,k+5);var h=a.substr(k+5)}else-1!=a.indexOf("dimDown")?(k=a.indexOf("dimDown"),g=a.substr(0,k+7),h=
a.substr(k+7)):-1!=a.indexOf("dimTo")?(k=a.indexOf("dimTo"),g=a.substr(0,k+5),h=a.substr(k+5)):-1!=a.indexOf("toggleTo")&&(k=a.indexOf("toggleTo"),g=a.substr(0,k+8),h=a.substr(k+8));var l=this;switch(g){case "dimOff":b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3","dimOff",function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimOff",function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":5","dimOff",c)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value+h,1<h&&(h=1),h=Math.round(100*h),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,e){a?
c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,c)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,c)})}))});break;case "dimTo":if(!h){c&&c(Error("dimTo has no value"));break}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":5","dimTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":2","LEVEL",e,(new Date).getTime()+1E3),c&&c(a))})})});break;case "toggleTo":if(!h){c&&c(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(e.value&&(h=0),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":3","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,c)})}))});break;case "ch3dimOff":case "ch4dimOff":case "ch5dimOff":switch(g){case "ch3dimOff":e=this.deviceAdr+":3";break;case "ch4dimOff":e=this.deviceAdr+":4";break;case "ch5dimOff":e=this.deviceAdr+":5"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
e,"dimOff",c);break;case "ch3dimUp":case "ch4dimUp":case "ch5dimUp":switch(g){case "ch3dimUp":e=this.deviceAdr+":3";break;case "ch4dimUp":e=this.deviceAdr+":4";break;case "ch5dimUp":e=this.deviceAdr+":5"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimUp"+h,c);break;case "ch3dimDown":case "ch4dimDown":case "ch5dimDown":switch(g){case "ch3dimDown":e=this.deviceAdr+":3";break;case "ch4dimDown":e=this.deviceAdr+":4";break;case "ch5dimDown":e=this.deviceAdr+":5"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,e,"dimDown"+h,c);break;case "ch3dimTo":case "ch4dimTo":case "ch5dimTo":switch(g){case "ch3dimTo":e=this.deviceAdr+":3";break;case "ch4dimTo":e=this.deviceAdr+":4";break;case "ch5dimTo":e=this.deviceAdr+":5"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimTo"+h,c);break;case "ch3toggleTo":case "ch4toggleTo":case "ch5toggleTo":switch(g){case "ch3toggleTo":e=this.deviceAdr+":3";break;case "ch4toggleTo":e=this.deviceAdr+":4";break;case "ch5toggleTo":e=this.deviceAdr+":5"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,e,"toggleTo"+h,c);break;default:c&&c(Error("no such command"))}};ea.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a)return b.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(2==f){if(a=b.DIMMER_TRANSMITTER.parseDptState(a,
c))e={},e.dimmerLevel=a.dimmerTLevel;return e}if(3==f||4==f||5==f){if(a=b.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,c))switch(e={},parseInt(f)){case 3:e.ch3Level=a.dimmerLevel;break;case 4:e.ch4Level=a.dimmerLevel;break;case 5:e.ch5Level=a.dimmerLevel}return e}return null};var fa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_dimmer3"};util.inherits(fa,b);fa.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();
e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.DIMMER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});(e=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":2",dpt:c});f.push({channel:a.deviceAdr+":3",dpt:c});f.push({channel:a.deviceAdr+":4",dpt:c})});return f};fa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},
e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":c.channel=a+":1";c.dataPoint=e.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch2Level":c.channel=a+":2";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch3Level":c.channel=a+":3";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch4Level":c.channel=a+":4";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;default:return null}return c};fa.prototype.executeCommand=function(f,a,c){var e=null,b=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("dimUp")){var k=a.indexOf("dimUp");g=a.substr(0,k+5);var h=a.substr(k+5)}else-1!=a.indexOf("dimDown")?(k=a.indexOf("dimDown"),g=a.substr(0,k+7),h=a.substr(k+7)):-1!=a.indexOf("dimTo")?(k=a.indexOf("dimTo"),g=a.substr(0,k+5),h=a.substr(k+5)):-1!=a.indexOf("toggleTo")&&(k=a.indexOf("toggleTo"),g=a.substr(0,k+8),h=a.substr(k+8));var l=this;switch(g){case "dimOff":b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":2","dimOff",function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimOff",function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimOff",c)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value+
h,1<h&&(h=1),h=Math.round(100*h),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,c)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==
typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,c)})}))});break;case "dimTo":if(!h){c&&c(Error("dimTo has no value"));break}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":2","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":1","LEVEL",e,(new Date).getTime()+1E3),c&&c(a))})})});break;case "toggleTo":if(!h){c&&c(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(e.value&&(h=0),b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,e){a?c&&c(a,e):b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,c)})}))});break;case "ch2dimOff":case "ch3dimOff":case "ch4dimOff":switch(g){case "ch2dimOff":e=
this.deviceAdr+":2";break;case "ch3dimOff":e=this.deviceAdr+":3";break;case "ch4dimOff":e=this.deviceAdr+":4"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimOff",c);break;case "ch2dimUp":case "ch3dimUp":case "ch4dimUp":switch(g){case "ch2dimUp":e=this.deviceAdr+":2";break;case "ch3dimUp":e=this.deviceAdr+":3";break;case "ch4dimUp":e=this.deviceAdr+":4"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimUp"+h,c);break;case "ch2dimDown":case "ch3dimDown":case "ch4dimDown":switch(g){case "ch2dimDown":e=
this.deviceAdr+":2";break;case "ch3dimDown":e=this.deviceAdr+":3";break;case "ch4dimDown":e=this.deviceAdr+":4"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimDown"+h,c);break;case "ch2dimTo":case "ch3dimTo":case "ch4dimTo":switch(g){case "ch2dimTo":e=this.deviceAdr+":2";break;case "ch3dimTo":e=this.deviceAdr+":3";break;case "ch4dimTo":e=this.deviceAdr+":4"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimTo"+h,c);break;case "ch2toggleTo":case "ch3toggleTo":case "ch4toggleTo":switch(g){case "ch2toggleTo":e=
this.deviceAdr+":2";break;case "ch3toggleTo":e=this.deviceAdr+":3";break;case "ch4toggleTo":e=this.deviceAdr+":4"}b.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggleTo"+h,c);break;default:c&&c(Error("no such command"))}};fa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=
null;if(0==f){if("UNREACH"==a)return b.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(1==f){if(a=b.DIMMER_TRANSMITTER.parseDptState(a,c))e={},e.dimmerLevel=a.dimmerTLevel;return e}if(2==f||3==f||4==f){if(a=b.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,c))switch(e={},parseInt(f)){case 2:e.ch2Level=a.dimmerLevel;break;case 3:e.ch3Level=a.dimmerLevel;break;case 4:e.ch4Level=a.dimmerLevel}return e}return null};var ha=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType=
"ip_motion"};util.inherits(ha,b);ha.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});return f};ha.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=
a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":c.channel=a+":1";c.dataPoint=e.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};ha.prototype.executeCommand=function(f,a,c){var e=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":e.MOTIONDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,c);break;default:c&&c(Error("no such command"))}};
ha.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,c):null};var H=function(f,a,c){b.call(this,
f,a,c);this.channel=3;this.legacyType="ip_motion2"};util.inherits(H,b);H.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});return f};H.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,
dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":c.channel=a+":3";c.dataPoint=e.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};H.prototype.executeCommand=function(f,a,c){switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":break;default:c&&c(Error("no such command"))}};H.prototype.parseDptState=
function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,c);b={};b["0_"+a.toLowerCase()]=c;return b}1==f&&(g=e.KEY_TRANRECEIVER.parseDptState(a,c))&&(g.pressShort&&(b={btn1pressShort:!0}),g.pressLong&&(b={btn1pressLong:!0}));2==f&&(g=
e.KEY_TRANRECEIVER.parseDptState(a,c))&&(g.pressShort&&(b={btn2pressShort:!0}),g.pressLong&&(b={btn2pressLong:!0}));return 3==f?e.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,c):b};H.prototype.isButton=function(){return!0};H.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(c,b){c&&console.error("button:1 claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(e.deviceIF,
e.deviceAdr+":1","PRESS_LONG",function(c,b){c&&console.error("button:1 claim PRESS_LONG event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":2","PRESS_SHORT",function(c,b){c&&console.error("button:2 claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":2","PRESS_LONG",function(c,e){c&&console.error("button:2 claim PRESS_LONG event error:"+c.stack);a&&a()})})})})};var N=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_button"};util.inherits(N,
b);N.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});return f};N.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};
N.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return b.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}f==this.channel&&(a=b.KEY_TRANRECEIVER.parseDptState(a,c))&&(a.pressShort&&(e={pressShort:!0}),a.pressLong&&
(e={pressLong:!0}));return e};N.prototype.isButton=function(){return!0};N.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(c,b){c&&console.error("button:1 claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":1","PRESS_LONG",function(c,e){c&&console.error("button:1 claim PRESS_LONG event error:"+c.stack);a&&a()})})};var O=
function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_button2"};util.inherits(O,b);O.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});return f};O.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=
a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};O.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,c);b={};b["0_"+a.toLowerCase()]=c;return b}1==f&&(g=e.KEY_TRANRECEIVER.parseDptState(a,
c))&&(g.pressShort&&(b={btn1pressShort:!0}),g.pressLong&&(b={btn1pressLong:!0}));2==f&&(g=e.KEY_TRANRECEIVER.parseDptState(a,c))&&(g.pressShort&&(b={btn2pressShort:!0}),g.pressLong&&(b={btn2pressLong:!0}));return b};O.prototype.isButton=function(){return!0};O.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(c,b){c&&console.error("button:1 claim PRESS_SHORT event error:"+
c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":1","PRESS_LONG",function(c,b){c&&console.error("button:1 claim PRESS_LONG event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":2","PRESS_SHORT",function(c,b){c&&console.error("button:2 claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":2","PRESS_LONG",function(c,e){c&&console.error("button:2 claim PRESS_LONG event error:"+c.stack);a&&a()})})})})};var I=function(f,a,c){b.call(this,f,a,c);this.channel=
1;this.legacyType="ip_button4"};util.inherits(I,b);I.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});return f};I.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);
break;default:return null}return c};I.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return b.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(1==f||2==f||3==f||4==f)if(a=b.KEY_TRANRECEIVER.parseDptState(a,c))e||
(e={}),a.pressShort&&(e["btn"+f+"pressShort"]=!0),a.pressLong&&(e["btn"+f+"pressLong"]=!0);return e};I.prototype.isButton=function(){return!0};I.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){e._claimButtonEvent(3,f,function(){e._claimButtonEvent(4,f,function(){a&&a()})})})})};I.prototype._claimButtonEvent=function(f,a,c){var e=this;a.reportValueUsage(this.deviceIF,
this.deviceAdr+":"+f,"PRESS_SHORT",function(b,g){b&&console.error("button:"+f+" claim PRESS_SHORT event error:"+b.stack);a.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(a,e){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);c&&c()})})};var J=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_button6"};util.inherits(J,b);J.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});return f};J.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};J.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=
this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return b.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(1==f||2==f||3==f||4==f||5==f||6==f)if(a=b.KEY_TRANRECEIVER.parseDptState(a,c))e||(e={}),a.pressShort&&(e["btn"+f+"pressShort"]=!0),a.pressLong&&(e["btn"+f+"pressLong"]=!0);return e};J.prototype.isButton=function(){return!0};J.prototype.claimEvent=
function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){e._claimButtonEvent(3,f,function(){e._claimButtonEvent(4,f,function(){e._claimButtonEvent(5,f,function(){e._claimButtonEvent(6,f,function(){a&&a()})})})})})})};J.prototype._claimButtonEvent=function(f,a,c){var e=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(b,g){b&&console.error("button:"+
f+" claim PRESS_SHORT event error:"+b.stack);a.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(a,e){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);c&&c()})})};var ia=function(f,a,c){b.call(this,f,a,c);this.channel=3;this.legacyType="ip_siren"};util.inherits(ia,b);ia.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});
(e=c.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});return f};ia.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":c.channel=a+":3";c.dataPoint=e.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return c};
ia.prototype.executeCommand=function(f,a,c){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3",a,c)};ia.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,
c);e={};e["0_"+a.toLowerCase()]=c;return e}return 3==f?e.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(a,c):null};var B=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_wallthermo"};util.inherits(B,b);B.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){"LEVEL"!=
c&&f.push({channel:a.deviceAdr+":1",dpt:c})});return f};B.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":c.channel=a+":1";c.dataPoint=e.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);break;
default:return null}return c};B.prototype.executeCommand=function(f,a,c){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,c)};B.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==f){if("UNREACH"==a||
"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,c);b={};b["0_"+a.toLowerCase()]=c;return b}return 1==f?e.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,c):b};var Ba=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_wallthermo2"};util.inherits(Ba,B);Ba.prototype._getReadableDpts=function(){var f=B.prototype._getReadableDpts.call(this);f||(f=[]);var a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+
":8",dpt:c})});(e=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":10",dpt:c})});return f};Ba.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "valveState":c.channel=a+":10";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "cl_fd_emergencyOP":case "cl_fd_frostProtection":case "cl_fd_state":case "cl_fd_humidityAlarm":c.channel=
a+":8";c.dataPoint=e.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(f);break;default:return B.prototype._getDptFromRef.call(this,f)}return c};Ba.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return b.MAINTENANCE_BAT_EL.parseDptState(a,
c);e={};e["0_"+a.toLowerCase()]=c;return e}if(1==f)return b.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,c);if(8==f)return b.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(a,c);10==f&&(e={},a=b.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,c),e.valveState=a?a.switchState:"?");return e};var ja=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_smoke"};util.inherits(ja,b);ja.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();
e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.SMOKE_DETECTOR.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});return f};ja.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":c.channel=
a+":1";c.dataPoint=e.SMOKE_DETECTOR.getDptFromState(f);break;default:return null}return c};ja.prototype.executeCommand=function(f,a,c){x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,c)};ja.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];
b=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE.parseDptState(a,c);b={};b["0_"+a.toLowerCase()]=c;return b}return 1==f?e.SMOKE_DETECTOR.parseDptState(a,c):b};var Ca=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_window"};util.inherits(Ca,b);Ca.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&
e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});return f};Ca.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":c.channel=a+":1";c.dataPoint=e.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};Ca.prototype.parseDptState=function(f,
a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];b=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,c);b={};b["0_"+a.toLowerCase()]=c;return b}return 1==f?e.ROTARY_HANDLE_TRANSCEIVER.parseDptState(a,c):b};var y=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType=
"ip_blind"};util.inherits(y,b);y.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.SHUTTER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});(e=c.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":4",dpt:c});f.push({channel:a.deviceAdr+":5",dpt:c});f.push({channel:a.deviceAdr+
":6",dpt:c})});return f};y.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "blindLevel":c.channel=a+":3";c.dataPoint=e.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case "ch4Level":c.channel=a+":4";c.dataPoint=e.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch5Level":c.channel=a+":5";
c.dataPoint=e.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch6Level":c.channel=a+":6";c.dataPoint=e.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null}return c};y.prototype.executeCommand=function(f,a,c){var e=null,b=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("stepUp")){var k=a.indexOf("stepUp");g=a.substr(0,k+6);var h=a.substr(k+6)}else-1!=a.indexOf("stepDown")?(k=a.indexOf("stepDown"),g=a.substr(0,k+8),h=a.substr(k+8)):-1!=a.indexOf("moveTo")?
(k=a.indexOf("moveTo"),g=a.substr(0,k+6),h=a.substr(k+6)):-1!=a.indexOf("stop")&&(k=a.indexOf("stop"),g=a.substr(0,k+4),h=a.substr(k+4));var l=this;switch(g){case "stop":b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","stop",function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","stop",function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","stop",c)})});break;case "moveUp":b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","moveUp",function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveUp",function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveUp",c)})});break;case "moveDown":b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveDown",function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveDown",function(a,e){a?c&&
c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveDown",c)})});break;case "stepUp":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h=e.value+h,1<h&&(h=1),h=Math.round(100*h),b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(a))})})}))});break;case "stepDown":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):
(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(a))})})}))});
break;case "moveTo":if(!h){c&&c(Error("moveTo has no value"));break}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveTo"+h,function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,e){a?c&&c(a,e):b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+
1E3),c&&c(a))})})});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(g){case "ch4stop":e=this.deviceAdr+":4";break;case "ch5stop":e=this.deviceAdr+":5";break;case "ch6stop":e=this.deviceAdr+":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stop",c);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(g){case "ch4moveUp":e=this.deviceAdr+":4";break;case "ch5moveUp":e=this.deviceAdr+":5";break;case "ch6moveUp":e=this.deviceAdr+":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,e,"moveUp",c);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(g){case "ch4moveDown":e=this.deviceAdr+":4";break;case "ch5moveDown":e=this.deviceAdr+":5";break;case "ch6moveDown":e=this.deviceAdr+":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveDown",c);break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(g){case "ch4stepUp":e=this.deviceAdr+":4";break;case "ch5stepUp":e=this.deviceAdr+":5";break;case "ch6stepUp":e=this.deviceAdr+
":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stepUp"+h,c);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(g){case "ch4stepDown":e=this.deviceAdr+":4";break;case "ch5stepDown":e=this.deviceAdr+":5";break;case "ch6stepDown":e=this.deviceAdr+":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stepDown"+h,c);break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(g){case "ch4moveTo":e=this.deviceAdr+":4";break;case "ch5moveTo":e=this.deviceAdr+
":5";break;case "ch6moveTo":e=this.deviceAdr+":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveTo"+h,c);break;default:c&&c(Error("no such command"))}};y.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a)return b.MAINTENANCE.parseDptState(a,
c);e={};e["0_"+a.toLowerCase()]=c;return e}if(3==f){if(a=b.SHUTTER_TRANSMITTER.parseDptState(a,c))e={},e.blindLevel=a.blindTLevel;return e}if(4==f||5==f||6==f){if(a=b.SHUTTER_VIRTUAL_RECEIVER.parseDptState(a,c))switch(e={},parseInt(f)){case 4:e.ch4Level=a.blindLevel;break;case 5:e.ch5Level=a.blindLevel;break;case 6:e.ch6Level=a.blindLevel}return e}return null};y.prototype.getConfig=function(f,a){var c=this.deviceAdr+":3";f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)a&&a(e);else{var b=
{},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});b[c]=g;a&&a(e,b)}})};y.prototype.setConfig=function(f,a,c){if(a){var e=this.deviceAdr+
":3";if(a=a[e]){var b={};b.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};b.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};f.setParamset(this.deviceIF,e,"MASTER",b,function(a){c&&c(a)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};y.prototype.isButton=function(){return!0};y.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){a&&
a()})})};y.prototype._claimButtonEvent=function(f,a,c){var e=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(b,g){b&&console.error("button:"+f+" claim PRESS_SHORT event error:"+b.stack);a.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(a,e){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);c&&c()})})};var z=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_jalousie"};util.inherits(z,b);z.prototype._getReadableDpts=
function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.BLIND_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":3",dpt:c})});(e=c.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":4",dpt:c});f.push({channel:a.deviceAdr+":5",dpt:c});f.push({channel:a.deviceAdr+":6",dpt:c})});return f};z.prototype._getDptFromRef=
function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=a+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "blindLevel":c.channel=a+":3";c.dataPoint=e.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":c.channel=a+":3";c.dataPoint=e.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case "ch4blindLevel":c.channel=a+":4";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");
break;case "ch4lamellaLevel":c.channel=a+":4";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch5blindLevel":c.channel=a+":5";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch5lamellaLevel":c.channel=a+":5";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch6blindLevel":c.channel=a+":6";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch6lamellaLevel":c.channel=a+":6";c.dataPoint=
e.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null}return c};z.prototype.executeCommand=function(f,a,c){var e=null,b=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("stepUp")){var k=a.indexOf("stepUp");g=a.substr(0,k+6);var h=a.substr(k+6)}else-1!=a.indexOf("stepDown")?(k=a.indexOf("stepDown"),g=a.substr(0,k+8),h=a.substr(k+8)):-1!=a.indexOf("moveTo")?(k=a.indexOf("moveTo"),g=a.substr(0,k+6),h=a.substr(k+6)):-1!=a.indexOf("stop")?(k=a.indexOf("stop"),g=a.substr(0,
k+4),h=a.substr(k+4)):-1!=a.indexOf("lamellaStepUp")?(k=a.indexOf("lamellaStepUp"),g=a.substr(0,k+13),h=a.substr(k+13)):-1!=a.indexOf("lamellaStepDown")?(k=a.indexOf("lamellaStepDown"),g=a.substr(0,k+15),h=a.substr(k+15)):-1!=a.indexOf("lamellaTo")&&(k=a.indexOf("lamellaTo"),g=a.substr(0,k+9),h=a.substr(k+9));var l=this;switch(g){case "stop":case "moveUp":case "moveDown":b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4",g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5",g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6",g,c)})});break;case "lamellaUp":case "lamellaDown":f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h=e.value,h=Math.round(100*h),b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4",g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5",g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6",g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,e){c&&c(a,e)})})})})})}))});break;case "stepUp":h=
h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h=e.value+h,1<h&&(h=1),h=Math.round(100*h),b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(a))})})}))});break;case "stepDown":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(a))})})}))});break;case "moveTo":if(!h){c&&c(Error("moveTo has no value"));break}b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","moveTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(a))})})});break;case "lamellaStepUp":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){if(a)c&&c(a);else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var g=e.value;g=Math.round(100*g);f.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get lamella current value return invalid")):(h=e.value+h,1<h&&(h=1),h=Math.round(100*h),b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":4","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+1E3),c&&c(a))})})})})})}))})}});break;case "lamellaStepDown":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){if(a)c&&c(a);else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var g=e.value;g=Math.round(100*
g);f.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,e){a?c&&c(a):"undefined"==typeof e||null==e?c&&c(Error("get lamella current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":5","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+1E3),c&&
c(a))})})})})})}))})}});break;case "lamellaTo":if(!h){c&&c(Error("lamellaTo has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,e){if(a)c&&c(a);else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var g=e.value;g=Math.round(100*g);b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":4","moveTo"+g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,e){a?c&&c(a,e):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(a,e){a?c&&c(a,e):(e=h/100,1<e&&
(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+1E3),c&&c(a))})})})})})})}});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(g){case "ch4stop":e=this.deviceAdr+":4";break;case "ch5stop":e=this.deviceAdr+":5";break;case "ch6stop":e=this.deviceAdr+":6"}b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stop",c);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(g){case "ch4moveUp":e=this.deviceAdr+":4";break;case "ch5moveUp":e=
this.deviceAdr+":5";break;case "ch6moveUp":e=this.deviceAdr+":6"}b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveUp",c);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(g){case "ch4moveDown":e=this.deviceAdr+":4";break;case "ch5moveDown":e=this.deviceAdr+":5";break;case "ch6moveDown":e=this.deviceAdr+":6"}b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveDown",c);break;case "ch4lamellaUp":case "ch5lamellaUp":case "ch6lamellaUp":switch(g){case "ch4lamellaUp":e=
this.deviceAdr+":4";break;case "ch5lamellaUp":e=this.deviceAdr+":5";break;case "ch6lamellaUp":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(a,g){if(a)c&&c(a);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var h=g.value;h=Math.round(100*h);b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"lamellaUp",function(a,g){a?c&&c(a):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+h,function(a,
e){c&&c(a,e)})})}});break;case "ch4lamellaDown":case "ch5lamellaDown":case "ch6lamellaDown":switch(g){case "ch4lamellaDown":e=this.deviceAdr+":4";break;case "ch5lamellaDown":e=this.deviceAdr+":5";break;case "ch6lamellaDown":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(a,g){if(a)c&&c(a);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var h=g.value;h=Math.round(100*h);b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,e,"lamellaDown",function(a,g){a?c&&c(a):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+h,function(a,e){c&&c(a,e)})})}});break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(g){case "ch4stepUp":e=this.deviceAdr+":4";break;case "ch5stepUp":e=this.deviceAdr+":5";break;case "ch6stepUp":e=this.deviceAdr+":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stepUp"+h,c);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(g){case "ch4stepDown":e=
this.deviceAdr+":4";break;case "ch5stepDown":e=this.deviceAdr+":5";break;case "ch6stepDown":e=this.deviceAdr+":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stepDown"+h,c);break;case "ch4lamellaStepUp":case "ch5lamellaStepUp":case "ch6lamellaStepUp":switch(g){case "ch4lamellaStepUp":e=this.deviceAdr+":4";break;case "ch5lamellaStepUp":e=this.deviceAdr+":5";break;case "ch6lamellaStepUp":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(a,
g){if(a)c&&c(a);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var k=g.value;k=Math.round(100*k);b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"lamellaStepUp"+h,function(a,g){a?c&&c(a):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+k,function(a,e){c&&c(a,e)})})}});break;case "ch4lamellaStepDown":case "ch5lamellaStepDown":case "ch6lamellaStepDown":switch(g){case "ch4lamellaStepDown":e=this.deviceAdr+":4";break;case "ch5lamellaStepDown":e=
this.deviceAdr+":5";break;case "ch6lamellaStepDown":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(a,g){if(a)c&&c(a);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var k=g.value;k=Math.round(100*k);b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"lamellaStepDown"+h,function(a,g){a?c&&c(a):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+k,function(a,e){c&&c(a,e)})})}});break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(g){case "ch4moveTo":e=
this.deviceAdr+":4";break;case "ch5moveTo":e=this.deviceAdr+":5";break;case "ch6moveTo":e=this.deviceAdr+":6"}b.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveTo"+h,c);break;case "ch4lamellaTo":case "ch5lamellaTo":case "ch6lamellaTo":switch(g){case "ch4lamellaTo":e=this.deviceAdr+":4";break;case "ch5lamellaTo":e=this.deviceAdr+":5";break;case "ch6lamellaTo":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(a,g){if(a)c&&c(a);else if("undefined"==
typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var k=g.value;k=Math.round(100*k);b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"lamellaTo"+h,function(a,g){a?c&&c(a):b.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+k,function(a,e){c&&c(a,e)})})}});break;default:c&&c(Error("no such command"))}};z.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");
-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a)return b.MAINTENANCE.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(3==f){if(c=b.BLIND_TRANSMITTER.parseDptState(a,c))e={},"LEVEL"==a?e.blindLevel=c.blindTPos:"LEVEL_2"==a&&(e.lamellaLevel=c.lamellaTPos);return e}if(4==f||5==f||6==f){if(c=b.BLIND_VIRTUAL_RECEIVER.parseDptState(a,c))switch(e={},parseInt(f)){case 4:"LEVEL"==a?e.ch4blindLevel=c.blindPos:"LEVEL_2"==
a&&(e.ch4lamellaLevel=c.lamellaPos);break;case 5:"LEVEL"==a?e.ch5blindLevel=c.blindPos:"LEVEL_2"==a&&(e.ch5lamellaLevel=c.lamellaPos);break;case 6:"LEVEL"==a?e.ch6blindLevel=c.blindPos:"LEVEL_2"==a&&(e.ch6lamellaLevel=c.lamellaPos)}return e}return null};z.prototype.getConfig=function(f,a){var c=this.deviceAdr+":3";f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)a&&a(e);else{var b={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});b[c]=g;a&&a(e,b)}})};z.prototype.setConfig=function(f,a,c){if(a){var e=
this.deviceAdr+":3";if(a=a[e]){var b={};b.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};b.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};b.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_UNIT};b.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_VALUE};f.setParamset(this.deviceIF,e,"MASTER",b,function(a){c&&c(a)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};z.prototype.isButton=
function(){return!0};z.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){a&&a()})})};z.prototype._claimButtonEvent=function(f,a,c){var e=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(b,g){b&&console.error("button:"+f+" claim PRESS_SHORT event error:"+b.stack);a.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",
function(a,e){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);c&&c()})})};var ka=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_presence"};util.inherits(ka,b);ka.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+
":1",dpt:c})});return f};ka.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "current_illumination":case "active":c.channel=a+":1";c.dataPoint=e.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};ka.prototype.executeCommand=
function(f,a,c){var e=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":e.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,c);break;default:c&&c(Error("no such command"))}};ka.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];
if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(a,c):null};var Da=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_floor_heater"};util.inherits(Da,b);Da.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();c&&c.forEach(function(c){f.push({channel:a.deviceAdr+
":"+a.channel,dpt:c})});return f};Da.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_f_humidityLimiter":case "cl_f_emergencyOP":case "cl_f_frostProtection":case "cl_f_state":case "cl_f_dewPointAlarm":case "cl_f_externalClock":c.channel=a+":"+this.channel;c.dataPoint=e.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};Da.prototype.parseDptState=function(f,
a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?e.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(a,c):null};var Ea=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_floor_pump_heater"};util.inherits(Ea,b);Ea.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();
c&&c.forEach(function(c){f.push({channel:a.deviceAdr+":"+a.channel,dpt:c})});return f};Ea.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_fp_humidityLimiter":case "cl_fp_emergencyOP":case "cl_fp_frostProtection":case "cl_fp_state":case "cl_fp_dewPointAlarm":case "cl_fp_externalClock":c.channel=a+":"+this.channel;c.dataPoint=e.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};
Ea.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?e.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(a,c):null};var Fa=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_weather"};util.inherits(Fa,b);Fa.prototype._getReadableDpts=function(){var f=
[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_CL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.WEATHER_TRANSMIT.getReadableDpts())&&e.forEach(function(c){-1==c.indexOf("RAIN")&&-1==c.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:c})});return f};Fa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=
a+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:c.channel=a+":1";f=e.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};Fa.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_CL.parseDptState(a,
c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.WEATHER_TRANSMIT.parseDptState(a,c):null};var Ga=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_weather2"};util.inherits(Ga,b);Ga.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_CL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.WEATHER_TRANSMIT.getReadableDpts())&&e.forEach(function(c){-1==c.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+
":1",dpt:c})});return f};Ga.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:c.channel=a+":1";f=e.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};Ga.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+
1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_CL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.WEATHER_TRANSMIT.parseDptState(a,c):null};var Ha=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_weather3"};util.inherits(Ha,b);Ha.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],
e=c.MAINTENANCE_BAT_CL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.CLIMATE_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});return f};Ha.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:c.channel=
a+":1";f=e.CLIMATE_TRANSCEIVER.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};Ha.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_CL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.CLIMATE_TRANSCEIVER.parseDptState(a,
c):null};var Ia=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_weather4"};util.inherits(Ia,b);Ia.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_CL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.WEATHER_TRANSMIT.getReadableDpts())&&e.forEach(function(c){-1==c.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:c})});return f};Ia.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:c.channel=a+":1";f=e.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};Ia.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_CL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.WEATHER_TRANSMIT.parseDptState(a,c):null};var la=function(f,a,c){b.call(this,f,a,c);this.channel=2;this.legacyType="ip_direction"};util.inherits(la,b);la.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:a.deviceAdr+
":0",dpt:c})});(e=c.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":2",dpt:c});f.push({channel:a.deviceAdr+":3",dpt:c})});return f};la.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "ch2State":c.channel=a+":2";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch3State":c.channel=a+":3";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":c.channel=a+":4";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:c.channel=a+":2";f=e.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};la.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");
-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return b.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(2==f){if(a=b.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,c))e={},"undefined"!=typeof a.current_direction&&(e.current_passage_r2l=a.current_direction),"undefined"!=typeof a.last_direction&&(e.last_passage_r2l=a.last_direction),"undefined"!=typeof a.passage_counter&&
(e.r2l_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&(e.r2l_passage_counter_overflow=a.passage_counter_overflow);return e}if(3==f){if(a=b.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,c))e={},"undefined"!=typeof a.current_direction&&(e.current_passage_l2r=a.current_direction),"undefined"!=typeof a.last_direction&&(e.last_passage_l2r=a.last_direction),"undefined"!=typeof a.passage_counter&&(e.l2r_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&
(e.l2r_passage_counter_overflow=a.passage_counter_overflow);return e}return null};la.prototype.parseStates=function(f){var a={},c;for(c in f){var e=this.parseChnState(c,f[c]);e&&(a=x.hub.m.hm._Util.mergeObj(a,e))}a.current_passage_r2l&&a.current_passage_l2r&&(a.current_direction=a.current_passage_r2l.value?{value:"right_to_left",time:a.current_passage_r2l.time}:{value:"left_to_right",time:a.current_passage_l2r.time});a.last_passage_r2l&&a.last_passage_l2r&&(a.last_direction=a.last_passage_r2l.value?
{value:"right_to_left",time:a.last_passage_r2l.time}:{value:"left_to_right",time:a.last_passage_l2r.time});delete a.current_passage_r2l;delete a.current_passage_l2r;delete a.last_passage_r2l;delete a.last_passage_l2r;return a};var K=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_button8"};util.inherits(K,b);K.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+
":0",dpt:c})});return f};K.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};K.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return b.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(1==f||2==f||3==f||4==f||5==f||6==f||7==f||8==f)if(a=b.KEY_TRANRECEIVER.parseDptState(a,c))e||(e={}),a.pressShort&&(e["btn"+f+"pressShort"]=!0),a.pressLong&&(e["btn"+f+"pressLong"]=!0);return e};K.prototype.isButton=function(){return!0};K.prototype.claimEvent=function(f,a){var c=this.deviceAdr;-1==c.indexOf(":")&&
this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){e._claimButtonEvent(3,f,function(){e._claimButtonEvent(4,f,function(){e._claimButtonEvent(5,f,function(){e._claimButtonEvent(6,f,function(){e._claimButtonEvent(7,f,function(){e._claimButtonEvent(8,f,function(){a&&a()})})})})})})})})};K.prototype._claimButtonEvent=function(f,a,c){var e=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(b,g){b&&console.error("button:"+
f+" claim PRESS_SHORT event error:"+b.stack);a.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(a,e){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);c&&c()})})};var Ja=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_generic_input"};util.inherits(Ja,b);Ja.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();c&&c.forEach(function(c){f.push({channel:a.deviceAdr+
":"+a.channel,dpt:c})});return f};Ja.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];c.channel=a+":"+this.channel;f=e.GENERIC_INPUT_TRANSMITER.getDptFromState(f);if(!f)return null;c.dataPoint=f;return c};Ja.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));
if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?e.GENERIC_INPUT_TRANSMITER.parseDptState(a,c):null};var ma=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_analog_output"};util.inherits(ma,b);ma.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();c&&c.forEach(function(c){f.push({channel:a.deviceAdr+":"+a.channel,dpt:c})});return f};ma.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "outputLevel":c.channel=a+":"+this.channel;c.dataPoint=e.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel");break;default:return null}return c};ma.prototype.executeCommand=function(f,a,c){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,function(a,f){c&&c(a,f)})};ma.prototype.parseDptState=function(f,a,c){var e=
f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];b=null;f==this.channel&&(b=e.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(a,c));return b};var Ka=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_water"};util.inherits(Ka,b);Ka.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_CL.getReadableDpts();
e&&e.forEach(function(c){f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",dpt:c})});return f};Ka.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;case "alarm":case "moisture":case "water":c.channel=
a+":1";c.dataPoint=e.WATER_DETECTION_TRANSMITTER.getDptFromState(f);break;default:return null}return c};Ka.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"ERROR_NON_FLAT_POSITIONING"==a)return e.MAINTENANCE_BAT_CL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=
c;return e}return 1==f?e.WATER_DETECTION_TRANSMITTER.parseDptState(a,c):null};var La=function(f,a,c){b.call(this,f,a,c);this.channel=1;this.legacyType="ip_acce"};util.inherits(La,b);La.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});(e=c.ACCELERATION_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:a.deviceAdr+":1",
dpt:c})});return f};La.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "volatage":case "errorCode":case "sensorError":c.channel=a+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "motion":c.channel=a+":1";c.dataPoint=e.ACCELERATION_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};La.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");
if(-1==e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a||"SENSOR_ERROR"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}return 1==f?e.ACCELERATION_TRANSCEIVER.parseDptState(a,c):null};var C=function(f,a,c){b.call(this,f,a,c);this.channel=
1;this.legacyType="ip_garagedoor"};util.inherits(C,b);C.prototype._getReadableDpts=function(){var f=[],a=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:a.deviceAdr+":0",dpt:c})});return f};C.prototype._getDptFromRef=function(f){var a=this.deviceAdr,c={channel:a+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "voltage":case "errorCode":c.channel=a+":0";c.dataPoint=
e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};C.prototype.executeCommand=function(f,a,c){var e=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var b=this.deviceAdr+":3";e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,b,"onFor0.5",c);break;default:"onFor"==a.substr(0,5)?(b=this.deviceAdr+":3",e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,b,a,c)):c&&c(Error("no such command"))}};C.prototype.parseDptState=function(f,a,c){var e=f.indexOf(":");if(-1==
e)return null;var b=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(b!=g)return null;b=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a)return b.MAINTENANCE_BAT_EL.parseDptState(a,c);e={};e["0_"+a.toLowerCase()]=c;return e}if(1==f){if(a=b.KEY_TRANRECEIVER.parseDptState(a,c))e||(e={}),a.pressShort&&(e.btnPressShort=!0),a.pressLong&&(e.btnPressLong=!0);return e}return null};
C.prototype.isButton=function(){return!0};C.prototype.claimEvent=function(f,a){this._claimButtonEvent(1,f,function(){a&&a()})};C.prototype._claimButtonEvent=function(f,a,c){var e=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(b,g){b&&console.error("button:"+f+" claim PRESS_SHORT event error:"+b.stack);a.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(a,e){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);c&&c()})})};var Sa=
function(){var f=function(a,c,e){b.call(this,a,c,e);this._chMaintenance=0;this._chKeyTransceiver1=1;this._chKeyTransceiver2=2;this._chSwitchTransmitter3=3;this._chSwitchVirtualReceiver4=4;this._chDimmerTransmitter7=7;this._chDimmerVirtualReceiver8=8;this._chDimmerTransmitter11=11;this._chDimmerVirtualReceiver12=12;this._chDimmerWeekProfile=15;this.legacyType="ip_bsl"};util.inherits(f,b);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+
":"+this._chSwitchTransmitter3,dpt:"STATE"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"COLOR"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"COLOR"}]};f.prototype._getDptFromRef=function(a){var c={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":c.channel+=this._chMaintenance;c.dataPoint="UNREACH";break;case "state":c.channel+=
this._chSwitchTransmitter3;c.dataPoint="STATE";break;case "led1Level":c.channel+=this._chDimmerTransmitter7;c.dataPoint="LEVEL";break;case "led1Color":c.channel+=this._chDimmerTransmitter7;c.dataPoint="COLOR";break;case "led2Level":c.channel+=this._chDimmerTransmitter11;c.dataPoint="LEVEL";break;case "led2Color":c.channel+=this._chDimmerTransmitter11;c.dataPoint="COLOR";break;default:return null}return c};f.prototype.executeCommand=function(a,c,e){var f=x.hub.m.hm._Channel["HmIP-RF"],b=this.getSerial();
var g=c;if(-1!=c.indexOf("dimUp")){var h=c.indexOf("dimUp");g=c.substr(0,h+5);h=c.substr(h)}else-1!=c.indexOf("dimDown")?(h=c.indexOf("dimDown"),g=c.substr(0,h+7),h=c.substr(h)):-1!=c.indexOf("dimTo")?(h=c.indexOf("dimTo"),g=c.substr(0,h+5),h=c.substr(h)):-1!=c.indexOf("toggleTo")?(h=c.indexOf("toggleTo"),g=c.substr(0,h+8),h=c.substr(h)):-1!=c.indexOf("colorTo")&&(h=c.indexOf("colorTo"),g=c.substr(0,h+7),h=c.substr(h));switch(g){case "on":case "off":case "toggle":c=b+":"+this._chSwitchVirtualReceiver4;
f.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,c,g,e);break;case "led1on":case "led1off":case "led1dimUp":case "led1dimDown":case "led1dimTo":case "led1toggleTo":case "led1colorTo":case "led2on":case "led2off":case "led2dimUp":case "led2dimDown":case "led2dimTo":case "led2toggleTo":case "led2colorTo":c="led1"==g.substr(0,4)?b+":"+this._chDimmerVirtualReceiver12:b+":"+this._chDimmerVirtualReceiver8;"led1on"==g?h="dimTo100":"led1off"==g?h="dimOff":"led2on"==g?h="dimTo100":"led2off"==g&&(h=
"dimOff");f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,c,h,e);break;default:"onFor"==g.substr(0,5)?(c=b+":"+this._chSwitchVirtualReceiver4,f.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,c,g,e)):e&&e(Error("no such command"))}};f.prototype.parseDptState=function(a,c,e){var f=a.indexOf(":");if(-1==f)return null;var b=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(b!=f)return null;b=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":return b.MAINTENANCE.parseDptState(c,
e);default:var g={};g["0_"+c.toLowerCase()]=e;return g}case this._chKeyTransceiver1:case this._chKeyTransceiver2:if(e=b.KEY_TRANRECEIVER.parseDptState(c,e))g||(g={}),e.pressShort&&(g["btn"+a+"pressShort"]=!0),e.pressLong&&(g["btn"+a+"pressLong"]=!0);return g;case this._chSwitchTransmitter3:switch(c){case "STATE":if(e=b.SWITCH_TRANSMITTER.parseDptState(c,e))g={},g.state=e.switchTState;return g;default:return null}case this._chDimmerTransmitter7:if(e=b.DIMMER_TRANSMITTER.parseDptState(c,e))g={},"LEVEL"==
c?g.led2Level=e.dimmerTLevel:"COLOR"==c&&(g.led2Color=e.dimmerTColor);return g;case this._chDimmerTransmitter11:if(e=b.DIMMER_TRANSMITTER.parseDptState(c,e))g={},"LEVEL"==c?g.led1Level=e.dimmerTLevel:"COLOR"==c&&(g.led1Color=e.dimmerTColor);return g;default:return null}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,c){var e=this.getSerial(),f=this;a.reportValueUsage(this.deviceIF,e+":"+this._chKeyTransceiver1,"PRESS_SHORT",function(b,g){b&&console.error("button:1 claim PRESS_SHORT event error:"+
b.stack);a.reportValueUsage(f.deviceIF,e+":"+f._chKeyTransceiver1,"PRESS_LONG",function(b,g){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);a.reportValueUsage(f.deviceIF,e+":"+f._chKeyTransceiver2,"PRESS_SHORT",function(b,g){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);a.reportValueUsage(f.deviceIF,e+":"+f._chKeyTransceiver2,"PRESS_LONG",function(a,e){a&&console.error("button:2 claim PRESS_LONG event error:"+a.stack);c&&c()})})})})};return f}(),Ta=function(){var f=
function(a,c,e){b.call(this,a,c,e);this._chMaintenance=0;this._chDoorReceiver=1;this._chSimpleSwitchReceiver=2;this.legacyType="ip_tormatic"};util.inherits(f,b);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chDoorReceiver,dpt:"DOOR_STATE"},{channel:this.deviceAdr+":"+this._chSimpleSwitchReceiver,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var c={channel:this.getSerial()+":",dataPoint:null};
switch(a){case "timeout":c.channel+=this._chMaintenance;c.dataPoint="UNREACH";break;case "doorState":c.channel+=this._chDoorReceiver;c.dataPoint="DOOR_STATE";break;case "lightState":c.channel+=this._chSimpleSwitchReceiver;c.dataPoint="STATE";break;default:return null}return c};f.prototype.executeCommand=function(a,c,e){var f=x.hub.m.hm._Channel["HmIP-RF"],b=this.getSerial();switch(c){case "open":case "close":case "partialOpen":case "stop":b=b+":"+this._chDoorReceiver;f.DOOR_RECEIVER.executeCommand(a,
this.deviceIF,b,c,e);break;case "lightOn":case "lightOff":case "lightToggle":c=c.substr(5).toLowerCase();b=b+":"+this._chSimpleSwitchReceiver;f.SIMPLE_SWITCH_RECEIVER.executeCommand(a,this.deviceIF,b,c,e);break;default:e&&e(Error("no such command"))}};f.prototype.parseDptState=function(a,c,e){var f=a.indexOf(":");if(-1==f)return null;var b=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(b!=f)return null;b=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":return b.MAINTENANCE.parseDptState(c,
e);default:var g={};g["0_"+c.toLowerCase()]=e;return g}case this._chDoorReceiver:return(c=b.DOOR_RECEIVER.parseDptState(c,e))&&(g=c),g;case this._chSimpleSwitchReceiver:if(c=b.SIMPLE_SWITCH_RECEIVER.parseDptState(c,e))g={},g.lightState=c.state;return g;default:return null}};return f}(),Ua=function(){var f=function(a,c,e){b.call(this,a,c,e);this._chMaintenance=0;this._chBrightness=1;this.legacyType="ip_lux"};util.inherits(f,b);f.prototype._getReadableDpts=function(){var a=[],c=this,e=x.hub.m.hm._Channel["HmIP-RF"],
f=e.MAINTENANCE_BAT_EL.getReadableDpts();f&&f.forEach(function(e){"SABOTAGE"!=e&&"ERROR_CODE"!=e&&"SENSOR_ERROR"!=e&&a.push({channel:c.deviceAdr+":0",dpt:e})});(f=e.BRIGHTNESS_TRANSMITTER.getReadableDpts())&&f.forEach(function(e){a.push({channel:c.deviceAdr+":1",dpt:e})});return a};f.prototype._getDptFromRef=function(a){var c=this.deviceAdr,e={channel:c+":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "volatage":e.channel=c+":0";e.dataPoint=
f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "illu":case "avgIllu":case "maxIllu":case "minIllu":e.channel=c+":1";e.dataPoint=f.BRIGHTNESS_TRANSMITTER.getDptFromState(a);break;default:return null}return e};f.prototype.parseDptState=function(a,c,e){var f=a.indexOf(":");if(-1==f)return null;var b=a.substr(0,f);a=a.substr(f+1);var g=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(g=this.deviceAdr.substr(0,f));if(b!=g)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(0==a){if("UNREACH"==c||"LOW_BAT"==
c||"OPERATING_VOLTAGE"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,e);f={};f["0_"+c.toLowerCase()]=e;return f}return 1==a?f.BRIGHTNESS_TRANSMITTER.parseDptState(c,e):null};return f}(),Va=function(){var f=function(a,c,e){b.call(this,a,c,e);this._chMaintenance=0;this._chPowerMainsTransmitter=1;this.legacyType="ip_pmfs"};util.inherits(f,b);f.prototype._getReadableDpts=function(){var a=this.getSerial(),c=[],e=this,f=x.hub.m.hm._Channel["HmIP-RF"],b=f.MAINTENANCE.getReadableDpts();b&&b.forEach(function(f){"UNREACH"==
f&&c.push({channel:a+":"+e._chMaintenance,dpt:f})});(b=f.POWER_MAINS_TRANSMITTER.getReadableDpts())&&b.forEach(function(f){c.push({channel:a+":"+e._chPowerMainsTransmitter,dpt:f})});return c};f.prototype._getDptFromRef=function(a){var c=this.getSerial(),e={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":e.channel=c+":"+this._chMaintenance;e.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "powerMainsFailure":e.channel=c+":"+this._chPowerMainsTransmitter;
e.dataPoint=f.POWER_MAINS_TRANSMITTER.getDptFromState(a);break;default:return null}return e};f.prototype.parseDptState=function(a,c,e){var f=a.indexOf(":");if(-1==f)return null;var b=a.substr(0,f);a=a.substr(f+1);var g=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(g=this.deviceAdr.substr(0,f));if(b!=g)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(a==this._chMaintenance){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,e);f={};f["0_"+c.toLowerCase()]=e;return f}return a==this._chPowerMainsTransmitter?
f.POWER_MAINS_TRANSMITTER.parseDptState(c,e):null};return f}(),Pa=function(){var f=function(a,c,e){b.call(this,a,c,e);this._chKeyTransceivers=[1];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH","LOW_BAT"];this.legacyType=1==this._chKeyTransceivers.length?"ip_button":"ip_button"+this._chKeyTransceivers};util.inherits(f,b);f.prototype._getReadableDpts=function(){var a=[],c=this,e=this.getSerial(),f=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getReadableDpts();f&&f.forEach(function(f){-1!=
c._chMaintenanceDpts.indexOf(f)&&a.push({channel:e+":"+c._chMaintenance,dpt:f})});return a};f.prototype._getDptFromRef=function(a){return(a=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getDptFromState(a))?{channel:this.getSerial()+":"+this._chMaintenance,dataPoint:a}:null};f.prototype.parseDptState=function(a,c,e){var f=a.indexOf(":");if(-1==f)return null;var b=x.hub.m.hm._Channel["HmIP-RF"],g=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(g!=f)return null;if(parseInt(a)==this._chMaintenance){if(-1!=
this._chMaintenanceDpts.indexOf(c))return b.T_MAINTENANCE.parseDptState(c,e);var h={};h["0_"+c.toLowerCase()]=e;return h}if(-1!=this._chKeyTransceivers.indexOf(parseInt(a))){if(tmp=b.KEY_TRANRECEIVER.parseDptState(c,e))h={},1==this._chKeyTransceivers.length?h=tmp:(tmp.pressShort&&(h["btn"+a+"pressShort"]=!0),tmp.pressLong&&(h["btn"+a+"pressLong"]=!0));return h}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,c){var e=0,f=this,b=function(){e++;e<f._chKeyTransceivers.length?
f._claimButtonEvent(f._chKeyTransceivers[e],a,b):c&&c()};this._claimButtonEvent(this._chKeyTransceivers[e],a,b)};f.prototype._claimButtonEvent=function(a,c,e){var f=this;c.reportValueUsage(this.deviceIF,this.deviceAdr+":"+a,"PRESS_SHORT",function(b,g){b&&console.error("button:"+a+" claim PRESS_SHORT event error:"+b.stack);c.reportValueUsage(f.deviceIF,f.deviceAdr+":"+a,"PRESS_LONG",function(c,f){c&&console.error("button:"+a+" claim PRESS_LONG event error:"+c.stack);e&&e()})})};f.parse=function(a){var c=
null,e=a.address,b=a.address.indexOf(":");-1!=b&&(c=a.address.substr(b+1),e=a.address.substr(0,b));b=null;switch(a.type){case "HmIP-MOD-OC8":b=new f(a.type,a.interface,e),b._chMaintenance=0,b._chMaintenanceDpts=["UNREACH","OPERATING_VOLTAGE"],b._chKeyTransceivers=[parseInt(c)]}return b};f.resolve=function(a,c){return"HmIP-MOD-OC8"==a?this._resolveIPMultiButton(a,c,1,8,["UNREACH","OPERATING_VOLTAGE"]):"HmIP-RCV-50"==a.substr(0,11)?this._resolveIPMultiButton(a,c,1,50,null):null};f._resolveIPMultiButton=
function(a,c,e,b,g){var h,k=[];for(h=0;h<b;h++){var l=new f(a,c.interface,c.address+":"+(h+e));l._chMaintenance=0;g&&(l._chMaintenanceDpts=g);l._chKeyTransceivers=[h+e];k.push(l)}return k};return f}(),P=function(){var f=function(a,c,e){b.call(this,a,c,e);this.channel=1;this._chMaintenance=0;this._chSwitchVirtualReceiver1=2;this._chSwitchVirtualReceiver2=3;this._chSwitchVirtualReceiver3=4;this._chSwitchWeekProfile=5;this.legacyType="ip_switch"};util.inherits(f,b);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var c={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":c.channel+=this._chMaintenance;c.dataPoint="UNREACH";break;case "state":c.channel+=this.channel;c.dataPoint="STATE";break;default:return null}return c};f.prototype.executeCommand=function(a,c,e){var f=this.getSerial(),b=this;switch(c){case "on":var g="STATE";var h=f+":"+this._chSwitchVirtualReceiver1;
a.writeValue(this.deviceIF,h,g,!0,e);break;case "off":g="STATE";h=f+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,h,g,!1,e);break;case "toggle":g="STATE";h=f+":"+this.channel;a.getState({interface:this.deviceIF,channel:h,datapoint:g},function(c,k){c?e&&e(c):k?(c=!0,k.value&&(c=!1),g="STATE",h=f+":"+b._chSwitchVirtualReceiver1,a.writeValue(b.deviceIF,h,g,c,e)):e&&e(Error("get switch current value return invalid"))});break;default:"onFor"==c.substr(0,5)?(c=parseFloat(c.substr(5)),isNaN(c)?
e&&e(Error("onFor command invalid")):(g="ON_TIME",h=f+":"+b._chSwitchVirtualReceiver1,a.writeValue(this.deviceIF,h,g,{type:"double",value:c},function(c){c?e&&e(c):(g="STATE",h=f+":"+b._chSwitchVirtualReceiver1,a.writeValue(b.deviceIF,h,g,!0,e))}))):e&&e(Error("no such command"))}};f.prototype.parseDptState=function(a,c,e){var f=a.indexOf(":");if(-1==f)return null;var b=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(b!=f)return null;switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":return{timeout:e};
default:return b={},b["0_"+c.toLowerCase()]=e,b}case this.channel:switch(c){case "STATE":return{state:1==e?"on":"off"};default:return null}default:return null}};f.parse=function(a){var c=null,e=a.address.indexOf(":");-1!=e&&(c=a.address.substr(e+1));e=null;switch(a.type){case "HmIP-MOD-OC8":e=this._parseTSwitch(a,c,41)}return e};f._parseTSwitch=function(a,c,e){a=new f(a.type,a.interface,a.address);a._chMaintenance=0;a.channel=parseInt(c);a._chSwitchVirtualReceiver1=a.channel+1;a._chSwitchVirtualReceiver2=
a.channel+2;a._chSwitchVirtualReceiver3=a.channel+3;a._chSwitchWeekProfile=e;return a};f.resolve=function(a,c){var e=[];if("HmIP-MOD-OC8"==a)for(i=0;8>i;i++)d=new f(a,c.interface,c.address+":"+(4*i+9)),d._chMaintenance=0,d.channel=4*i+9,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=41,e.push(d);return e};return f}(),Qa=function(){var f=function(a,c,e){b.call(this,a,c,e);this.channel=1;this._chMaintenance=
0;this._chDimmerVirtualReceiver1=2;this._chDimmerVirtualReceiver2=3;this._chDimmerVirtualReceiver3=4;this._chDimmerWeekProfile=13;this.legacyType="ip_dimmer"};util.inherits(f,b);f.prototype._getReadableDpts=function(){var a=[],c=this,e=x.hub.m.hm._Channel["HmIP-RF"],f=e.MAINTENANCE.getReadableDpts();f&&f.forEach(function(e){"UNREACH"==e&&a.push({channel:c.deviceAdr+":"+c._chMaintenance,dpt:e})});(f=e.DIMMER_TRANSMITTER.getReadableDpts())&&f.forEach(function(e){a.push({channel:c.deviceAdr+":"+c.channel,
dpt:e})});(f=e.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(e){a.push({channel:c.deviceAdr+":"+c._chDimmerVirtualReceiver1,dpt:e});a.push({channel:c.deviceAdr+":"+c._chDimmerVirtualReceiver2,dpt:e});a.push({channel:c.deviceAdr+":"+c._chDimmerVirtualReceiver3,dpt:e})});return a};f.prototype._getDptFromRef=function(a){var c=this.getSerail(),e={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":e.channel=c+":"+this._chMaintenance;e.dataPoint=f.MAINTENANCE.getDptFromState(a);
break;case "dimmerLevel":e.channel=c+":"+this.channel;e.dataPoint=f.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;default:return null}return e};f.prototype.executeCommand=function(a,c,e){var f=x.hub.m.hm._Channel["HmIP-RF"],b=c;if(-1!=c.indexOf("dimUp")){var g=c.indexOf("dimUp");b=c.substr(0,g+5);var h=c.substr(g+5)}else-1!=c.indexOf("dimDown")?(g=c.indexOf("dimDown"),b=c.substr(0,g+7),h=c.substr(g+7)):-1!=c.indexOf("dimTo")?(g=c.indexOf("dimTo"),b=c.substr(0,g+5),h=c.substr(g+5)):-1!=
c.indexOf("toggleTo")&&(g=c.indexOf("toggleTo"),b=c.substr(0,g+8),h=c.substr(g+8));var k=this.getSerial(),l=this;switch(b){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chDimmerVirtualReceiver1,"dimOff",e);break;case "dimUp":h=h?parseInt(h)/100:.1;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,b){c?e&&e(c):"undefined"==typeof b||null==b?e&&e(Error("get dimmer current value return invalid")):(h=b.value+h,1<h&&(h=1),
h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,e))});break;case "dimDown":h=h?parseInt(h)/100:.1;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,b){c?e&&e(c):"undefined"==typeof b||null==b?e&&e(Error("get dimmer current value return invalid")):(h=b.value-h,0>h&&(h=0),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,
e))});break;case "dimTo":if(!h){e&&e(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,channel);break;case "toggleTo":if(!h){e&&e(Error("toggle has no value"));break}a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,b){c?e&&e(c):"undefined"==typeof b||null==b?e&&e(Error("get dimmer current value return invalid")):(b.value&&(h=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,
l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,e))});break;default:e&&e(Error("no such command"))}};f.prototype.parseDptState=function(a,c,e){var f=a.indexOf(":");if(-1==f)return null;var b=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(b!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":return f.MAINTENANCE.parseDptState(c,e);default:return b={},b["0_"+c.toLowerCase()]=e,b}case this.channel:if(c=f.DIMMER_TRANSMITTER.parseDptState(c,
e))b={},b.dimmerLevel=c.dimmerTLevel;return b}return null};return f}(),Ra=function(){var f=function(a,c,e){b.call(this,a,c,e);this.channel=1;this._chMaintenance=0;this._chBlindVirtualReceiver1=2;this._chBlindVirtualReceiver2=3;this._chBlindVirtualReceiver3=4;this._chBlindWeekProfile=5;this.legacyType="ip_jalousie"};util.inherits(f,b);f.prototype._getReadableDpts=function(){var a=[],c=this,e=x.hub.m.hm._Channel["HmIP-RF"],f=e.MAINTENANCE.getReadableDpts();f&&f.forEach(function(e){"UNREACH"==e&&a.push({channel:c.deviceAdr+
":"+c._chMaintenance,dpt:e})});(f=e.BLIND_TRANSMITTER.getReadableDpts())&&f.forEach(function(e){a.push({channel:c.deviceAdr+":"+c.channel,dpt:e})});(f=e.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(e){a.push({channel:c.deviceAdr+":"+c._chBlindVirtualReceiver1,dpt:e});a.push({channel:c.deviceAdr+":"+c._chBlindVirtualReceiver2,dpt:e});a.push({channel:c.deviceAdr+":"+c._chBlindVirtualReceiver3,dpt:e})});return a};f.prototype._getDptFromRef=function(a){var c=this.getSerial(),e={channel:null,
dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":e.channel=c+":"+this._chMaintenance;e.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "blindLevel":e.channel=c+":"+this.channel;e.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":e.channel=c+":"+this.channel;e.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;default:return null}return e};f.prototype.executeCommand=function(a,c,e){var f=x.hub.m.hm._Channel["HmIP-RF"],
b=c;if(-1!=c.indexOf("stepUp")){var g=c.indexOf("stepUp");b=c.substr(0,g+6);var h=c.substr(g+6)}else-1!=c.indexOf("stepDown")?(g=c.indexOf("stepDown"),b=c.substr(0,g+8),h=c.substr(g+8)):-1!=c.indexOf("moveTo")?(g=c.indexOf("moveTo"),b=c.substr(0,g+6),h=c.substr(g+6)):-1!=c.indexOf("stop")?(g=c.indexOf("stop"),b=c.substr(0,g+4),h=c.substr(g+4)):-1!=c.indexOf("lamellaStepUp")?(g=c.indexOf("lamellaStepUp"),b=c.substr(0,g+13),h=c.substr(g+13)):-1!=c.indexOf("lamellaStepDown")?(g=c.indexOf("lamellaStepDown"),
b=c.substr(0,g+15),h=c.substr(g+15)):-1!=c.indexOf("lamellaTo")&&(g=c.indexOf("lamellaTo"),b=c.substr(0,g+9),h=c.substr(g+9));var k=this.getSerial(),l=this;switch(b){case "stop":case "moveUp":case "moveDown":f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,b,e);break;case "lamellaUp":case "lamellaDown":a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,g){c?e&&e(c):"undefined"==typeof g||null==g?e&&e(Error("get blind current value return invalid")):
f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,"lamellaTo"+(b=100),function(c){c?e&&e(c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+Math.round(100*g.value),e)})});break;case "stepUp":case "stepDown":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,g){c?e&&e(c):"undefined"==typeof g||null==g?e&&e(Error("get blind current value return invalid")):
(h="stepUp"==b?g.value+h:g.value-h,1<h&&(h=1),0>h&&(h=0),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+h,e))});break;case "moveTo":if(!h){e&&e(Error("moveTo has no value"));break}f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,"moveTo"+h,e);break;case "lamellaStepUp":case "lamellaStepDown":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},
function(c,g){if(c)e&&e(c);else if("undefined"==typeof g||null==g)e&&e(Error("get blind current value return invalid"));else{var m=g.value;m=Math.round(100*m);a.getState({interface:l.deviceIF,channel:k+":"+l.channel,datapoint:"LEVEL_2"},function(c,g){c?e&&e(c):"undefined"==typeof g||null==g?e&&e(Error("get lamella current value return invalid")):(h="lamellaStepUp"==b?g.value+h:g.value-h,1<h&&(h=1),0>h&&(h=0),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,
"lamellaTo"+h,function(c,b){c?e&&e(c,b):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+m,e)}))})}});break;case "lamellaTo":if(!h){e&&e(Error("lamellaTo has no value"));break}a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,b){if(c)e&&e(c);else if("undefined"==typeof b||null==b)e&&e(Error("get blind current value return invalid"));else{var g=b.value;g=Math.round(100*g);f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,
l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"lamellaTo"+h,function(c){c?e&&e(c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+g,e)})}});break;default:e&&e(Error("no such command"))}};f.prototype.parseDptState=function(a,c,e){var f=a.indexOf(":");if(-1==f)return null;var b=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(b!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];b=null;switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":return f.MAINTENANCE.parseDptState(c,
e);default:return b={},b["0_"+c.toLowerCase()]=e,b}case this.channel:if(e=f.BLIND_TRANSMITTER.parseDptState(c,e))b={},"LEVEL"==c?b.blindLevel=e.blindTPos:"LEVEL_2"==c&&(b.lamellaLevel=e.lamellaTPos);return b}return null};f.prototype.getConfig=function(a,c){var e=this.getSerial()+":"+this.channel;a.getParamset(this.deviceIF,e,"MASTER",function(a,f){if(a)c&&c(a);else{var b={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});b[e]=g;c&&c(a,b)}})};f.prototype.setConfig=function(a,c,e){if(c){var f=
this.getSerial()+":"+this.channel;if(c=c[f]){var b={};b.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:c.CHANGE_OVER_DELAY};b.REFERENCE_RUN_COUNTER=c.REFERENCE_RUN_COUNTER;b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};b.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_SLATS_UNIT};b.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_SLATS_VALUE};a.setParamset(this.deviceIF,f,"MASTER",b,function(a){e&&e(a)})}else e&&e(Error("config data not complete"))}else e&&e(Error("config data invalid"))};return f}(),
Q=function(){var f=function(a,e,f){b.call(this,a,e,f);this.channel=1;this._chMaintenance=0;this.legacyType="ip_multi_input"};util.inherits(f,b);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var c={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":c.channel+=this._chMaintenance;c.dataPoint="UNREACH";break;case "state":c.channel+=
this.channel;c.dataPoint="STATE";break;default:return null}return c};f.prototype.parseDptState=function(a,e,f){var c=a.indexOf(":");if(-1==c)return null;var b=a.substr(0,c);a=a.substr(c+1);c=this.getSerial();if(b!=c)return null;b=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(e){case "UNREACH":return{timeout:f};default:return b={},b["0_"+e.toLowerCase()]=f,b}case this.channel:switch(e){case "STATE":return{state:1==f?"on":"off"};case "PRESS_SHORT":case "PRESS_LONG":return b.KEY_TRANRECEIVER.parseDptState(e,
f);default:return null}default:return null}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,e){this._claimButtonEvent(this.channel,a,function(){e&&e()})};f.prototype._claimButtonEvent=function(a,e,f){var c=this.getSerial()+":"+a,b=this;e.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(g,h){g&&console.error("button:"+a+" claim PRESS_SHORT event error:"+g.stack);e.reportValueUsage(b.deviceIF,c,"PRESS_LONG",function(c,e){c&&console.error("button:"+a+" claim PRESS_LONG event error:"+
c.stack);f&&f()})})};var a=function(a,e,b){f.call(this,a,e,b);this.legacyType="ip_multi_input_bat"};util.inherits(a,f);a.prototype._getReadableDpts=function(){for(var a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts,e=x.hub.m.hm._Channel["HmIP-RF"].MULTI_MODE_INPUT_TRANSMITTER.getReadableDpts,f=[],b=0;b<a.length;b++)f.push({channel:this.deviceAdr+":"+this._chMaintenance,dpt:a[b]});for(b=0;b<e.length;b++)f.push({channel:this.deviceAdr+":"+this.channel,dpt:e[b]});return f};a.prototype._getDptFromRef=
function(a){var c={channel:this.getSerial()+":",dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "voltage":case "errorCode":c.channel+=this._chMaintenance;c.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":c.channel+=this.channel;c.dataPoint=f.MULTI_MODE_INPUT_TRANSMITTER.getDptFromState(a);break;default:return null}return c};a.prototype.parseDptState=function(a,e,f){var c=a.indexOf(":");if(-1==c)return null;var b=a.substr(0,c);a=a.substr(c+
1);c=this.getSerial();if(b!=c)return null;b=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(e){case "UNREACH":case "LOW_BAT":case "OPERATING_VOLTAGE":case "ERROR_CODE":return b.MAINTENANCE_BAT_EL.parseDptState(e,f);default:return b={},b["0_"+e.toLowerCase()]=f,b}case this.channel:switch(e){case "STATE":case "PRESS_SHORT":case "PRESS_LONG":return b.MULTI_MODE_INPUT_TRANSMITTER.parseDptState(e,f);default:return null}default:return null}};f.resolve=function(c,e){if("HmIP-FCI"==
c.substr(0,8)){var b=parseInt(c.substr(8));var g=a}else"HmIP-MOD-RC"==c.substr(0,11)?(b=parseInt(c.substr(11)),g=a):"HmIPW-DRI"==c.substr(0,9)&&(b=parseInt(c.substr(9)),g=f);return this._resolveIPMultiInput(c,e,b,g)};f._resolveIPMultiInput=function(a,e,f,b){var c,g=[];for(c=0;c<f;c++){var h=new b(a,e.interface,e.address+":"+(c+1));h._chMaintenance=0;h.channel=c+1;g.push(h)}return g};f.parse=function(c){var e=null,f=c.address,b=c.address.indexOf(":");-1!=b&&(e=c.address.substr(b+1),f=c.address.substr(0,
b));b=Q;if("HmIP-FCI1"==c.type||"HmIP-FCI6"==c.type||"HmIP-MOD-RC8"==c.type)b=a;c=new b(c.type,c.interface,f);c._chMaintenance=0;c.channel=parseInt(e);return c};return f}(),t={};t.CLASS_MAP={maintenance:k,button:n,vbutton:g,switch:h,dimmer:l,blind:q,powerswitch:m,weather:r,heater:w,heater2:u,heater3:na,wallthermo:R,wallthermo2:S,contact:oa,weatherstation:v,rain:T,gong2:D,gong:Ma,window:pa,temp:qa,co2:sa,motion:ta,smoke:ua,siren:U,capacity:va,switch_interface:L,tilt:wa,temp2:ra,water:xa,weather2:p,
energymeter:ya,rgb:M,lux:za,siren2:V,jalousie:W,mod_em_8bit:E,mod_em_8:F,keymatic:X,ou_led16:G,hm_dis_ep_wm55:Na,dualwhite:Y};t.CLASS_MAP_IP={ip_switch:Oa,ip_contact:Aa,ip_heater:Z,ip_powerswitch:aa,ip_energyactor:ba,ip_dimmer:da,ip_motion:ha,ip_motion2:H,ip_button2:O,ip_siren:ia,ip_wallthermo:B,ip_smoke:ja,ip_window:Ca,ip_button4:I,ip_dimmer2:ea,ip_energyactor2:ca,ip_blind:y,ip_jalousie:z,ip_presence:ka,ip_dimmer3:fa,ip_wallthermo2:Ba,ip_floor_heater:Da,ip_floor_pump_heater:Ea,ip_button6:J,ip_weather:Fa,
ip_weather2:Ga,ip_weather3:Ha,ip_weather4:Ia,ip_direction:la,ip_button8:K,ip_generic_input:Ja,ip_analog_output:ma,ip_water:Ka,ip_acce:La,ip_garagedoor:C,ip_bsl:Sa,ip_tormatic:Ta,ip_button:N,ip_lux:Ua,ip_pmfs:Va};t.parseJson=function(f){if(!(f&&f.type&&f.interface&&f.address))return null;switch(f.interface){case "BidCos-RF":f=this._parseRFDeviceJson(f);break;case "HmIP-RF":f=this._parseIPDeviceJson(f);break;default:return null}return f};t._parseRFDeviceJson=function(f){var a=x.hub.m.hm.RFDeviceTypes[f.type];
if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.RFDeviceCatagory[a];if(!a||!a.type)return null;var c=this.CLASS_MAP[a.type];if(!c)return null;a=null;var e=f.address.indexOf(":");-1!=e&&(a=f.address.substr(e+1));"HM-Dis-EP-WM55"==f.type&&3==a&&(c=this.CLASS_MAP.hm_dis_ep_wm55);f=new c(f.type,f.interface,f.address);a&&(f.channel=parseInt(a));return f};t._parseIPDeviceJson=function(f){if("HmIPW"==f.type.substr(0,5))return this._parseIPW(f);if("HmIP-MIOB"==f.type)return t._parse_HMIP_MIOB(f);
if("HmIP-FCI1"==f.type||"HmIP-FCI6"==f.type||"HmIP-MOD-RC8"==f.type)return Q.parse(f);var a=null,c=f.address.indexOf(":");-1!=c&&(a=f.address.substr(c+1));switch(f.type){case "HmIP-WHS2":return this._parseTSwitch(f,a,9);case "HmIP-MOD-OC8":return 8>=parseInt(a)?Pa.parse(f):P.parse(f)}a=t._getIPMetaIndex(f.type);if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.IPDeviceCatagory[a];if(!a||!a.type)return null;var e=this.CLASS_MAP_IP[a.type];if(!e)return null;a=null;c=f.address.indexOf(":");
-1!=c&&(a=f.address.substr(c+1));f=new e(f.type,f.interface,f.address);a&&(f.channel=parseInt(a));return f};t._parseIPW=function(f){var a=null;var c=f.address.indexOf(":");-1!=c&&(a=f.address.substr(c+1));return"HmIPW-DRS"==f.type.substr(0,9)?(c=parseInt(f.type.substr(9)),f=new P(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chSwitchVirtualReceiver1=f.channel+1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=4*c+1,
f):"HmIPW-DRD"==f.type.substr(0,9)?(c=parseInt(f.type.substr(9)),f=new Qa(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chDimmerVirtualReceiver1=f.channel+1,f._chDimmerVirtualReceiver2=f.channel+2,f._chDimmerVirtualReceiver3=f.channel+3,f._chDimmerWeekProfile=4*c+1,f):"HmIPW-DRBL"==f.type.substr(0,10)?(c=parseInt(f.type.substr(10)),f=new Ra(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chBlindVirtualReceiver1=f.channel+1,f._chBlindVirtualReceiver2=
f.channel+2,f._chBlindVirtualReceiver3=f.channel+3,f._chBlindWeekProfile=4*c+1,f):"HmIPW-DRI"==f.type.substr(0,9)?(parseInt(f.type.substr(9)),f=new Q(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f):"HmIPW-FIO"==f.type.substr(0,9)?(c=parseInt(f.type.substr(9)),a=parseInt(a),a<=c?(f=new Q(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a)):(f=new P(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chSwitchVirtualReceiver1=f.channel+
1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=c+4*c+1),f):null};t._parse_HMIP_MIOB=function(f){var a=f.address,c=null,e=f.address.indexOf(":");-1!=e&&(a=f.address.substr(0,e),c=f.address.substr(e+1));e=null;0==c?e=this.CLASS_MAP.maintenance:3==c||7==c?e=this.CLASS_MAP_IP.ip_switch:9==c||10==c?e=this.CLASS_MAP_IP.ip_generic_input:11==c&&(e=this.CLASS_MAP_IP.ip_analog_output);return e?(f=new e(f.type,f.interface,a),f.channel=c,f):null};t._parseTSwitch=
function(f,a,c){f=new P(f.type,f.interface,f.address);f._chMaintenance=0;f.channel=parseInt(a);f._chSwitchVirtualReceiver1=f.channel+1;f._chSwitchVirtualReceiver2=f.channel+2;f._chSwitchVirtualReceiver3=f.channel+3;f._chSwitchWeekProfile=c;return f};t.resolve=function(f){if(!f||!f.type||!f.interface)return null;switch(f.interface){case "BidCos-RF":f=this._resolveRFFromType(f.type,f);break;case "HmIP-RF":f=this._resolveIPFromType(f.type,f);break;default:return null}return f?Array.isArray(f)?f:[f]:
null};t._resolveRFFromType=function(f,a){if("HM-MOD-EM-8"==f)return this._resolve_HM_MOD_EM_8(f,a);if("HM-OU-LED16"==f)return this._resolve_HM_OU_LED16(f,a);if("HM-Dis-EP-WM55"==f)return this._resolve_HM_Dis_EP_WM55(f,a);var c=x.hub.m.hm.RFDeviceTypes[f];if("undefined"==typeof c||null==c)return null;c=x.hub.m.hm.RFDeviceCatagory[c];if(!c||!c.type)return this._resolveRFFromTypeGeneral(f,a);var e=[];if(a.channels)for(var b in a.channels){var g=a.channels[b];g.type==c.channel&&e.push(g)}var h=this.CLASS_MAP[c.type];
if(!h)return null;if("*"==c.channelNum){var k=[];e.forEach(function(c){var b=new h(f,a.interface,a.address),g=c.address.indexOf(":");1<e.length&&(b.deviceAdr=c.address);b.channel=c.address.substr(g+1);k.push(b)});return k}b=new h(f,a.interface,a.address);"undefined"!=typeof c.channelNum&&null!=c.channelNum&&(b.channel=c.channelNum);return b};t._resolveIPFromType=function(f,a){if("HmIPW"==f.substr(0,5))return this._resolveIPW(f,a);if("HmIP-MOD-OC8"==f){var c=Pa.resolve(f,a),e=P.resolve(f,a);return c.concat(e)}if(0==
f.indexOf("HmIP-FAL"))return t._resolve_HMIP_FAL_X(f,a);if(0==f.indexOf("HmIP-MIOB"))return t._resolve_HMIP_MIOB(f,a);switch(f){case "HmIP-WHS2":return this._resolveIPMultiSwitch(f,a,2);case "HmIP-FCI1":case "HmIP-FCI6":case "HmIP-MOD-RC8":return Q.resolve(f,a)}c=this._getIPMetaIndex(f);if("undefined"==typeof c||null==c)return null;c=x.hub.m.hm.IPDeviceCatagory[c];if(!c||!c.type)return null;var b=[];if(a.channels)for(e in a.channels){var g=a.channels[e];g.type==c.channel&&b.push(g)}var h=this.CLASS_MAP_IP[c.type];
if(!h)return null;if("*"==c.channelNum){var k=[];b.forEach(function(c){var e=new h(f,a.interface,a.address),g=c.address.indexOf(":");1<b.length&&(e.deviceAdr=c.address);e.channel=c.address.substr(g+1);k.push(e)});return k}e=new h(f,a.interface,a.address);"undefined"!=typeof c.channelNum&&null!=c.channelNum&&(e.channel=c.channelNum);return e};t._resolveIPW=function(f,a){var c,e=[];if("HmIPW-DRS"==f.substr(0,9)){var b=parseInt(f.substr(9));e=this._resolveIPMultiSwitch(f,a,b)}else if("HmIPW-DRD"==f.substr(0,
9))for(b=parseInt(f.substr(9)),c=0;c<b;c++){var g=new Qa(f,a.interface,a.address+":"+(4*c+1));g._chMaintenance=0;g.channel=4*c+1;g._chDimmerVirtualReceiver1=g.channel+1;g._chDimmerVirtualReceiver2=g.channel+2;g._chDimmerVirtualReceiver3=g.channel+3;g._chDimmerWeekProfile=4*b+1;e.push(g)}else if("HmIPW-DRBL"==f.substr(0,10))for(b=parseInt(f.substr(10)),c=0;c<b;c++)g=new Ra(f,a.interface,a.address+":"+(4*c+1)),g._chMaintenance=0,g.channel=4*c+1,g._chBlindVirtualReceiver1=g.channel+1,g._chBlindVirtualReceiver2=
g.channel+2,g._chBlindVirtualReceiver3=g.channel+3,g._chBlindWeekProfile=4*b+1,e.push(g);else if("HmIPW-DRI"==f.substr(0,9))for(b=parseInt(f.substr(9)),c=0;c<b;c++)g=new Q(f,a.interface,a.address+":"+(c+1)),g._chMaintenance=0,g.channel=c+1,e.push(g);else if("HmIPW-FIO"==f.substr(0,9))for(b=parseInt(f.substr(9)),c=0;c<b;c++)g=new Q(f,a.interface,a.address+":"+(c+1)),g._chMaintenance=0,g.channel=c+1,e.push(g),g=new P(f,a.interface,a.address+":"+(4*c+b+1)),g._chMaintenance=0,g.channel=4*c+b+1,g._chSwitchVirtualReceiver1=
g.channel+1,g._chSwitchVirtualReceiver2=g.channel+2,g._chSwitchVirtualReceiver3=g.channel+3,g._chSwitchWeekProfile=b+4*b+1,e.push(g);return e};t._resolveIPMultiSwitch=function(f,a,c){var e,b=[];for(e=0;e<c;e++){var g=new P(f,a.interface,a.address+":"+(4*e+1));g._chMaintenance=0;g.channel=4*e+1;g._chSwitchVirtualReceiver1=g.channel+1;g._chSwitchVirtualReceiver2=g.channel+2;g._chSwitchVirtualReceiver3=g.channel+3;g._chSwitchWeekProfile=4*c+1;b.push(g)}return b};t._resolveRFFromTypeGeneral=function(f,
a){var c=[];if(!a||!a.channels)return null;var e=a.channels,b;for(b in e){var g=e[b];if(g&&g.type&&x.hub.m.hm._Channel["BidCos-RF"][g.type]&&(g=x.hub.m.hm._Channel["BidCos-RF"][g.type].device)&&(g=this.CLASS_MAP[g])){g=new g(f,a.interface,b);var h=b.indexOf(":");g.channel=b.substr(h+1);c.push(g)}}return c};t._resolve_HM_MOD_EM_8=function(f,a){var c=[];if(!a||!a.channels)return null;var e=a.channels,b;for(b in e){e=b.indexOf(":");e=b.substr(e+1);var g=new (0==e?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(f,
a.interface,b);g.channel=e;c.push(g)}return c};t._resolve_HM_OU_LED16=function(f,a){var c=[];if(!a||!a.channels)return null;var e=a.channels,b;for(b in e){e=b.indexOf(":");e=b.substr(e+1);var g=new (0==e?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(f,a.interface,b);g.channel=e;c.push(g)}return c};t._resolve_HM_Dis_EP_WM55=function(f,a){var c=[];if(!a||!a.channels)return null;var e=a.channels,b;for(b in e){e=b.indexOf(":");e=b.substr(e+1);var g=null;0==e?g=this.CLASS_MAP.maintenance:1==e||2==
e?g=this.CLASS_MAP.button:3==e&&(g=this.CLASS_MAP.hm_dis_ep_wm55);g&&(g=new g(f,a.interface,b),g.channel=e,c.push(g))}return c};t._resolve_HMIP_FAL_X=function(f,a){var c=[];if(!a||!a.channels)return null;var e=a.channels,b;for(b in e){var g=e[b],h=b.indexOf(":");h=b.substr(h+1);if(0==h)var k=this.CLASS_MAP.maintenance;else"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==g.type?k=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==g.type&&(k=this.CLASS_MAP_IP.ip_floor_heater);k&&(g=
new k(f,a.interface,b),g.channel=h,c.push(g))}return c};t._resolve_HMIP_MIOB=function(f,a){var c=[];if(!a||!a.channels)return null;var e=a.channels,b;for(b in e){e=b.indexOf(":");e=b.substr(e+1);var g=null;0==e?g=this.CLASS_MAP.maintenance:3==e||7==e?g=this.CLASS_MAP_IP.ip_switch:9==e||10==e?g=this.CLASS_MAP_IP.ip_generic_input:11==e&&(g=this.CLASS_MAP_IP.ip_analog_output);g&&(g=new g(f,a.interface,b),g.channel=e,c.push(g))}return c};t._getIPMetaIndex=function(f){for(var a in x.hub.m.hm.IPDeviceTypes)if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(a)&&
a.toUpperCase()==f.toUpperCase())return x.hub.m.hm.IPDeviceTypes[a];return null};return t}();
x.hub.m.hm.Manager=function(){var b=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager");this._gateway=b;this._devices={};this._meta={}};b.prototype.init=function(b){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(b)):b&&b()};b.prototype.onDeviceEvent=function(b){this._logger.log("trace","receive device event:"+JSON.stringify({device:b.device?b.device.type:null,address:b.device?b.device.address:
null,channel:b.channel,datapoint:b.datapoint,value:b.value?b.value.value:null,ip:b.ip}));var k=function(b,g){var h=null;if(!g||0==g.length)return null;g.forEach(function(g){g&&g.key==b&&(h=g)});return h};if(!b||!b.device)return null;var g=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!g)return null;var h=b.device;h.hsstype=h.type;if(h.channels)for(var l in h.channels)if(h.channels.hasOwnProperty(l)){var q=h.channels[l];q.hsstype=q.type}h=g._parseDevice(h);if(!h||0==h.length)return null;var m;
1==h.length?m=h[0]:h.forEach(function(g){if(g.address==b.channel)m=g;else if(0==b.channel.indexOf(g.address)){var h=b.channel.split(":")[1];if(g.channels)for(var k in g.channels)if(g.channels[k].address==h){m=g;break}}});if(!m)return null;h=x.hub.m.hm._Util.getDeviceHashCode(m);var r=g.resolveState(m,b,b.oldValue.value);g=g.resolveState(m,b,b.value.value);if(!g)return null;this._logger.log("trace","event to device state");this._logger.log("trace","device:"+JSON.stringify(m));this._logger.log("trace",
"state:"+JSON.stringify(g));var p=[];Array.isArray(g)?g.forEach(function(b){var g=k(b.key,r);p.push({device:m,gateway:this._gateway,data:{key:b.key,value:b.value,changed:g?b.value!=g.value:!0,oldValue:g?g.value:void 0}})}.bind(this)):p.push({device:m,gateway:this._gateway,data:{key:g.key,value:g.value,changed:g.value!=r.value,oldValue:r.value}});this._generateEvent(h,p)};b.prototype._generateEvent=function(b,n){var g=require("x.hub.eventbus.js");if((b=this._meta[b])&&0<b.length)for(var h=0;h<b.length;h++){var k=
b[h];if(k)for(var q=0;q<n.length;q++){var m=n[q];m&&m.data&&(m.data.key==k.statusKey||"*"==m.data.key)&&g.emit("status",{module:"hm",device:m.device,gateway:m.gateway,data:m.data},k)}}};b.prototype.addStateDevice=function(b,n,g){if(b){b=JSON.parse(JSON.stringify(b));var h=x.hub.m.hm._Util.getDeviceHashCode(b);this._devices[h]||(delete b.gateway,this._devices[h]=b);this._meta[h]||(this._meta[h]=[]);g&&this._meta[h].push(g);n&&n()}else n&&n(Error("device json invalid"))};b.prototype.removeStateDevice=
function(b,n,g){if(!b)n&&n(Error("device json invalid"));else if(g){b=JSON.parse(JSON.stringify(b));b=x.hub.m.hm._Util.getDeviceHashCode(b);var h=this._meta[b];if(h){for(var k=-1,q=0;q<h.length;q++){var m=h[q];if(m&&"taskman"==m.src&&"taskman"==g.src&&m.taskID==g.taskID&&m.statusKey==g.statusKey){k=q;break}}0<=k&&h.splice(k,1);0==h.length&&(delete this._devices[b],delete this._meta[b])}n&&n()}};b.prototype.getAllStates=function(){var b=[],n;for(n in this._devices)if(this._devices.hasOwnProperty(n)){var g=
this._devices[n];g&&g.device&&(g=this.getStates(g.device))&&b.push(g)}return b};b.prototype.getStates=function(b){if(!b)return null;b=JSON.parse(JSON.stringify(b));var k=x.hub.m.hm._Util.getDeviceHashCode(b),g=this._devices[k];g||this.addStateDevice(b);var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return null;var l={};g=this._devices[k];for(var q in g.states)k=h.getBufferedState(g.states[q]),l[q]=this._resolveRawState(b,q,k);return{device:b,gateway:this._gateway,
states:l}};b.prototype.updateStates=function(b,n){if(b){b=JSON.parse(JSON.stringify(b));var g=x.hub.m.hm._Util.getDeviceHashCode(b),h=this._devices[g];h||this.addStateDevice(b);h=this._devices[g];this._updateStates(b,h.states,n)}else n&&n(Error("device json is null"))};b.prototype.getState=function(b,n,g){if(!b||!n)return g&&g(Error("argument invalid")),null;if("SysVar"==b.type||"CUxD"==b["interface"])x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,b,{value:n},function(b,h){b?g&&g(b):h?(b={value:h.status,
time:(new Date).getTime()},g&&g(null,b)):g&&g(Error("get sys var status return null"))});else{b=JSON.parse(JSON.stringify(b));var h=x.hub.m.hm._Util.getDeviceHashCode(b);this._devices[h]||this.addStateDevice(b);h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return g&&g(Error("no monitor for gateway")),null;var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return g&&g(Error("gateway json invalid")),null;var q=k.resolveDatapointInfo(b,n);
if(!q)return g&&g(Error("device json or state ref invalid")),null;h.getState(q,function(h,l){if(h)g&&g(h);else if(l){h=k.resolveState(b,q,l.value);var m;h?Array.isArray(h)?h.forEach(function(b){b&&b.key==n&&(m={value:b.value,time:l.time})}):m={value:h.value,time:l.time}:m={value:h,time:l.time};g&&g(null,m)}else g&&g(null,null)})}};b.prototype.executeCommand=function(b,n,g){var h=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!h)return g&&g(Error("gateway json invalid")),null;h.executeCommandCreator(b,
n,g)};b.prototype.updateState=function(b,n,g){if(!b||!n)return g&&g(Error("argument invalid")),null;b=JSON.parse(JSON.stringify(b));var h=x.hub.m.hm._Util.getDeviceHashCode(b);this._devices[h]||this.addStateDevice(b);h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return g&&g(Error("no monitor for gateway")),null;var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return g&&g(Error("gateway json invalid")),null;var q=k.resolveDatapointInfo(b,
n);if(!q)return g&&g(Error("device json or state ref invalid")),null;h.updateState(q,function(h,l){if(h)g&&g(h);else{h=k.resolveState(b,q,l);var m;h?Array.isArray(h)?h.forEach(function(b){b&&b.key==n&&(m={value:b.value})}):m={value:h.value}:m={value:h};g&&g(null,m)}})};b.prototype._startMonitor=function(b){var k=require("x.hub.m.hm.js")._monitorManager,g=this;k.startMonitor(this._gateway,{persistant:!0},function(h){var l=k.getMonitor(g._gateway.ip,g._gateway.uuid);if(l)l.on("new_devices",g._onNewDevices.bind(g));
b&&b(h)})};b.prototype._onNewDevices=function(b){var k=[],g;for(g in b)if(b.hasOwnProperty(g)){var h=x.hub.m.hm._Device.resolve(b[g]);h&&0<h.length&&(h=h.filter(function(b){return b&&b.isButton()}),k=k.concat(h))}var l=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(l&&0<k.length){var q=0,m=function(){q++;q<k.length&&k[q].claimEvent(l,m)};k[q].claimEvent(l,m)}};b.prototype._updateStates=function(b,n,g){var h=this;require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,
{persistant:!0},function(k){k?g&&g(k):h._getStateByScript(b,n,g)})};b.prototype._resolveDetailDpt=function(b){var k=require("xnm.aio.hm.js").devicemanager,g=k.applyUIFilter(b,{catagory:"status",elems:"*"}),h=g?g.status:null;k=(g=k.applyUIFilter(b,{catagory:"command",elems:"*"}))?g.command:null;g={states:{},commands:{}};if(h&&0<=h.length)for(var l=0;l<h.length;l++){var q=h[l],m=this._resolveDatapointRef(b,q.ref.value,!1);m&&(g.states[q.ref.value]=m)}if(k&&0<=k.length)for(l=0;l<k.length;l++)h=k[l],
(m=this._resolveDatapointRef(b,h.ref.value,!0))&&(g.commands[h.ref.value]=m);return g};b.prototype.learnRFDevice=function(b){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);k?k.learnRF(function(g,h){if(g)b&&b(g);else{g=[];var k=new x.hub.m.hm.HM_MODULE.CCU,n;for(n in h){var m=h[n];m.hsstype=m.type;if(m.channels)for(n in m.channels)m.channels[n].hsstype=m.channels[n].type;(m=k._parseDevice(m))&&(g=g.concat(m))}b&&b(null,g)}}):b&&b(Error("monitor not started"))};
b.prototype.learnIPDevice=function(b,n,g){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnIP(b,n,function(b,h){if(b)g&&g(b);else{b=[];var k=new x.hub.m.hm.HM_MODULE.CCU,l;for(l in h){var n=h[l];n.hsstype=n.type;if(n.channels)for(l in n.channels)n.channels[l].hsstype=n.channels[l].type;(n=k._parseDevice(n))&&(b=b.concat(n))}g&&g(null,b)}}):g&&g(Error("monitor not started"))};b.prototype.learnIPDeviceQR=function(b,n){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,
this._gateway.uuid);g?g.learnIPQR(b,function(b,g){if(b)n&&n(b);else{b=[];var h=new x.hub.m.hm.HM_MODULE.CCU,k;for(k in g){var l=g[k];l.hsstype=l.type;if(l.channels)for(k in l.channels)l.channels[k].hsstype=l.channels[k].type;(l=h._parseDevice(l))&&(b=b.concat(l))}n&&n(null,b)}}):n&&n(Error("monitor not started"))};b.prototype.deleteDevice=function(b,n,g){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.deleteDevice(b,n,g):g&&g(Error("monitor not started"))};
b.prototype.getRFInterfaces=function(b){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);k?k.getRFInterfaces(b):b&&b(Error("monitor not started"))};return b}();x.hub.m.hm.ChipManager=function(b){x.hub.m.hm.Manager.call(this,b);this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager")};util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager);
x.hub.m.hm.ChipManager.prototype.init=function(b){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var k=this,n=require("x.hub.m.hm.js")._monitorManager;n.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(g){var h=n.getMonitor(k._gateway.ip,k._gateway.uuid);if(h)h.on("new_devices",k._onNewDevices.bind(k));b&&b(g)},!0,!0)}else b&&b()};
x.hub.m.hm.ChipManager.prototype.reset=function(b){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return b&&b(Error("no chip monitor")),null;k.reset(b)};
x.hub.m.hm.ChipManager.prototype.executeCommand=function(b,k,n){if(b&&b.address&&k)if(b=b.address.split("."),3>b.length)n&&n({error:Error("address invalid")});else{var g={type:b[0],interface:b[1],address:b[2]};b=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!b)return n&&n(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.executeCommand(b,k.value,n):n&&n(Error("unknow device"))}else n&&n(Error("argument invalid"))};
x.hub.m.hm.ChipManager.prototype.getState=function(b,k,n){if(!b||!b.address||!k)return n&&n(Error("argument invalid")),null;b=b.address.split(".");if(3>b.length)n&&n(Error("address invalid"));else{var g={type:b[0],interface:b[1],address:b[2]};b=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!b)return n&&n(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.getState(b,k.value,n):n&&n(Error("unknow device"))}};
x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(b,k){if(!b)return null;b=x.hub.m.hm._Device.resolve(b);if(!b||0==b.length)return null;var n;1==b.length?n=b[0]:b.forEach(function(b){b.deviceAdr==k&&(n=b)});if(!n)return null;var g;if(b=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid)){b=b.getAllBufferedStates();var h=n.deviceAdr,l=h.indexOf(":");-1!=l&&(h=h.substr(0,l));b[h]&&b[h].states&&(g=n.parseStates(b[h].states))}if(!g)return null;b={type:"HM",
adr:n.toLegacyAdr(),state:{}};for(var q in g)b.state[q]=g[q].value;return b};
x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(b){if(!b||!b.device||!b.datapoint||0!=b.datapoint.indexOf("PRESS"))return null;var k=x.hub.m.hm._Device.resolve(b.device);if(!k||0==k.length)return null;var n;1==k.length?n=k[0]:k.forEach(function(g){g.deviceAdr==b.channel&&(n=g)});if(!n)return null;k=n.parseDptState(b.channel,b.datapoint,b.value.value);if(!k)return null;var g={type:"HM",adr:n.deviceType+"."+n.deviceIF+"."+n.deviceAdr,state:{},_ver:"v5+"},h=Object.keys(k);g.state[h[0]]=k[h[0]];
require("x.hub.eventbus.js").emit("gatewayevent",g,{address:"HM"},"BTN")};
x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(b){if(!b||!b.device)return null;var k=x.hub.m.hm._Device.resolve(b.device);if(!k||0==k.length)return null;var n;1==k.length?n=k[0]:k.forEach(function(g){g.deviceAdr==b.channel&&(n=g)});if(!n)return null;k=n.parseDptState(b.channel,b.datapoint,b.oldValue.value);var g=n.parseDptState(b.channel,b.datapoint,b.value.value);if(!g)return null;var h={sys:"aio",type:"HM",address:n.deviceType+"."+n.deviceIF+"."+n.deviceAdr},l=this._gateway,q={key:null,
value:null,changed:b.changed,oldValue:null},m=Object.keys(g);q.key=m[0];q.value=g[m[0]];q.oldValue=k?k[m[0]]:void 0;this._logger.log("debug","EVENT:\t"+h.address+"\t"+q.key+"\t"+q.value);return{device:h,gateway:l,data:q}};
x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(b){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);k?k.learnRF(function(k,g){if(k)b&&b(k);else{var h=[],l;for(l in g){var n=x.hub.m.hm._Device.resolve(g[l]);n&&(h=h.concat(n))}b&&b(k,h)}}):b&&b(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(b,k){var n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);n?n.learnRFSN(b,function(b,h){if(b)k&&k(b);else{var g=[],n;for(n in h){var m=x.hub.m.hm._Device.resolve(h[n]);m&&(g=g.concat(m))}k&&k(b,g)}}):k&&k(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(b,k,n){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);g?g.learnIP(b,k,function(b,g){if(b)n&&n(b);else{var h=[],k;for(k in g){var l=x.hub.m.hm._Device.resolve(g[k]);l&&(h=h.concat(l))}n&&n(b,h)}}):n&&n(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(b,k){var n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);n?n.learnIPQR(b,function(b,h){if(b)k&&k(b);else{var g=[],n;for(n in h){var m=x.hub.m.hm._Device.resolve(h[n]);m&&(g=g.concat(m))}k&&k(b,g)}}):k&&k(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var b=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!b)return[];b=b.getAllBufferedStates();var k=[],n;for(n in b){var g=b[n],h=x.hub.m.hm._Device.resolve(g.device);if(h)for(var l=0,q=h.length;l<q;l++){var m=h[l],r=m.parseStates(g.states);k.push({device:m,states:r})}}return k};
x.hub.m.hm.ChipManager.prototype.getConfig=function(b,k){if(b&&b.address)if(b=b.address.split("."),3>b.length)k&&k({error:Error("address invalid")});else{var n={type:b[0],interface:b[1],address:b[2]};b=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!b)return k&&k(Error("no chip monitor")),null;(n=x.hub.m.hm._Device.parseJson(n))?n.getConfig(b,k):k&&k(Error("unknow device"))}else k&&k(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype.setConfig=function(b,k,n){if(b&&b.address)if(b=b.address.split("."),3>b.length)n&&n({error:Error("address invalid")});else{var g={type:b[0],interface:b[1],address:b[2]};b=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!b)return n&&n(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.setConfig(b,k,n):n&&n(Error("unknow device"))}else n&&n(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype._onNewDevices=function(b){var k=[],n;for(n in b)if(b.hasOwnProperty(n)){var g=x.hub.m.hm._Device.resolve(b[n]);g&&0<g.length&&(g=g.filter(function(b){return b&&b.isButton()}),k=k.concat(g))}var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(h&&0<k.length){var l=0,q=function(){l++;l<k.length&&k[l].claimEvent(h,q)};k[l].claimEvent(h,q)}};
x.hub.m.hm.CCU2Discovery=function(){var b=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery");this._autoDiscoverTO=null;var k=this;this._hmHandlerCB=function(b,h){k._logger.log("debug","find ccu:"+b.uuid+"@"+b.ip+" from netif:"+h);k._searchCB&&k._searchCB(b,h);if(b.ip){var g=!1;k._searchTmpHMs.forEach(function(h){h.ip==b.ip&&(g=!0)});g||k._searchTmpHMs.push(b)}};this._searchCB=b;this._searchRunning=!1;this._searchTmpHMs=[];this._searchTmpCBs=[]};b.prototype.discover=
function(b){b&&-1==this._searchTmpCBs.indexOf(b)&&this._searchTmpCBs.push(b);if(!this._searchRunning){this._searchRunning=!0;this._searchTmpHMs=[];this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null);require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var k=this;setTimeout(function(){k._searchRunning=!1;k._autoDiscoverTO=setTimeout(function(){k.discover()},3E4);k._searchTmpCBs.forEach(function(b){b&&b(k._searchTmpHMs)});k._searchTmpCBs=[]},3E3)}};return b}();
x.hub.m.hm._Util={isDeviceJsonValid:function(b){return b&&b.type&&b.address&&b.interface},isGatewayJsonValid:function(b){return b&&b.ip},getDeviceHashCode:function(b){if(!b)return-1;var k=0;k=(k<<5)-k+this._getStringHashCode(b.type);k=(k<<5)-k+this._getStringHashCode(b.address);return k=(k<<5)-k+this._getStringHashCode(b.interface)},getGatewayHashCode:function(b){if(!b)return-1;var k=80;b.port&&((k=parseInt(b.port))||(k=80));var n=0;n=(n<<5)-n+this._getStringHashCode(b.ip);n=(n<<5)-n+k;n=(n<<5)-n+
this._getStringHashCode(b.uuid);n=(n<<5)-n+this._getStringHashCode(b.username);return n=(n<<5)-n+this._getStringHashCode(b.password)},getLocalIP:function(b,k){var n=function(b){return b?(b=b.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))?(+b[1]<<24)+(+b[2]<<16)+(+b[3]<<8)+ +b[4]:-1:-1};if("127.0.0.1"==k||"localhost"==k)return"127.0.0.1";var g=require("os").networkInterfaces(),h;for(h in g)if(g.hasOwnProperty(h))for(var l=g[h],q=0;q<l.length;q++){var m=l[q];if(m&&"IPv4"==m.family&&m.address){if(b==h||!b&&
!k)return m.address;if(!b&&m.netmask&&k){var r=n(m.netmask),p=n(m.address),v=n(k);if((p&r)==(v&r))return m.address}}}return null},getLocalMac:function(b){var k=require("os").networkInterfaces(),n;for(n in k)if(k.hasOwnProperty(n))for(var g=k[n],h=0;h<g.length;h++){var l=g[h];if(l&&"IPv4"==l.family&&l.address&&l.mac&&b==l.address)return l.mac}return"00:00:00:00:00:00"},isIP:function(b){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(b)},
mergeObj:function(b,k){var n={},g;for(g in b)b.hasOwnProperty(g)&&(n[g]=b[g]);for(g in k)k.hasOwnProperty(g)&&(n[g]=k[g]);return n},_getStringHashCode:function(b){var k=0,n;if("undefined"==typeof b||null==b)return-1;if(0===b.length)return k;var g=0;for(n=b.length;g<n;g++){var h=b.charCodeAt(g);k=(k<<5)-k+h}return k}};
x.hub.m.hm.UdpEventProducer=function(){var b=function(b){this._handler=b;this._pool={}};b.prototype.EVENT_TO=300;b.prototype.onEvent=function(b){if(b&&b.channel){var k=0,g=b.channel,h=g.indexOf(":");-1!=h&&(g=b.channel.substr(0,h),k=b.channel.substr(h+1));(h=this._pool[g])&&h.timeout&&clearTimeout(h.timeout);var l=this;h=setTimeout(function(){var b=l._pool[g];l._pool[g]=null;for(var h in b){var k=b[h];if(k=l._handler._chipManager.getBufferedStateLegacy(k.device,k.channel)){k._ver="v5+";var n=require("x.hub.eventbus.js");
n.emit("gatewayevent",k,{address:"HM"},"STA");n.emit("udpevent",k,"STA")}}},this.EVENT_TO);this._pool[g]||(this._pool[g]={});this._pool[g].timeout=h;this._pool[g][k]||(this._pool[g][k]=b)}};b.prototype.addSTAEvent=function(b){if(b&&b.adr){var k=(new Date).getTime(),g=b.adr,h=this._pool[g];h&&h.timeout&&clearTimeout(h.timeout);var l=this;h=setTimeout(function(){var b=l._pool[g];if(b&&b.states){var h=require("x.hub.eventbus.js");h.emit("gatewayevent",b.states,{address:"HM"},"STA");h.emit("udpevent",
b.states,"STA")}},this.EVENT_TO);this._pool[g]={states:b,timestamp:k,timeout:h}}};return b}();
x.hub.m.hm.Handler=function(){var b=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var b=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer(this);this._discoveryCB=function(k,g){b._onFindHM(k,g)};this._monitorManager=this._discovery=null;this._managers={};this._chipManager=this._xmlrpcServer=null};util.inherits(b,EventEmitter);b.prototype.CCU=x.hub.m.hm.CCU;b.prototype.XMLRPCClient=x.hub.m.hm.Client;b.prototype.init=function(b){var k=this;if(localStorage){var g=
!0;"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(g=!1);x.hub.m.hm.CCU_INIT_STATE=g}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(b){var g=!0;"false"==b&&(g=!1);x.hub.m.hm.CCU_INIT_STATE=g});this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB);this._monitorManager=new x.hub.m.hm.MonitorManager;this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT);this._xmlrpcServer.start(function(g){g?(k._logger.log("warn","start homematic local server error with port:"+
k._xmlrpcServer.getPort()),k._logger.log("warn",g.stack),b&&b({error:g})):k._monitorManager.init(k._xmlrpcServer,function(g){g?b&&b({error:g}):global&&global.HM_CHIP?k._initChipManager(function(g){b&&b({error:g})}):b&&b({})})})};b.prototype.getSystems=function(){return["hm"]};b.prototype.addStateDevice=function(b,n,g){if(b)if(b.gateway&&"mediola"!=b.gateway.uuid)if(b.gateway.ip&&x.hub.m.hm._Util.isIP(b.gateway.ip))if(x.hub.m.hm._Util.isIP(b.gateway.ip)){var h=this._getManager(b.gateway);h?h.addStateDevice(b,
function(b){n&&n({error:b})},g):(h=this._addManager(b.gateway),h.init(function(b){}),h.addStateDevice(b,function(b){n&&n({error:b})},g))}else this._logger.log("warn","ccu has ip:"+b.gateway.ip," , may not receive event from it."),n&&n({error:Error("gateway ip is url")});else n&&n({error:Error("gateway ip format invalid")});else n&&n();else n&&n({error:Error("device json format invalid")})};b.prototype.removeStateDevice=function(b,n,g){if(b)if(b.gateway&&"mediola"!=b.gateway.uuid)if(b.gateway.ip&&
x.hub.m.hm._Util.isIP(b.gateway.ip))if(x.hub.m.hm._Util.isIP(b.gateway.ip)){var h=this._getManager(b.gateway);h?h.removeStateDevice(b,function(b){n&&n({error:b})},g):n&&n({})}else this._logger.log("warn","ccu has ip:"+b.gateway.ip," , may not receive event from it."),n&&n({error:Error("gateway ip is url")});else n&&n({error:Error("gateway ip format invalid")});else n&&n();else n&&n({error:Error("device json format invalid")})};b.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():
[]};b.prototype.getStates=function(b){if(!(b&&x.hub.m.hm._Util.isDeviceJsonValid(b)&&b.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(b.gateway)))return null;var k=this._getManager(b.gateway);if(k)return k.getStates(b);k=this._addManager(b.gateway);k.init();return null};b.prototype.getState=function(b,n,g){if(!b)return g&&g({error:Error("device is null")}),null;if(!b.gateway||"mediola"==b.gateway.uuid){if(!this._chipManager){g&&g({error:Error("chip manager not inited")});return}return this._chipManager.getState(b,
{value:n},function(b,k){g&&g({error:b,data:k})})}if(!x.hub.m.hm._Util.isDeviceJsonValid(b)||!b.gateway||!x.hub.m.hm._Util.isGatewayJsonValid(b.gateway))return g&&g({error:Error("device json invalid")}),null;x.hub.m.hm.HM_MODULE.doStatus("xhub",b.gateway,b,{value:n},function(b,k){b?g&&g({error:b}):k?g&&g({data:{value:k.status}}):g&&g({error:Error("do status failed")})})};b.prototype.executeCommand=function(b,n,g){b?n?b.gateway&&"mediola"!=b.gateway.uuid?b.gateway?x.hub.m.hm.HM_MODULE.doCommand(b.gateway,
b,n,function(b){b?g&&g({error:b}):g&&g({})}):g&&g({error:Error("gateway is null")}):this._chipManager?this._chipManager.executeCommand(b,n,function(b){g&&g({error:b})}):g&&g({error:Error("chip manager not inited")}):g&&g({error:Error("command invalid")}):g&&g({error:Error("device is null")})};b.prototype.updateStates=function(b,n){if(b&&x.hub.m.hm._Util.isDeviceJsonValid(b)&&b.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(b.gateway)){var g=this._getManager(b.gateway);g?g.updateStates(b,function(b,
g){n&&n({error:b,data:g})}):(g=this._addManager(b.gateway),g.init(function(h){h?n&&n({error:h}):g.updateStates(b,function(b,g){n&&n({error:b,data:g})})}))}else n&&n({error:Error("device json format invalid")})};b.prototype.checkDeviceMatch=function(b,n){if(!(n&&n.device&&b&&b.device))return!1;if(n.gateway&&"mediola"!=n.gateway.uuid)return n=x.hub.m.hm._Util.getDeviceHashCode(n.device),b=x.hub.m.hm._Util.getDeviceHashCode(b.device),n==b;var g=b.device.address;b.device.interface&&b.device.type&&(g=
b.device.type+"."+b.device.interface+"."+b.device.address);return g!=n.device.address?!1:!0};b.prototype._initChipManager=function(b){var k="127.0.0.1";global&&global.HM_CHIP&&(k=global.HM_CHIP);this._chipManager=new x.hub.m.hm.ChipManager({ip:k,username:global.HM_CHIP_USERNAME,password:global.HM_CHIP_PASSWORD,uuid:"mediola"});this._chipManager.init(b)};b.prototype._initCCU3Manager=function(b){this._addManager({ip:"127.0.0.1",type:3}).init(function(k){b&&b(k)})};b.prototype._discover=function(b){this._discovery.discover(b)};
b.prototype._onFindHM=function(b,n){this._logger.log("debug","find ccu:"+b.uuid+"@"+b.ip+" from netif:"+n);this._monitorManager.onFindHomeMatic(b.ip,n,b.uuid)};b.prototype._getManager=function(b){b=x.hub.m.hm._Util.getGatewayHashCode(b);return this._managers[b]};b.prototype._addManager=function(b){var k=x.hub.m.hm._Util.getGatewayHashCode(b);b=new x.hub.m.hm.Manager(b);return this._managers[k]=b};b.prototype.onDeviceEvent=function(b,n){this._logger.log("trace","receive device event:"+JSON.stringify(b));
require("x.hub.eventbus.js");if(n)this._chipManager&&(this._chipManager.checkButtonEvent(b),this._udpEvtProducer.onEvent(b));else for(var g in this._managers)if(n=this._managers[g])try{n.onDeviceEvent(b)}catch(h){console.error(h.stack)}};b.prototype.resetChip=function(b){this._chipManager?this._chipManager.reset(function(){b&&b({})}):b&&b(Error("chip manager not inited"))};b.prototype.initManager=function(b,n){if(b){var g=this._getManager(b);g||(g=this._addManager(b));g.init(function(b){n&&n({error:b})})}else n&&
n({error:Error("gateway invalid")})};b.prototype.learnRFDevice=function(b,n){if(b){var g=this._getManager(b);g?g.learnRFDevice(function(b,g){n&&n({error:b,data:g})}):(g=this._addManager(b),g.init(function(b){b?n&&n({error:b}):setTimeout(function(){g.learnRFDevice(function(b,g){n&&n({error:b,data:g})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDevice(function(b,g){if(b)n&&n({error:b});else{var h=[];g.forEach(function(b){if(b){var g=b.toLegacyAdr();b=b.toLegacyType();h.push({address:g,
type:b})}});n&&n({data:h})}}):n&&n(Error("chip manager not inited"))};b.prototype.learnRFDeviceSN=function(b,n,g){if(b){var h=this._getManager(b);h?h.learnRFDevice(function(b,h){g&&g({error:b,data:h})}):(h=this._addManager(b),h.init(function(b){b?g&&g({error:b}):setTimeout(function(){h.learnRFDevice(function(b,h){g&&g({error:b,data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDeviceSN(n,function(b,h){if(b)g&&g({error:b});else{var k=[];h.forEach(function(b){if(b){var g=b.toLegacyAdr();
b=b.toLegacyType();k.push({address:g,type:b})}});g&&g({data:k})}}):g&&g(Error("chip manager not inited"))};b.prototype.learnIPDevice=function(b,n,g,h){if(b){var k=this._getManager(b);k?k.learnIPDevice(n,g,function(b,g){h&&h({error:b,data:g})}):(k=this._addManager(b),k.init(function(b){b?h&&h({error:b}):setTimeout(function(){k.learnIPDevice(n,g,function(b,g){h&&h({error:b,data:g})})},3E3)}))}else n?g?this._chipManager?this._chipManager.learnIPDevice(n,g,function(b,g){if(b)h&&h({error:b});else{var k=
[];g.forEach(function(b){if(b){var g=b.toLegacyAdr();b=b.toLegacyType();k.push({address:g,type:b})}});h&&h({data:k})}}):h&&h(Error("chip manager not inited")):h&&h({error:Error("key is null")}):h&&h({error:Error("sgtin is null")})};b.prototype.learnIPDeviceQR=function(b,n,g){if(n)if(b){var h=this._getManager(b);h?h.learnIPDeviceQR(n,function(b,h){g&&g({error:b,data:h})}):(h=this._addManager(b),h.init(function(b){b?g&&g({error:b}):setTimeout(function(){h.learnIPDeviceQR(n,function(b,h){g&&g({error:b,
data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnIPDeviceQR(n,function(b,h){if(b)g&&g({error:b});else{var k=[];h.forEach(function(b){if(b){var g=b.toLegacyAdr();b=b.toLegacyType();k.push({address:g,type:b})}});g&&g({data:k})}}):g&&g(Error("chip manager not inited"));else g&&g({error:Error("qrKey is null")})};b.prototype.deleteDevice=function(b,n,g){if(n){var h=n.split(".");3>h.length?g&&g({error:Error("address invalid")}):(n=h[1],h=h[2],b?g&&g({error:Error("not supported yet")}):
this._chipManager?this._chipManager.deleteDevice(n,h,function(b){g&&g({error:b})}):g&&g(Error("chip manager not inited")))}else g&&g({error:Error("address invalid")})};b.prototype.getRFInterfaces=function(b,n){if(b){var g=this._getManager(b);g?g.getRFInterfaces(function(b,g){n&&n({error:b,data:g})}):(g=this._addManager(b),g.init(function(b){b?n&&n({error:b}):setTimeout(function(){g.getRFInterfaces(function(b,g){n&&n({error:b,data:g})})},3E3)}))}else this._chipManager?this._chipManager.getRFInterfaces(function(b,
g){n&&n({error:b,data:g})}):n&&n(Error("chip manager not inited"))};b.prototype.executeCommandLegacy=function(b,n,g,h){b?h&&h({error:Error("not supported yet")}):this._chipManager?n?this.executeCommand({address:n},{value:g},function(b){h&&h({error:b?b.error:null})}):h&&h({error:Error("address invalid")}):h&&h({error:Error("chip manager not inited")})};b.prototype.getAllStatesLegacy=function(b){var k=[];try{this.getAllStates().forEach(function(b){if(b&&b.device&&b.states){var g={type:"HM",adr:b.device.toLegacyAdr(),
state:{}},l;for(l in b.states)g.state[l]=b.states[l].value;k.push(g)}})}catch(g){console.error(g.stack)}b&&b({data:k})};b.prototype.getConfig=function(b,n){b?b.gateway&&"mediola"!=b.gateway.uuid?n&&n({error:Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(b,function(b,h){n&&n({error:b,data:h})}):n&&n({error:Error("chip manager not inited")}):n&&n({error:Error("device is null")})};b.prototype.setConfig=function(b,n,g){b?b.gateway&&"mediola"!=b.gateway.uuid?g&&g({error:Error("not supported yet")}):
this._chipManager?this._chipManager.setConfig(b,n,function(b){g&&g({error:b})}):g&&g({error:Error("chip manager not inited")}):g&&g({error:Error("device is null")})};b.prototype.getMonitorStates=function(b){this._monitorManager.getMonitorStates(function(k,g){b&&b({error:k,data:g})})};b.prototype.getAllDevices=function(b){var k=[];try{this.getAllStates().forEach(function(b){b&&b.device&&b.states&&(b={type:"HM",address:b.device.toLegacyAdr(),data:b.device.toLegacyType(),snr:b.device.getSerial(),_ver:"v5+"},
k.push(b))})}catch(g){console.error(g.stack)}b&&b({data:k})};b.prototype.isWindowOpen=function(){try{for(var b=this.getAllStates(),n=0;n<b.length;n++){var g=b[n];if(g&&g.device&&g.states){var h=g.device.toLegacyType();if("window"==h){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("contact"==h){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("ip_contact"==h){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("ip_window"==h&&g.states.state&&"closed"!=
g.states.state.value)return!0}}}catch(l){return!1}};return b}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler);
