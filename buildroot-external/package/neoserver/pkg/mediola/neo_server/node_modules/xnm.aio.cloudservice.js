var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.cloudservice=xnm.aio.cloudservice||{};
xnm.aio.cloudservice.Ivideon=function(){var e=function(a,c,d,b){this._connectionID=a;this._camID=c;this._cloudService=d;this._format=b;this._jpegCam=null};e.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._camID};e.prototype.getLivePreview=function(a){var c=this.getBaseURL()+"/live_preview";this._cloudService.doEAPIRequest("ivideon","GET",c,null,null,function(c,b){a&&a(c,b)})};e.prototype.getLiveStream=function(a,c){var d=this.getBaseURL()+"/live_stream";a||(a={});a.format||
(a.format="hls");"string"!==typeof a.q&&"number"!==typeof a.q&&(a.q=1);this._cloudService.doEAPIRequest("ivideon","GET",d,a,null,function(b,a){c&&c(b,a)})};e.prototype.getArchiveStream=function(a,c){var d=this.getBaseURL()+"/record_stream";a||(a={});a.format||(a.format="hls");"string"!==typeof a.q&&"number"!==typeof a.q&&(a.q=1);this._cloudService.doEAPIRequest("ivideon","GET",d,a,null,function(b,a){if(b)c(b,a);else{var f=null;a&&"object"===typeof a&&(f=a.url);if("string"!==typeof f||0===f.length)b=
Error("Result did not contain an URL or it was an empty string: "+f);c(b,f)}})};e.prototype.getEvents=function(a,c){var d=this.getBaseURL()+"/events";a||(a={});a.limit||(a.limit=20);this._cloudService.doEAPIRequest("ivideon","POST",d,null,a,function(b,a){c&&c(b,a)})};e.prototype.getRecords=function(a,c){var d=this.getBaseURL()+"/records";this._cloudService.doEAPIRequest("ivideon","GET",d,a,null,function(b,a){c&&c(b,a)})};e.prototype.loadImage=function(a,c){var d=this;this._jpegCam?this._jpegCam.loadImage(function(b,
f){b?a&&a(b):b||!f||401!=f.statusCode||c?a&&a():(d._jpegCam=null,d.loadImage(a,!0))}):this.getLivePreview(function(b,f){!b&&f&&f.url&&f.token?(b="https://"+f.host+"/cameras/"+d._camID+"/live_preview",d._jpegCam=require("xnm.aio.cams.js").createJPEGCam(b,{headers:{Authorization:"Bearer "+f.token}}),d.loadImage(a,!0)):a&&a()})};e.parseJSON=function(a,c){return a&&a.connection&&a.id?new e(a.connection,a.id,c,a.format):null};return e}();
xnm.aio.cloudservice.Ring=function(){var e=function(a,c,d){this._connectionID=a;this._deviceID=c;this._cloudService=d;this._last_file_path=this._last_timestap=null};e.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._deviceID};e.prototype.getLastSnapshot=function(a){var c=this.getBaseURL()+"/last_snapshot";this._cloudService.doEAPIRequest("nuki","GET",c,null,null,function(c,b){a&&a(c,b)})};e.prototype.getEvents=function(a,c){var d=this.getBaseURL()+"/history";a||(a={});
a.limit||(a.limit=20);this._cloudService.doEAPIRequest("ring","POST",d,a,null,function(b,a){c&&c(b,a)})};e.prototype.getRecordStream=function(a,c){var d=this.getBaseURL()+"/record_stream";a||(a={});a.eventID?this._cloudService.doEAPIRequest("ring","GET",d,a,null,function(b,a){if(b)c(b,a);else{var f=null;a&&"object"===typeof a&&(f=a.url);if("string"!==typeof f||0===f.length)b=Error("Result did not contain an URL or it was an empty string: "+f);c(b,f)}}):c(Error("no eventID"))};e.prototype.loadImage=
function(a,c){var d=this;c=new Date;!this._last_timestap||6E4<=c-this._last_timestap?(this._last_file_path=this._last_timestap=null,this.getLastSnapshot(function(b,f){!b&&f&&f.url&&f.timestamp&&f.access_token?(d._last_timestap=timestamp,require("xnm.aio.cams.js").createJPEGCam(url,{headers:{Authorization:"Bearer "+f.access_token}}).loadImage(function(b,f){b?(d._last_file_path=b,a&&a(b,timestamp)):(d._last_timestap=null,a&&a())})):a&&a()})):a&&a(this._last_file_path,this._last_timestap)};return{parseJSON:function(a,
c){return a&&a.type&&a.connection&&a.id?"doorbell"==a.type?new e(a.connection,a.id,c,a.format):null:null}}}();
xnm.aio.cloudservice.CloudService=function(){var e=function(b){this._cloudservice=b};e.prototype.getRules=function(b){this._cloudservice._doJsonRequest("GET","/rules",null,null,b)};e.prototype.addRule=function(b,a){b?this._cloudservice._doJsonRequest("POST","/rules",null,b,a):a&&a(Error("rule is null"))};e.prototype.updateRule=function(b,a,c){b?a?this._cloudservice._doJsonRequest("POST","/rules/"+b,null,a,c):c&&c(Error("rule is null")):c&&c(Error("rule id is null"))};e.prototype.deleteRule=function(b,
a){b?this._cloudservice._doJsonRequest("POST","/rules/"+b,null,{},a):a&&a(Error("rule id is null"))};e.prototype.deleteRules=function(b,a){this._cloudservice._doJsonRequest("DELETE","/rules",b,null,a)};var a=function(b){this._cloudservice=b;this._version="v1"};a.prototype.disconenct=function(b,a,c){b?a?this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+b+"/disconnect",{id:a},null,function(b,a){c&&c(b,a)}):c&&c(Error("invalid connection id")):c&&c(Error("invalid module"))};a.prototype.getModuleConnectionInfo=
function(b,a,c){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+b+"/info/"+a,null,null,function(b,a){c(b,a)})};a.prototype.getModuleInfo=function(b,a){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+b+"/info",null,null,function(b,c){a(b,c)})};a.prototype.getModuleDevices=function(b,a){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+b+"/devices",null,null,function(b,c){a(b,c)})};a.prototype.getModuleStates=function(b,a){this._cloudservice._doJsonRequest("GET",
"/eapi/"+this._version+"/"+b+"/states",null,null,function(b,c){a(b,c)})};a.prototype.executeModuleCommand=function(b,a,c){this._cloudservice._doJsonRequest("POST","/eapi/"+this._version+"/"+b+"/command",null,a,function(b,a){c(b,a)})};a.prototype.doRequest=function(b,a,c,d,e,m){this._cloudservice._doJsonRequest(a,"/eapi/"+this._version+"/"+b+c,d,e,function(b,a){m(b,a)})};var c=function(b){this._cloudservice=b;this._version="v1"};c.prototype.getUserInfo=function(b){this._cloudservice._doJsonRequest("GET",
"/service/userInfo",null,null,function(a,c){b(a,c)})};c.prototype.getModulesInfo=function(b){this._cloudservice._doJsonRequest("GET","/service/moduleInfo",null,null,function(a,c){b(a,c)})};c.prototype.toCloudDevice=function(b,a){this._cloudservice._doJsonRequest("POST","/service/toCloudDevice",null,b,function(b,c){a(b,c)})};var d=function(b,d,h,l){this._logger=require("x.logger.js").getLogger("xnm.aio.cloudservice.CloudService");this._ip=b;this._ip||(this._ip="cloud.mediola.com");this._port=d;this._port||
(this._port=443);this._username=h;this._password=l;this._protocol="https";this._eapi=new a(this);this._ruleEngine=new e(this);this._service=new c(this)};d.prototype.getIP=function(){return this._ip};d.prototype.getPort=function(){return this._port};d.prototype.getUsername=function(){return this._password};d.prototype.getUserInfo=function(b){this._service.getUserInfo(b)};d.prototype.getModulesInfo=function(b){this._service.getModulesInfo(b)};d.prototype.toCloudDevice=function(b,a){this._service.toCloudDevice(b,
a)};d.prototype.doEAPIRequest=function(b,a,c,d,e,m){this._eapi.doRequest(b,a,c,d,e,m)};d.prototype.disconenct=function(b,a,c){this._eapi.disconenct(b,a,c)};d.prototype.getModuleConnectionInfo=function(b,a,c){this._eapi.getModuleConnectionInfo(b,a,c)};d.prototype.getModuleInfo=function(b,a){this._eapi.getModuleInfo(b,a)};d.prototype.getModuleDevices=function(b,a){this._eapi.getModuleDevices(b,a)};d.prototype.getModuleStates=function(b,a){this._eapi.getModuleStates(b,a)};d.prototype.executeModuleCommand=
function(b,a,c){this._eapi.executeModuleCommand(b,a,c)};d.prototype.getRules=function(b){this._ruleEngine.getRules(b)};d.prototype.addRule=function(b,a){this._ruleEngine.addRule(b,a)};d.prototype.updateRule=function(b,a,c){this._ruleEngine.updateRule(b,a,c)};d.prototype.deleteRule=function(b,a){this._ruleEngine.deleteRule(b,a)};d.prototype.deleteRules=function(b,a){this._ruleEngine.deleteRules(b,a)};d.prototype.getAccessToken=function(b,a,c){b={sid:b};a&&(b.force=1);this._doJsonRequest("GET","/getAccessToken",
b,null,function(a,b){a?c&&c(a):b?c&&c(null,b.at):c&&c(Error("invalid response"))})};d.prototype.executeCommandCreator=function(a,c,d){if(a&&a.module&&a.connection&&a.id)if(c&&c.value){var b={connection:a.connection,device:a.id,command:c.value};"undefined"!=typeof c.ext&&null!=c.ext&&(b.value=c.ext);this.executeModuleCommand(a.module,b,function(a){d&&d(a)})}else d&&d(Error("command json invalid"));else d&&d(Error("device json invalid"))};d.prototype.getStatesCreator=function(a,c,d){var b=this;a=function(a,
c){b.getModuleStates(a,function(b,d){c(b,d,a)})};var f=[],e;for(e=0;e<c.length;e++){var k=c[e];k&&k.device&&k.device.module&&-1==f.indexOf(k.device.module)&&f.push(k.device.module)}if(0==f.length)d&&d(null,[]);else{var h=0,p=[];for(e=0;e<f.length;e++)a(f[e],function(a,b,e){h++;var k=[];if(!a&&b)for(var m=0;m<c.length;m++){var n=c[m];if(n&&n.id&&n.device&&n.device.module==e){var g=null;if(n.device&&n.device.connection&&n.device.id&&n.status&&n.status.value){var l=b[n.device.connection];l&&l[n.device.id]&&
(l=l[n.device.id].states)&&(g=l[n.status.value])}if("undefined"==typeof g||null==g)g="?";p.push({id:n.id,status:g});k.push({id:n.id,status:g})}}"undefined"!=typeof commandhandler&&null!=commandhandler&&"undefined"!=typeof commandhandler.reportStates&&null!=commandhandler.reportStates&&!a&&k&&0<k.length&&commandhandler.reportStates(null,k);h==f.length&&d&&d(null,p)})}};d.prototype.getDeviceList=function(a,c){this.getModuleDevices(a,function(b,d){if(b)c(b);else{b=[];if(d)for(var f in d){var e=d[f],
k;for(k in e){var h=e[k];h&&(h.sys="cloudservice",h.module=a,h.connection=f,h.id=k,b.push(h))}}c(null,b)}})};d.prototype._doJsonRequest=function(a,c,d,e,g){var b=null;e&&(b=JSON.stringify(e));this._doRequest(a,c,d,b,function(a,b){a?g&&g(a):b?b.XC_ERR?(a=Error("error response:"+b.XC_ERR.msg),a.code=b.XC_ERR.code,g&&g(a)):b.XC_SUC?g&&g(null,b.XC_SUC):g&&g(Error("unknown response")):g&&g(Error("invalid response"))})};d.prototype._doRequest=function(a,c,d,e,g){c||(c="/");var b={};d&&(b=JSON.parse(JSON.stringify(d)));
d="";for(var f in b)b.hasOwnProperty(f)&&(d&&(d+="&"),d+=f+"="+encodeURIComponent(b[f]));d&&(c+="?"+d);a={host:this._ip,port:this._port,path:c,method:a,headers:{Connection:"close","Content-Type":"application/json; charset=UTF-8"}};if(this._username||this._password)a.auth=(this._username?this._username:"")+":"+(this._password?this._password:""),a.headers.Authorization="Basic "+(new Buffer((this._username?this._username:"")+":"+(this._password?this._password:""))).toString("base64");f=require(this._protocol);
"https"==this._protocol&&"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0");d=JSON.parse(JSON.stringify(a));d.headers&&(d.headers.auth&&(d.headers.auth="*********"),d.headers.Authorization&&(d.headers.Authorization="*********"));d.auth&&(d.auth="********");this._logger.log("trace","do request:"+JSON.stringify(d));var h=this,p=g,q=f.request(a,function(a){a.setEncoding("utf-8");var b="";a.on("data",function(a){b+=a});a.on("end",function(){h._logger.log("trace",
"receive code:"+a.statusCode+" headers:"+JSON.stringify(a.headers)+" response:"+b);if(200==a.statusCode)try{var c=b?JSON.parse(b):null}catch(r){var d=r}else d=Error("http reponse:"+a.statusCode);p&&(p(d,c,a.statusCode),p=null)})});if(q.on)q.on("error",function(a){h._logger.log("trace","do request error:"+a.message);p&&(p(a),p=null)});q.setTimeout&&q.setTimeout(2E4,function(){h._logger.log("trace","do request timeout");q.abort();p&&(p(Error("timeout")),p=null)});e&&(this._logger.log("trace","do request send body:"+
e),q.write(e));q.end()};d.prototype.toJSON=function(){return{sys:"cloudservice",username:this._username,password:this._password,ip:this._ip,port:this._port}};d.prototype.equalsTo=function(a){return a&&a instanceof d?this._ip==a._ip&&this._port==a._port&&this._username==a._username&&this._password==a._password:!1};d.parseJSON=function(a){return a&&a.username&&a.password?new d(a.ip,a.port,a.username,a.password):null};return d}();
xnm.aio.cloudservice.DM=function(){var e=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};e.prototype=Error();e.prototype.name="cloudserviceDMError";e.prototype.code=0;e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"cloudservice",getGatewayType:function(){return[{sys:this.SYS,name:"Cloud Service"}]},createGateway:function(a,c,d){c=e.ERROR_CODE;a?a.username?a.password?d(null,a):d(new e(c.INVALID,"password is invalid")):d(new e(c.INVALID,
"username is invalid")):d(new e(c.INVALID,"info is invalid"))},updateGateway:function(a,c,d,b){a=e.ERROR_CODE;c?c.username?c.password?b(null,c):b(new e(a.INVALID,"password is invalid")):b(new e(a.INVALID,"username is invalid")):b(new e(a.INVALID,"update is invalid"))},deleteGateway:function(a,c,d){d()},createDevice:function(a,c,d){var b=e.ERROR_CODE;if(a)if(a.connection)if(a.id)if(a.gateway){c=c.data.gateways;var f;for(f=0;f<c.length;f++)if(c[f].index===a.gateway){var h=c[f];break}h?d&&d(null,a):
d(new e(b.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new e(b.INVALID,"gateway is invalid"));else d(new e(b.INVALID,"id is invalid"));else d(new e(b.INVALID,"connection is invalid"));else d(new e(b.INVALID,"info is invalid"))},updateDevice:function(a,c,d){var b=e.ERROR_CODE;if(a)if(a.connection)if(a.id)if(a.gateway){c=c.data.gateways;var f;for(f=0;f<c.length;f++)if(c[f].index===a.gateway){var h=c[f];break}h?d(null,a):d(new e(b.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new e(b.INVALID,
"gateway is invalid"));else d(new e(b.INVALID,"id is invalid"));else d(new e(b.INVALID,"connection is invalid"));else d(new e(b.INVALID,"info is invalid"))},deleteDevice:function(a,c,d){d()},applyUIFilter:function(a,c,d){var b=this,f=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},e=function(a,b,c){var d=[];"command"==c.catagory?a.command&&a.command.forEach(function(a){f(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))}):"status"==c.catagory?
a.status&&a.status.forEach(function(a){f(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))}):"ipevt"==c.catagory&&a.status&&a.ipevt.forEach(function(a){f(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))});return d},l=function(a,c){var f=[],k=b.getCommandStatusMap(a,d);k&&(a=e(k,a,c),f=f.concat(a));return f};if(!a.sys)return null;var g=JSON.parse(JSON.stringify(a)),m=null;if("command"==c.catagory)m=l(a,c),g.command=m;else if("status"==c.catagory)m=l(a,c),g.status=m;else if("ipevt"==
c.catagory)m=l(a,c),g.ipevt=m;else return null;return m&&0!=m.length?g:null},applyIPEventFilter:function(a){return a?this.applyUIFilter(a,{catagory:"ipevt",elems:"*"}):null},getCommandStatusMap:function(a,c){if(!a)return null;c={command:[],status:[]};var d;if(a.commands)for(d in c.command=[],a.commands){var b=a.commands[d];if(b.values)c.command.push({type:"enum",name:d,ref:{value:d,ext:"%e",extMeta:b.values}});else if(b.value){switch(b.value.type){case "FLOAT":var f={type:"float",name:d,ref:{value:d,
ext:"%f"}};break;case "RGB":f={type:"rgb",name:d,ref:{value:d,ext:"%rgb"}};break;case "RGBW":f={type:"rgbw",name:d,ref:{value:d,ext:"%rgbw"}};break;default:f={type:"int",name:d,ref:{value:d,ext:"%d"}}}void 0!=b.value.min&&null!=b.value.min&&void 0!=b.value.max&&null!=b.value.max&&f&&(f.ref.extMeta=b.value.min+"-"+b.value.max);void 0!=b.value.step&&null!=b.value.step&&f&&(f.ref.scale=b.value.step);f&&c.command.push(f)}else c.command.push({type:"enum",name:d,ref:{value:d}})}if(a.states)for(d in c.status=
[],c.ipevt=[],a.states)if(b=a.states[d],b.values)0!=b.state&&c.status.push({type:"enum",name:d,ref:{value:d,options:b.values}}),0!=b.event&&c.ipevt.push({type:"enum",name:d,ref:{value:d,options:b.values}});else{switch(b.type){case "BOOL":f={type:"enum",name:d,ref:{value:d,options:["true","false"]}};break;case "FLOAT":f={type:"float",name:d,ref:{value:d}};break;case "RGB":f={type:"rgb",name:d,ref:{value:d}};break;case "RGBW":f={type:"rgbw",name:d,ref:{value:d}};break;case "STRING":f={type:"string",
name:d,ref:{value:d}};break;case "TIME":f={type:"int",name:d,ref:{value:d}};break;default:f={type:"int",name:d,ref:{value:d}}}void 0!=b.min&&null!=b.min&&void 0!=b.max&&null!=b.max&&f&&(f.ref.extMeta=b.min+"-"+b.max);void 0!=b.step&&null!=b.step&&f&&(f.ref.scale=b.step);f&&(0!=b.state&&c.status.push(f),0!=b.event&&c.ipevt.push(f))}return c},toGeneralDevice:function(a,c,d){if(!a||!a.module)return null;c=null;switch(a.module){case "hue":case "lightify":c={type:"dimmer",commands:{},states:{},details:{commands:{},
states:{}}};var b;if(a.commands)for(b in a.commands)switch(b){case "on":case "off":case "toggle":case "up":case "down":c.commands[b]={};c.details.commands[b]={value:b};break;case "brightness":case "colorTemperature":c.commands[b]={value:{type:"INT"}};c.details.commands[b]={value:b,ext:"%d"};a.commands[b]&&a.commands[b].value&&(d=a.commands[b].value,isNaN(d.min)||isNaN(d.max)||(c.commands[b].value.min=d.min,c.commands[b].value.max=d.max,c.details.commands[b].extMeta=d.min+"-"+d.max));break;case "color":c.commands[b]=
{value:{type:"RGB"}},c.details.commands[b]={value:b,ext:"%rgb"},c.commands.white={},c.details.commands.white={value:"color",ext:"FFFFFF"},a.commands[b]&&a.commands[b].value&&(d=a.commands[b].value,"RGBW"==d.type&&(c.commands[b].value.type="RGBW",c.details.commands[b].ext="%rgbw",c.details.commands.white={value:"color",ext:"FFFFFFFF"}))}if(a.states)for(b in a.states)switch(b){case "state":c.states.state={values:["on","off"]};c.details.states.state={value:"state"};break;case "brightness":c.states.brightness=
{value:{type:"INT",min:0,max:100}};c.details.states.brightness={value:"brightness",ext:"%d",extMeta:"0-100"};break;case "colorTemperature":c.states.colorTemperature={value:{type:"INT",min:154,max:500}};c.details.states.colorTemperature={value:"colorTemperature",ext:"%d",extMeta:"154-500"};break;case "color":c.states.color={type:"RGB"},c.details.states.color={value:"color",ext:"%rgb"},a.states[b]&&a.states[b].value&&(d=a.states[b].value,"RGBW"==d.type&&(c.states.color.type="RGBW",c.details.states.color.ext=
"%rgbw"))}break;case "somfy":c={type:"blind",commands:{},states:{},details:{commands:{},states:{}}};if(a.commands)for(b in a.commands)switch(b){case "open":case "close":c=null;break;case "stop":case "up":case "down":c.commands[b]={};c.details.commands[b]={value:b};break;case "position":case "rotation":c.commands[b]={value:{type:"INT",min:0,max:100}},c.details.commands[b]={value:b,ext:"%d"}}if(a.states)for(b in a.states)switch(b){case "position":case "rotation":c.states[b]={value:{type:"INT",min:0,
max:100}},c.details.states[b]={value:b,ext:"%d",extMeta:"0-100"}}}return c},supportSmartWidget:function(a,c){if(!a||!a.module)return!1;switch(a.module){case "netatmo":case "openweathermap":case "nuki":return!0;case "ring":return"doorbell"==a.type;default:return!1}},applySmartWidgetFilter:function(a,c,d,b,f){if(!c||!c.module)return null;var e=d=null,l=null,g=null;d=function(a,b){switch(a.module){case "netatmo":switch(a.type){case "NAMain":b.push("netatmo_basestation");break;case "NAModule1":case "NAModule4":b.push("climate");
b.push("notification");break;case "NAModule2":b.push("netatmo_wind");b.push("notification");break;case "NAModule3":b.push("netatmo_rain"),b.push("notification")}break;case "openweathermap":b.push("openweathermap");break;case "nuki":b.push("nuki");break;case "ring":switch(a.type){case "doorbell":b.push("motion")}}return b}(c,d?d:[]);e=function(a,b){switch(a.module){case "nuki":b["%unlock%"]={value:"unlock"},b["%lock%"]={value:"lock"},b["%open%"]={value:"lock_n_go"}}return b}(c,e?e:{});l=function(a,
b){switch(a.module){case "netatmo":switch(a.type){case "NAMain":b["%tempState%"]={value:"temperature"};b["%humState%"]={value:"humidity"};b["%co2State%"]={value:"co2"};b["%noiseState%"]={value:"noise"};b["%pressureState%"]={value:"pressure"};break;case "NAModule1":case "NAModule4":b["%tempState%"]={value:"temperature"};b["%humState%"]={value:"humidity"};b["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NAModule2":b["%windspeedState%"]={value:"wind_speed"};b["%windDirection%"]=
{value:"wind_direction"};b["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NAModule3":b["%rain%"]={value:"rain"},b["%rain_last_hour%"]={value:"rain_last_hour"},b["%rain_last_day%"]={value:"rain_last_day"},b["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}}}break;case "openweathermap":b["%tempState%"]={value:"temperature"};b["%humState%"]={value:"humidity"};b["%windspeedState%"]={value:"wind_speed"};b["%windDirection%"]={value:"wind_direction"};break;case "nuki":b["%lockStatus%"]=
{value:"state",conv_s:{locked:"locked",unlocked:"open"}};break;case "ring":switch(a.type){case "doorbell":b["%motionState%"]={value:"state",conv_s:{locked:"locked",unlocked:"open"}}}}return b}(c,l?l:{});g=function(a,b){return b}(c,g?g:{});return a._injectToSmartWidgetTemplate(b,d,f,e,l,g)}}}();
xnm.aio.cloudservice.Handler=function(){var e=function(){};e.prototype.devicemanager=xnm.aio.cloudservice.DM;e.prototype.CloudService=xnm.aio.cloudservice.CloudService;e.prototype.Ivideon=xnm.aio.cloudservice.Ivideon;e.prototype.Ring=xnm.aio.cloudservice.Ring;e.prototype.registModule=function(a){a.register("cloudservice","cloudservice")};e.prototype.resolveGateway=function(a){return a?this.CloudService.parseJSON(a):null};e.prototype.getDeviceCommands=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,
{catagory:"command",elems:"*"}))?a.command:[];c&&c(null,a)};e.prototype.getDeviceStatus=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];c&&c(null,a)};e.prototype.doCommand=function(a,c,d,b){(a=this.resolveGateway(a))?a.executeCommandCreator(c,d,function(a){b&&b(a)}):b&&b(Error("gateway json format invalid"))};e.prototype.doStatus=function(a,c,d,b,f){(c=this.resolveGateway(c))?c.getStatesCreator(null,[{id:a,device:d,status:b}],function(a,b){a?f&&f(a):
f&&f(null,b[0])}):f&&f(Error("gateway json format invalid"))};e.prototype.getUserInfo=function(a,c){(a=this.resolveGateway(a))?a.getUserInfo(function(a,b){c&&c(a,b)}):c&&c(Error("gateway json format invalid"))};e.prototype.getModulesInfo=function(a,c){(a=this.resolveGateway(a))?a.getModulesInfo(function(a,b){c&&c(a,b)}):c&&c(Error("gateway json format invalid"))};e.prototype.getDeviceList=function(a,c,d){c?(a=this.resolveGateway(a))?a.getDeviceList(c,function(a,c){d&&d(a,c)}):d&&d(Error("gateway json format invalid")):
d&&d(Error("module name invalid"))};e.prototype.getConnectionState=function(a,c,d,b){c?d?(a=this.resolveGateway(a))?a.getModuleConnectionInfo(c,d,function(a,c){b&&b(a,c)}):b&&b(Error("gateway json format invalid")):b&&b(Error("connection id invalid")):b&&b(Error("module name invalid"))};e.prototype.disconnect=function(a,c,d,b){c?d?(a=this.resolveGateway(a))?a.disconenct(c,d,function(a){b&&b(a)}):b&&b(Error("gateway json format invalid")):b&&b(Error("connection id invalid")):b&&b(Error("module name invalid"))};
return e}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.cloudservice.Handler);
