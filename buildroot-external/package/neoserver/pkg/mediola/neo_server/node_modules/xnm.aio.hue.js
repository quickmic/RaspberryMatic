var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,e={next:function(){if(b<a.length){var d=b++;return{value:c(d,a[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.hue=xnm.aio.hue||{};
xnm.aio.hue.Util={_HSVToRGB:function(a,c,b){var e=Math.floor(6*a),d=6*a-e;a=b*(1-c);var f=b*(1-d*c);c=b*(1-(1-d)*c);switch(e%6){case 0:var h=b;var g=c;var k=a;break;case 1:h=f;g=b;k=a;break;case 2:h=a;g=b;k=c;break;case 3:h=a;g=f;k=b;break;case 4:h=c;g=a;k=b;break;case 5:h=b,g=a,k=f}return[255*h,255*g,255*k]},_RGBToHex:function(a,c,b){for(a=a.toString(16);2>a.length;)a="0"+a;for(c=c.toString(16);2>c.length;)c="0"+c;for(b=b.toString(16);2>b.length;)b="0"+b;return(a+c+b).toUpperCase()}};
xnm.aio.hue.Bridge=function(a,c,b,e,d){this._logger=(e=require("x.logger.js"))?e.getLogger("xnm.aio.hue.Bridge"):{log:function(){}};this._USER="IQONTROLUser";d&&(this._USER=d);this.ip=a;this.port=c;this.uuid=b;this.CommandHandler=null};xnm.aio.hue.Bridge.prototype._RGBToHSV=function(a,c,b){a/=255;c/=255;b/=255;var e=Math.min(a,Math.min(c,b)),d=Math.max(a,Math.max(c,b));return e==d?[0,0,e]:[60*((a==e?3:b==e?1:5)-(a==e?c-b:b==e?a-c:b-a)/(d-e)),(d-e)/d,d]};
xnm.aio.hue.Bridge.prototype._RGBToXY=function(a,c,b){function e(a,b){return a[0]*b[1]-a[1]*b[0]}function d(a,b,c){return null!=a&&null!=b&&null!=c?(c=[c[0]-a[0],c[1]-a[1]],b=[b[0]-a[0],b[1]-a[1]],c=(c[0]*b[0]+c[1]*b[1])/(b[0]*b[0]+b[1]*b[1]),0>c?c=0:1<c&&(c=1),[a[0]+b[0]*c,a[1]+b[1]*c]):null}function f(a,b){var c=a[0]-b[0];a=a[1]-b[1];return Math.sqrt(c*c+a*a)}var h=[[.703,.296],[.214,.709],[.139,.081]],g=[[.674,.322],[.408,.517],[.168,.041]],k=[[.692,.308],[.17,.7],[.153,.048]],m=[[1,0],[0,1],[0,
0]],n="LLC001 LLC005 LLC006 LLC007 LLC010 LLC011 LLC012 LLC014 LLC013 LST001".split(" "),p="LCT001 LCT002 LCT003 LCT004 LLM001 LCT005 LCT006 LCT007".split(" "),l="LCT010 LCT011 LCT012 LCT014 LCT015 LCT016 LLC020 LST002".split(" "),u="HBL001 HBL002 HBL003 HIL001 HIL002 HEL001 HEL002".split(" ");return function(a,b,c,q){a/=255;b/=255;c/=255;a=.04045<a?Math.pow((a+.055)/1.055,2.4000000953674316):a/12.92;b=.04045<b?Math.pow((b+.055)/1.055,2.4000000953674316):b/12.92;var t=.04045<c?Math.pow((c+.055)/1.055,
2.4000000953674316):c/12.92;c=.664511*a+.154324*b+.162028*t;var r=.283881*a+.668433*b+.047685*t;a=8.8E-5*a+.07231*b+.986039*t;a=[c/(c+r+a),r/(c+r+a)];isNaN(a[0])&&(a[0]=0);isNaN(a[1])&&(a[1]=0);null==q&&(q=" ");q=-1==p.indexOf(q)&&-1==u.indexOf(q)?0<=n.indexOf(q)?h:0<=l.indexOf(q)?k:m:g;null!=a&&null!=q?(c=q[0],b=q[1],r=q[2],b=[b[0]-c[0],b[1]-c[1]],r=[r[0]-c[0],r[1]-c[1]],t=[a[0]-c[0],a[1]-c[1]],c=e(t,r)/e(b,r),b=e(b,t)/e(b,r),b=0<=c&&0<=b&&1>=c+b):b=!1;if(!b){c=d(q[0],q[1],a);b=d(q[2],q[0],a);q=
d(q[1],q[2],a);r=f(a,c);t=f(a,b);var w=f(a,q),v=r;t<r&&(v=t,c=b);w<v&&(c=q);a[0]=c[0];a[1]=c[1]}a[0]=Math.round(1E4*a[0])/1E4;a[1]=Math.round(1E4*a[1])/1E4;return a}(a,c,b)};
xnm.aio.hue.Bridge.prototype._doRequest=function(a,c,b,e){var d="/api/"+this._USER+c;c||(d="/api");d={host:this.ip,port:this.port,path:d,method:a,headers:{"Content-Type":'application/json; charset="UTF-8"',"User-Agent":"mediola",Connection:"close"}};var f=this,h=e;this._logger.log("trace","send '"+a+"' to "+this.ip+":"+this.port+"/api/xxxxxxxx"+(c?c:""));b&&this._logger.log("trace","with data: "+b);var g=require("http").request(d,function(a){if(200==a.statusCode){a.setEncoding("utf-8");var b="";a.on("data",
function(a){b+=a});a.on("end",function(){f._logger.log("trace","http response 200: "+b);var a={};try{var c=JSON.parse(b);c&&c[0]&&c[0].error?(a.error="unknown",1==c[0].error.type&&(a.error="unauthorized"),101==c[0].error.type&&(a.error="unpressed")):a.data=c}catch(l){}h&&(h(a),h=null)})}else f._logger.log("trace","http response "+a.statusCode),h&&(h(null),h=null)});g.setTimeout(1E3,function(){f._logger.log("trace","http request timeout");g.abort()});g.on("error",function(a){f._logger.log("trace",
"http request error:"+a.message);h&&(h(null),h=null)});b&&g.write(b);g.end()};
xnm.aio.hue.Bridge.prototype._doRequestForAuth=function(a,c,b,e){var d="/api/"+this._USER+c;c||(d="/api");a={host:this.ip,port:this.port,path:d,method:a,headers:{"Content-Type":'application/json; charset="UTF-8"',"User-Agent":"mediola",Connection:"close"}};this._logger.log("debug","do auth:"+JSON.stringify(a));var f=this,h=e,g=null,k=require("http").request(a,function(a){f._logger.log("trace","do auth return status:"+a.statusCode);g=a.statusCode;if(200==a.statusCode){a.setEncoding("utf-8");var b=
"";a.on("data",function(a){b+=a});a.on("end",function(){f._logger.log("trace","do auth return:"+b);var a={};try{var c=JSON.parse(b);c&&c[0]&&c[0].error?(a.error="unknown",1==c[0].error.type&&(a.error="unauthorized"),101==c[0].error.type&&(a.error="unpressed")):a.data=c}catch(u){}h&&(h(a),h=null)})}else XC.debugf("Failed to post request to "+f.ip),h&&(h(null),h=null)});k.setTimeout(1E3,function(){f._logger.log("trace","do auth timeout");k.abort()});k.on("error",function(a){g&&"ECONNRESET"==a.code?
f._logger.log("trace","do auth connection reset"):(f._logger.log("trace","do auth error:"+a.message),h&&(h(null),h=null))});b&&k.write(b);k.end()};xnm.aio.hue.Bridge.prototype.getLights=function(a){this._doRequest("GET","/lights",null,function(c){a&&a(c)})};
xnm.aio.hue.Bridge.prototype.executeCommand=function(a,c,b,e){"power"==c&&(c="toggle");if("ct"==a.channel||3<c.length&&"CT:"==c.substr(0,3)){var d=Math.floor(500-3.46*parseInt(c));3<c.length&&"CT:"==c.substr(0,3)&&(d=parseInt(c.substr(3)));500<d&&(d=500);154>d&&(d=154);this._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",'{"ct": '+d+', "on": true}',b)}else if("on"==c)this._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",JSON.stringify({on:!0}),
b);else if("off"==c)d={on:!1},a.manufacturer&&"osram"==a.manufacturer.toLowerCase()&&(d.transitiontime=0),this._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",JSON.stringify(d),b);else if("alertStop"==c||"alertOne"==c||"alertRepeat"==c)d="none","alertOne"==c?d="select":"alertRepeat"==c&&(d="lselect"),this._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",'{"alert": "'+d+'"}',b);else if("effectNone"==c||"effectColorloop"==c)d="none","effectColorloop"==
c&&(d="colorloop"),this._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",'{"effect": "'+d+'"}',b);else if("string"==typeof c&&"setscene"==c.substr(0,8))d=c.split("@"),2>d.length?b&&b():this._doRequest("PUT","/groups/"+a.address+"/action",'{"scene": "'+d[1]+'"}',b);else if("toggle"==c){var f=this;this._doRequest("GET",e?"/groups/"+a.address:"/lights/"+a.address,null,function(c){if(!c||c.error)b&&b(c);else if(c.data){if(a.type&&0==a.type.indexOf("On/Off"))c=c.data.state;
else if(e&&c.data.action&&null!=c.data.action.bri&&"undefined"!=typeof c.data.action.bri){var d=c.data.action.bri;c=c.data.action}else!e&&c.data.state&&null!=c.data.state.bri&&"undefined"!=typeof c.data.state.bri?(d=c.data.state.bri,c=c.data.state):(d=0,c={on:!1});var g={on:!0};a.type&&0==a.type.indexOf("On/Off")?c.on&&(g.on=!1):(c.on&&(g.on=!1,a.manufacturer&&"osram"==a.manufacturer.toLowerCase()&&(g.transitiontime=0)),g.on&&0==d&&(g.bri=10));d=JSON.stringify(g);f._doRequest("PUT",e?"/groups/"+a.address+
"/action":"/lights/"+a.address+"/state",d,b)}else b&&b({error:Error("no data field")})})}else if("up"==c||"down"==c)f=this,this._doRequest("GET",e?"/groups/"+a.address:"/lights/"+a.address,null,function(d){if(d&&d.error)b&&b(d);else{if(d&&d.data){var g=-1;e&&d.data.action&&null!=d.data.action.bri&&"undefined"!=typeof d.data.action.bri?g=d.data.action.bri:!e&&d.data.state&&null!=d.data.state.bri&&"undefined"!=typeof d.data.state.bri&&(g=d.data.state.bri);-1!=g&&(d=g,d="up"==c?Math.floor(d+25.4):Math.floor(d-
25.4),254<d&&(d=254),0>d&&(d=0),g='{"bri": '+d+', "on": true}',0==d&&(g='{"bri": '+d+', "on": false, "transitiontime":0}'),f._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",g,b),b=null)}b&&b()}});else if("string"==typeof c&&7<c.length&&"briRamp"==c.substr(0,7)){d=c.substr(7).split(":");var h=Math.floor(2.54*parseInt(d[0])),g=parseInt(d[1]);d=null;d=0==h?{on:!1,transitiontime:g}:{on:!0,bri:h,transitiontime:g};this._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+
a.address+"/state",JSON.stringify(d),b)}else if(6==c.length){var k=parseInt(c.substr(0,2),16),m=parseInt(c.substr(2,2),16),n=parseInt(c.substr(4,2),16);d=this._RGBToHSV(k,m,n);var p=Math.floor(d[0]/360*65535+3E3);65535<p&&(p=65535);0>p&&(p=0);var l=Math.floor(254*d[1]);254<l&&(l=254);0>l&&(l=0);f=this;this._doRequest("GET",e?"/groups/"+a.address:"/lights/"+a.address,null,function(c){if(c&&c.error)b&&b(c);else{if(c&&c.data){var d=-1;e&&c.data.action&&null!=c.data.action.bri&&"undefined"!=typeof c.data.action.bri?
d=c.data.action.bri:!e&&c.data.state&&null!=c.data.state.bri&&"undefined"!=typeof c.data.state.bri&&(d=c.data.state.bri);-1!=d&&(c.data.state&&"xy"==c.data.state.colormode?(c=f._RGBToXY(k,m,n),0==d&&(d=10),c=JSON.stringify({xy:c,on:!0,bri:d})):(c='{"hue": '+p+', "sat": '+l+', "on": true}',0==d&&(c='{"hue": '+p+', "sat": '+l+', "bri": 10, "on": true}')),f._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",c,b),b=null)}b&&b()}})}else 8==c.length?(p=Math.floor(parseInt(c.substr(0,
4),16)),l=Math.floor(parseInt(c.substr(4,2),16)),n=Math.floor(parseInt(c.substr(6,2),16)),this._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",'{"hue": '+p+', "sat": '+l+', "bri": '+n+', "on": true}',b)):(h=Math.floor(2.54*parseInt(c)),254<h&&(h=254),0>h&&(h=0),d='{"bri": '+h+', "on": true}',0==h&&(d='{"bri": '+h+', "on": false, "transitiontime":0}'),this._doRequest("PUT",e?"/groups/"+a.address+"/action":"/lights/"+a.address+"/state",d,b))};
xnm.aio.hue.Bridge.prototype.authorizeUser=function(a){this._doRequest("POST",null,'{"username": "'+this._USER+'", "devicetype": "IQONTROL"}',a)};
xnm.aio.hue.Bridge.prototype.getStates=function(a,c,b){var e=this;this.CommandHandler=a;this.getLights(function(a){if(a&&a.error&&"unauthorized"==a.error)b&&b("AUT");else if(a&&a.data&&a.data.XC_ERR)XC.debugf("[xnm.aio.hue.Bridge.getStates] "+JSON.stringify(a.data),"error"),b&&b("XC_ERR",a.data.XC_ERR);else{if(a&&a.data)if(c&&e.CommandHandler.setState)for(var d=0;d<c.length;d++){var h=c[d],g;if(a.data[h.address]&&(g=a.data[h.address].state)){var k=e.getStateValues(h.subtype,g),m;for(m in k)"state"==
m?e.CommandHandler.setState(h.id,k[m]):e.CommandHandler.setState(h.id+":"+m,k[m])}}else if(e.CommandHandler.receivedState)for(d in a.data)e.CommandHandler.receivedState("hue",d,a.data[d].state);b&&b("OK")}})};xnm.aio.hue.Bridge.prototype.getStateValues=function(a,c){a={};c.on?(a.state=""+Math.round(c.bri/2.54),1==c.bri&&(a.state="1"),a.power="on"):(a.state="0",a.power="off");c.ct&&(a.ct=""+c.ct);return a};
xnm.aio.hue.Discovery=function(){var a=function(){};a.prototype.discoverBridges=function(a){};return a}();xnm.aio.hue.Handler=function(){var a=require("x.logger.js");xnm.aio.hue.DM._logger=a?a.getLogger("xnm.aio.hue.DM"):{log:function(){}};this._logger=a?a.getLogger("xnm.aio.hue.Handler"):{log:function(){}};this.detectedBridges={}};
xnm.aio.hue.Handler.prototype.discoverBridges=function(a){var c=this;(function(a){var b=require("x.upnp.js");b&&b.discoverDevices(function(b){if("hue"==b.type){c._logger.log("trace","upnp find hue:"+b.ip+" uuid:"+b.uuid);var d=new xnm.aio.hue.Bridge(b.ip,80,b.uuid);c.detectedBridges[b.uuid]=d;a(d)}})})(a);(function(a){var b=function(a,c){var b="http://"+a+"/description.xml";(new (require("x.upnp.js").DescLoader)(a)).load(b,function(a,b){c&&c(a,b)})};(function(a){var b=a;$.ajax({url:"https://discovery.meethue.com",
type:"GET",timeout:3E3,dataType:"text",cache:!0,success:function(a){c._logger.log("trace","nupnp request success:"+a);try{var d=JSON.parse(a);b&&(b(null,d),b=null)}catch(k){b&&(b(k),b=null)}},error:function(a,d){a="nupnp request error:"+(a?a.status:"0")+"-"+d;c._logger.log("trace",a);b&&(b(Error(a)),b=null)}})})(function(d,e){if(!d&&e&&0!=e.length)for(d=0;d<e.length;d++)e[d]&&e[d].internalipaddress&&b(e[d].internalipaddress,function(b,d){!b&&d&&"hue"==d.type&&(c._logger.log("trace","nupnp find hue:"+
d.ip+" uuid:"+d.uuid),b=new xnm.aio.hue.Bridge(d.ip,80,d.uuid),c.detectedBridges[d.uuid]=b,a(b))})})})(a);(function(a){var b=function(a,c){var b="http://"+a+"/description.xml";(new (require("x.upnp.js").DescLoader)(a)).load(b,function(a,b){c&&c(a,b)})};(function(a){var b=a;$.ajax({url:"https://www.meethue.com/api/nupnp",type:"GET",timeout:3E3,dataType:"text",cache:!0,success:function(a){c._logger.log("trace","nupnp request success:"+a);try{var d=JSON.parse(a);b&&(b(null,d),b=null)}catch(k){b&&(b(k),
b=null)}},error:function(a,d){a="nupnp request error:"+(a?a.status:"0")+"-"+d;c._logger.log("trace",a);b&&(b(Error(a)),b=null)}})})(function(d,e){if(!d&&e&&0!=e.length)for(d=0;d<e.length;d++)e[d]&&e[d].internalipaddress&&b(e[d].internalipaddress,function(b,d){!b&&d&&"hue"==d.type&&(c._logger.log("trace","nupnp find hue:"+d.ip+" uuid:"+d.uuid),b=new xnm.aio.hue.Bridge(d.ip,80,d.uuid),c.detectedBridges[d.uuid]=b,a(b))})})})(a)};xnm.aio.hue.Handler.prototype._NUPnP=function(a){};
xnm.aio.hue.Handler.prototype.Bridge=xnm.aio.hue.Bridge;xnm.aio.hue.Handler.prototype.getStateValues=function(a,c){return(new xnm.aio.hue.Bridge).getStateValues(a.type,c)};
xnm.aio.hue.Handler.prototype.getDeviceCommandList=function(a,c){var b=[];if("rgb"==a.data||"colortemplight"==a.data)c||("rgb"==a.data?b.push({id:window.XC_Text.colorvalue+" (RGBA)",cmd:"colorvalue"}):"colortemplight"==a.data&&b.push({id:window.XC_Text.colorvalue,cmd:"colorvalue"})),b.push({id:window.XC_Text.on,cmd:"on"}),b.push({id:window.XC_Text.off,cmd:"off"});else if(b.push({id:window.XC_Text.on,cmd:"on"}),b.push({id:window.XC_Text.off,cmd:"off"}),"dimmer"==a.data&&!c)for(a=0;100>=a;a+=5)b.push({id:a+
"%",cmd:""+a});return b};xnm.aio.hue.Bridge.prototype.authorizeUser2=function(a){a.__count||(a.__count=0);var c=this;this._doRequestForAuth("POST",null,'{"devicetype": "mediola#user"}',function(b){b&&b.data&&b.data[0]&&b.data[0].success&&b.data[0].success.username?(b=b.data[0].success.username,a&&a(null,b)):50<=a.__count?(b=Error("push button error"),a&&a(b)):(a.__count++,setTimeout(function(){c.authorizeUser2(a)},500))})};
xnm.aio.hue.Bridge.prototype.getGroupStates=function(a,c,b){var e=this;this.CommandHandler=a;c&&0!=c.length?xnm.aio.hue.Group.getAllGroups(this,function(a,f){if(a&&1==a.error)b&&b("AUT");else{if(f)if(c&&e.CommandHandler.setState)for(a=0;a<c.length;a++)for(var d=c[a],g,k=0;k<f.length;k++){if(f[k]&&f[k]._meta&&f[k]._meta.action&&f[k]._address==d.address){g=f[k]._meta.action;g=e.getStateValues(d.subtype,g);for(var m in g)"state"==m?e.CommandHandler.setState(d.id,g[m]):e.CommandHandler.setState(d.id+
":"+m,g[m])}}else if(e.CommandHandler.receivedState)for(k=0;k<f.length;k++)f[k]&&f[k]._meta&&f[k]._meta.action&&f[k]._address&&e.CommandHandler.receivedState("hue",f[k]._address,f[k]._meta.action,!0);b&&b("OK")}}):b&&b("OK")};
xnm.aio.hue.Bridge.prototype.executeCommandCreator=function(a,c,b){if(a)if(c){var e=c.value;if("rgb"==e||"rgbS"==e||"hue"==e||"bri"==e)e=c.ext;else if("ct"==e){e=parseInt(c.ext);if(!(153<=e||500>=e)){b&&b(Error("ct command invalid"));return}153>e&&(e=153);500<e&&(e=500);e="CT:"+e}else if("alert"==e)switch(e=c.ext,e){case "stop":e="alertStop";break;case "one":e="alertOne";break;case "repeat":e="alertRepeat";break;default:b&&b(Error("alert command ext invalid"));return}else if("effect"==e)switch(e=
c.ext,e){case "none":e="effectNone";break;case "colorloop":e="effectColorloop";break;default:b&&b(Error("effect command ext invalid"));return}else if("setScene"==e){e=c.ext;if(!e){b&&b(Error("setScene command ext invalid"));return}e="setscene@"+e}else if("briRamp"==e){if(!c.ext||0==c.ext.length)return b&&b(Error("briRamp command ext invalid")),null;for(e=0;e<c.ext.length;e++){var d=c.ext[e];if(d)switch(d.value){case "bri":var f=d.ext;break;case "transtime":var h=d.ext}}if("undefined"==typeof f||null==
f||"undefined"==typeof h||null==h){b&&b(Error("briRamp command ext invalid"));return}e="briRamp"+f+":"+h}a.manufacturer=a.manufacturername;switch(a.category){case "light":this.executeCommand(a,e,function(a){if(a&&a.error){var c=Error(a.error);"unauthorized"==a.error&&(c.code=1,c.module=xnm.aio.hue.DM.SYS)}b&&b(c)});break;case "group":this.executeCommandGroup(a,e,function(a){if(a&&a.error){var c=Error(a.error);"unauthorized"==a.error&&(c.code=1,c.module=xnm.aio.hue.DM.SYS)}b&&b(c)});break;default:b&&
b(Error("no such category:"+a.category))}}else b&&b(Error("command is null"));else b&&b(Error("device is null"))};
xnm.aio.hue.Bridge.prototype.getStatesCreator=function(a,c,b){if(c){a=[];for(var e=[],d=0;d<c.length;d++){var f=c[d];"group"==f.device.category?e.push({id:f.id,address:f.device.address}):a.push({id:f.id,address:f.device.address})}var h=[];d={};var g=this;d.receivedState=function(a,b,d,e){d=g.getStateValues(0,d);for(a=0;a<c.length;a++)if(c[a]&&c[a].device&&c[a].device.address==b&&c[a].status&&(!e||"group"==c[a].device.category))if("power"==c[a].status.value&&null!==d.power&&"undefined"!=typeof d.power){var f=
{id:c[a].id,status:d.power};h.push(f)}else"brightness"==c[a].status.value&&null!==d.state&&"undefined"!=typeof d.state?(f={id:c[a].id,status:parseInt(d.state)},h.push(f)):"ct"==c[a].status.value&&null!==d.ct&&"undefined"!=typeof d.ct&&(f=parseInt(d.ct),153<=f||500>=f)&&(f={id:c[a].id,status:f},h.push(f))};var k=3,m=b;this.getStates(d,a,function(a){k--;"AUT"==a?(a=Error(a),a.code=1,a.module=xnm.aio.hue.DM.SYS,m&&m(a)):0==k&&(m&&m(null,h),m=null)});this.getGroupStates(d,e,function(a){k--;"AUT"==a?(a=
Error(a),a.code=1,a.module=xnm.aio.hue.DM.SYS,m&&m(a),m=null):0==k&&(m&&m(null,h),m=null)});xnm.aio.hue.Sensor._getAllSensors(this,function(a,b){k--;if(a)m&&m(a),m=null;else{if(b)for(a=0;a<c.length;a++)if(c[a]){var d=c[a].id,e=c[a].device,g=c[a].status;if(d&&g&&g.value&&e&&e.address&&"sensor"==e.category){var f=b[e.address];if(f&&(e=xnm.aio.hue.Sensor._parseSensor(e.address,f))&&(e=e.getStates())){g=e[g.value];if("undefined"==typeof g||null==g)g="?";h.push({id:d,status:g})}}}0==k&&(m&&m(null,h),m=
null)}})}else b&&b(Error("deviceList is null"))};xnm.aio.hue.Bridge.prototype.executeCommandGroup=function(a,c,b){this.executeCommand(a,c,b,!0)};xnm.aio.hue.Bridge.prototype.getAllGroups=function(a){xnm.aio.hue.Group.getAllGroups(this,a)};xnm.aio.hue.Bridge.prototype.toJSON=function(){return{sys:xnm.aio.hue.DM.SYS,ip:this.ip,port:this.port,uuid:this.uuid,username:this._USER}};
xnm.aio.hue.Bridge.prototype.equalsTo=function(a){return a&&a instanceof xnm.aio.hue.Bridge?this.ip==a.ip&&this.port==a.port:!1};xnm.aio.hue.Bridge.prototype.getAllStates=function(a){xnm.aio.hue.Light.getAllLights(this,function(a,b){});xnm.aio.hue.Group.getAllGroups(this,function(a,b){});xnm.aio.hue.Sensor.getAllSensors(this,function(a,b){})};
xnm.aio.hue.Light=function(){var a=function(c,b){this._category=a.CATEGORY;this._address=c;this._meta=b};a.CATEGORY="light";a.getAllLights=function(a,b){var c=this;a.getLights(function(a){if(a)if(a.error){var d=Error(a.error);"unauthorized"==a.error&&(d.code=1,d.module=xnm.aio.hue.DM.SYS);b&&b(d)}else a.data?b&&b(null,c.parseLights(a.data)):b&&b(null,[]);else b&&b(Error("hue request error"))})};a.parseLights=function(c){for(var b=[],e=Object.keys(c),d=0;d<e.length;d++){var f=new a(e[d],c[e[d]]);b.push(f)}return b};
a.prototype.getStates=function(){if(!this._meta)return null;var a={};if(this._meta.state){var b=a=this._meta.state;b.on?(a.state=""+Math.round(b.bri/2.54),1==b.bri&&(a.state="1"),a.power="on"):(a.state="0",a.power="off");b.ct&&(a.ct=b.ct);"undefined"!=typeof b.hue&&null!=b.hue&&"undefined"!=typeof b.sat&&null!=b.sat&&"undefined"!=typeof b.bri&&null!=b.bri&&(b=xnm.aio.hue.Util._HSVToRGB(b.hue/65535,b.sat/254,b.bri/254),a.rgb=xnm.aio.hue.Util._RGBToHex(Math.round(b[0]),Math.round(b[1]),Math.round(b[2])))}return a};
a.prototype.toJSON=function(){var a=JSON.parse(JSON.stringify(this._meta));a.sys=xnm.aio.hue.DM.SYS;a.category=this._category;a.address=this._address;return a};return a}();
xnm.aio.hue.Group=function(){var a=function(c,b){this._category=a.CATEGORY;this._address=c;this._meta=b};a.prototype.toJSON=function(){var a=JSON.parse(JSON.stringify(this._meta));a.sys=xnm.aio.hue.DM.SYS;a.category=this._category;a.address=this._address;return a};a.CATEGORY="group";a.getAllGroups=function(a,b){var c=this,d,f;this._getGroupWithID(a,0,function(e,g){e?b&&b(e):(f=g,c._getGroups(a,function(a,e){a?b&&b(a):(d=e?e:{},f&&(d["0"]=f),b&&b(null,c._parseGroupList(d)))}))})};a.createGroup=function(c,
b,e){if(b)if(b.name)if(b.lights)if(b.lights.length){var d=this;this._createGroup(c,b,function(b,h){b?e&&e(b):d._getGroupWithID(c,h,function(b,c){b?e&&e(b):(b=new a(h,c),e&&e(null,b))})})}else e&&e(Error("group lights is empty"));else e&&e(Error("group lights is invalid"));else e&&e(Error("group name is invalid"));else e&&e(Error("group is null"))};a._getGroups=function(a,b){a._doRequest("GET","/groups",null,function(a){if(a)if(a.error){var c=Error(a.error);"unauthorized"==a.error&&(c.code=1,c.module=
xnm.aio.hue.DM.SYS);b&&b(c)}else a.data?b&&b(null,a.data):b&&b(Error("heu response format invalid"));else b&&b(Error("hue request error"))})};a._getGroupWithID=function(a,b,e){a._doRequest("GET","/groups/"+b,null,function(a){if(a)if(a.error){var b=Error(a.error);"unauthorized"==a.error&&(b.code=1,b.module=xnm.aio.hue.DM.SYS);e&&e(b)}else a.data?e&&e(null,a.data):e&&e(Error("heu response format invalid"));else e&&e(Error("hue request error"))})};a._createGroup=function(a,b,e){a._doRequest("POST","/groups",
JSON.stringify({name:b.name,lights:b.lights}),function(a){if(a)if(a.error){var b=Error(a.error);"unauthorized"==a.error&&(b.code=1,b.module=xnm.aio.hue.DM.SYS);e&&e(b)}else a.data&&a.data[0]&&a.data[0].success&&a.data[0].success.id?(a=a.data[0].success.id,0==a.indexOf("/groups/")&&(a=a.substr(8)),e&&e(null,a)):e&&e(Error("heu response format invalid"));else e&&e(Error("hue request error"))})};a._parseGroupList=function(c){for(var b=[],e=Object.keys(c),d=0;d<e.length;d++){"0"==e[d]&&(c[e[d]].name=
"All Lights");var f=new a(e[d],c[e[d]]);b.push(f)}return b};return a}();xnm.aio.hue.Scene=function(){var a=function(){};a.getAllScenes=function(a,b){a._doRequest("GET","/scenes",null,function(a){if(a)if(a.error){var c=Error(a.error);"unauthorized"==a.error&&(c.code=1,c.module=xnm.aio.hue.DM.SYS);b&&b(c)}else a.data?b&&b(null,a.data):b&&b(Error("heu response format invalid"));else b&&b(Error("hue request error"))})};return a}();
xnm.aio.hue.Sensor=function(){var a=function(b,c){this._category=a.CATEGORY;this._address=b;this._meta=c};a.CATEGORY="sensor";a.getAllSensors=function(a,b){var c=this;this._getAllSensors(a,function(a,d){a?b&&b(a):b&&b(null,c._parseSensors(d))})};a._parseSensors=function(a){for(var b=[],c=Object.keys(a),d=0;d<c.length;d++){var e=this._parseSensor(c[d],a[c[d]]);e&&b.push(e)}return b};a._parseSensor=function(a,k){switch(k.type){case "Daylight":return new c(a,k);case "ZGPSwitch":return new b(a,k);case "ZLLSwitch":return new e(a,
k);case "ZLLPresence":return new d(a,k);case "ZLLTemperature":return new f(a,k);case "ZLLLightLevel":return new h(a,k);default:return null}};a._getAllSensors=function(a,b){a._doRequest("GET","/sensors",null,function(a){if(a)if(a.error){var c=Error(a.error);"unauthorized"==a.error&&(c.code=1,c.module=xnm.aio.hue.DM.SYS);b&&b(c)}else a.data?b&&b(null,a.data):b&&b(Error("hue response format invalid"));else b&&b(Error("hue request error"))})};a.prototype.getType=function(){return this._meta?this._meta.type:
null};a.prototype.getAddress=function(){return this._address};a.prototype.getStates=function(){return null};a.prototype.toJSON=function(){var a=JSON.parse(JSON.stringify(this._meta));a.sys=xnm.aio.hue.DM.SYS;a.category=this._category;a.address=this._address;return a};var c=function(b,c){a.call(this,b,c)};c.prototype=new a;c.prototype.constructor=c;c.prototype.getStates=function(){if(!this._meta)return null;var a={};this._meta.state&&(a.daylight=this._meta.state.daylight,a.ltime=this._meta.state.lastupdated);
return a};var b=function(b,c){a.call(this,b,c)};b.prototype=new a;b.prototype.constructor=b;b.prototype.getStates=function(){if(!this._meta)return null;var a={};if(this._meta.state){switch(this._meta.state.buttonevent){case 34:a.levent="Press_Button1";break;case 16:a.levent="Press_Button2";break;case 17:a.levent="Press_Button3";break;case 18:a.levent="Press_Button4"}a.ltime=this._meta.state.lastupdated}return a};var e=function(b,c){a.call(this,b,c)};e.prototype=new a;e.prototype.constructor=e;e.prototype.getStates=
function(){if(!this._meta)return null;var a={};if(this._meta.state){switch(this._meta.state.buttonevent){case 1E3:case 1001:case 1002:case 1003:a.levent="ON";break;case 2E3:case 2001:case 2002:case 2003:a.levent="DIM_UP";break;case 3E3:case 3001:case 3002:case 3003:a.levent="DIM_DOWN";break;case 4E3:case 4001:case 4002:case 4003:a.levent="OFF"}a.ltime=this._meta.state.lastupdated}return a};var d=function(b,c){a.call(this,b,c)};d.prototype=new a;d.prototype.constructor=d;d.prototype.getStates=function(){if(!this._meta)return null;
var a={};this._meta.state&&(a.motion=this._meta.state.presence,a.motion2=this._meta.state.presence?"on":"off",a.ltime=this._meta.state.lastupdated);this._meta.config&&(a.battery=this._meta.config.battery);return a};var f=function(b,c){a.call(this,b,c)};f.prototype=new a;f.prototype.constructor=f;f.prototype.getStates=function(){if(!this._meta)return null;var a={};this._meta.state&&(a.temperature=this._meta.state.temperature/100,a.ltime=this._meta.state.lastupdated);this._meta.config&&(a.battery=this._meta.config.battery);
return a};var h=function(b,c){a.call(this,b,c)};h.prototype=new a;h.prototype.constructor=h;h.prototype.getStates=function(){if(!this._meta)return null;var a={};this._meta.state&&(a.lightlevel=this._meta.state.lightlevel,a.dark=this._meta.state.dark,a.daylight=this._meta.state.daylight,a.ltime=this._meta.state.lastupdated);this._meta.config&&(a.battery=this._meta.config.battery);return a};return a}();
xnm.aio.hue.MAP={onoff:{command:[{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"alert",ref:{value:"alert",ext:"%e",extMeta:["stop","one","repeat"]}}],status:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}}]},dimmable:{command:[{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},{type:"int",name:"brightness",ref:{value:"bri",ext:"%d",extMeta:"0-100"}},
{type:"multi",name:"brightness (transition)",ref:{value:"briRamp",ext:"%multi",extMeta:[{type:"int",name:"brightness",ref:{value:"bri",ext:"%d",extMeta:"0-100"}},{type:"int",name:"transition time (100ms)",ref:{value:"transtime",ext:"%d",extMeta:"0-16343"}}]}}],status:[{type:"int",name:"brightness",ref:{value:"brightness",extMeta:"0-100"}}]},colortemp:{command:[{type:"int",name:"color temperature",ref:{value:"ct",ext:"%d",extMeta:"153-500",scale:"1"}}],status:[{type:"int",name:"color temperature",
ref:{value:"ct",extMeta:"153-500",scale:"1"}}]},colorlight:{command:[{type:"string",name:"rgb color",ref:{value:"rgbS",ext:"%s"}},{type:"rgb",name:"rgb color",ref:{value:"rgb",ext:"%s"}},{type:"enum",name:"effect",ref:{value:"effect",ext:"%e",extMeta:["none","colorloop"]}},{type:"string",name:"hsb color",ref:{value:"hue",ext:"%s"}}]},extendcolor:{},group:{command:[{type:"dynamic",name:"set scene",ref:{value:"setScene",ext:"%dynamic"}}]},sensor:{Daylight:{status:[{type:"enum",name:"day light",ref:{value:"daylight",
options:["true","fasle"]}},{type:"string",name:"last event time",ref:{value:"ltime"}}],ipevt:[{type:"enum",name:"event",ref:{value:"event",options:["sunrise","sunset"]}}]},ZGPSwitch:{status:[{type:"enum",name:"last event",ref:{value:"levent",options:["Press_Button1","Press_Button2","Press_Button3","Press_Button4"]}},{type:"string",name:"last event time",ref:{value:"ltime"}}],ipevt:[{type:"enum",name:"event",ref:{value:"levent",options:["Press_Button1","Press_Button2","Press_Button3","Press_Button4"]}}]},
ZLLSwitch:{status:[{type:"enum",name:"last event",ref:{value:"levent",options:["ON","DIM_UP","DIM_DOWN","OFF"]}},{type:"string",name:"last event time",ref:{value:"ltime"}}],ipevt:[{type:"enum",name:"event",ref:{value:"levent",options:["ON","DIM_UP","DIM_DOWN","OFF"]}}]},ZLLPresence:{status:[{type:"enum",name:"detect motion",ref:{value:"motion",options:["true","false"]}},{type:"string",name:"last event time",ref:{value:"ltime"}},{type:"int",name:"battery",ref:{value:"battery"}},{type:"enum",name:"detect motion (on/off)",
ref:{value:"motion2",options:["on","off"]}}],ipevt:[{type:"enum",name:"detect motion",ref:{value:"motion",options:["true","false"]}}]},ZLLTemperature:{status:[{type:"float",name:"temperature",ref:{value:"temperature"}},{type:"string",name:"last event time",ref:{value:"ltime"}},{type:"int",name:"battery",ref:{value:"battery"}}],ipevt:[{type:"float",name:"temperature",ref:{value:"temperature"}},{type:"int",name:"battery",ref:{value:"battery"}}]},ZLLLightLevel:{status:[{type:"int",name:"light level",
ref:{value:"lightlevel"}},{type:"enum",name:"dark",ref:{value:"dark",options:["true","false"]}},{type:"enum",name:"daylight",ref:{value:"daylight",options:["true","false"]}},{type:"string",name:"last event time",ref:{value:"ltime"}},{type:"int",name:"battery",ref:{value:"battery"}}],ipevt:[{type:"int",name:"light level",ref:{value:"lightlevel"}},{type:"enum",name:"dark",ref:{value:"dark",options:["true","false"]}},{type:"enum",name:"daylight",ref:{value:"daylight",options:["true","false"]}},{type:"int",
name:"battery",ref:{value:"battery"}}]}}};xnm.aio.hue.DMError=function(a,c){this.code=a;this.message=c;this.stack=Error().stack};xnm.aio.hue.DMError.prototype=Error();xnm.aio.hue.DMError.prototype.name="HUEDeviceManagerError";xnm.aio.hue.DMError.prototype.code=0;xnm.aio.hue.DMError.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};
xnm.aio.hue.DM={SYS:"hue",getGatewayType:function(){return[{sys:this.SYS,name:"Philips HUE"}]},createGateway:function(a,c,b){c=xnm.aio.hue.DMError;var e=xnm.aio.hue.DMError.ERROR_CODE;a?a.ip?b(null,a):b(new c(e.INVALID,"ip is invalid")):b(new c(e.INVALID,"info is invalid"))},updateGateway:function(a,c,b,e){a=xnm.aio.hue.DMError;b=xnm.aio.hue.DMError.ERROR_CODE;c?c.ip?e(null,c):e(new a(b.INVALID,"ip is invalid")):e(new a(b.INVALID,"update is invalid"))},deleteGateway:function(a,c,b){b()},createDevice:function(a,
c,b){var e=xnm.aio.hue.DMError,d=xnm.aio.hue.DMError.ERROR_CODE;if(a)if(a.gateway)if(null==a.address||"undefined"==typeof a.address)b(new e(d.INVALID,"address is invalid"));else if(a.category)if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=c.data.gateways;var f;for(f=0;f<c.length;f++)if(c[f].index===a.gateway){var h=c[f];break}h?b(null,a):b(new e(d.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else b(new e(d.NOT_FOUND,"gateway with index "+a.gateway+" not exists"));else b(new e(d.INVALID,
"catagory is invalid"));else b(new e(d.INVALID,"gateway is invalid"));else b(new e(d.INVALID,"info is invalid"))},updateDevice:function(a,c,b){var e=xnm.aio.hue.DMError,d=xnm.aio.hue.DMError.ERROR_CODE;if(a)if(null==a.address||"undefined"==typeof a.address)b(new e(d.INVALID,"address is invalid"));else if(a.category)if(a.gateway){c=c.data.gateways;var f;for(f=0;f<c.length;f++)if(c[f].index===a.gateway){var h=c[f];break}h?b(null,a):b(new e(d.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else b(new e(d.INVALID,
"gateway is invalid"));else b(new e(d.INVALID,"catagory is invalid"));else b(new e(d.INVALID,"info is invalid"))},deleteDevice:function(a,c,b){b()},applyUIFilter:function(a,c){var b=function(a,b){var c=[],d=[];a&&a.command&&0<a.command.length&&(c=c.concat(a.command));b&&b.command&&0<b.command.length&&(c=c.concat(b.command));a&&a.status&&0<a.status.length&&(d=d.concat(a.status));b&&b.status&&0<b.status.length&&(d=d.concat(b.status));return{command:c,status:d}},e=function(a,b){if("*"==a)return!0;for(var c=
!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},d=function(a,b,c){var d=[];switch(c.catagory){case "command":a.command&&a.command.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))});break;case "status":a.status&&a.status.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))})}return d},f=function(a,b){if(!a.type)return null;a=xnm.aio.hue.MAP.sensor[a.type];if(!a)return null;switch(b.catagory){case "command":return a.command;case "status":return a.status;
default:return null}},h=function(a,c){if("sensor"==a.category)return f(a,c);var e=[];if(!a.type)return null;var h=a.type.toLowerCase(),g=[];if(a.state||a.action){var k=a.state;if("room"==h||"lightgroup"==h||"luminaire"==h||"lightsource"==h)k=a.action;k&&(null!=k.on&&"undefined"!=typeof k.on&&(g=b(g,xnm.aio.hue.MAP.onoff)),null!=k.bri&&"undefined"!=typeof k.bri&&(g=b(g,xnm.aio.hue.MAP.dimmable)),null!=k.ct&&"undefined"!=typeof k.ct&&(g=b(g,xnm.aio.hue.MAP.colortemp)),null!=k.hue&&"undefined"!=typeof k.hue&&
(g=b(g,xnm.aio.hue.MAP.colorlight)),"room"==h||"lightgroup"==h||"luminaire"==h||"lightsource"==h)&&(g=b(g,xnm.aio.hue.MAP.group))}else switch(a.type.toLowerCase()){case "on/off light":case "on/off plug-in unit":g=xnm.aio.hue.MAP.onoff;break;case "dimmable light":case "dimmable plug-in unit":g=b(xnm.aio.hue.MAP.onoff,xnm.aio.hue.MAP.dimmable);break;case "color temperature light":g=b(xnm.aio.hue.MAP.onoff,xnm.aio.hue.MAP.colortemp);break;case "color light":g=b(b(xnm.aio.hue.MAP.onoff,xnm.aio.hue.MAP.dimmable),
xnm.aio.hue.MAP.colorlight);break;case "extended color light":case "lightgroup":case "luminaire":case "lightsource":if(g=b(b(b(xnm.aio.hue.MAP.onoff,xnm.aio.hue.MAP.dimmable),xnm.aio.hue.MAP.colortemp),xnm.aio.hue.MAP.colorlight),"lightgroup"==h||"luminaire"==h||"lightsource"==h)g=b(g,xnm.aio.hue.MAP.group)}g&&(a=d(g,a,c),e=e.concat(a));return e};if(!a.category)return null;var g=JSON.parse(JSON.stringify(a)),k=null;switch(c.catagory){case "command":k=h(a,c);g.command=k;break;case "status":k=h(a,c);
g.status=k;break;default:return null}return k&&0!=k.length?g:null},applyIPEventFilter:function(a,c){if(!a.sys||"sensor"!=a.category)return null;c=xnm.aio.hue.MAP.sensor[a.type];if(!c)return null;a=JSON.parse(JSON.stringify(a));a.ipevt=c.ipevt;return a},supportSmartWidget:function(a){if(!a||!a.type)return!1;if("ZLLPresence"==a.type)return!0;a=this.applyUIFilter(a,{catagory:"command",elems:"*"});if(!a||!a.command||0==a.command.length)return!1;for(var c=0;c<a.command.length;c++){var b=a.command[c];if(b&&
b.ref&&("on"==b.ref.value||"up"==b.ref.value||"ct"==b.ref.value||"rgb"==b.ref.value))return!0}return!1},applySmartWidgetFilter:function(a,c,b){if(!a||!a.type)return!1;var e=this.applyUIFilter(a,{catagory:"command",elems:"*"});if(!e||!e.command||0==e.command.length)return!1;for(var d=!1,f=!1,h=!1,g=!1,k=0;k<e.command.length;k++){var m=e.command[k];m&&m.ref&&("on"==m.ref.value&&(d=!0),"up"==m.ref.value&&(f=!0),"ct"==m.ref.value&&(h=!0),"rgb"==m.ref.value&&(g=!0))}var n;if("ZLLPresence"==a.type){var p=
{"%motionState%":{value:"motion2",options:["on","off"],name:"detect motion (on/off)"}};var l=["motion"]}d&&(n||(n={}),n["%on%"]||(n["%on%"]={value:"on",name:"on"}),n["%off%"]||(n["%off%"]={value:"off",name:"off"}),n["%toggle%"]||(n["%toggle%"]={value:"toggle",name:"toggle"}),p||(p={}),p["%switchState%"]||(p["%switchState%"]={value:"power",options:["off","on"],name:"power"}),l||(l=[]),-1==l.indexOf("switch")&&l.push("switch"));f&&(n||(n={}),n["%dimOn%"]||(n["%dimOn%"]={value:"on",name:"on"}),n["%dimOff%"]||
(n["%dimOff%"]={value:"off",name:"off"}),n["%dimUp%"]||(n["%dimUp%"]={value:"up",name:"up"}),n["%dimDown%"]||(n["%dimDown%"]={value:"down",name:"down"}),n["%dimTo%"]||(n["%dimTo%"]={value:"bri",ext:"%d",extMeta:"0-100",name:"brightness"}),p||(p={}),p["%dimmerState%"]||(p["%dimmerState%"]={value:"brightness",name:"brightness"}),l||(l=[]),-1==l.indexOf("dimmer")&&l.push("dimmer"));h&&(n||(n={}),n["%colorTemp%"]||(n["%colorTemp%"]={value:"ct",ext:"%d",extMeta:"153-500",name:"color temperature"}),l||
(l=[]),-1==l.indexOf("color_temp")&&l.push("color_temp"));g&&(n||(n={}),n["%rgb%"]||(n["%rgb%"]={value:"rgb",ext:"%s",name:"rgb color"}),n["%white%"]||(n["%white%"]={value:"rgbS",ext:"FFFFFF",name:"rgb color"}),l||(l=[]),-1==l.indexOf("rgb")&&l.push("rgb"));return l&&0!=l.length?this._injectToSmartWidgetTemplate(c,l,b,n,p):null},_injectToSmartWidgetTemplate:function(a,c,b,e,d){var f=[];a||(e={});e||(e={});d||(d={});for(var h=0;h<a.length;h++){var g=a[h];if(g.meta&&-1!=c.indexOf(g.meta.type)&&g.elements){g=
JSON.parse(JSON.stringify(g));var k=!1,m;for(m in g.elements){var n=g.elements[m];if(n&&Array.isArray(n))for(var p=0;p<n.length;p++){var l=n[p];l&&(l.action&&"command"==l.action.type&&l.action.ref&&l.action.ref.value&&(e[l.action.ref.value]?(l.action.ref=e[l.action.ref.value],l.action.device=b,k=!0):l.action=null),l.status&&l.status.ref&&l.status.ref.value&&(d[l.status.ref.value]?(l.status.ref=d[l.status.ref.value],l.status.device=b,k=!0):l.status=null))}}k&&f.push(g)}}return f}};
xnm.aio.hue.Handler.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"hue")};xnm.aio.hue.Handler.prototype.devicemanager=xnm.aio.hue.DM;xnm.aio.hue.Handler.prototype.Light=xnm.aio.hue.Light;xnm.aio.hue.Handler.prototype.Group=xnm.aio.hue.Group;xnm.aio.hue.Handler.prototype.Scene=xnm.aio.hue.Scene;xnm.aio.hue.Handler.prototype.Sensor=xnm.aio.hue.Sensor;
xnm.aio.hue.Handler.prototype.discoverBridgesWithTimeout=function(a,c){this._discoverCallbacks||(this._discoverCallbacks=[]);for(var b=!1,e=0;e<this._discoverCallbacks.length;e++)if(this._discoverCallbacks[e]===c){b=!0;break}b||this._discoverCallbacks.push(c);var d=this,f=[];10>=a&&(a=10);setTimeout(function(){if(null!=d._discoverCallbacks)for(var a=0;a<d._discoverCallbacks.length;a++)d._discoverCallbacks[a](null,f);d._discoverCallbacks=null},1E3*a);this.discoverBridges(function(a){if(a){for(var b=
0;b<f.length;b++)if(f[b].uuid==a.uuid)return;f.push(a)}})};xnm.aio.hue.Handler.prototype.auth=function(a,c){a.ip?(a=this.resolveGateway(a))?a.authorizeUser2(function(a,e){c&&c(a,e)}):c&&c(Error("gateway json format invalid")):c&&c(Error("bridge format invalid"))};
xnm.aio.hue.Handler.prototype.getDeviceList=function(a,c){if(a.ip)if(a=this.resolveGateway(a)){var b=3,e=[];xnm.aio.hue.Light.getAllLights(a,function(a,f){b--;f&&(e=e.concat(f));0==b&&c&&c(a,e)});xnm.aio.hue.Group.getAllGroups(a,function(a,f){b--;f&&(e=e.concat(f));0==b&&c&&c(a,e)});xnm.aio.hue.Sensor.getAllSensors(a,function(a,f){b--;f&&(e=e.concat(f));0==b&&c&&c(a,e)})}else c&&c(Error("gateway json format invalid"));else c&&c(Error("bridge format invalid"))};
xnm.aio.hue.Handler.prototype.createGroup=function(a,c,b){a.ip?(a=this.resolveGateway(a))?xnm.aio.hue.Group.createGroup(a,c,b):b&&b(Error("gateway json format invalid")):b&&b(Error("bridge format invalid"))};xnm.aio.hue.Handler.prototype.resolveGateway=function(a){return new xnm.aio.hue.Bridge(a.ip,a.port,a.uuid,null,a.username)};xnm.aio.hue.Handler.prototype.getDeviceCommands=function(a,c){a=(a=xnm.aio.hue.DM.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];c&&c(null,a)};
xnm.aio.hue.Handler.prototype.getDeviceStatus=function(a,c){a=(a=xnm.aio.hue.DM.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];c&&c(null,a)};xnm.aio.hue.Handler.prototype.getSceneCommands=function(a,c){a.ip?(a=this.resolveGateway(a))?xnm.aio.hue.Scene.getAllScenes(a,function(a,e){if(a)c&&c(a);else{a={};if(e)for(var b in e)e.hasOwnProperty(b)&&e[b]&&e[b].name&&(a[b]=e[b].name);c&&c(null,a)}}):c&&c(Error("gateway json format invalid")):c&&c(Error("bridge format invalid"))};
xnm.aio.hue.Handler.prototype.doCommand=function(a,c,b,e){(a=this.resolveGateway(a))?a.executeCommandCreator(c,b,function(a){e&&e(a)}):e&&e(Error("gateway json format invalid"))};xnm.aio.hue.Handler.prototype.doStatus=function(a,c,b,e,d){(c=this.resolveGateway(c))?c.getStatesCreator(null,[{id:a,device:b,status:e}],function(a,b){a?d&&d(a):d&&d(null,b[0])}):d&&d(Error("gateway json format invalid"))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.hue.Handler);
